CR.Settings={_initialized:false,_saveInterval:1000*30,_saveIntervalServer:60000*60,_userSettingsDirty:false,_userSettingsSaving:false,_userSettingsLoaded:false,_events:new Ext.util.Observable(),on:function(){CR.Settings._events.on.apply(CR.Settings._events,arguments);},un:function(){CR.Settings._events.un.apply(CR.Settings._events,arguments);},initialize:function(){if(!CR.Settings._initialized){CR.Settings._userSettingsDirty=false;CR.Settings._userSettingsSaving=false;CR.Settings._userSettingsLoaded=false;window.setTimeout(CR.Settings._saveSettingsLocal,CR.Settings._saveInterval);window.setTimeout(CR.Settings._saveSettingsServer,CR.Settings._saveIntervalServer);window.addEventListener("beforeunload",function(){if(CR.Settings._userSettingsDirtyServer&&!CR.Settings._userSettingsSavingServer){CR.Settings.saveCurrentUserSettings({saveToDB:true});}});CR.Settings._initialized=true;}},reset:function(){window.removeEventListener("beforeunload",CR.Settings._saveBeforeUnload);CR.Settings._initialized=false;},_saveSettingsLocal:function(){if(CR.Settings._initialized){if(CR.Settings._userSettingsDirty&&!CR.Settings._userSettingsSaving&&(CR.Login.userName==="admin"||CR.Settings._userSettingsLoaded)){CR.Settings.saveCurrentUserSettings({saveToDB:false,callbackFunction:function(){window.setTimeout(CR.Settings._saveSettingsLocal,CR.Settings._saveInterval);}});}else{window.setTimeout(CR.Settings._saveSettingsLocal,CR.Settings._saveInterval);}}},_saveSettingsServer:function(){if(CR.Settings._initialized){if(CR.Settings._userSettingsDirtyServer&&!CR.Settings._userSettingsSavingServer&&CR.Settings._userSettingsLoaded){CR.Settings.saveCurrentUserSettings({saveToDB:true,callbackFunction:function(){window.setTimeout(CR.Settings._saveSettingsServer,CR.Settings._saveIntervalServer);}});}else{window.setTimeout(CR.Settings._saveSettingsServer,CR.Settings._saveIntervalServer);}}},_saveBeforeUnload:function(){if(CR.Settings._initialized&&CR.Settings._userSettingsLoaded){CR.Settings.saveCurrentUserSettings({saveToDB:true});}},parseUserInterfaceResponse:function(h){var b=CR.Storage.getItemJSON("userSettings",{});CR.Settings._userSettings=b;CR.Settings._userSettingsLoaded=true;if(CR.Login.userName==="admin"){CR.Settings._events.fireEvent("loaded","user");}else{if(h){if(h.userInterfaceSettingsForUser){var g=h.userInterfaceSettingsForUser;if(g){var f=CR.Settings._xmlSettingsToJSON(g);var a=b.__lastModified__||0;var d=f.__lastModified__||0;if(d>=a){CR.Settings._userSettings=f;}else{CR.Settings._userSettingsDirtyServer=true;CR.Settings.saveCurrentUserSettings({saveToDB:true});}CR.Settings._events.fireEvent("loaded","user");}}if(h.userInterfaceSettingsForRole){var c=h.userInterfaceSettingsForRole;if(c){CR.Settings._roleSettings=CR.Settings._xmlSettingsToJSON(c);CR.Settings._events.fireEvent("loaded","role");}}CR.Settings._userSettingsDirtyServer=false;}}},loadSettings:function(c){c=Ext.apply({callbackFunction:CR.Core.emptyFunction,callbackScope:this},c);var b=new CR.XML();var g=b.addContainer(b.getRootElement(),"sequence");var f=b.addContainer(g,"transaction");var d=b.addContainer(f,"step");var a=b.addContainer(d,"userInterface");b.addOption(a,"operation","VIEW_LOGON_VALUES");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),scope:c.callbackScope,crOverride:{},crMask:{suppress:true},success:function(i){var m=null;var k="failed";var j=[];var h=CR.JSON.parse(i.responseText);var l=h.query;if(l){Ext.each(l.sequence,function(n){Ext.each(n.transaction,function(o){k=o.$attr.result;Ext.each(o.exception,function(p){j.push(p.message);});Ext.each(o.step,function(p){if(p.tranResult&&p.tranResult.category&&p.tranResult.category.option&&p.tranResult.category.option==="E"){j.push(p.tranResult.description);}else{if(p.userInterface){m=p.userInterface;}}});});});}if(k!=="posted"||j.length>0){CR.Core.displayExceptions({items:j});}else{if(m){CR.Settings.parseUserInterfaceResponse(m);}else{c.callbackFunction.call(c.callbackScope);}}}});},saveRoleSettings:function(b){b=Ext.apply({roleSettings:{},roleSerial:null,roleDescription:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},b);if(!b.roleSerial){if(b.roleDescription){CR.Core.recordSearch({search:{tableName:"ROLE",filterName:"BY_EXACT_DESCRIPTION",returnLimit:"1",parameter:[{columnName:"DESCRIPTION",contents:b.roleDescription}]},callbackFunction:function(d){if(d.record){b.roleSerial=d.record["SERIAL"];CR.Settings.saveRoleSettings(b);}}});}else{CR.Settings.getUserRole({callbackFunction:function(d){if(d){b.roleSerial=d;CR.Settings.saveRoleSettings(b);}}});}return;}var c=b.roleSettings;if(typeof b.roleSettings==="object"){c=CR.JSON.stringify(b.roleSettings);}var a='<settings type="JSON" version="1">'+"<![CDATA["+c+"]]>"+"</settings>";CR.Core.recordUpdate({tableName:"ROLE",targetSerial:b.roleSerial,displayExceptions:true,fields:[{columnName:"USER_INTERFACE_SETTINGS",newContents:a}],callbackFunction:function(){b.callbackFunction.call(b.callbackScope,b.roleSettings);}});},getUserRole:function(a){a=Ext.apply({userSerial:CR.Login.userSerial,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);CR.Core.recordView({tableName:"USER",targetSerial:a.userSerial,callbackFunction:function(b){if(b.record){if(CR.Core.isLiveDatabase()){a.roleSerial=b.record["ROLE_SERIAL"];}else{a.roleSerial=b.record["TEST_ROLE_SERIAL"]||b.record["ROLE_SERIAL"];}a.callbackFunction.call(a.callbackScope,a.roleSerial);}}});},getRoleSettings:function(a){a=Ext.apply({roleSerial:null,roleDescription:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);if(!a.roleSerial){if(a.roleDescription){CR.Core.recordSearch({search:{tableName:"ROLE",filterName:"BY_EXACT_DESCRIPTION",returnLimit:"1",parameter:[{columnName:"DESCRIPTION",contents:a.roleDescription}]},callbackFunction:function(b){if(b.record&&b.record["SERIAL"]){a.roleSerial=b.record["SERIAL"];CR.Settings.getRoleSettings(a);}}});}else{CR.Settings.getUserRole({callbackFunction:function(b){if(b){a.roleSerial=b;CR.Settings.getRoleSettings(a);}}});}return;}CR.Core.recordView({tableName:"ROLE",targetSerial:a.roleSerial,displayExceptions:true,fields:[{columnName:"USER_INTERFACE_SETTINGS"}],callbackFunction:function(b){var c={};if(b.record&&b.record["USER_INTERFACE_SETTINGS"]){try{c=CR.Settings._xmlSettingsToJSON(b.record["USER_INTERFACE_SETTINGS"]);}catch(d){}}a.callbackFunction.call(a.callbackScope,c||{});}});},setRoleSetting:function(a){a=Ext.apply({roleSerial:null,key:null,value:undefined,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);var b=a.key;var c=a.value;if(!b||typeof b!=="string"){return;}CR.Settings.getRoleSettings({roleSerial:a.roleSerial,callbackFunction:function(d){if(typeof c==="undefined"){delete d[b];}else{d[b]=c;}CR.Settings.saveRoleSettings({roleSerial:a.roleSerial,roleSettings:d,callbackFunction:function(f){a.callbackFunction.call(a.callbackScope,f);}});}});},getCurrentRoleSettings:function(c){if(!CR.Settings._roleSettings){CR.Settings._roleSettings={};}var a=CR.Settings._roleSettings;if(c){try{a=CR.JSON.stringify(CR.Settings._roleSettings);}catch(b){console.warn("CR.Settings.getCurrentRoleSettings: unable to stringify role settings",CR.Settings._roleSettings);CR.Settings._roleSettings={};a=CR.JSON.stringify(CR.Settings._roleSettings);}}return a;},getCurrentRoleSetting:function(b,a){var d=a;if(!b||typeof b!=="string"){return;}var c=CR.Settings.getCurrentRoleSettings();d=CR.Settings._get(c,b,d);return d;},setCurrentRoleSettings:function(a){CR.Settings._roleSettings=a;},setCurrentRoleSetting:function(b,d){if(!b||typeof b!=="string"){return;}var a=CR.Settings.getCurrentRoleSetting(b);var c=CR.Settings.getCurrentRoleSettings();var f=CR.Settings._set(c,b,d);if(f&&d!==a){CR.Settings._roleSettingsDirty=true;CR.Settings._events.fireEvent(b,b,d,a,"role");CR.Settings._events.fireEvent("change",b,d,a,"role");}return f;},saveCurrentUserSettings:function(d){d=Ext.apply({saveToDB:true,callbackFunction:CR.Core.emptyFunction,callbackScope:this},d);CR.Settings._userSettingsSaving=true;CR.Storage.setItemJSON("userSettings",CR.Settings.getUserSettings());CR.Settings._userSettingsDirty=false;CR.Settings._userSettingsSaving=false;if(!d.saveToDB||CR.Login.userName==="admin"){CR.Settings._events.fireEvent("saved","user");d.callbackFunction.call(d.callbackScope);}else{if(CR.Settings._userSettingsDirtyServer){var c=new CR.XML();var h=c.addContainer(c.getRootElement(),"sequence");var g=c.addContainer(h,"transaction");var f=c.addContainer(g,"step");var a=c.addContainer(f,"userInterface");c.setAttribute(a,"label","userInterface");c.addOption(a,"operation","UPDATE_USER_INTERFACE_SETTINGS_FOR_USER");var b='<settings type="JSON" version="1">'+"<![CDATA["+CR.Settings.getUserSettings(true)+"]]>"+"</settings>";c.addText(a,"userInterfaceSettingsForUser",b);CR.Settings._userSettingsSavingServer=true;CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:c.getXMLDocument(),success:function(j){var l="failed";var k=[];var i=CR.JSON.parse(j.responseText);var m=i.query;if(m){Ext.each(m.sequence,function(n){Ext.each(n.transaction,function(o){l=o.$attr.result;Ext.each(o.exception,function(p){k.push(p.message);});Ext.each(o.step,function(p){if(p.tranResult&&p.tranResult.category&&p.tranResult.category.option&&p.tranResult.category.option==="E"){k.push(p.tranResult.description);}});});});}if((l!=="posted"&&l!=="verified")||k.length>0){console.warn("CR.Settings.saveCurrentUserSettings: unable to store Settings for current user.",k);}else{CR.Settings._userSettingsDirtyServer=false;CR.Settings._events.fireEvent("saved","user");}CR.Settings._userSettingsSavingServer=false;d.callbackFunction.call(d.callbackScope);},failure:function(){CR.Settings._userSettingsSavingServer=false;console.warn("CR.Settings.saveCurrentUserSettings: unable to store Settings for current user. HTTP STATUS",xhr.status);}});}else{CR.Settings._events.fireEvent("saved","user");d.callbackFunction.call(d.callbackScope);}}},clearCurrentUserSettings:function(){CR.Settings._userSettings={};CR.Settings.saveCurrentUserSettings();},getUserSettings:function(c){if(!CR.Settings._userSettings){CR.Settings._userSettings={};}var a=CR.Settings._userSettings;if(c){try{a=CR.JSON.stringify(CR.Settings._userSettings);}catch(b){console.warn("CR.Settings.getUserSettings: unable to stringify user settings",CR.Settings._userSettings);CR.Settings._userSettings={};a=CR.JSON.stringify(CR.Settings._userSettings);}}return a;},getUserSetting:function(c,b){if(!c||typeof c!=="string"){return;}var h=b;var a=false;var g=CR.Settings.getUserSettings();var d=CR.Settings.getCurrentRoleSettings();if(CR.Settings._has(g,c)){h=CR.Settings._get(g,c,h);a=true;}else{if(CR.Settings._has(d,c)){h=CR.Settings._get(d,c,h);a=true;}}if(!a){var f=CR.Storage.getItem(c);if(f!==null&&f!=="null"){try{f=CR.JSON.parse(f);}catch(i){}h=f;CR.Settings._set(g,c,h);}}return h;},setUserSetting:function(b,f){if(!b||typeof b!=="string"){return;}var a=CR.Settings.getUserSetting(b);var d=CR.Settings.getUserSettings();var g=CR.Settings._set(d,b,f);if(g){var c=false;if(typeof f==="object"&&typeof a==="object"){try{c=CR.JSON.stringify(f)===CR.JSON.stringify(a);}catch(h){if(window.CRDebug===true){console.warn("CR.Settings.setUserSetting: unable compare values",h);}}}if(c||f!==a){d.__lastModified__=Date.now();CR.Settings._userSettingsDirty=true;CR.Settings._userSettingsDirtyServer=true;CR.Settings._events.fireEvent(b,b,f,a,"user");CR.Settings._events.fireEvent("change",b,f,a,"user");}}return g;},getDeviceSetting:function(c,b){if(!c||typeof c!=="string"){return;}var g=b;var a=false;var f=CR.Settings.getUserSettings();var i=c+"."+"DEVICE:"+CR.Login.deviceSerial;if(CR.Settings._has(f,i)){g=CR.Settings._get(f,i,g);a=true;}if(!a){var d=CR.Storage.getItem(c);if(d!==null&&d!=="null"){try{d=CR.JSON.parse(d);}catch(h){}g=d;CR.Settings._set(f,i,g);}}return g;},setDeviceSetting:function(a,b){if(!a||typeof a!=="string"){return;}var c="DEVICE:"+CR.Login.deviceSerial;return CR.Settings.setUserSetting(a+"."+c,b);},_xmlSettingsToJSON:function(a){var f={};try{var c=new CR.XML({xmlText:a});var g=c.getRootElement();if(g.nodeName==="settings"){var d=g.getAttribute("type");var i=g.getAttribute("version");if(d==="JSON"){var h=c.getText(g);f=CR.JSON.parse(h);}else{console.warn("CR.Settings._xmlSettingsToJSON: unable to parse User Interface settings",g);}}}catch(b){console.error("CR.Settings._xmlSettingsToJSON: unable to parse User Interface settings",g);}return f;},_canBeJSON:function(b){var c=true;try{CR.JSON.stringify(b);}catch(a){c=false;}return c;},_get:function(d,c,a){if(!d||!c||typeof c!=="string"){return;}var g=a;var h=c.split(".");if(h&&h.length>0){var b=d[h[0]];Ext.each(h.slice(1),function(i){b=b?b[i]:undefined;return b;});var f=b;if(typeof f!=="undefined"){g=f;}}return g;},_set:function(d,c,f){var i=false;if(!d||!c||typeof c!=="string"){return;}if(!CR.Settings._canBeJSON(f)){console.error("CR.Settings._set: the value for '"+c+"' is not a valid JSON",f);return;}var h=c.split(".");if(h&&h.length>0){var g=d;var a=h[0];var b=g[a]=g[a]||{};if(typeof b!=="object"){b=d[a]={};}Ext.each(h.slice(1),function(j){g=b;a=j;b=b[j]=b[j]||{};});g[a]=f;i=true;}return i;},_has:function(c,b){if(!c||!b||typeof b!=="string"){return;}var f=b.split(".");if(f&&f.length>0){var d=c;for(var a=0;a<f.length;a++){if(!d||!d.hasOwnProperty(f[a])){return false;}d=d[f[a]];}}return true;},formatXML:function(a,b){window.CRFormatXML=!!a;if(b){CR.Storage.setItem("CRFormatXML",""+!!window.CRFormatXML);}},addPanelConfig:function(b,a){if(!CR.Settings._panelConfigs){CR.Settings._panelConfigs={};}CR.Settings._panelConfigs[b]=a;},getConfigPanel:function(g,c){var b=null;if(!CR.Settings._panelConfigs){CR.Settings._panelConfigs={};}var d=CR.Settings._panelConfigs[g];if(d){var a=[];if(d.description){a.push({xtype:"container",html:d.description});}var f=d.defaults||{};Ext.each(d.settings,function(i){var h=i.key;if(f.keyPrefix){h=f.keyPrefix+"."+i.key;}var j=CR.Settings.get(h,i.defaults);var k="textfield";if(f.type==="boolean"){k="checkbox";}a.push({crKey:h,xtype:k,boxLabel:i.label||h,checked:!!j,listeners:{check:function(m,l){CR.Settings.set(m.crKey,l);}}});});b={xtype:"panel",bodyStyle:{padding:"10px",font:"14px arial,tahoma,helvetica,sans-serif"},autoScroll:true,title:d.title||g,items:a};}return b;}};CR.Settings.set=CR.Settings.setUserSetting;CR.Settings.get=CR.Settings.getUserSetting;CR.Settings.save=CR.Settings.saveCurrentUserSettings;CR.Settings.RECENT_ROWS_LIMIT_PER_TABLE=10;CR.Settings.getRecentRows=function(){var d=CR.Settings.get("recentRows",[]);if(typeof d==="string"){var a=d.split(";");d=[];for(var c=0;c<a.length;++c){var b=a[c].split(":");if(b.length===3){d.push({tableName:b[0],targetSerial:b[1],rowDescription:decodeURIComponent(b[2])});}}CR.Settings.set("recentRows",d);}return d;};CR.Settings.addRecentRow=function(b,c,f){var g=CR.Settings.getRecentRows();var a=0;var d=0;while(d<g.length){if(g[d].tableName!==b){++d;}else{if(g[d].targetSerial===c||++a>=CR.Settings.RECENT_ROWS_LIMIT_PER_TABLE){g.splice(d,1);}else{++d;}}}g.unshift({tableName:b,targetSerial:c,rowDescription:f});CR.Settings.set("recentRows",g);};CR.Settings.removeRecentRow=function(a,b){var f=CR.Settings.getRecentRows();var d=false;var c=0;while(c<f.length){if(f[c].tableName===a&&(!b||f[c].targetSerial===b)){f.splice(c,1);d=true;}else{++c;}}if(d){CR.Settings.set("recentRows",f);}};CR.Settings.clearRecentRows=function(a){if(!a){CR.Settings.set("recentRows");}else{CR.Settings.removeRecentRow(a);}};CR.Settings.checkForValidRecord=function(a){a=Ext.apply({tableName:null,targetSerial:null,rowDescription:null,overrideContainer:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},a);CR.Core.getRowDescription({tableName:a.tableName,targetSerial:a.targetSerial,maskingContainer:a.overrideContainer,callbackFunction:function(b){if(b.rowDescription){a.callbackFunction.call(a.callbackScope,a.callbackArgs);}else{CR.Settings.removeRecentRow(a.tableName,a.targetSerial);var d=CR.Core.findTableByName(a.tableName);var c="";if(d&&d.tableDescription){c=d.tableDescription+" ";
}Ext.MessageBox.alert("Access Error",c+a.rowDescription+" could not be found!");}}});};CR.XML=function(a){if(!a){a={};}this.xmlDocument=null;this.namespaceURI="";this.namespacePrefix="";this.namespacePrefixColon="";this.namespaceDeclarationRequired=false;this.rootElementName="";this.stack=[];this.exceptionList=[];if(typeof a.namespaceURI==="string"){this.namespaceURI=a.namespaceURI;}else{this.namespaceURI="http://www.corelationinc.com/queryLanguage/v1.0";}if(this.namespaceURI===""){this.namespacePrefix="";}else{if(typeof a.namespacePrefix==="string"){this.namespacePrefix=a.namespacePrefix;}else{this.namespacePrefix="v1";}}if(this.namespacePrefix){this.namespacePrefixColon=this.namespacePrefix+":";}if(typeof a.rootElementName==="string"){this.rootElementName=a.rootElementName;}else{this.rootElementName="query";}if(a.xmlDocument){this.xmlDocument=a.xmlDocument;}else{if(a.xmlText){if(typeof DOMParser!=="undefined"){this.xmlDocument=(new DOMParser()).parseFromString(a.xmlText,"application/xml");}else{if(typeof ActiveXObject!=="undefined"){this.xmlDocument=new ActiveXObject("Microsoft.XMLDOM");this.xmlDocument.loadXML(a.xmlText);}else{var b="data:text/xml;charset=utf-8,"+encodeURIComponent(a.xmlText);var d=new XMLHttpRequest();d.open("GET",b,false);d.send(null);this.xmlDocument=d.responseXML;}}}else{var c=this.namespacePrefixColon+this.rootElementName;if(document.implementation&&document.implementation.createDocument){this.xmlDocument=document.implementation.createDocument(this.namespaceURI,c,null);}else{this.xmlDocument=new ActiveXObject("Microsoft.XMLDOM");this.xmlDocument.loadXML("<"+c+(this.namespaceURI?(" xmlns:"+this.namespacePrefix+'="'+this.namespaceURI+'"'):"")+"/>");}}}if(a.json){this.addJSON(a.json);}};CR.XML.prototype.serialize=function(b){var c=null;if(!b){b=this.xmlDocument;}if(typeof XMLSerializer!=="undefined"){c=(new XMLSerializer()).serializeToString(b);}else{if(b.xml){c=b.xml;}else{throw"XML.serialize is not supported or cannot serialize "+b;}}if(c&&(window.CRDebug===true||window.CRFormatXML===true||window.top.CRFormatXML===true)){if(typeof vkbeautify!=="undefined"){try{c=vkbeautify.xml(c,"  ");}catch(a){console.warn("CRFormatXML error",a);}}}return c;};CR.XML.prototype.getXMLDocument=function(){return this.xmlDocument;};CR.XML.prototype.getRootElement=function(){return this.xmlDocument.documentElement;};CR.XML.prototype.getRootElementName=function(){return this.rootElementName;};CR.XML.prototype.getNamespaceURI=function(){return this.namespaceURI;};CR.XML.prototype.setNamespaceDeclarationRequired=function(a){this.namespaceDeclarationRequired=a;};CR.XML.prototype.createElement=function(a){var b=this.xmlDocument.createElement(this.namespacePrefixColon+a);if(this.namespaceDeclarationRequired){b.setAttribute("xmlns:"+this.namespacePrefix,this.namespaceURI);}return b;};CR.XML.prototype.addContainer=function(c,a){var b=this.createElement(a);c.appendChild(b);return b;};CR.XML.prototype.removeContainer=function(b,a){return b.removeChild(a);};CR.XML.prototype.setAttribute=function(b,a,c){if(c){b.setAttribute(a,c);}};CR.XML.prototype.removeAttribute=function(b,a){b.removeAttribute(a);};CR.XML.prototype.addOption=function(c,a,d){if(d){var b=this.createElement(a);b.setAttribute("option",d);c.appendChild(b);}};CR.XML.prototype.addText=function(c,a,f,d){if(d||f){var b=this.createElement(a);if(!f){f="";}b.appendChild(this.xmlDocument.createTextNode(f));c.appendChild(b);}};CR.XML.prototype.addSerial=CR.XML.prototype.addText;CR.XML.prototype.addCount=function(b,a,d,c){if(c||d!=="0"){this.addText(b,a,d);}};CR.XML.prototype.addMoney=function(b,a,d,c){if(c||d!=="0.00"){this.addText(b,a,d);}};CR.XML.prototype.addRate=function(b,a,d,c){if(c||d!=="0.000"){this.addText(b,a,d);}};CR.XML.prototype.addDate=CR.XML.prototype.addText;CR.XML.prototype.addTime=CR.XML.prototype.addText;CR.XML.prototype.addDocument=CR.XML.prototype.addText;CR.XML.prototype.addBinary=CR.XML.prototype.addText;CR.XML.prototype.addData=function(c,a,b,d){switch(b){case"C":this.addCount(c,a,d);break;case"D":this.addDate(c,a,d);break;case"T":this.addTime(c,a,d);break;case"M":this.addMoney(c,a,d);break;case"R":this.addRate(c,a,d);break;case"L":this.addDocument(c,a,d);break;case"B":this.addBinary(c,a,d);break;case"O":this.addOption(c,a,d);break;case"E":this.addSerial(c,a,d);break;case"S":this.addText(c,a,d);break;}};CR.XML.prototype.removeElement=function(a){var b=a.parentNode;if(b){b.removeChild(a);}return b;};CR.XML.prototype.beginElement=function(a){this.stack.push({index:0,node:a});};CR.XML.prototype.nextSubElement=function(){var c=this.stack[this.stack.length-1];var d=c.node.childNodes;var b=d.length;var a=null;while(!a&&c.index<b){a=d[c.index++];if(a.nodeType!==1){a=null;}}if(!a){this.stack.pop();}else{if(a.nodeName==="exception"){this.exceptionList.push(this.getExceptionMessage(a));}}return a;};CR.XML.prototype.endElement=function(a){if(a){this.stack.pop();}};CR.XML.prototype.nameEquals=function(c,a){var b=false;if(c.nodeName===a||c.nodeName===(this.namespacePrefixColon+a)){b=true;}return b;};CR.XML.prototype.clearSubElement=function(){this.stack=[];};CR.XML.prototype.getOption=function(a){return a.getAttribute("option");};CR.XML.prototype.getText=function(b){var f="";var d=false;for(var a=0;a<b.childNodes.length&&!d;++a){var c=b.childNodes[a];if((c.nodeType===3||c.nodeType===4)&&c.nodeValue){d=true;f=c.nodeValue;}}return f;};CR.XML.prototype.getElementName=function(b){var a=null;if(b&&b.nodeName){a=b.nodeName;var c=a.indexOf(":");if(c!==-1){a=a.substring(c+1);}}return a;};CR.XML.prototype.getOptionText=CR.XML.prototype.getText;CR.XML.prototype.getSerial=CR.XML.prototype.getText;CR.XML.prototype.getCount=CR.XML.prototype.getText;CR.XML.prototype.getMoney=CR.XML.prototype.getText;CR.XML.prototype.getRate=CR.XML.prototype.getText;CR.XML.prototype.getDate=CR.XML.prototype.getText;CR.XML.prototype.getTime=CR.XML.prototype.getText;CR.XML.prototype.getDocument=CR.XML.prototype.getText;CR.XML.prototype.getBinary=CR.XML.prototype.getText;CR.XML.prototype.getExceptionMessage=function(a){var c=null;var b;this.beginElement(a);while(!!(b=this.nextSubElement())){if(b.nodeName==="message"){c=this.getText(b);}}return c;};CR.XML.prototype.addException=function(b){var c=false;for(var a=0;a<this.exceptionList.length&&!c;++a){if(this.exceptionList[a]===b){c=true;}}if(!c){this.exceptionList.push(b);}};CR.XML.prototype.clearException=function(){this.exceptionList=[];};CR.XML.prototype.getExceptionList=function(){return this.exceptionList;};CR.XML.prototype.addJSON=function(c,a){var b=function(h,j,f){var l,d,g,i,k;if(j===null||typeof j!=="object"){if(!j){j="";}f.appendChild(h.xmlDocument.createTextNode(j));}if(j instanceof Object){for(l in j){if(j.hasOwnProperty(l)){if(l==="$attr"){for(d in j[l]){h.setAttribute(f,d,j[l][d]);}}else{if(l==="option"){h.setAttribute(f,l,j[l]);}else{if(l==="text"){f.appendChild(h.xmlDocument.createTextNode(j[l]));}else{if(j[l] instanceof Array){i=j[l];for(k=0;k<i.length;k++){g=h.addContainer(f,l);b(h,i[k],g);}}else{g=h.addContainer(f,l);b(h,j[l],g);}}}}}}}};if(!a){a=this.getRootElement();if(Ext.isArray(c)){c={sequence:[{transaction:[{step:c}]}]};}else{if(Ext.isObject(c)){if(c.query){c=c.query;}else{if(c.sequence){}else{if(c.transaction){c={sequence:c};}else{if(c.step){c={sequence:[{transaction:c}]};}else{c={sequence:[{transaction:[{step:c}]}]};}}}}}}}b(this,c,a);return this;};CR.XML.prototype.toJSON=function(){var a=this.getXMLDocument();return CR.Core.convertXMLtoJSON(a);};if(!Array.prototype.includes){Array.prototype.includes=function(a){return this.indexOf(a)>-1;};}if(typeof Object.assign!=="function"){Object.defineProperty(Object,"assign",{value:function assign(d){if(!d){throw new TypeError("Cannot convert undefined or null to object");}var f=Object(d);for(var c=1;c<arguments.length;c++){var b=arguments[c];if(!b){for(var a in b){if(Object.prototype.hasOwnProperty.call(b,a)){f[a]=b[a];}}}}return f;},writable:true,configurable:true});}if(!String.prototype.hashCode){String.prototype.hashCode=function(){var c=0,a,b;if(this.length===0){return c;}for(a=0;a<this.length;a++){b=this.charCodeAt(a);c=((c<<5)-c)+b;c|=0;}return c;};}if(!String.prototype.startsWith){String.prototype.startsWith=function(a,b){b=!b||b<0?0:+b;return this.substring(b,b+a.length)===a;};}if(!String.prototype.endsWith){String.prototype.endsWith=function(b,a){if(a===undefined||a>this.length){a=this.length;}return this.substring(a-b.length,a)===b;};}if(!String.prototype.padStart){String.prototype.padStart=function padStart(b,a){b=b>>0;a=String(typeof a!=="undefined"?a:" ");if(this.length>=b){return String(this);}else{b=b-this.length;if(b>a.length){a+=a.repeat(b/a.length);}return a.slice(0,b)+String(this);}};}if(!String.prototype.padEnd){String.prototype.padEnd=function padEnd(b,a){b=b>>0;a=String((typeof a!=="undefined"?a:" "));if(this.length>b){return String(this);}else{b=b-this.length;if(b>a.length){a+=a.repeat(b/a.length);}return String(this)+a.slice(0,b);}};}if(!String.prototype.trim){String.prototype.trim=function(){return this.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");};}Ext.QuickTips.init();Ext.BLANK_IMAGE_URL="images/blank-image.gif";Ext.form.Field.prototype.msgTarget="under";Ext.form.Field.prototype.validationDelay=750;Ext.namespace("CR.Core");Ext.namespace("CR.Field");Ext.namespace("CR.Storage");Ext.namespace("CR.Workflow");if(Ext.isChrome){Ext.Msg.minWidth=300;}CR.Core.extV3=(typeof Ext.version==="string"&&Ext.version.charAt(0)==="3");if(Ext.version==="3.0.1"){Ext.layout.FormLayout.prototype.onRemove=function(d){Ext.layout.FormLayout.superclass.onRemove.call(this,d);if(this.trackLabels&&!this.isHide(d)){d.un("show",this.onFieldShow,this);d.un("hide",this.onFieldHide,this);}if(d.rendered){if(d.getItemCt){var b=d.getPositionEl(),a=d.getItemCt();b.insertAfter(a);}else{a=d;}Ext.destroy(a);delete d.label;delete d.itemCt;if(d.customItemCt){delete d.getItemCt;delete d.customItemCt;}}};}if(Ext.version==="2.3.0"||Ext.version==="3.0.1"){Ext.lib.Event.resolveTextNode=Ext.isGecko?function(b){if(!b){return;}var a=HTMLElement.prototype.toString.call(b);if(a==="[xpconnect wrapped native prototype]"||a==="[object XULElement]"){return;}return b.nodeType===3?b.parentNode:b;}:function(a){return a&&a.nodeType===3?a.parentNode:a;};}if(Ext.version==="2.3.0"||Ext.version==="3.0.1"||Ext.version==="3.0.3"||Ext.version==="3.1.0"||Ext.version==="3.2.1"||Ext.version==="3.2.2"){Ext.tree.TreeNodeUI.prototype.crOriginalRenderElements=Ext.tree.TreeNodeUI.prototype.renderElements;Ext.tree.TreeNodeUI.prototype.renderElements=function(){this.crOriginalRenderElements.apply(this,arguments);this.getAnchor().tabIndex=-1;};}if(Ext.version.indexOf("3.")===0){Ext.DomHelper.overwrite=function(b,d,c){b=Ext.getDom(b);var f=Ext.DomHelper.createHtml(d);b.innerHTML=f;if(!b.firstChild){var a=document.createElement("div");a.innerHTML=f;b.appendChild(a.firstChild);}return c?Ext.get(b.firstChild):b.firstChild;};}CR.Core.emptyFunction=function emptyFunction(){};CR.Core.cascade=function(c,g,f,b){if(typeof c==="object"){if(Ext.isArray(c)){for(var d=0,a=c.length;d<a;d++){if(c[d]){CR.Core.cascade(c[d],g,f,b);}}}else{if(g.apply(f||c,b||[c])!==false){for(var h in c){if(c[h]){CR.Core.cascade(c[h],g,f,b);}}}}}return c;};CR.Core.findBy=function(a,c,b){var d=[],f=a;CR.Core.cascade(a,function(g){if(f!==g&&c.call(b||g,g,f)===true){d.push(g);}});return d;};CR.Core.find=function(a,c,b){return CR.Core.findBy(a,function(d){return d[c]===b;});};CR.Core.findFirst=function(a,c,b){return CR.Core.find(a,c,b).shift();};CR.Core.findFirstOrDefault=function(a,c,b){return CR.Core.findFirst(a,c,b)||{};};CR.Core.findProperty=function(a,c){var b=CR.Core.findBy(a,function(d){return d.hasOwnProperty(c);});return b.map(function(d){return d[c];});};CR.Core.findFirstProperty=function(a,b){return CR.Core.findProperty(a,b).shift();};CR.Core.findFirstPropertyOrDefault=function(a,b){return CR.Core.findFirstProperty(a,b)||{};};CR.Core.copyTo=function(b){b=Ext.apply({dest:{},source:undefined,properties:undefined,primitive:false},b);if(b.source){if(!b.properties){for(var a in b.source){if(b.source.hasOwnProperty(a)&&typeof b.source[a]!=="undefined"&&(!b.primitive||b.source[a]!==Object(b.source[a]))){b.dest[a]=b.source[a];}}}else{if(typeof b.properties==="string"){b.properties=b.properties.split(/[,;\s]/);}Ext.each(b.properties,function(c){if(b.source.hasOwnProperty(c)&&typeof b.source[c]!=="undefined"&&(!b.primitive||b.source[c]!==Object(b.source[c]))){b.dest[c]=b.source[c];}},this);}}return b.dest;};CR.Core.expect=function(f,d,c){c=Ext.apply({throwError:true,display:!!c,callbackScope:this,callbackArgs:{}},c);d=d||"Assertion failed";var a=true;var g=null;if(typeof c.callbackFunction==="function"){g=c.callbackFunction;}var b=function(){if(g){g.call(c.callbackScope,c.callbackArgs);}else{if(c.throwError){throw new Error(d);}else{console.error(new Error(d));}}};if(!f){a=false;if(c.display||c.title){CR.Core.displayExceptions({title:c.title,items:[d],callbackFunction:b,callbackFunctionScope:c.callbackScope,callbackFuncitonArgs:c.callbackArgs});}else{b();}}return a;};CR.Core.includeJSCSS=function(c){c=Ext.apply({url:null,errorHandler:CR.Core.emptyFunction,callbackFunction:CR.Core.emptyFunction,callbackScope:this},c);if(c.url){var g=/\.js$/.test(c.url);var f=g?"script":"link";var b=document.createElement(f);if(g){b.src=c.url;}else{b.href=c.url;b.rel="stylesheet";b.crossorigin="anonymous";}b.async=true;if(c.errorHandler&&typeof c.errorHandler==="function"){b.onerror=function(h){c.errorHandler.call(c.callbackScope,{url:c.url,event:h});};}var a=false;b.onload=b.onreadystatechange=function(){if(!a&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){a=true;c.callbackFunction.call(c.callbackScope);}};var d=document.getElementsByTagName("head")[0];d.appendChild(b);}};CR.Field.STANDARD_WIDTH=225;CR.Field.DEFAULT_OPTION_WIDTH=225;CR.Field.FMPANEL_OPTION_WIDTH=225;CR.Field.DEFAULT_SERIAL_WIDTH=225;CR.Field.FMPANEL_SERIAL_WIDTH=225;CR.Field.DEFAULT_TEXT_WIDTH=175;CR.Field.FMPANEL_TEXT_WIDTH=175;CR.Field.DEFAULT_TEXTAREA_WIDTH=225;CR.Field.FMPANEL_TEXTAREA_WIDTH=225;CR.Field.DEFAULT_TEXTAREA_HEIGHT=60;CR.Field.DEFAULT_MONEY_WIDTH=175;CR.Field.FMPANEL_MONEY_WIDTH=175;CR.Field.DEFAULT_RATE_WIDTH=175;CR.Field.FMPANEL_RATE_WIDTH=175;CR.Field.DEFAULT_COUNT_WIDTH=95;CR.Field.FMPANEL_COUNT_WIDTH=95;CR.Field.DEFAULT_DATE_WIDTH=95;CR.Field.FMPANEL_DATE_WIDTH=95;CR.Field.DEFAULT_TIME_WIDTH=175;CR.Field.FMPANEL_TIME_WIDTH=175;CR.Field.SERIAL_QUERY_DELAY=500;CR.Field.FIELD_HIGHLIGHT_COLOR="#99bbe8";CR.Core.BatchServerSerial=null;CR.Core.ShowTranProfileWindow=false;CR.Core.LOGIN_LOGO="images/Logos/Login_Logo.png";CR.initialTabHtml='<div class="cr-initialTab"><br><br><br><img src="images/Logos/Corelation_Logo_Faded.jpg" /></div>';CR.initialTabHtmlVertical='<div class="cr-initialTab"><br><br><br><img src="images/Logos/Corelation_Logo_Faded_Vertical.jpg" /></div>';CR.confluenceBaseURL="https://confluence.corelationinc.com";CR.Core.JaspersoftVersion="";try{if(JSON&&JSON.parse&&typeof JSON.parse('{"test":"ok"}')==="object"){CR.JSON=JSON;}}catch(e){}if(!CR.JSON){CR.JSON={parse:function(jsonString){return eval("("+jsonString+")");}};}CR.Storage.keyBase=window.location.pathname+";";CR.Storage.keyStoneLauncherIndex=CR.Storage.keyBase.indexOf("/KeyStoneLauncher;");if(CR.Storage.keyStoneLauncherIndex!==-1){CR.Storage.keyBase=CR.Storage.keyBase.substring(0,CR.Storage.keyStoneLauncherIndex+1)+";";}if(window.localStorage){CR.Storage.handler=window.localStorage;}else{if(window.globalStorage){CR.Storage.handler=window.globalStorage[window.location.hostname];}else{CR.Storage.handler={getItem:function(a){},setItem:function(a,b){},removeItem:function(a){}};}}CR.Storage.setUser=function(a){CR.Storage.keyUser=CR.Storage.keyBase+"U"+a+";";};CR.Storage.setUser("");CR.Storage.getItem=function(a){return String(CR.Storage.handler.getItem(CR.Storage.keyUser+a));};CR.Storage.setItem=function(a,b){CR.Storage.handler.setItem(CR.Storage.keyUser+a,b);};CR.Storage.removeItem=function(a){CR.Storage.handler.removeItem(CR.Storage.keyUser+a);
};CR.Storage.setItemJSON=function(b,a){if(!a){CR.Storage.removeItem(b);}else{CR.Storage.setItem(b,CR.JSON.stringify(a));}};CR.Storage.getItemJSON=function(c,a){var d=a;var f=CR.Storage.getItem(c);if(f&&typeof f==="string"&&f!=="null"){try{d=CR.JSON.parse(f);}catch(b){console.error(b);}}return d;};if(!CR.Core.Events){CR.Core.Events=new Ext.util.Observable();CR.Core.Events.addEvents("uiready");}CR.Core._callbackMap={};CR.Core.registerCallback=function(b){var a=Ext.id(null,"cr-callback-");b=Ext.apply({callbackId:a,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);CR.Core._callbackMap[a]=b;return a;};CR.Core.executeCallback=function(b,c){var a=CR.Core._callbackMap[b];if(a){delete CR.Core._callbackMap[b];if(typeof a.callbackFunction==="function"){a.callbackArgs=Ext.apply(a.callbackArgs,c);a.callbackFunction.call(a.callbackScope||this,a.callbackArgs);}}};CR.Core.getVersionInfo=function(b){b=Ext.apply({callbackFunction:CR.Core.emptyFunction,callbackArgs:{},callbackScope:this},b);var c={uiFullVersion:window.CRRev||"unknown",uiVersion:window.CRRev||"unknown",minimumDatabaseVersion:"",uiRevisionNumber:"",uiBuildNumber:"",uiRevisionPatch:"",databaseVersionMismatch:false};var a=/\d{4}_\d{2}_\d{2}v\d{2}\.\d{2}(\.\d{2})?/g;CR.Core.recordSearch({search:{tableName:"ENV",returnLimit:"1"},fields:["DATABASE_VERSION"],callbackFunction:function(d){var g=d.record;if(g){c.databaseVersion=g["DATABASE_VERSION"];if(a.test(c.uiFullVersion)){var h=c.uiFullVersion.split("v");if(h&&h.length>0){c.minimumDatabaseVersion=h[0];if(h.length>1){c.uiVersion=h[1];var f=c.uiVersion.split(".");if(f&&f.length>0){c.uiRevisionNumber=f[0];if(f.length>1){c.uiBuildNumber=f[1];if(f.length>2){c.uiRevisionPatch=f[2];}}}}}}if(c.databaseVersion&&c.minimumDatabaseVersion&&c.databaseVersion<c.minimumDatabaseVersion){c.databaseVersionMismatch=true;}}b.callbackFunction.call(b.callbackScope,c);}});};CR.OptionField=Ext.extend(Ext.form.ComboBox,{crColumnName:"",crColumnDescription:"",crContents:"",crNullAllowed:false,crCalculation:undefined,crPrivilegeToGet:true,crPanelType:undefined,crOptions:null,crMonthPrompt:false,crMonthPromptAllowBlank:false,crApplyBackgroundColor:false,crModified:false,crEnterKeyHandler:function(){},crOnContentsChange:function(){},width:CR.Field.DEFAULT_OPTION_WIDTH,typeAhead:true,selectOnFocus:true,constructor:function(c){var b=Ext.apply({},c);b.mode="local";if(Ext.version==="3.2.1"||Ext.version==="3.2.2"){b.forceSelection="yes";}else{b.forceSelection=true;}b.triggerAction="all";b.name=b.crColumnName||"";b.fieldLabel=b.crColumnDescription||"";b.allowBlank=false;if(b.crMonthPrompt){b.crOptions=[];if(b.crMonthPromptAllowBlank){b.crOptions.push([""," "]);}b.crOptions.push(["1","January"],["2","February"],["3","March"],["4","April"],["5","May"],["6","June"],["7","July"],["8","August"],["9","September"],["10","October"],["11","November"],["12","December"]);if(b.crMonthPromptAllowBlank){b.crOptions.push([""," "]);}}else{if(b.crFrequencyPrompt){b.crOptions=[["S","Single"],["A","Annually"],["SA","Semiannually"],["Q","Quarterly"],["BM","Bimonthly"],["M","Monthly"],["SM","Semimonthly"],["BF","Biweekly skip first"],["BL","Biweekly skip last"],["B","Biweekly"],["WF","Weekly skip first"],["WL","Weekly skip last"],["W","Weekly"],["D","Daily"]];}}for(var d=0;d<b.crOptions.length;++d){if(b.crOptions[d][1]===""){b.allowBlank=true;}}if(b.crPanelType==="FMPanel"){b.width=b.width||CR.Field.FMPANEL_OPTION_WIDTH;}b.listWidth=b.width||this.width;b.valueField="key";b.displayField="label";var a=["key","label"];if(b.crApplyBackgroundColor){a.push("bgClass");b.tpl='<tpl for="."><div class="x-combo-list-item {bgClass}">{label}</div></tpl>';}var f=new Ext.data.ArrayReader({},a);b.store=new Ext.data.Store({autoDestroy:true,reader:f,data:b.crOptions});if(!b.crContents){b.crContents=b.crOptions[0][0];}b.value=b.crContents;b.enableKeyEvents=true;if(b.listeners){b.crAdditionalListeners=b.listeners;delete b.listeners;}CR.Field.mask(b);CR.OptionField.superclass.constructor.call(this,b);this.addEvents("optionchange");this.crDestroyed=false;this.crNullAllowed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;this.crListFrameAndScrollBarWidth=27;this.addListener({render:this.crOnRender,show:CR.Field.showHandler,hide:CR.Field.hideHandler,resize:this.crSetToolTip,select:this.crOnSelect,beforedestroy:this.crBeforeDestroy,beforequery:this.crBeforeQuery,blur:this.crOnBlur,keydown:CR.Field.keyDownHandler,specialkey:CR.Field.specialKeyHandler,change:this.crOnChange});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"O";},crGetOptionDescription:function(b){var c="";var a=0;while(a<this.crOptions.length&&!c){if(this.crOptions[a][0]===b){c=this.crOptions[a][1];}++a;}return c;},crSetContents:function(c){if(!this.crDestroyed&&this.crGetOptionDescription(c)!==""){delete this.lastQuery;this.getStore().clearFilter();var a=this.crGetNewContents();this.crSuperclassSetValue(c);this.crOnSelect();this.crOnContentsChange();var b=this.crGetNewContents();if(a!==b){this.fireEvent("optionchange",this,b,a);}}},crGetNewContents:function(){return this.crDestroyed?this.crContentsInitial:this.getValue();},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return this.crGetOptionDescription(this.crGetNewContents());},crIsDestroyed:function(){return this.crDestroyed;},crIsModified:function(){return this.crModified;},crCollapse:function(){if(!this.crDestroyed){this.collapse();}},crExpand:function(){if(!this.crDestroyed){this.expand();}},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){if(this.dqTask){this.dqTask.cancel();}if(this.taTask){this.taTask.cancel();}this.collapse();CR.Field.blurHandler(this);}},crExpandList:function(){CR.Core.defer(function(){if(!this.crDestroyed&&this.rendered&&!this.hidden&&!this.disabled){this.onTriggerClick();}},this);},crAddOptions:function(h){var d=[];var a=this.initialConfig.crOptions;var b=this.initialConfig.store;for(var f=0;f<h.length;f++){var g=false;for(var c=0;c<a.length;c++){if(h[f][0]===a[c][0]){g=true;}}if(!g){d.push(h[f]);}}for(f=0;f<d.length;f++){a.push(d[f]);}b.loadData(d,true);},crInsertOption:function(d,f){var a=this.initialConfig.crOptions;var b=this.initialConfig.store;var g=false;for(var c=0;c<a.length;c++){if(f[0]===a[c][0]){g=true;}}if(!g){a.splice(d,0,f);}b.loadData(a,true);},crReplaceOptions:function(b){this.initialConfig.crOptions=b;var a=this.initialConfig.store;a.loadData(b,false);this.crOptions=b||[];},crClearAllOptions:function(){this.initialConfig.crOptions=[];var a=this.initialConfig.store;a.loadData([],true);this.crOptions=[];},crOnRender:function(){CR.Field.renderHandler(this);var c=0;for(var b=0;b<this.crOptions.length;++b){var a=CR.Field.calculateWidth(this,this.crOptions[b][1]);if(c<a){c=a;}}this.listWidth=c+this.crListFrameAndScrollBarWidth;if(this.listWidth<this.width){this.listWidth=this.width;}this.crSetToolTip();},crBeforeQuery:function(a){if(this.crKeyHandledFlag){a.cancel=true;this.crKeyHandledFlag=false;}},crBeforeDestroy:function(){if(this.dqTask){this.dqTask.cancel();}if(this.taTask){this.taTask.cancel();}CR.Field.beforeDestroyHandler(this);},crOnSelect:function(){CR.Field.columnHideUpdate(this);this.crSetToolTip();},crOnChange:function(){this.crModified=true;},crSetToolTip:function(){if(!this.crDestroyed){CR.Field.setToolTip(this,this.crGetOptionDescription(this.getValue()));}}});Ext.reg("crOptionField",CR.OptionField);Ext.override(CR.OptionField,{beforeBlur:function(){if(this.crDoNotAssert){this.setValue(this.value);}else{this.assertValue();}}});CR.OptionField.getColumnOptions=function(c){c=Ext.apply({tableName:null,columnName:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},c);var i=null;var b=new CR.XML();var h=b.addContainer(b.getRootElement(),"sequence");var g=b.addContainer(h,"transaction");var d=b.addContainer(g,"step");var a=b.addContainer(d,"record");b.addText(a,"tableName",c.tableName);b.addOption(a,"operation","V");b.addOption(a,"includeColumnMetadata","Y");var f=b.addContainer(a,"field");b.addText(f,"columnName",c.columnName);CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),success:function(l){var j=null;var n="failed";var m=[];var k=CR.JSON.parse(l.responseText);var o=k.query;if(o){Ext.each(o.sequence,function(p){Ext.each(p.transaction,function(q){n=q.$attr.result;Ext.each(q.exception,function(r){m.push(r.message);});Ext.each(q.step,function(r){if(r.tranResult&&r.tranResult.category&&r.tranResult.category.option&&r.tranResult.category.option==="E"){m.push(r.tranResult.description);}else{if(r.record){j=r.record;if(j.field){i=[];Ext.each(j.field[0].options,function(s){i.push([s.value.option,s.value.text]);});}}}});});});}if(n!=="posted"||m.length>0){CR.Core.displayExceptions({items:m});}else{c.callbackFunction.call(c.callbackScope,i);}}});};CR.SerialObject=function(a){if(typeof a==="object"){this.setSerial(a.serial,a.rowDescription);}else{if(typeof a==="string"){this.fromString(a);}}};CR.SerialObject.prototype={getSerial:function(){return this.serial||"";},getRowDescription:function(){return this.rowDescription||"";},setSerial:function(a,b){this.serial=a;this.rowDescription=b;if(!this.serial||!this.rowDescription){this.serial="";this.rowDescription="";}},toString:function(){var a="";if(this.serial){a=this.serial+":";if(this.rowDescription){a+=this.rowDescription;}}return a;},fromString:function(a){this.serial="";this.rowDescription="";var b=a.indexOf(":");if(b>=0){this.serial=a.substring(0,b);this.rowDescription=a.substring(b+1);if(!this.serial||!this.rowDescription){this.serial="";this.rowDescription="";}}}};CR.SerialField=Ext.extend(Ext.form.ComboBox,{crColumnName:"",crColumnDescription:"",crContents:"",crNullAllowed:false,crCalculation:undefined,crPrivilegeToGet:true,crRowDescription:"",crTableName:"",crComplexSearchRequired:false,crRefTableName:"",crRefColumnName:"",crRefParentSerial:"",crSearchFilterName:"",crSearchParameters:null,crIncludeDescriptionParameter:true,crEnterKeyHandler:function(){},crOnContentsChange:function(){},crOnTabKeyQueryFailure:function(){},crSetValue:function(){this.crSuperclassSetValue.apply(this,arguments);},crModified:false,crPersonSearchInitiated:false,width:CR.Field.DEFAULT_SERIAL_WIDTH,listWidth:500,pageSize:20,typeAhead:false,loadingText:"Searching...",triggerClass:"serial-trigger",minChars:1,queryDelay:CR.Field.SERIAL_QUERY_DELAY,constructor:function(c){var b=Ext.apply({},c);b.name=b.crColumnName||"";b.fieldLabel=b.crColumnDescription||"";b.crRowDescription=b.crRowDescription||(b.crContents?"<Missing>":"");b.value=b.crRowDescription||"";if(b.crNullAllowed===undefined){b.crNullAllowed=this.crNullAllowed;}b.allowBlank=b.crNullAllowed;if(b.crPanelType==="FMPanel"){b.width=b.width||CR.Field.FMPANEL_SERIAL_WIDTH;}b.forceSelection=false;var f=this;var a=new Ext.data.JsonReader({root:"resultRows",totalProperty:"totalHitCount",id:"serial"},[{name:"serial"},{name:"rowDescription"},{name:"rowStatus"}]);var d=new CR.Core.AjaxProxy({url:"SearchJSON",crOverride:{focusFld:this},crMask:{suppress:true}});b.store=new Ext.data.Store({autoDestroy:true,baseParams:{rowDescriptionOnly:"Y"},proxy:d,reader:a,listeners:{load:function(h,g,i){f.crCheckStoreContents(i.params.query);},loadexception:function(i,h,g){f.crAbortOutstandingQuery();f.crTabKeyQueryFlag=false;f.crSetSerial(f.crContents,f.crRowDescription);f.crCollapse();CR.Field.blurHandler(f);CR.Core.ajaxErrorHandler(g);}}});b.displayField="rowDescription";b.enableKeyEvents=true;if(b.listeners){b.crAdditionalListeners=b.listeners;delete b.listeners;}b.tpl=new Ext.XTemplate('<tpl for=".">',"<tpl if=\"this.getRowStatusOption(rowStatus) === '-'\">",'<div class="x-combo-list-item">{rowDescription}</div>',"</tpl>","<tpl if=\"this.getRowStatusOption(rowStatus) === 'C'\">",'<div class="x-combo-list-item cr-rowStatus-closed">{rowDescription}</div>',"</tpl>","<tpl if=\"this.getRowStatusOption(rowStatus) === 'O'\">",'<div class="x-combo-list-item cr-rowStatus-chargedOff">{rowDescription}</div>',"</tpl>","<tpl if=\"this.getRowStatusOption(rowStatus) === 'V'\">",'<div class="x-combo-list-item cr-rowStatus-voided">{rowDescription}</div>',"</tpl>","<tpl if=\"this.getRowStatusOption(rowStatus) === 'E'\">",'<div class="x-combo-list-item cr-rowStatus-expired">{rowDescription}</div>',"</tpl>","<tpl if=\"this.getRowStatusOption(rowStatus) === 'F'\">",'<div class="x-combo-list-item cr-rowStatus-effectiveInFuture">{rowDescription}</div>',"</tpl>","</tpl>",{compiled:true,disableFormats:true,getRowStatusOption:function(g){return(g&&g.option)||"-";}});CR.Field.mask(b);CR.SerialField.superclass.constructor.call(this,b);this.addEvents("serialchange");this.crDestroyed=false;this.crContentsInitial=this.crContents;this.crRowDescriptionInitial=this.crRowDescription;this.crSuperclassOnTriggerClick=this.onTriggerClick;this.onTriggerClick=this.crOnTriggerClick;this.crSuperclassOnEmptyResults=this.onEmptyResults;this.onEmptyResults=this.crOnEmptyResults;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetValue;this.crDownArrowKeyFlag=false;this.crTabKeyQueryFlag=false;this.crTabKeyFlag=false;this.crSearchWindow=null;this.addListener({render:this.crOnRender,show:CR.Field.showHandler,hide:CR.Field.hideHandler,resize:this.crSetToolTip,beforedestroy:this.crBeforeDestroy,beforequery:this.crBeforeQuery,select:this.crOnSelect,blur:this.crOnBlur,keydown:this.crOnKeyDown,specialkey:this.crOnSpecialKey,keypress:this.crOnKeyPress,change:this.crOnChange,focus:this.crOnFocus});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}if(this.crTableName==="PERSON"){this.crComplexSearchRequired=true;}},crRefreshComponent:function(a){if(a.rowDescription&&this.crGetTableName()===a.tableName&&this.crGetNewContents()===a.targetSerial){this.crSetSerial(a.targetSerial,a.rowDescription);}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"E";},crGetSerialObject:function(){return new CR.SerialObject({serial:this.crContents,rowDescription:this.crRowDescription});},crSetSerial:function(b,c){if(!this.crDestroyed){if(b&&typeof b==="object"&&b.getSerial&&typeof c==="undefined"){c=b.getRowDescription();b=b.getSerial();}if(!b||!c){b="";c="";}var d=true;if(this.crContents===b&&this.crRowDescription===c||(!this.crContents&&!b)){d=false;}var a=this.crGetSerialObject();this.crContents=b;this.crRowDescription=c;this.crSuperclassSetValue(this.crRowDescription);this.crSetToolTip();if(d){this.crOnContentsChange();this.fireEvent("serialchange",this,this.crGetSerialObject(),a);}}},crSetSearchFilterName:function(a){this.crSearchFilterName=a;},crSetSearchParameters:function(b){delete this.lastQuery;if(!this.crDestroyed){var a=this.initialConfig.store;a.removeAll();}this.crSearchParameters=b;this.crSetSerial("","");},crGetTableName:function(){return this.crTableName;},crSetTableName:function(a){if(a!==this.crTableName){this.crSetSerial("","");this.crContents="";this.crContentsInitial="";this.crRowDescription="";this.crRowDescriptionInitial="";this.crAbortOutstandingQuery();this.crTableName=a;if(this.crTableName==="PERSON"){this.crComplexSearchRequired=true;}else{this.crComplexSearchRequired=false;}}},crAbortOutstandingQuery:function(){this.crTabKeyQueryAbort=true;delete this.lastQuery;if(!this.crDestroyed){var a=this.initialConfig.store;a.removeAll();}},crGetNewRowDescription:function(){return this.crRowDescription;},crGetOldRowDescription:function(){return this.crRowDescriptionInitial;},crGetNewContents:function(){return this.crContents;},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return this.crRowDescription;
},crIsDestroyed:function(){return this.crDestroyed;},crIsModified:function(){return this.crModified;},crCollapse:function(){if(!this.crDestroyed){this.collapse();}},crExpand:function(){if(!this.crDestroyed){this.expand();}},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){if(this.dqTask){this.dqTask.cancel();}if(this.taTask){this.taTask.cancel();}var a=this.getValue();var b=this.crTabKeyFlag;this.crTabKeyFlag=false;this.crCollapse();if(b&&a&&a!==this.crRowDescription){this.crTabKeyQueryFlag=true;this.crTabKeyQueryAbort=false;this.crTabKeyQueryText=a;this.doQuery(a);}else{if(!a||!this.crContents){this.crSetSerial("","");}else{this.crSetSerial(this.crContents,this.crRowDescription);}CR.Field.blurHandler(this);}}},crOnTriggerClick:function(){if(this.disabled){if(this.crGetNewContents()){this.crSerialInquiry();}}else{if(this.crDownArrowKeyFlag){this.crDownArrowKeyFlag=false;this.crCollapse();var a=this.minChars;this.minChars=0;this.crSuperclassOnTriggerClick();this.minChars=a;}else{if(this.isExpanded()){this.crSetSerial(this.crContents,this.crRowDescription);this.crCollapse();}this.crComplexSearch();}}},crOnEmptyResults:function(){if(!this.crDestroyed){this.expand();this.innerList.update('<div class="cr-serial-noMatches">No matches found</div>');this.restrictHeight();}},crBeforeQuery:function(j){if(this.dqTask){this.dqTask.cancel();}if(!this.crTableName||this.crKeyHandledFlag||this.crComplexSearchRequired||this.crDestroyed){j.cancel=true;this.crTabKeyQueryFlag=false;}else{var h=new CR.XML();var f=h.addContainer(h.getRootElement(),"sequence");var c=h.addContainer(f,"transaction");var b=h.addContainer(c,"step");var m=h.addContainer(b,"search");h.addText(m,"tableName",this.crTableName);if(this.crRefTableName){var d=h.addContainer(m,"reference");h.addText(d,"tableName",this.crRefTableName);h.addText(d,"columnName",this.crRefColumnName);h.addText(d,"parentSerial",this.crRefParentSerial);}if(this.crSearchFilterName){h.addText(m,"filterName",this.crSearchFilterName);}h.addOption(m,"includeSelectColumns","Y");h.addOption(m,"includeTotalHitCount","Y");h.addCount(m,"returnLimit",this.pageSize.toString());var l;if(this.crSearchParameters){for(var g=0;g<this.crSearchParameters.length;g++){l=h.addContainer(m,"parameter");h.addText(l,"columnName",this.crSearchParameters[g].columnName);var a=this.crSearchParameters[g].contents;if(a==="{queryEvent}"){a=j.query;}h.addText(l,"contents",a);}if(this.crIncludeDescriptionParameter){l=h.addContainer(m,"parameter");h.addText(l,"columnName","DESCRIPTION");h.addText(l,"contents",j.query);}}else{l=h.addContainer(m,"parameter");h.addText(l,"contents",j.query);}var k=this.initialConfig.store;k.baseParams.crXMLData=h.getXMLDocument();if(this.lastQuery===j.query){j.cancel=this.crCheckStoreContents(j.query);}}},crCheckStoreContents:function(d){var f=false;if(!this.crDestroyed&&this.crTabKeyQueryFlag){if(this.crTabKeyQueryAbort){this.crAbortOutstandingQuery();}else{var c=this.initialConfig.store;var b=c.getTotalCount();var g=c.getCount();if(b===1&&g===1&&this.crTabKeyQueryText===d){var a=c.getAt(0);if(a&&a.data&&a.data.serial&&a.data.rowDescription){this.crSetSerial(a.data.serial,a.data.rowDescription);CR.Field.blurHandler(this);f=true;}}if(!f){CR.Core.defer(function(){this.crDownArrowKeyFlag=true;this.crOnTriggerClick();},this);this.crOnTabKeyQueryFailure();f=true;}}}this.crTabKeyQueryFlag=false;return f;},crOnKeyDown:function(d,f){var c=f.getKey();this.crKeyHandledFlag=false;this.crDownArrowKeyFlag=false;if(!CR.Core.extV3){this.crTabKeyFlag=false;}var g=false;if(c===Ext.EventObject.TAB){if(!CR.Core.extV3){this.crTabKeyFlag=true;}}else{if(c===Ext.EventObject.DOWN){if(!this.crComplexSearchRequired){this.crDownArrowKeyFlag=true;}}else{if(c===Ext.EventObject.HOME){if(f.shiftKey){f.stopEvent();this.crKeyHandledFlag=true;this.crOnBlur();this.crSerialInquiry();}else{if(f.ctrlKey){f.stopEvent();this.crKeyHandledFlag=true;this.crOnBlur();this.crComplexSearch();}}}else{if(c===Ext.EventObject.DELETE){f.stopEvent();this.crKeyHandledFlag=true;g=true;if(this.crNullAllowed){this.crSetSerial("","");}}else{if(c===Ext.EventObject.INSERT||c===Ext.EventObject.BACKSPACE){g=true;}else{if(f.ctrlKey){if(c===Ext.EventObject.X||c===Ext.EventObject.V){g=true;}else{if(c===Ext.EventObject.Z){f.stopEvent();this.crKeyHandledFlag=true;var b=this.crGetNewContents();var a=this.crGetOldContents();if(b!==a&&!this.isExpanded()){this.crRedoContents=b;this.crRedoRowDescription=this.crGetNewRowDescription();this.crSetSerial(a,this.crGetOldRowDescription());}}else{if(c===Ext.EventObject.Y){f.stopEvent();this.crKeyHandledFlag=true;if(this.crRedoContents!==undefined&&this.crGetNewContents()===this.crGetOldContents()&&!this.isExpanded()){this.crSetSerial(this.crRedoContents,this.crRedoRowDescription);this.crRedoContents=undefined;this.crRedoRowDescription=undefined;}}}}}}}}}}if(g){if(!this.crComplexSearchRequired){this.crCollapse();}else{if(!this.crKeyHandledFlag){f.stopEvent();this.crKeyHandledFlag=true;this.crComplexSearch();}}}},crOnSpecialKey:function(b,c){var a=c.getKey();if(CR.Core.extV3){this.crTabKeyFlag=false;}if(a===Ext.EventObject.TAB){if(CR.Core.extV3){this.crTabKeyFlag=true;}}else{if(a===Ext.EventObject.ENTER){this.crOnBlur();this.crEnterKeyHandler();}}},crOnKeyPress:function(a,b){if(CR.Core.convertKeyPressEventToCharacter(b)){if(!this.crComplexSearchRequired){this.crCollapse();}else{if(!this.crKeyHandledFlag){b.stopEvent();this.crKeyHandledFlag=true;this.crComplexSearch();}}}},crComplexSearch:function(){if(!this.crDestroyed&&!this.crSearchWindow){var b=this.findParentByType("crFMPanel");var a=null;if(b){if(b.crFMPanelContainer){a=b.crFMPanelContainer;}if(b.crFMPanelContainerId){a=Ext.getCmp(b.crFMPanelContainerId);}else{a=b.ownerCt;}}if(!a&&CR.FMPanel){a=CR.FMPanel.getDefaultContainer();}if(this.crTableName==="PERSON"){if(!this.crPersonSearchInitiated){this.crPersonSearchInitiated=true;CR.Core.defer(CR.PersonSearch.openWindow,undefined,[{crTitle:this.crGetColumnDescription()+" Search",crCallbackScope:this,crCallbackFunction:function(c){if(!this.crDestroyed){if(c.data&&c.data.serial){this.crSetSerial(c.data.serial,c.data.rowDescription);}this.focus(false,true);this.crPersonSearchInitiated=false;}}}]);}}else{CR.Core.defer(CR.SearchPanel.openWindow,undefined,[{tableName:this.crGetTableName(),tableDescription:this.crGetColumnDescription(),containerForViewSelections:a,clearButtonCreate:this.crNullAllowed,parentComponent:this,callbackScope:this,callbackFunction:function(c){if(!this.crDestroyed){if(c.serial!==undefined){this.crSetSerial(c.serial,c.rowDescription);}if(c.mode==="destroy"||c.mode==="insert"){this.focus(false,true);}}}}]);}}},crSerialInquiry:function(){var c=this.crGetNewContents();if(c&&!this.crDestroyed){var b=this.findParentByType("crFMPanel");var a=null;if(b){if(b.crFMPanelContainer){a=b.crFMPanelContainer;}if(b.crFMPanelContainerId){a=Ext.getCmp(b.crFMPanelContainerId);}else{a=b.ownerCt;}}if(this.crGetTableName()==="TRANSACTION"&&CR.HistoryResultPanel){CR.HistoryResultPanel.tranSerialClick(a.getId(),c);}else{if(a&&a.isXType("crWindow")){a=new CR.Window({autoHeight:true,autoScroll:true,autoWidth:true,modal:true,listeners:{show:function(){this.autoHeight=false;if(this.getHeight()>Ext.getBody().getHeight()){this.setHeight(Ext.getBody().getHeight()-50);}this.center();}}});}if(!a&&CR.FMPanel){a=CR.FMPanel.getDefaultContainer();}if(a&&CR.FMPanel){CR.FMPanel.open({container:a,fmRequest:{requestType:"update",tableName:this.crGetTableName(),targetSerial:c}});}}}},crOnSelect:function(c,a,b){var d=CR.Core.safeGet(a,["data","rowStatus","option"]);switch(d){case"C":this.el.addClass("cr-rowStatus-closed");break;case"O":this.el.addClass("cr-rowStatus-chargedOff");break;case"V":this.el.addClass("cr-rowStatus-voided");break;case"E":this.el.addClass("cr-rowStatus-expired");break;case"F":this.el.addClass("cr-rowStatus-effectiveInFuture");break;}this.crSetSerial(a.data.serial,a.data.rowDescription);},crOnChange:function(){this.crModified=true;},crOnFocus:function(){this.crPersonSearchInitiated=false;},crBeforeDestroy:function(){if(this.dqTask){this.dqTask.cancel();}if(this.taTask){this.taTask.cancel();}this.crContents=this.crContentsInitial;this.crRowDescription=this.crRowDescriptionInitial;CR.Field.beforeDestroyHandler(this);if(this.crSearchWindow){var a=this.crSearchWindow;CR.Core.defer(function(){a.crClose();});}},crOnRender:function(){CR.Field.renderHandler(this);this.crSetToolTip();this.el.addListener("keypress",function(){this.removeClass(["cr-rowStatus-closed","cr-rowStatus-chargedOff","cr-rowStatus-voided","cr-rowStatus-expired","cr-rowStatus-effectiveInFuture"]);});},crSetToolTip:function(){CR.Field.setToolTip(this,this.crRowDescription);}});Ext.reg("crSerialField",CR.SerialField);CR.TextField=Ext.extend(Ext.form.TextField,{crColumnName:"",crColumnDescription:"",crContents:"",crNullAllowed:true,crCalculation:undefined,crPrivilegeToGet:true,crTextNumericOnly:false,crTextBlankAllowed:true,crMaximumLength:undefined,crEnterKeyHandler:function(){},width:CR.Field.DEFAULT_TEXT_WIDTH,grow:true,constructor:function(c){var a=Ext.apply({},c);a.name=a.crColumnName||"";a.fieldLabel=a.crColumnDescription||"";a.crContents=a.crContents||this.crContents;a.value=a.crContents;if(a.crTextBlankAllowed===undefined){a.crTextBlankAllowed=this.crTextBlankAllowed;}a.allowBlank=a.crTextBlankAllowed;if(a.crPanelType==="FMPanel"){a.width=a.width||CR.Field.FMPANEL_TEXT_WIDTH;}a.maxLength=undefined;if(a.crMaximumLength){a.maxLength=a.crMaximumLength;}a.growMin=a.width||this.width;if(a.crTextNumericOnly){a.maskRe=/[0-9]/;}a.enableKeyEvents=true;if(a.listeners){a.crAdditionalListeners=a.listeners;delete a.listeners;}CR.Field.mask(a);CR.TextField.superclass.constructor.call(this,a);this.crDestroyed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;var b=this;this.addListener({render:this.crOnRender,show:CR.Field.showHandler,hide:CR.Field.hideHandler,resize:this.crSetToolTip,beforedestroy:CR.Field.beforeDestroyHandler,blur:this.crOnBlur,keydown:CR.Field.keyDownHandler,specialkey:CR.Field.specialKeyHandler,change:function(){if(b.crOnContentsChange){b.crOnContentsChange();}}});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"S";},crSetContents:function(a){if(!this.crDestroyed){this.crSuperclassSetValue(a);this.crSetToolTip();}},crGetNewContents:function(){return this.crDestroyed?this.crContentsInitial:this.getValue();},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return this.crGetNewContents();},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){this.crSetToolTip();CR.Field.blurHandler(this);}},crOnRender:function(){CR.Field.renderHandler(this);this.crSetToolTip();},crSetToolTip:function(){if(!this.crDestroyed){CR.Field.setToolTip(this,this.getValue());}}});Ext.reg("crTextField",CR.TextField);CR.ColorPickerField=Ext.extend(Ext.form.TextField,{crColumnName:"",crColumnDescription:"",crContents:"",crNullAllowed:true,crPrivilegeToGet:true,crTextBlankAllowed:true,crShowBatchTrigger:true,crMaximumLength:6,maskRe:/[a-fA-F\d]/,stripCharsRe:/[^a-fA-F\d]/g,regex:/[a-fA-F\d]{3}|[a-fA-F\d]{6}/i,regexText:"Invalid color code",crEnterKeyHandler:function(){},width:CR.Field.DEFAULT_TEXT_WIDTH,grow:false,disabled:false,constructor:function(b){var a=Ext.apply({},b);a.name=a.crColumnName||"";a.fieldLabel=a.crColumnDescription||"";a.crContents=a.crContents||this.crContents;a.style=a.style||{};a.style["text-transform"]="uppercase";if(a.crContents&&a.crContents!==""){a.style["color"]="#"+CR.ColorPickerField.calculateForegroundColor(a.crContents);a.style["background"]="#"+a.crContents;}a.value=a.crContents;if(a.crTextBlankAllowed===undefined){a.crTextBlankAllowed=this.crTextBlankAllowed;}a.allowBlank=a.crTextBlankAllowed;if(a.crPanelType==="FMPanel"){a.width=a.width||CR.Field.FMPANEL_TEXT_WIDTH;}a.maxLength=undefined;if(a.crMaximumLength){a.maxLength=a.crMaximumLength;}a.growMin=a.width||this.width;a.enableKeyEvents=true;if(a.listeners){a.crAdditionalListeners=a.listeners;delete a.listeners;}CR.Field.mask(a);CR.ColorPickerField.superclass.constructor.call(this,a);this.crDestroyed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;this.addListener({render:this.crOnRender,show:CR.Field.showHandler,hide:CR.Field.hideHandler,resize:this.crSetToolTip,beforedestroy:CR.Field.beforeDestroyHandler,blur:this.crOnBlur,keydown:CR.Field.keyDownHandler,specialkey:CR.Field.specialKeyHandler,change:this.crUpdateControlColors});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}this.addListener("render",function(){var c=this;var d=new Ext.form.TriggerField({triggerClass:"cr-colorPicker-trigger",onTriggerClick:function(h){var f=[];var j=c.crGetNewContents();var g=new Ext.ColorPalette({style:"width:235px;",value:j});g.colors=["330000","331900","333300","193300","003300","003319","003333","001933","000033","190033","330033","330019","000000","660000","663300","666600","336600","006600","006633","006666","003366","000066","330066","660066","660033","202020","990000","994C00","999900","4C9900","009900","00994C","009999","004C99","000099","4C0099","990099","99004C","404040","CC0000","CC6600","CCCC00","66CC00","00CC00","00CC66","00CCCC","0066CC","0000CC","6600CC","CC00CC","CC0066","606060","FF0000","FF8000","FFFF00","80FF00","00FF00","00FF80","00FFFF","0080FF","0000FF","7F00FF","FF00FF","FF007F","808080","FF3333","FF9933","FFFF33","99FF33","33FF33","33FF99","33FFFF","3399FF","3333FF","9933FF","FF33FF","FF3399","A0A0A0","FF6666","FFB266","FFFF66","B2FF66","66FF66","66FFB2","66FFFF","66B2FF","6666FF","B266FF","FF66FF","FF66B2","C0C0C0","FF9999","FFCC99","FFFF99","CCFF99","99FF99","99FFCC","99FFFF","99CCFF","9999FF","CC99FF","FF99FF","FF99CC","E0E0E0","FFCCCC","FFE5CC","FFFFCC","E5FFCC","CCFFCC","CCFFE5","CCFFFF","CCE5FF","CCCCFF","E5CCFF","FFCCFF","FFCCE5","FFFFFF"];if(j&&g.colors.indexOf(j)===-1){g.colors.push(j);}f.push(g);var i=new CR.Menu({id:"mainMenu",items:f});i.addListener("hide",i.destroy,i);g.addListener("select",function(l,k){c.crSetContents(k);i.hide();});i.showAt(h.getXY());}});d.applyToMarkup(this.getEl());},this);},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"S";},crSetContents:function(a){if(!this.crDestroyed){this.crSuperclassSetValue(a);this.crSetToolTip();this.crUpdateControlColors();}},crGetNewContents:function(){return this.crDestroyed?this.crContentsInitial:this.getValue();},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return this.crGetNewContents();},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){this.setValue(this.getValue().toUpperCase());var a=this.getValue();if(a&&a.length===3){this.crSetContents(""+a[0]+a[0]+a[1]+a[1]+a[2]+a[2]);}this.crSetToolTip();CR.Field.blurHandler(this);}},crOnRender:function(){CR.Field.renderHandler(this);this.crSetToolTip();},crSetToolTip:function(){if(!this.crDestroyed){CR.Field.setToolTip(this,this.getValue());}},crUpdateControlColors:function(d,c,b){var a=this.crGetNewContents();if(a&&(a.length===6||a.length===3)){this.getEl().setStyle("color","#"+CR.ColorPickerField.calculateForegroundColor(a));this.getEl().setStyle("background","#"+a);}else{this.getEl().setStyle("color","#000000");this.getEl().setStyle("background","#ffffff");
}}});Ext.reg("crColorPickerField",CR.ColorPickerField);CR.ColorPickerField.calculateForegroundColor=function(d){var k="000000";if(d){d=d.replace("#","").replace(";","");var l=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;var j=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;d=d.replace(l,function(p,s,q,i){return s+s+q+q+i+i;});var o=j.exec(d);if(o){var c=parseInt(o[1],16);var h=parseInt(o[2],16);var m=parseInt(o[3],16);var a=[c/255,h/255,m/255];for(var f=0;f<a.length;++f){if(a[f]<=0.03928){a[f]=a[f]/12.92;}else{a[f]=Math.pow((a[f]+0.055)/1.055,2.4);}}var n=0.2126*a[0]+0.7152*a[1]+0.0722*a[2];if(n>0.179){k="000000";}else{k="FFFFFF";}}}return k;};CR.TextAreaField=Ext.extend(Ext.form.TextArea,{crColumnName:"",crColumnDescription:"",crContents:"",crNullAllowed:true,crCalculation:undefined,crPrivilegeToGet:true,crTextNumericOnly:false,crTextBlankAllowed:true,crMaximumLength:undefined,crTextNewLineAllowed:false,crEnterKeyHandler:function(){},crSuppressTooltip:false,width:CR.Field.DEFAULT_TEXTAREA_WIDTH,height:CR.Field.DEFAULT_TEXTAREA_HEIGHT,grow:true,stripCharsRe:/[^\x0A\x20-\x7E]/g,constructor:function(b){var a=Ext.apply({},b);a.name=a.crColumnName||"";a.fieldLabel=a.crColumnDescription||"";a.crContents=a.crContents||this.crContents;a.value=a.crContents;if(a.crTextBlankAllowed===undefined){a.crTextBlankAllowed=this.crTextBlankAllowed;}a.allowBlank=a.crTextBlankAllowed;if(a.crPanelType==="FMPanel"){a.width=a.width||CR.Field.FMPANEL_TEXTAREA_WIDTH;}a.maxLength=undefined;if(a.crMaximumLength){a.maxLength=a.crMaximumLength;}if(a.crMaximumLengthText){a.maxLengthText=a.crMaximumLengthText;}a.growMin=a.height||this.height;if(a.crTextNumericOnly){a.maskRe=/[0-9]/;}a.enableKeyEvents=true;if(a.listeners){a.crAdditionalListeners=a.listeners;delete a.listeners;}CR.Field.mask(a);CR.TextAreaField.superclass.constructor.call(this,a);this.crDestroyed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;this.addListener({render:this.crOnRender,show:CR.Field.showHandler,hide:CR.Field.hideHandler,resize:this.crSetToolTip,beforedestroy:CR.Field.beforeDestroyHandler,blur:this.crOnBlur,keydown:CR.Field.keyDownHandler,specialkey:CR.Field.specialKeyHandler});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},processValue:function(a){if(this.stripCharsRe){var b=a.replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"').replace(this.stripCharsRe,"");if(b!==a){this.setRawValue(b);return b;}}return a;},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"S";},crSetContents:function(a){if(!this.crDestroyed){this.crSuperclassSetValue(a);this.crSetToolTip();}},crGetNewContents:function(){var a=this.crDestroyed?this.crContentsInitial:this.getValue();if(!this.crTextNewLineAllowed){a=a.replace(/\n/g," ");}return a;},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return this.crGetNewContents();},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){this.crSetToolTip();CR.Field.blurHandler(this);}},crOnRender:function(){CR.Field.renderHandler(this);this.crSetToolTip();},crSetToolTip:function(){if(!this.crDestroyed&&!this.crSuppressTooltip){CR.Field.setToolTip(this,this.getValue());}}});Ext.reg("crTextAreaField",CR.TextAreaField);CR.MoneyField=Ext.extend(Ext.form.TextField,{crColumnName:"",crColumnDescription:"",crContents:"0.00",crNullAllowed:false,crCalculation:undefined,crPrivilegeToGet:true,crNegativeAllowed:true,crEnterKeyHandler:function(){},width:CR.Field.DEFAULT_MONEY_WIDTH,selectOnFocus:true,constructor:function(c){var a=Ext.apply({},c);a.name=a.crColumnName||"";a.fieldLabel=a.crColumnDescription||"";if(a.crPanelType==="FMPanel"){a.width=a.width||CR.Field.FMPANEL_MONEY_WIDTH;}a.value=a.crContents||this.crContents;a.value=CR.MoneyField.convertToDisplay(a.value);a.crContents=CR.MoneyField.convertFromDisplay(a.value);if(a.crNegativeAllowed===undefined){a.crNegativeAllowed=this.crNegativeAllowed;}if(!a.crNegativeAllowed){a.maskRe=/[0123456789.$]/;}else{a.maskRe=/[0123456789.$-]/;}a.enableKeyEvents=true;if(a.listeners){a.crAdditionalListeners=a.listeners;delete a.listeners;}CR.Field.mask(a);CR.MoneyField.superclass.constructor.call(this,a);this.crDestroyed=false;this.crNullAllowed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;var b=this;this.addListener({render:CR.Field.renderHandler,show:CR.Field.showHandler,hide:CR.Field.hideHandler,beforedestroy:CR.Field.beforeDestroyHandler,blur:this.crOnBlur,keydown:CR.Field.keyDownHandler,specialkey:CR.Field.specialKeyHandler,keyup:this.crOnKeyUp,change:function(){if(b.crOnContentsChange){b.crOnContentsChange();}}});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"M";},crSetContents:function(a){if(!this.crDestroyed){this.crSuperclassSetValue(CR.MoneyField.convertToDisplay(a));}},crGetNewContents:function(){return this.crDestroyed?this.crContentsInitial:CR.MoneyField.convertFromDisplay(this.getValue());},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return CR.MoneyField.convertToDisplay(this.crGetNewContents());},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){this.crSuperclassSetValue(CR.MoneyField.convertToDisplay(this.getValue()));CR.Field.blurHandler(this);}},crOnKeyUp:function(){this.crSuperclassSetValue(CR.MoneyField.convertToDisplay(this.getValue(),this.crNegativeAllowed,true));}});Ext.reg("crMoneyField",CR.MoneyField);CR.MoneyField.convertToDisplay=function(l,i,c){if(typeof l!=="string"||!l){l="";}var g=false;var f=false;var b=false;var j="";var d="";var k=0;if(k<l.length&&l.charAt(k)==="$"){++k;b=true;}if(i||i===undefined){if(k<l.length&&l.charAt(k)==="-"){++k;g=true;}if(k<l.length&&l.charAt(l.length-1)==="-"){g=!g;}}while(k<l.length){var a=l.charAt(k);if(a==="."){f=true;}else{if(a>="0"&&a<="9"){if(!f){j+=a;}else{if(d.length<2){d+=a;}}}}++k;}while(j.length>1&&j.charAt(0)==="0"){j=j.substring(1);}if(!c){f=true;b=true;if(j.length===0){j="0";}while(d.length<2){d+="0";}if(g&&j==="0"&&d==="00"){g=false;}}var h="";if(b){h="$";}if(g){h+="-";}k=j.length%3;if(k===0){k=3;}while(j.length>3){h+=j.substring(0,k);h+=",";j=j.substring(k);k=3;}h+=j;if(f){h+=".";h+=d;}return h;};CR.MoneyField.convertFromDisplay=function(a){if(typeof a!=="string"||!a){a="";}return a.replace(/[^0123456789.-]/g,"");};CR.MoneyField.convertFromValue=function(a){var b="";if(typeof a==="number"){b=Number(a).toFixed(2);}else{if(typeof a==="string"){if(a){b=a.replace(/[^0123456789.]/g,"");b=(a.trim().startsWith("-")?"-":"")+Number(b).toFixed(2);}}}return b;};CR.RateField=Ext.extend(Ext.form.TextField,{crColumnName:"",crColumnDescription:"",crContents:"0.000",crNullAllowed:false,crCalculation:undefined,crPrivilegeToGet:true,crNegativeAllowed:true,crMinDecimalPlaces:0,crEnterKeyHandler:function(){},width:CR.Field.DEFAULT_RATE_WIDTH,selectOnFocus:true,constructor:function(c){var a=Ext.apply({},c);a.name=a.crColumnName||"";a.fieldLabel=a.crColumnDescription||"";if(a.crPanelType==="FMPanel"){a.width=a.width||CR.Field.FMPANEL_RATE_WIDTH;}a.value=a.crContents||this.crContents;a.value=CR.RateField.convertToDisplay(a.value);a.crContents=CR.RateField.convertFromDisplay(a.value);if(a.crNegativeAllowed===undefined){a.crNegativeAllowed=this.crNegativeAllowed;}if(!a.crNegativeAllowed){a.maskRe=/[0123456789.%]/;}else{a.maskRe=/[0123456789.%-]/;}a.enableKeyEvents=true;if(a.listeners){a.crAdditionalListeners=a.listeners;delete a.listeners;}CR.Field.mask(a);CR.RateField.superclass.constructor.call(this,a);this.crDestroyed=false;this.crNullAllowed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;var b=this;this.addListener({render:CR.Field.renderHandler,show:CR.Field.showHandler,hide:CR.Field.hideHandler,beforedestroy:CR.Field.beforeDestroyHandler,blur:this.crOnBlur,keydown:CR.Field.keyDownHandler,specialkey:CR.Field.specialKeyHandler,keyup:this.crOnKeyUp,change:function(){if(b.crOnContentsChange){b.crOnContentsChange();}}});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"R";},crSetContents:function(a){if(!this.crDestroyed){this.crSuperclassSetValue(CR.RateField.convertToDisplay(a,this.crNegativeAllowed,false,this.crMinDecimalPlaces));}},crGetNewContents:function(){return this.crDestroyed?this.crContentsInitial:CR.RateField.convertFromDisplay(this.getValue(),this.crNegativeAllowed,false,this.crMinDecimalPlaces);},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return CR.RateField.convertToDisplay(this.crGetNewContents(),this.crNegativeAllowed,false,this.crMinDecimalPlaces);},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){this.crSuperclassSetValue(CR.RateField.convertToDisplay(this.getValue(),this.crNegativeAllowed,false,this.crMinDecimalPlaces));CR.Field.blurHandler(this);}},crOnKeyUp:function(){this.crSuperclassSetValue(CR.RateField.convertToDisplay(this.getValue(),this.crNegativeAllowed,true));}});Ext.reg("crRateField",CR.RateField);CR.RateField.convertToDisplay=function(k,i,b,g){if(typeof k!=="string"||!k){k="";}if(!g){g=0;}var f=false;var c=false;var d=false;var m="";var l="";var j=0;if(i||i===undefined){if(j<k.length&&k.charAt(j)==="-"){++j;f=true;}}if(j<k.length&&k.charAt(k.length-1)==="%"){d=true;}while(j<k.length){var a=k.charAt(j);if(a==="."){c=true;}else{if(a>="0"&&a<="9"){if(!c){m+=a;}else{l+=a;}}}++j;}if(!b){d=true;if(m.length===0){m="0";}while(m.length>1&&m.charAt(0)==="0"){m=m.substring(1);}while(l.length>0&&l.charAt(l.length-1)==="0"){l=l.substring(0,l.length-1);}l=l.padEnd(g,"0");if(l.length===0){c=false;}else{c=true;}if(f&&m==="0"&&l===""){f=false;}}var h="";if(f){h="-";}h+=m;if(c){h+=".";h+=l;}if(d){h+="%";}return h;};CR.RateField.convertFromDisplay=function(a){if(typeof a!=="string"||!a){a="";}return a.replace(/[^0123456789.-]/g,"");};CR.CountField=Ext.extend(Ext.form.NumberField,{crColumnName:"",crColumnDescription:"",crContents:"0",crNullAllowed:false,crCalculation:undefined,crPrivilegeToGet:true,crNegativeAllowed:true,crMaximumAbsoluteValue:undefined,crEnterKeyHandler:function(){},width:CR.Field.DEFAULT_COUNT_WIDTH,selectOnFocus:true,constructor:function(c){var a=Ext.apply({},c);a.name=a.crColumnName||"";a.fieldLabel=a.crColumnDescription||"";if(a.crPanelType==="FMPanel"){a.width=a.width||CR.Field.FMPANEL_COUNT_WIDTH;}a.allowDecimals=false;a.value=a.crContents||this.crContents;a.value=a.value.valueOf();a.crContents=a.value.toString();if(a.crNegativeAllowed===undefined){a.crNegativeAllowed=this.crNegativeAllowed;}a.allowNegative=a.crNegativeAllowed;a.maxValue=undefined;if(a.crMaximumAbsoluteValue){a.maxValue=a.crMaximumAbsoluteValue;}a.enableKeyEvents=true;if(a.listeners){a.crAdditionalListeners=a.listeners;delete a.listeners;}CR.Field.mask(a);CR.CountField.superclass.constructor.call(this,a);this.crDestroyed=false;this.crNullAllowed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;var b=this;this.addListener({render:CR.Field.renderHandler,show:CR.Field.showHandler,hide:CR.Field.hideHandler,beforedestroy:CR.Field.beforeDestroyHandler,blur:this.crOnBlur,keydown:CR.Field.keyDownHandler,specialkey:CR.Field.specialKeyHandler,change:function(){if(b.crOnContentsChange){b.crOnContentsChange();}}});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"C";},crSetContents:function(a){if(!this.crDestroyed){this.crSuperclassSetValue(a);}},crGetNewContents:function(){return this.crDestroyed?this.crContentsInitial:this.getValue().toString();},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return this.crGetNewContents();},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){var a=this.getValue();if(a===undefined||a===null){a=0;}a=a.toString();if(!a){a="0";}while(a.length>1&&a.charAt(0)==="0"){a=a.substring(1);}this.crSuperclassSetValue(a);CR.Field.blurHandler(this);}}});Ext.reg("crCountField",CR.CountField);CR.DateField=Ext.extend(Ext.form.DateField,{crColumnName:"",crColumnDescription:"",crContents:"",crNullAllowed:true,crCalculation:undefined,crPrivilegeToGet:true,crFutureAllowed:true,crAddDaysToCurrentDate:false,crEnterKeyHandler:function(){},width:CR.Field.DEFAULT_DATE_WIDTH,constructor:function(c){var a=Ext.apply({},c);a.name=a.crColumnName||"";a.fieldLabel=a.crColumnDescription||"";if(a.crPanelType==="FMPanel"){a.width=a.width||CR.Field.FMPANEL_DATE_WIDTH;}if(!a.crContents){a.value="";a.crContents="";}else{a.value=CR.DateField.convertToJavaScript(a.crContents);a.crContents=CR.DateField.convertFromJavaScript(a.value);}if(a.crNullAllowed===undefined){a.crNullAllowed=this.crNullAllowed;}a.allowBlank=a.crNullAllowed;a.enableKeyEvents=true;if(a.listeners){a.crAdditionalListeners=a.listeners;delete a.listeners;}CR.Field.mask(a);if(a.crAddDaysToCurrentDate===undefined){a.crAddDaysToCurrentDate=this.crAddDaysToCurrentDate;}if(a.crAddDaysToCurrentDate){a.beforeBlur=function(){var g=this.getRawValue();if(Number(g)<=365){var d=CR.DateField.convertToJavaScript(CR.Login.postingDate);d.setDate(d.getDate()+Number(g));this.setValue(d);}else{var f=this.parseDate(g);if(f){this.setValue(f);}}};}CR.DateField.superclass.constructor.call(this,a);this.crDestroyed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;var b=this;this.addListener({render:CR.Field.renderHandler,show:CR.Field.showHandler,hide:CR.Field.hideHandler,beforedestroy:CR.Field.beforeDestroyHandler,blur:this.crOnBlur,keydown:CR.Field.keyDownHandler,specialkey:CR.Field.specialKeyHandler,change:function(){if(b.crOnContentsChange){b.crOnContentsChange();}}});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"D";},crSetContents:function(a){if(!this.crDestroyed){if(!a){this.crSuperclassSetValue("");}else{if(typeof a==="object"){this.crSuperclassSetValue(a);}else{this.crSuperclassSetValue(CR.DateField.convertToJavaScript(a));}}}},crGetNewContents:function(){return this.crDestroyed?this.crContentsInitial:CR.DateField.convertFromJavaScript(this.getValue());},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return CR.DateField.convertToDisplay(this.crGetNewContents());},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){CR.Field.blurHandler(this);}}});Ext.reg("crDateField",CR.DateField);CR.DateField.convertToJavaScript=function(c){var b=null;if(c&&c.length===10){var g;
var a;var f;if(c.charAt(2)==="/"&&c.charAt(5)==="/"){g=Number(c.substring(6));a=Number(c.substring(0,2)-1);f=Number(c.substring(3,5));}else{g=Number(c.substring(0,4));a=Number(c.substring(5,7)-1);f=Number(c.substring(8));}b=new Date(g,a,f);}return b;};CR.DateField.convertFromJavaScript=function(a){var d="";if(a){var c=a.getFullYear();var f=a.getMonth()+1;var b=a.getDate();if(f<10){f="0"+f;}if(b<10){b="0"+b;}d=c+"-"+f+"-"+b;}return d;};CR.DateField.convertToDisplay=function(a){var b="";if(a){if(typeof a==="object"){b=CR.DateField.convertFromJavaScript(a);}else{b=a;}if(b.length===10&&b.charAt(4)==="-"&&b.charAt(7)==="-"){b=b.substring(5,7)+"/"+b.substring(8,10)+"/"+b.substring(0,4);}}return b;};CR.DateField.convertFromDisplay=function(a){var b="";if(typeof a==="object"){b=CR.DateField.convertFromJavaScript(a);}else{if(typeof a!=="string"||!a){a="";}b=a;if(b.length===10&&b.charAt(2)==="/"&&b.charAt(5)==="/"){b=b.substring(6,10)+"-"+b.substring(0,2)+"-"+b.substring(3,5);}}return b;};CR.DateField.convertFromMMDDYY=function(f,b){if(typeof f!=="string"||!f){f="";}var h="";var c;var i;var a;var g;if(f.length===8&&f.charAt(2)==="-"&&f.charAt(5)==="-"){i=Number(f.substring(6));if(b){i=i+2000;}a=Number(f.substring(0,2)-1);g=Number(f.substring(3,5));c=new Date(i,a,g);h=CR.DateField.convertFromJavaScript(c);}return h;};CR.DateField.convertFromMMDDYYYY=function(c){if(typeof c!=="string"||!c){c="";}var g="";var b;var h;var a;var f;if(c.length===10&&c.charAt(2)==="-"&&c.charAt(5)==="-"){h=Number(c.substring(6));a=Number(c.substring(0,2)-1);f=Number(c.substring(3,5));b=new Date(h,a,f);g=CR.DateField.convertFromJavaScript(b);}return g;};CR.TimeField=Ext.extend(Ext.form.TriggerField,{crColumnName:"",crColumnDescription:"",crContents:"",crNullAllowed:true,crCalculation:undefined,crPrivilegeToGet:true,crEnterKeyHandler:function(){},crAfterTimeUpdateFunction:function(){},width:CR.Field.DEFAULT_TIME_WIDTH,triggerClass:"cr-time-trigger",constructor:function(c){var a=Ext.apply({},c);a.name=a.crColumnName||"";a.fieldLabel=a.crColumnDescription||"";if(a.crPanelType==="FMPanel"){a.width=a.width||CR.Field.FMPANEL_TIME_WIDTH;}a.crContents=a.crContents||this.crContents;a.value=CR.TimeField.convertToDisplay(a.crContents);if(a.crNullAllowed===undefined){a.crNullAllowed=this.crNullAllowed;}a.allowBlank=a.crNullAllowed;a.maxLength=23;a.enableKeyEvents=true;if(a.listeners){a.crAdditionalListeners=a.listeners;delete a.listeners;}CR.Field.mask(a);CR.TimeField.superclass.constructor.call(this,a);this.crDestroyed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;this.crSuperclassOnTriggerClick=this.onTriggerClick;this.onTriggerClick=this.crOnTriggerClick;var b=this;this.addListener({render:CR.Field.renderHandler,show:CR.Field.showHandler,hide:CR.Field.hideHandler,beforedestroy:this.crBeforeDestroy,blur:this.crOnBlur,keydown:this.crOnKeyDown,specialkey:this.crOnSpecialKey,keypress:this.crOnKeyPress,valid:function(){if(b.crOnContentsChange&&(b.startValue||b.crContentsInitial||"")!==b.value){b.crOnContentsChange();}}});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"T";},crSetContents:function(a){if(!this.crDestroyed){this.crSuperclassSetValue(CR.TimeField.convertToDisplay(a));}},crGetNewContents:function(){var a=this.crDestroyed?this.crContentsInitial:CR.TimeField.convertFromDisplay(this.getValue());if(a&&a.length===19){a+=" DEF";}return a;},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return CR.TimeField.convertToDisplay(this.crGetNewContents());},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){CR.Field.blurHandler(this);}},crBeforeDestroy:function(){if(this.crTimeWindow){var a=this.crTimeWindow;this.crTimeWindow=null;a.crClose();}CR.Field.beforeDestroyHandler(this);},crOnKeyDown:function(b,c){this.crKeyHandledFlag=false;CR.Field.keyDownHandler(b,c);if(!this.crKeyHandledFlag){var a=c.getKey();if(a===Ext.EventObject.DELETE){c.stopEvent();this.crKeyHandledFlag=true;if(this.crNullAllowed){this.crSetContents("");if(this.crAfterTimeUpdateFunction){this.crAfterTimeUpdateFunction();}}}else{if(a===Ext.EventObject.BACKSPACE||a===Ext.EventObject.INSERT){this.crKeyHandledFlag=true;}else{if(c.ctrlKey){if(a===Ext.EventObject.X||a===Ext.EventObject.V){this.crKeyHandledFlag=true;}}}if(this.crKeyHandledFlag){c.stopEvent();this.crTimePrompts();}}}},crOnSpecialKey:function(a,b){CR.Field.specialKeyHandler(a,b);},crOnKeyPress:function(a,b){if(!this.crKeyHandledFlag&&CR.Core.convertKeyPressEventToCharacter(b)){b.stopEvent();this.crKeyHandledFlag=true;this.crTimePrompts();}},crOnTriggerClick:function(){this.crTimePrompts();},crTimePrompts:function(){if(!this.crDestroyed&&!this.crTimeWindow){var w=CR.Field.DEFAULT_DATE_WIDTH;var v=50;var m=50;var j=50;var a=75;var B=this.crGetNewContents();if(!B){B=new Date();}var l=CR.TimeField.getTimeBreakdown(B);var A=[];for(var u=0;u<24;++u){B=u.toString();while(B.length<2){B="0"+B;}A.push([B,B]);}var t=[];for(u=0;u<60;++u){B=u.toString();while(B.length<2){B="0"+B;}t.push([B,B]);}var q=[["","Default"],["EST","EST"],["EDT","EDT"],["CST","CST"],["CDT","CDT"],["MST","MST"],["MDT","MDT"],["PST","PST"],["PDT","PDT"],["AST","AST"],["ADT","ADT"],["HST","HST"],["UTC","UTC"]];var b=this;var n=function(){var C=g.crGetNewContents()+" "+d.crGetNewContents()+":"+z.crGetNewContents()+":"+x.crGetNewContents();var i=k.crGetNewContents();if(i){C+=" "+i;}b.crSetContents(C);r.crClose();};var g=new CR.DateField({crContents:l.dateValue,width:w,crNullAllowed:false,crColumnDescription:"Date",crEnterKeyHandler:n});var d=new CR.OptionField({crContents:l.hourValue,width:v,crColumnDescription:"Hour",crOptions:A,crEnterKeyHandler:n});var z=new CR.OptionField({crContents:l.minuteValue,width:m,crColumnDescription:"Minute",crOptions:t,crEnterKeyHandler:n});var x=new CR.OptionField({crContents:l.secondValue,width:j,crColumnDescription:"Second",crOptions:t,crEnterKeyHandler:n});var k=new CR.OptionField({crContents:l.localTimeName,width:a,crColumnDescription:"Time Name",crOptions:q,crEnterKeyHandler:n});var s=w+v+m+j+a;var p=new CR.Panel({columnWidth:w/s,layout:"form",border:false,labelAlign:"top",items:[g]});var o=new CR.Panel({columnWidth:v/s,layout:"form",border:false,labelAlign:"top",items:[d]});var h=new CR.Panel({columnWidth:m/s,layout:"form",border:false,labelAlign:"top",items:[z]});var c=new CR.Panel({columnWidth:j/s,layout:"form",border:false,labelAlign:"top",items:[x]});var y=new CR.Panel({columnWidth:a/s,layout:"form",border:false,labelAlign:"top",items:[k]});var f=new CR.Panel({layout:"column",autoHeight:true,autoWidth:true,labelAlign:"top",items:[p,o,h,c,y]});var r=new CR.Window({title:this.crGetColumnDescription(),modal:true,autoHeight:true,width:s+50,items:[f]});b.crTimeWindow=r;r.addListener("beforedestroy",function(){if(b.crTimeWindow){b.crTimeWindow=null;if(!b.crIsDestroyed()){b.focus(false,true);}if(b.crAfterTimeUpdateFunction){b.crAfterTimeUpdateFunction();}}});r.addButton({text:"OK",handler:n});r.addButton({text:"Now",handler:function(){var i=CR.TimeField.getTimeBreakdown(new Date());g.crSetContents(i.dateValue);d.crSetContents(i.hourValue);z.crSetContents(i.minuteValue);x.crSetContents(i.secondValue);k.crSetContents(i.localTimeName);n();}});if(this.crNullAllowed){r.addButton({text:"Clear",handler:function(){b.crSetContents("");r.crClose();}});}r.addButton({text:"Cancel",handler:function(){r.crClose();}});r.show();g.focus(true,true);}}});Ext.reg("crTimeField",CR.TimeField);CR.TimeField.tzLUT={UTC:0,GMT:0,AST:-4,ADT:-3,EST:-5,EDT:-4,CST:-6,CDT:-5,MST:-7,MDT:-6,PST:-8,PDT:-7,AKST:-9,AKDT:-8,HST:-10,HAST:-10,HADT:-9,SST:-11,SDT:-10,CHST:10};CR.TimeField.convertToJavaScript=function(g){if(typeof g==="string"&&g.length>19){var h=g.split(" ");var a=h[0].split("-");var d=h[1].split(":");var f=new Date(+a[0],+a[1]-1,+a[2],d[0],d[1],d[2]);var c=(f.getTimezoneOffset()/-60);var b=CR.TimeField.tzLUT[h[2]];if(isNaN(b)){b=c;}var i=b-c;f.setHours(f.getHours()-i);return f;}else{return new Date(g);}};CR.TimeField.convertFromJavaScript=function(b){var a="";if(b){a+=b.getFullYear();a+="-";a+=(""+(b.getMonth()+1)).padStart(2,"0");a+="-";a+=(""+b.getDate()).padStart(2,"0");a+=" ";a+=(""+b.getHours()).padStart(2,"0");a+=":";a+=(""+b.getMinutes()).padStart(2,"0");a+=":";a+=(""+b.getSeconds()).padStart(2,"0");a+=" ";a+=b.getTimezone();}return a;};CR.TimeField.getTimeBreakdown=function(b){var a={};if(b){if(typeof b==="string"){a.dateValue=b.substring(0,10);a.hourValue=b.substring(11,13);a.minuteValue=b.substring(14,16);a.secondValue=b.substring(17,19);a.localTimeName="";if(b.length>20){a.localTimeName=b.substring(20);if(a.localTimeName==="DEF"){a.localTimeName="";}}}else{if(Ext.isDate(b)){a.dateValue=CR.DateField.convertFromJavaScript(b);a.hourValue=b.getHours().toString();if(a.hourValue.length===1){a.hourValue="0"+a.hourValue;}a.minuteValue=b.getMinutes().toString();if(a.minuteValue.length===1){a.minuteValue="0"+a.minuteValue;}a.secondValue=b.getSeconds().toString();if(a.secondValue.length===1){a.secondValue="0"+a.secondValue;}a.localTimeName="";}}}return a;};CR.TimeField.convertToDisplay=function(a){if(typeof a!=="string"||!a){a="";}var b=a;if(a.length>=10&&a.charAt(4)==="-"&&a.charAt(7)==="-"){b=a.substring(5,7)+"/"+a.substring(8,10)+"/"+a.substring(0,4)+a.substring(10);}return b;};CR.TimeField.convertFromDisplay=function(b){if(typeof b!=="string"||!b){b="";}var a=b;if(b.length>=10&&b.charAt(2)==="/"&&b.charAt(5)==="/"){a=b.substring(6,10)+"-"+b.substring(0,2)+"-"+b.substring(3,5)+b.substring(10);}return a;};CR.DocumentField=Ext.extend(CR.TextAreaField,{crTextNewLineAllowed:true});Ext.reg("crDocumentField",CR.DocumentField);CR.Checkbox=Ext.extend(Ext.form.Checkbox,{crColumnName:"",crColumnDescription:"",crContents:"",crNullAllowed:false,crCalculation:undefined,crPrivilegeToGet:true,crCheckedValue:"Y",crCheckedValueText:"Yes",crUncheckedValue:"N",crUncheckedValueText:"No",crEnterKeyHandler:function(){},constructor:function(b){var a=Ext.apply({},b);a.name=a.crColumnName||"";a.fieldLabel=a.crColumnDescription||"";if(a.crCheckedValue===undefined){a.crCheckedValue=this.crCheckedValue;}if(a.crUncheckedValue===undefined){a.crUncheckedValue=this.crUncheckedValue;}a.checked=true;if(a.crContents!==a.crCheckedValue){a.crContents=a.crUncheckedValue;a.checked=false;}a.enableKeyEvents=true;if(a.listeners){a.crAdditionalListeners=a.listeners;delete a.listeners;}CR.Checkbox.superclass.constructor.call(this,a);this.crDestroyed=false;this.crNullAllowed=false;this.crContentsInitial=this.crContents;this.crSuperclassSetValue=this.setValue;this.setValue=this.crSetContents;this.addListener({render:CR.Field.renderHandler,show:CR.Field.showHandler,hide:CR.Field.hideHandler,beforedestroy:CR.Field.beforeDestroyHandler,blur:this.crOnBlur,keydown:CR.Field.keyDownHandler,specialkey:CR.Field.specialKeyHandler});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"O";},crGetOptionDescription:function(a){var b="";if(a===this.crCheckedValue){b=this.crCheckedValueText||this.crCheckedValue;}else{if(a===this.crUncheckedValue){b=this.crUncheckedValueText||this.crUncheckedValue;}}return b;},crSetContents:function(a){if(!this.crDestroyed){if(typeof a==="boolean"){this.crSuperclassSetValue(a);}else{this.crSuperclassSetValue(a===this.crCheckedValue);}}},crGetNewContents:function(){return this.crDestroyed?this.crContentsInitial:(this.getValue()?this.crCheckedValue:this.crUncheckedValue);},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return this.crGetOptionDescription(this.crGetNewContents());},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show();}},crHide:function(){if(!this.crDestroyed){this.hide();}},crOnBlur:function(){if(!this.crDestroyed){CR.Field.blurHandler(this);}}});Ext.reg("crCheckbox",CR.Checkbox);Ext.override(Ext.Button,{onClick:function(a){if(a){a.preventDefault();}if(a.button!==0){return;}if(!this.disabled){if(!this.crJustClicked){this.crJustClicked=true;if(this.enableToggle&&(this.allowDepress!==false||!this.pressed)){this.toggle();}if(this.menu&&!this.hasVisibleMenu()&&!this.ignoreNextClick){this.showMenu();}this.fireEvent("click",this,a);if(this.handler){this.handler.call(this.scope||this,this,a);}CR.Core.defer(function(){this.crJustClicked=false;},this,null,500);}else{if(a.stopEvent){a.stopEvent();}}}}});Ext.override(Ext.Component,{onShow:function(){this.getVisibilityEl().removeClass("x-hide-"+this.hideMode);if(this.rendered&&this.el&&this.el.dom&&this.el.dom.style.display==="none"&&!this.collapsed&&Ext.isChrome){this.el.dom.style.display="";}},isDisplayed:function(){var c=this.isVisible();if(c){var g=this.findParentBy(function(i){return i.constructor===CR.TabPanel||i.constructor===Ext.TabPanel;});if(g){var a=g.getActiveTab();if(a){c=this.findParentBy(function(i){return i===a;})!==null;}}else{var f=this.findParentBy(function(i){return i.constructor===CR.Window||i.constructor===Ext.Window;});if(f){c=!f.collapsed&&!f.disabled;if(c){var h=f.getEl();var b=h.findParent(".x-tab-panel",100,true);if(b){var g=Ext.getCmp(b.id);if(g){var a=g.getActiveTab();if(a){var d=a.getEl();if(d&&d.id){c=h.findParent("#"+d.id,100,true)!==null;}}}}}}}}return c;},show:function(){if(this.fireEvent("beforeshow",this)!==false){this.hidden=false;if(this.autoRender){this.render(Ext.isBoolean(this.autoRender)?Ext.getBody():this.autoRender);}if(this.rendered){this.onShow();}this.fireEvent("show",this);if(typeof this.cascade==="function"){this.cascade(function(b){if(b.constructor===CR.TabPanel||b.constructor===Ext.TabPanel){var a=b.getActiveTab();if(a){a.fireEvent("show",a);}}});}}return this;},hide:function(){if(this.fireEvent("beforehide",this)!==false){this.doHide();this.fireEvent("hide",this);if(typeof this.cascade==="function"){this.cascade(function(b){if(b.constructor===CR.TabPanel||b.constructor===Ext.TabPanel){var a=b.getActiveTab();if(a){a.fireEvent("hide",a);}}});}}return this;}});Ext.override(Ext.PagingToolbar,{beforeLoad:function(){if(this.rendered&&this.refresh){this.refresh.disable();this.refresh.enable();}}});Ext.override(Ext.grid.GridView,{getCellIndex:function(b){if(this.cm&&b){var a=b.className.match(this.colRe);if(a&&a[1]){return this.cm.getIndexById(a[1]);}}return false;}});Ext.layout.BorderLayout.Region.prototype.getCollapsedEl=Ext.layout.BorderLayout.Region.prototype.getCollapsedEl.createSequence(function(){if((this.position==="north"||this.position==="south")&&!this.collapsedEl.titleEl){this.collapsedEl.titleEl=this.collapsedEl.createChild({cls:"x-panel-header-text",style:"color: rgb(21, 66, 139); "+"font-family: tahoma,arial,verdana,sans-serif; "+"font-size: 11px; "+"font-weight: bold; "+"padding-top: 2px; "+"padding-left: 3px;",cn:this.panel.title});}});Ext.override(Ext.tree.TreeFilter,{clear:function(){var b=this.tree;var a=this.filtered;for(var d in a){if(typeof d!=="function"){var c=a[d];if(c&&c.ui){c.ui.show();}}}this.filtered={};}});Ext.override(Ext.grid.GridView,{fitColumns:function(g,i,h){var m=this.cm;var j=m.getTotalWidth(false);var o=this.grid.getGridEl().getWidth(true)-this.getScrollOffset();var b=this.grid.minimumFitWidth||20;if(o<b){return;}var p=o-j;if(p===0){return false;}var s=m.getColumnCount(true);var f=s-(Ext.isNumber(h)?1:0);if(f===0){f=1;h=undefined;}var a=m.getColumnCount();var n=[];var l=0;var d=0;var q;var c;for(q=0;q<a;q++){if(!m.isFixed(q)&&q!==h){c=m.getColumnWidth(q);n.push(q,c);if(!m.isHidden(q)){l=q;d+=c;}}}var k=(o-m.getTotalWidth())/d;
while(n.length){c=n.pop();q=n.pop();m.setColumnWidth(q,Math.max(this.grid.minColumnWidth,Math.floor(c+c*k)),true);}j=m.getTotalWidth(false);if(j>o){var r=f!==s?h:l;m.setColumnWidth(r,Math.max(1,m.getColumnWidth(r)-(j-o)),true);}if(g!==true){this.updateAllColumnWidths();}return true;}});Ext.override(Ext.grid.RowSelectionModel,{handleMouseDown:function(d,h,f){if(f.button!==0||this.isLocked()){return;}var a=this.grid.getView();if(f.shiftKey&&!this.singleSelect&&this.last!==false){var c=this.last;this.selectRange(c,h,f.ctrlKey);this.last=c;a.focusRow(h);}else{var b=this.isSelected(h);if((f.ctrlKey||this.crKeepExisting)&&b){this.deselectRow(h);}else{if(!b||this.getCount()>1){this.selectRow(h,f.ctrlKey||f.shiftKey||this.crKeepExisting);a.focusRow(h);}}}}});Ext.override(Ext.form.ComboBox,{anyMatch:false,doQuery:function(c,b){c=Ext.isEmpty(c)?"":c;var a={query:c,forceAll:b,combo:this,cancel:false};if(this.fireEvent("beforequery",a)===false||a.cancel){return false;}c=a.query;b=a.forceAll;if(b===true||(c.length>=this.minChars)){if(this.lastQuery!==c){this.lastQuery=c;if(this.mode==="local"){this.selectedIndex=-1;if(b){this.store.clearFilter();}else{this.store.filter(this.displayField,c,this.anyMatch);}this.onLoad();}else{this.store.baseParams[this.queryParam]=c;this.store.load({params:this.getParams(c)});this.expand();}}else{this.selectedIndex=-1;this.onLoad();}}}});Ext.override(Ext.Component,{onShow:function(){this.getVisibilityEl().removeClass("x-hide-"+this.hideMode);if(this.rendered&&this.el&&this.el.dom&&this.el.dom.style.display==="none"&&!this.collapsed&&Ext.isChrome){this.el.dom.style.display="";}}});Ext.TabPanel.AccessStack=function(){var a=[];return{add:function(b){a.push(b);if(a.length>100){a.shift();}},remove:function(f){var d=[];for(var c=0,b=a.length;c<b;c++){if(a[c]!==f){d.push(a[c]);}}a=d;},next:function(){return a.pop();}};};Ext.Container.prototype.findFirst=function(b,a){return this.find(b,a).shift()||{};};CR.Button=Ext.extend(Ext.Button,{crExternalDisable:false,constructor:function(b){var a=Ext.apply({},b);CR.Button.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}},crClose:function(){if(!this.crDestroyed){if(this.rendered){this.close.apply(this,arguments);}else{this.destroy();}}}});Ext.reg("crButton",CR.Button);CR.ToolbarButton=Ext.extend(CR.Button,{crStandardToolbarButton:true,cls:"cr-toolbar-button",constructor:function(b){var a=Ext.apply({},b);CR.ToolbarButton.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}},crClose:function(){if(!this.crDestroyed){if(this.rendered){this.close.apply(this,arguments);}else{this.destroy();}}}});Ext.reg("crToolbarButton",CR.ToolbarButton);CR.Field.beforeDestroyHandler=function(a){a.crDestroyed=true;};CR.Field.keyDownHandler=function(d,f){d.crKeyHandledFlag=false;if(f.ctrlKey){var c=f.getKey();if(c===Ext.EventObject.Z){f.stopEvent();d.crKeyHandledFlag=true;var b=d.crGetNewContents();var a=d.crGetOldContents();if(b!==a){d.crRedoContents=b;d.crSetContents(a);}}else{if(c===Ext.EventObject.Y){f.stopEvent();d.crKeyHandledFlag=true;if(d.crRedoContents!==undefined&&d.crGetNewContents()===d.crGetOldContents()){d.crSetContents(d.crRedoContents);d.crRedoContents=undefined;}}}}};CR.Field.specialKeyHandler=function(b,c){var a=c.getKey();if(a===Ext.EventObject.ENTER){b.crOnBlur();b.crEnterKeyHandler();}};CR.Field.blurHandler=function(b){if(!b.crDestroyed&&!b.crCalculation&&b.crGetNewContents()!==b.crGetOldContents()){var a=b.findParentByType("crFMPanel");if(a){a.crFieldModifiedHandler(b);}}};CR.Field.renderHandler=function(a){if(a.hidden&&CR.Core.extV3){CR.Field.hideHandler(a);}};CR.Field.hideHandler=function(a){if(a.rendered&&!a.crDestroyed&&a.initialConfig.fieldLabel){var b=a.getEl().up(".x-form-item");if(b){b.setDisplayed(false);}}};CR.Field.showHandler=function(a){if(a.rendered&&!a.crDestroyed&&a.initialConfig.fieldLabel){var b=a.getEl().up(".x-form-item");if(b){b.setDisplayed(true);}}};CR.Field.columnHideUpdate=function(h){var a=null;if(!h.crDestroyed&&h.crColumnHide&&h.crColumnHide.length>0){a=h.findParentByType("crFMPanel");}if(a){for(var m=0;m<h.crColumnHide.length;++m){var l=h.crColumnHide[m];var f=l.viewGroup;var g=l.columnName;var k=false;var p=a.findBy(function(s){return s.crColumnHide&&s.crColumnHide.length>0;});for(var o=0;o<p.length;++o){var n=p[o];for(var c=0;c<n.crColumnHide.length;++c){l=n.crColumnHide[c];var r=false;if(l.viewGroup){if(l.viewGroup===f){r=true;}}else{if(l.columnName===g){r=true;}}if(r){var j=n.crGetNewContents();for(var i=0;i<l.criteria.length;++i){if(j===l.criteria[i].contents){k=true;}}}}}if(f){var d=a.findBy(function(s){return s.crViewGroup===f&&s.isXType("crFieldSet");});for(var b=0;b<d.length;++b){var q=d[b];if(!q.rendered){q.hidden=k;}else{if(!k){q.crShow();}else{q.crHide();p=q.findBy(function(s){return s.crGetDataType!==undefined;});for(o=0;o<p.length;++o){n=p[o];CR.Field.resetContents(n);}}}}}else{p=a.findBy(function(s){return s.crColumnName===g&&s.crGetDataType!==undefined;});for(o=0;o<p.length;++o){n=p[o];if(!k){n.crShow();}else{n.crHide();CR.Field.resetContents(n);}}}}}};CR.Field.resetContents=function(a){if(a.crSetContents!==undefined){a.crSetContents(a.crGetOldContents());}else{a.crSetSerial(a.crGetOldContents(),a.crGetOldRowDescription());}};CR.Field.mask=function(a){if(a.crPrivilegeToGet!==undefined&&!a.crPrivilegeToGet){a.style="display:none;";a.hideTrigger=true;}};CR.Field.setToolTip=function(a,c){if(!a.crDestroyed){if(a.crToolTipRegistered){Ext.QuickTips.unregister(a);}a.crToolTipRegistered=false;if(a.rendered){var b=a.getSize().width;if(CR.Field.calculateWidth(a,c)>b){a.crToolTipRegistered=true;Ext.QuickTips.register({target:a,text:c});}}}};CR.Field.calculateWidth=function(a,b){if(!a.crDestroyed&&a.rendered){return Ext.util.TextMetrics.measure(a.getEl(),b).width;}else{return b.length*7;}};CR.Field.getFieldFromXML=function(f,h,d){var a={};var c=[];var b="";var i="";f.beginElement(h);while(!!(h=f.nextSubElement())){switch(h.nodeName){case"columnName":a.crColumnName=f.getText(h);break;case"columnDescription":a.crColumnDescription=f.getText(h);break;case"dataType":b=f.getOption(h);break;case"nullAllowed":a.crNullAllowed=(f.getOption(h)==="Y");break;case"defaultContents":a.crContents=f.getText(h);break;case"maximumLength":i=f.getCount(h);if(i){a.crMaximumLength=i;}break;case"textNumericOnly":a.crTextNumericOnly=(f.getOption(h)==="Y");break;case"textBlankAllowed":a.crTextBlankAllowed=(f.getOption(h)==="Y");break;case"negativeAllowed":a.crNegativeAllowed=(f.getOption(h)==="Y");break;case"maximumAbsoluteValue":i=f.getCount(h);if(i){a.crMaximumAbsoluteValue=i;}break;case"futureAllowed":a.crFutureAllowed=(f.getOption(h)==="Y");break;case"options":f.beginElement(h);while(!!(h=f.nextSubElement())){if(h.nodeName==="value"){c.push([f.getOption(h),f.getText(h)]);}}break;case"referenceTableName":i=f.getText(h);if(i){a.crTableName=f.getText(h);}break;}}if(b==="O"){a.crOptions=c;}a=Ext.apply(a,d);var g=CR.Field.getFieldFromDataType(b,a);return g;};CR.Field.getFieldFromJSON=function(g,d){var a={};var c=[];var b="";if(g.dataType&&g.dataType.option){b=g.dataType.option;}if(g.columnName){a.crColumnName=g.columnName;}if(g.columnDescription){a.crColumnDescription=g.columnDescription;}if(g.nullAllowed){a.crNullAllowed=g.nullAllowed.option==="Y";}if(g.defaultContents){a.crContents=g.defaultContents;}if(g.maximumLength){a.crMaximumLength=g.maximumLength;}if(g.textNumericOnly){a.crTextNumericOnly=g.textNumericOnly.option==="Y";}if(g.textBlankAllowed){a.crTextBlankAllowed=g.textBlankAllowed.option==="Y";}if(g.negativeAllowed){a.crNegativeAllowed=g.negativeAllowed.option==="Y";}if(g.maximumAbsoluteValue){a.crNegativeAllowed=g.maximumAbsoluteValue;}if(g.futureAllowed){a.crFutureAllowed=g.futureAllowed.option==="Y";}if(g.options){Ext.each(g.options,function(h){if(h.value&&h.value.option){c.push([h.value.option,h.value.text]);}});}if(g.referenceTableName){a.crTableName=g.referenceTableName;}if(b==="O"){a.crOptions=c;}a=Ext.apply(a,d);var f=CR.Field.getFieldFromDataType(b,a);return f;};CR.Field.getFieldFromDataType=function(b,a){var c=null;if(b==="C"){c=new CR.CountField(a);}else{if(b==="D"){c=new CR.DateField(a);}else{if(b==="T"){c=new CR.TimeField(a);}else{if(b==="M"){c=new CR.MoneyField(a);}else{if(b==="R"){c=new CR.RateField(a);}else{if(b==="L"){c=new CR.DocumentField(a);}else{if(b==="B"){c=new CR.BinaryField(a);}else{if(b==="O"){c=new CR.OptionField(a);}else{if(b==="E"){c=new CR.SerialField(a);}else{if(b==="S"){c=new CR.TextField(a);}}}}}}}}}}return c;};CR.Field.getXTypeFromDataType=function(a){var b=null;if(a==="C"){b="crCountField";}else{if(a==="D"){b="crDateField";}else{if(a==="T"){b="crTimeField";}else{if(a==="M"){b="crMoneyField";}else{if(a==="R"){b="crRateField";}else{if(a==="L"){b="crDocumentField";}else{if(a==="B"){b="crBinaryField";}else{if(a==="O"){b="crOptionField";}else{if(a==="E"){b="crSerialField";}else{if(a==="S"){b="crTextField";}}}}}}}}}}return b;};CR.Field.addXMLFromField=function(c,b,a,d){c.addData(b,a,d.crGetDataType(),d.crGetNewContents());};CR.FieldSet=Ext.extend(Ext.form.FieldSet,{crViewGroup:"",autoHeight:true,autoWidth:true,collapsible:true,constructor:function(b){var a=Ext.apply({},b);a.title=a.crViewGroup||"";if(a.crItems){a.items=a.crItems;}CR.FieldSet.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy,collapse:this.crCheckForParentResizing,expand:this.crCheckForParentResizing,hide:this.crCheckForParentResizing,show:this.crCheckForParentResizing});},crCheckForParentResizing:function(){var a=this.findParentBy(function(b){return b.crWinResizeHandler;});if(a){a.crWinResizeHandler();}},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}},crGetViewGroup:function(){return this.crViewGroup;},crFocusFirstField:function(){var b=this.findBy(function(c){return c.crGetDataType!==undefined&&!c.disabled;});if(b.length>0){var a=b[0];a.focus(true,true);}}});Ext.reg("crFieldSet",CR.FieldSet);CR.Window=Ext.extend(Ext.Window,{constrainHeader:true,cls:"cr-setFont",constructor:function(a){CR.Window.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}},crClose:function(){if(!this.crDestroyed){if(this.rendered){this.close.apply(this,arguments);}else{this.destroy();}}},crFocusFirstField:function(){var b=this.findBy(function(c){return c.crGetDataType!==undefined&&!c.disabled;});if(b.length>0){var a=b[0];a.focus(true,true);}}});Ext.reg("crWindow",CR.Window);CR.ToolTip=Ext.extend(Ext.ToolTip,{constrainHeader:true,cls:"cr-setFont",constructor:function(a){CR.ToolTip.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crShowAt:function(){if(!this.crDestroyed){this.showAt.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}},crClose:function(){if(!this.crDestroyed){if(this.rendered){this.close.apply(this,arguments);}else{this.destroy();}}},showAt:function(){var c=this;var f=CR.Core.safeGet(c,["lastSize","height"],c.height);var a=CR.Core.safeGet(c,["lastSize","width"],c.width);var d=c.x||c.targetXY[0];var b=c.y||c.targetXY[1];if((d+a)>window.innerWidth){d=window.innerWidth-a;}if((b+f)>window.innerHeight){b=window.innerHeight-f;}CR.ToolTip.superclass.showAt.call(this,[d,b]);}});Ext.reg("crToolTip",CR.ToolTip);CR.TabPanel=Ext.extend(Ext.TabPanel,{layoutOnTabChange:true,enableTabScroll:true,constructor:function(a){CR.TabPanel.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}}});Ext.reg("crTabPanel",CR.TabPanel);CR.Panel=Ext.extend(Ext.Panel,{border:false,cls:"cr-setFont",constructor:function(a){CR.Panel.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}},crFocusFirstField:function(){var b=this.findBy(function(c){return c.crGetDataType!==undefined&&!c.disabled;});if(b.length>0){var a=b[0];a.focus(true,true);}},crRefreshFieldValues:function(a){for(var c=0;c<a.length;c++){var b=a[c];this.cascade(function(d){if(d.crGetColumnName&&d.crGetColumnName()===b.columnName){if(d.getXType()==="crSerialField"){d.crSetSerial(b.newContents,b.newContentsDescription);}else{d.crSetContents(b.newContents);}}});}}});Ext.reg("crPanel",CR.Panel);CR.Panel.printInnerHTML=function(d,a){var b="";b+="<html>";b+="  <head>";b+="    <title>Corelation Inc.</title>";b+='    <style type="text/css">';b+="      a:link{";b+="        text-decoration: none;";b+="        color: black;";b+="      }";b+="    </style>";b+='    <script type="text/javascript" src="JSCSSLoader"><\/script>';b+='    <script type="text/javascript">';b+="      function crDisableLinks(){";b+='        var allLinks = document.getElementsByTagName("a");';b+="        for(var i = 0; i < allLinks.length; i++){";b+="          allLinks[i].onclick = function(){";b+="            return false;";b+="          }";b+="        }";b+="      }";b+="    <\/script>";if(!a){b+='  <script type="text/javascript">';b+="    function crOnLoadFunctions(){";b+="      crDisableLinks();";b+="      window.print();";b+="    }";b+="  <\/script>";b+=" </head>";b+=' <body onload="javascript:crOnLoadFunctions();" >';}else{b+="  </head>";b+="  <body>";}b+=d?d.replace("fieldset","div"):"";b+="  </body></html>";var c=window.open("","_blank","scrollbars=1,location=0,status=0,menubar=1,resizable=1");c.document.write(b);c.document.close();};CR.Panel.printTwoFieldSetColumns=function(a){var k="";var h="";var d=0;var o=false;if(a.crGetPanelTitle){h=a.crGetPanelTitle();}var p=a.findByType("crFieldSet");var n=0;for(var g=0;g<p.length;++g){var l=p[g];var c=CR.Core.findFields(l);n+=c.length;}n=Math.round(n/2)-2;k+='<table align="center" width="100%">';k+='<tr><th colspan="2"><h3 align="center">'+CR.Core.htmlText(h)+"</h2></th></tr>";k+='<tr><td width="50%" valign="top"><table width="100%">';for(g=0;g<p.length;++g){l=p[g];c=CR.Core.findFields(l);k+='<tr><td class="panel-printing-blank-line"></td></tr><tr><td>';k+='<table width="100%" class="panel-printing-fieldset">';
k+='<tr><th colspan="2"><h1 align="center">'+CR.Core.htmlText(l.crGetViewGroup())+"</h1></th></tr>";for(var f=0;f<c.length;++f){var b=c[f];++d;k+="<tr>";k+='<td width="40%">'+CR.Core.htmlText(b.crGetColumnDescription())+":</td>";var m="";if(b.crGetDataType()==="B"){m='<img alt="image" src="'+b.crGetBinaryURL()+'"/>';}else{if(b.crGetNewRowDescription){m=b.crGetNewRowDescription();}else{if(b.crGetOptionDescription){m=b.crGetOptionDescription(b.crGetNewContents());}else{m=b.crGetNewContents();}}m=CR.Core.htmlText(m);}k+='<td width="60%">'+m+"</td>";k+="</tr>";}k+="</table>";if(!o&&(d>n)){k+='</table></td><td width="50%" valign="top"><table width="100%">';o=true;}}k+="</tr></table>";CR.Panel.printInnerHTML(k);};CR.BinaryField=Ext.extend(CR.Panel,{crColumnName:"",crColumnDescription:"",crContents:"",crNullAllowed:true,crCalculation:undefined,crPrivilegeToGet:true,crBinaryURL:"",crBinaryFormat:"none",crBinaryFormatColumnName:"",crBinaryModificationTime:"",crBinaryModificationTimeColumnName:"",crParentTableName:"",crParentTargetSerial:"",crMaximumLength:undefined,crAsBase64String:false,crEnterKeyHandler:function(){},crOnSubmitSuccess:function(){},crOnClearSuccess:function(){},crUndisplayedBody:null,crSuppressMouseHoverOver:false,autoScroll:true,constructor:function(c){var b=Ext.apply({},c);var g=Ext.id();if(b.crBinaryFormat==="pdf"&&b.crBinaryURL){if(!b.height){b.height=600;}b.html='<iframe id="'+g+'" width="100%" height="100%" frameBorder="0" src="'+b.crBinaryURL+'" />';}else{if(b.crBinaryFormat==="jar"&&b.crBinaryURL){b.html=CR.BinaryField.crGetFieldStatusHtml("Compiled Code on File");}else{if(!b.crBinaryURL||b.crBinaryFormat==="none"){b.html=CR.BinaryField.crGetFieldStatusHtml("No Data on File");}else{b.html='<img alt="image" id="'+g+'" height="100%" frameBorder="0" src="'+b.crBinaryURL+'"/>';}}}if(b.crBinaryFormat==="pdf"&&b.crParentTableName==="RECEIPT"&&b.crParentTargetSerial&&!CR.KeyStoneService.isAdobeAcrobatPluginAvailable()){var d=new CR.ToolbarButton({text:"Open...",tooltip:"Open with Acrobat Reader"});var f="Print to default printer";var h=CR.ReceiptPanel.getDefaultWindowsReceiptPrinterIdentifier();if(h){f="Print to '"+h+"'";}var a=new CR.ToolbarButton({text:"Print",tooltip:f});b.tbar=[a,"-",d,"-"];}CR.BinaryField.superclass.constructor.call(this,b);this.crBinaryId=g;this.crContentsInitial=this.crContents;this.addListener("afterlayout",this.crOnAfterlayout,this);this.addListener("afterrender",this.crOnAfterRender,this);if(d){this.crOpenWithReaderButton=d;d.setHandler(this.crOpenWithReader,this);}if(a){this.crPrintWithReaderButton=a;a.setHandler(this.crPrintWithReader,this);}},crOnAfterlayout:function(){if(this.crUndisplayedBody){this.body.update('<img alt="image" height="100%" frameBorder="0" src="data:image/jpg;base64,'+this.crGetNewContents()+'"/>');this.crUndisplayedBody=null;}},crOnAfterRender:function(){var a=this;if(!a.crSuppressMouseHoverOver){a.getEl().addListener("mouseenter",a.crOnMouseEnter,a);}function c(g){var h=false;if(g&&g.contentDocument&&g.contentDocument.body&&g.contentDocument.body.innerText){h=g.contentDocument.body.innerText;}return h;}var b="Session must be specified in URL query string";var d=a.crGetIFrame();if(d){var f=c(d);if(f){if(f.indexOf(b)!==-1){a.crRefreshBinaryURLSession();}}else{d.addEventListener("load",function(){var g=c(d);if(g&&g.indexOf(b)!==-1){a.crRefreshBinaryURLSession();}});}}},crGetIFrame:function(){var c=null;var b=this;var a=b.getEl();if(a&&a.dom&&a.dom.innerHTML&&a.dom.innerHTML.indexOf("</iframe>")!==-1){var d=Ext.get(b.crBinaryId);if(d&&d.dom){c=d.dom;}}return c;},crRefreshBinaryURLSession:function(){var a=this;CR.Login.refreshSessionID({callbackFunction:function(){var c=a.crBinaryURL;var b=c.indexOf("session=");if(b!==-1){var f=b+8;var g=c.indexOf("&",f);if(g===-1){g=c.length;}a.crBinaryURL=c.substring(0,f)+encodeURIComponent(CR.Login.sessionID)+c.substring(g);}else{a.crBinaryURL+="&session="+encodeURIComponent(CR.Login.sessionID);}var d=a.crGetIFrame();if(d){d.src=a.crBinaryURL;}}});},crOnMouseEnter:function(f,i,a){var b=null;if(!this.crOptionsTip){var d=this.crParentTableName;var h=this.crParentTargetSerial;if(d!==""&&h!==""){b='<a href="javascript:void(0)" onclick="CR.BinaryField.crOnUploadClick(';b+="'"+this.getId()+"',";b+="'"+d+"',";b+="'"+h+"',";b+="'"+this.crGetColumnName()+"',";b+="'"+this.crBinaryFormatColumnName+"'";b+=')";">Upload</a>';b+="&nbsp;&nbsp;&nbsp;";b+='<a href="javascript:void(0)" onclick="CR.BinaryField.crOnClearClick(\''+this.getId()+'\')";">Clear</a>';}else{if(this.crAsBase64String){b='<a href="javascript:void(0)" onclick="CR.BinaryField.crOnSelectFileClick(';b+="'"+this.getId()+"',";b+="'"+d+"',";b+="'"+this.crGetColumnName()+"',";b+="'"+this.crBinaryFormatColumnName+"'";b+=')";">Select</a>';b+="&nbsp;&nbsp;&nbsp;";if(this.crGetNewContents()){b+='<a href="javascript:void(0)" onclick="CR.BinaryField.crOnSelectFileClearClick(\''+this.getId()+'\')";">Clear</a>';}}}if(b){var j=new CR.Panel({html:b});var g=new CR.Panel();var c=new CR.Tip({title:"Options",draggable:true,closable:true,layout:"fit",renderTo:this.body,items:[j,g],shim:true,floating:true,shadow:false,listeners:{afterrender:function(){this.setPosition(5,5);}}});this.crOptionsTip=c;}}if(this.crOptionsTip){this.crOptionsTip.crShow();this.crOptionsTip.setPosition(5,5);}},crOnMouseLeave:function(b,a,c){if(this.crOptionsTip&&!this.crOptionsTip.crIsDestroyed()&&!this.crMouseInTip){this.crOptionsTip.hide();}},crGetColumnName:function(){return this.crColumnName;},crGetColumnDescription:function(){return this.crColumnDescription;},crGetDataType:function(){return"B";},crSetContents:function(a,c){if(!this.crDestroyed){this.crContents=a;var d=null;var b=null;if(!a||a===""){b=CR.BinaryField.crGetFieldStatusHtml("No Data on File");}else{if(this.crBinaryFormat==="jpeg"||this.crBinaryFormat==="gif"||this.crBinaryFormat==="png"){d="data:image/"+this.crBinaryFormat+";base64,"+a;b='<img alt="image" height="100%" frameBorder="0" src="'+d+'"/>';}else{if(this.crBinaryFormat==="pdf"){b=CR.BinaryField.crGetFieldStatusHtml("File Selected",c?c.name:null);}else{b=CR.BinaryField.crGetFieldStatusHtml("Compiled Code on File");}}}if(this.body&&b){this.body.update(b);}else{this.crUndisplayedBody=a;}}},crGetNewContents:function(){return this.crDestroyed?this.crContentsInitial:this.crContents;},crGetOldContents:function(){return this.crContentsInitial;},crGetNewDisplayContents:function(){return this.crBinaryURL;},crGetBinaryURL:function(){return this.crBinaryURL;},crOnBlur:function(){if(!this.crDestroyed){CR.Field.blurHandler(this);}},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}},crOpenWithReader:function(){var a=this;var b=a.crOpenWithReaderButton;if(b){b.disable();CR.Core.defer(b.enable,b,null,2000);}CR.ReceiptPanel.openWithReader({receiptSerial:a.crParentTargetSerial,callbackFunction:function(){if(b){b.enable();}}});},crPrintWithReader:function(){var b=this;var a=b.crPrintWithReaderButton;if(a){a.disable();CR.Core.defer(a.enable,a,null,2000);}CR.ReceiptPanel.printWithReader({receiptSerial:b.crParentTargetSerial,callbackFunction:function(){if(a){a.enable();}}});}});Ext.reg("crBinaryField",CR.BinaryField);CR.BinaryField.crOnClearClick=function(i){var c=Ext.getCmp(i);var k=c.crOptionsTip;var h=new CR.XML();var d=h.addContainer(h.getRootElement(),"sequence");var b=h.addContainer(d,"transaction");var a;var g;a=h.addContainer(b,"step");var f=h.addContainer(a,"record");h.addOption(f,"operation","U");h.addText(f,"tableName",c.crParentTableName);h.addSerial(f,"targetSerial",c.crParentTargetSerial);var j=h.addContainer(f,"field");h.addText(j,"columnName",c.crGetColumnName());h.addOption(j,"operation","S");h.addText(j,"newContents","");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:h.getXMLDocument(),scope:c,crOverride:{},crMask:{},success:function(s){if(!c.crIsDestroyed()){var n=CR.JSON.parse(s.responseText);var v=n.query;var r="failed";var w=[];if(n.query){var q=v.sequence;if(q){for(var u=0;u<q.length;u++){var o=q[u].transaction;if(o){for(var t=0;t<o.length;t++){r=o[t].$attr.result;var m=o[t].step;if(m){for(var p=0;p<m.length;p++){if(m[p].tranResult&&m[p].tranResult.category&&m[p].tranResult.category.option&&m[p].tranResult.category.option==="E"){w.push(m[p].tranResult.description);}}}}}}}}if(r!=="posted"){CR.Core.displayExceptions({items:w});}else{c.crBinaryURL=null;var l=c.getHeight();c.body.update(CR.BinaryField.crGetFieldStatusHtml("No Data on File"));c.setHeight(l);k.destroy();c.crOptionsTip=null;if(c.crOnClearSuccess){c.crOnClearSuccess.call();}}}}});};CR.BinaryField.crOnUploadClick=function(g,j,h,b,f){var c=Ext.getCmp(g);var i=c.crOptionsTip;var a=new Ext.form.FileUploadField({fieldLabel:"File location",buttonText:"Browse"});var d=new CR.Button({text:"Submit"});var k=new CR.FormPanel({timeout:5,fileUpload:true,labelWidth:70,width:260,items:[a],buttons:[d]});d.addListener("click",function(){var l="UploadBinary?tableName="+j+"&targetSerial="+h+"&columnName="+b+"&formatColumnName="+f;var m=k.getForm();m.submit({url:l,success:function(n,s){var q=false;try{if(s&&s.response&&s.response.responseText){var t=CR.JSON.parse(s.response.responseText);q=t.format==="jar";}}catch(w){}var v=new CR.XML();var r=v.addContainer(v.getRootElement(),"sequence");var p=v.addContainer(r,"transaction");var o=v.addContainer(p,"step");if(this.crUpdateGridRowOnSubmit){v.addOption(p,"postingMode","V");}var u=v.addContainer(o,"record");v.setAttribute(u,"label","Main");v.addOption(u,"operation","V");v.addOption(u,"includeRowDescriptions","Y");v.addText(u,"tableName",c.crParentTableName);v.addSerial(u,"targetSerial",c.crParentTargetSerial);var x=v.addContainer(u,"field");v.addText(x,"columnName",c.crGetColumnName());CR.Core.ajaxRequest({url:"RecordInquiry",xmlData:v.getXMLDocument(),params:{panelType:"FMPanel",requestType:"view",recordLabel:"Main",tableName:c.crParentTableName,targetSerial:c.crParentTargetSerial,columnDefinition:false},crOverride:{},crMask:{},success:function(y){var z=CR.JSON.parse(y.responseText);if(z&&z.crItems){for(var A=0;A<z.crItems.length;A++){var C=z.crItems[A];if(C.crColumnName===c.crColumnName){c.crBinaryURL=C.crBinaryURL;if(q){c.crBinaryURL=null;c.body.update(CR.BinaryField.crGetFieldStatusHtml("Compiled Code on File"));}else{c.body.update('<iframe id="'+c.crBinaryId+'" width="100%" height="100%" frameBorder="0" src="'+c.crBinaryURL+'""/>');}var B=c.getHeight();c.setHeight(B);}}}i.destroy();c.crOptionsTip=null;if(c.crOnSubmitSuccess){c.crOnSubmitSuccess.call();}},failure:function(y){CR.Core.ajaxErrorHandler(y);}});},failure:function(n,o){switch(o.failureType){case Ext.form.Action.CLIENT_INVALID:Ext.Msg.alert("Failure","Form fields may not be submitted with invalid values");break;case Ext.form.Action.CONNECT_FAILURE:Ext.Msg.alert("Failure","Ajax communication failed");break;case Ext.form.Action.SERVER_INVALID:Ext.Msg.alert("Failure",o.result.msg);}}});});i.getComponent(1).add(k);i.getComponent(1).doLayout();};CR.BinaryField.crGetFieldStatusHtml=function(c,a){var b='<div class="cr-binary-field-status">';b+="<h1>"+c+"</h1>";if(a){b+="<p>"+a+"</p>";}b+="</div>";return b;};CR.BinaryField.crOnSelectFileClick=function(g,i,b,f){var c=Ext.getCmp(g);var h=c.crOptionsTip;var a=new Ext.form.FileUploadField({fieldLabel:"File location",buttonText:"Browse"});var d=new CR.Button({text:"Ok"});var j=new CR.FormPanel({timeout:5,labelWidth:70,width:260,items:[a],buttons:[d]});d.addListener("click",function(){var l=a.fileInput.dom.files[0];if(!l){CR.Core.displayExceptions({items:["No file selected"]});}else{if(l.size>c.crMaximumLength){CR.Core.displayExceptions({items:["Image cannot exceed "+c.crMaximumLength+" bytes"]});}else{var k=new FileReader();k.onloadend=function(){var o=k.result;var m=o.indexOf(";base64,")+8;var n=o.substring(0,m);var r=o.substring(m);var q=n.match(/^data:.+\/(.+);base64,$/);var p=q[1];c.crBinaryFormat=p;c.crSetContents(r,l);h.destroy();c.crOptionsTip=null;};k.readAsDataURL(l);}}});h.getComponent(1).add(j);h.getComponent(1).doLayout();};CR.BinaryField.crOnSelectFileClearClick=function(c,b,a,g){var d=Ext.getCmp(c);var f=d.crOptionsTip;f.destroy();d.crOptionsTip=null;d.crSetContents("");};CR.Tip=Ext.extend(Ext.Tip,{border:false,constructor:function(a){CR.Tip.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crShowAt:function(){if(!this.crDestroyed){this.showAt.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}},crFocusFirstField:function(){var b=this.findBy(function(c){return c.crGetDataType!==undefined&&!c.disabled;});if(b.length>0){var a=b[0];a.focus(true,true);}}});Ext.reg("crTip",CR.Tip);CR.FormPanel=Ext.extend(Ext.form.FormPanel,{border:false,constructor:function(a){CR.FormPanel.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}},crFocusFirstField:function(){var b=this.findBy(function(c){return c.crGetDataType!==undefined&&!c.disabled;});if(b.length>0){var a=b[0];a.focus(true,true);}}});Ext.reg("crFormPanel",CR.FormPanel);CR.GridPanel=Ext.extend(Ext.grid.GridPanel,{crRowSingleSelect:true,trackMouseOver:false,loadMask:false,constructor:function(b){var a=Ext.apply({},b);if(!a.view&&!a.viewConfig){a.view=new Ext.grid.GridView({forceFit:true});a.view.scrollOffset=0;}if(!a.sm&&!a.selModel){a.selModel=new Ext.grid.RowSelectionModel({singleSelect:a.crRowSingleSelect!==undefined?a.crRowSingleSelect:this.crRowSingleSelect});}CR.GridPanel.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}}});Ext.reg("crGridPanel",CR.GridPanel);CR.ListView=Ext.extend(Ext.list.ListView,{trackMouseOver:false,loadMask:true,constructor:function(b){var a=Ext.apply({},b);CR.ListView.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}}});Ext.reg("crListView",CR.ListView);CR.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{crColumns:undefined,crColumnModelCfg:undefined,crAutoCommit:false,crStoreReader:null,crStoreGroupField:null,trackMouseOver:false,loadMask:false,crRecordDefaultCfg:undefined,crColumnConfigIdentifier:null,enableColumnMove:false,constructor:function(b){var k=Ext.apply({},b);var a=this;if(k.crColumns){k.crColumnHash={};var l=[];var g=[];k.crRecordDefaultCfg={};for(var h=0;h<k.crColumns.length;++h){var f=k.crColumns[h];var p=Ext.apply({},f);delete p.serialIndex;var d=f.editor;if(d){d.msgTarget="qtip";d.grow=false;p.width=d.width;}if(!p.renderer){p.renderer=function(A,z,w,y,C,B){A=A||"";var q=k.crColumns[C].editor;var s=false;if(q){switch(q.crGetDataType()){case"S":s=true;break;case"M":A=CR.MoneyField.convertToDisplay(A);break;case"R":A=CR.RateField.convertToDisplay(A);break;case"D":A=CR.DateField.convertToDisplay(A);break;case"T":A=CR.TimeField.convertToDisplay(A);
break;case"O":s=true;A=q.crGetOptionDescription(A);if(!A){A=q.crOptions[0][1];}break;case"E":s=true;break;case"C":if(!A){A="0";}break;case"L":s=true;break;case"B":s=true;break;}}A=CR.Core.htmlText(A.toString());var v=A;var r=false;if(a.crInvalidFields&&a.crInvalidFields.length>0){for(var u=0;u<a.crInvalidFields.length;u++){var x=a.crInvalidFields[u];var t=q.crGetColumnName();if(x.rowIndex===y){if(x.columnName===t){v=CR.Core.htmlText(x.invalidText);r=true;}}}}if(r){z.css+=" x-form-invalid";z.attr='ext:qtip="'+v+'"; ext:qclass="x-form-invalid-tip"';return'<div ext:qtip="'+v+'" ext:qclass="x-form-invalid-tip">'+A+"</div>";}else{if(s&&A){return'<div ext:qtip="'+v+'">'+A+"</div>";}else{if(!A){A="&nbsp;";}return"<span>"+A+"</span>";}}};}l.push(p);g.push({name:f.dataIndex});if(d){if(d.crGetDataType()==="E"){if(!f.serialIndex){f.serialIndex=f.dataIndex+"Serial";}g.push({name:f.serialIndex});k.crRecordDefaultCfg[f.dataIndex]=d.crGetNewRowDescription();k.crRecordDefaultCfg[f.serialIndex]=d.crGetNewContents();}else{k.crRecordDefaultCfg[f.dataIndex]=d.crGetNewContents();}}if(f.editor){k.crColumnHash[f.dataIndex]=f;}}var m=Ext.apply({},k.crColumnModelCfg);m.columns=l;if(k.crColumnConfigIdentifier){var j=CR.Settings.get(k.crColumnConfigIdentifier+"_columnColumnConfig");if(j&&j.columns){Ext.each(j.columns,function(i){Ext.each(m.columns,function(q){if(i.dataIndex===q.dataIndex){q.crProcessColumn=true;q.hidden=i.hidden;q.width=i.width;}});});}var c=function(r){var q={};q.columns=[];for(var t=0;t<r.columns.length;t++){var s=r.columns[t];q.columns.push({dataIndex:s.dataIndex,hidden:s.hidden,width:s.width});}CR.Settings.set(k.crColumnConfigIdentifier+"_columnColumnConfig",q);};m.listeners={hiddenchange:function(r,q,s){var i=r.getDataIndex(q);CR.Settings.set(k.crColumnConfigIdentifier+"_"+i+"_columnHidden",s);c(r);},columnmoved:function(i){c(i);}};}k.colModel=new Ext.grid.ColumnModel(m);var n=k.crStoreReader||new Ext.data.ArrayReader({},g);if(k.crStoreGroupField){var o=new Ext.data.GroupingStore({autoDestroy:true,reader:n,groupField:k.crStoreGroupField});}else{var o=new Ext.data.Store({autoDestroy:true,reader:n});}k.store=o;}if(!k.view&&!k.viewConfig){k.view=new Ext.grid.GridView({forceFit:true});k.view.scrollOffset=0;}if(k.listeners){k.crAdditionalListeners=k.listeners;delete k.listeners;}CR.EditorGridPanel.superclass.constructor.call(this,k);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});if(k.crColumns){this.addListener("beforeedit",function(u){var i=this;var s=this.crColumnHash[u.field];u.crColumn=s;i.crEditEventObject=u;var r=s.editor;if(r.crGetDataType()==="E"){var x=s.serialIndex;var t=u.record;var v=u.field;var w=u.row;var q=u.column;if(r.crEditorGridRecord!==t){r.crAbortOutstandingQuery();r.crEditorGridRecord=t;r.crEditorGridTabKeyQueryFailure=false;}r.crEditorGridTabKeyQueryFailure=false;if(!r.crEditorGridTabKeyQueryFailure){r.crOnContentsChange=CR.Core.emptyFunction;r.crSetSerial(t.data[x],u.value);}r.crOnContentsChange=function(){t.set(v,this.crGetNewRowDescription());t.set(x,this.crGetNewContents());if(i.crAutoCommit){t.commit();}};r.crOnTabKeyQueryFailure=function(){t.set(v,this.crGetNewRowDescription());t.set(x,this.crGetNewContents());if(i.crAutoCommit){t.commit();}r.crEditorGridTabKeyQueryFailure=true;i.startEditing(w,q);};}});this.addListener("validateedit",function(s){var q=this.crColumnHash[s.field];s.crColumn=q;a.crEditEventObject=s;var i=q.editor;i.crOnBlur();if(i.crGetDataType()==="E"){var r=q.serialIndex;s.value=i.crGetNewRowDescription();s.record.set(r,i.crGetNewContents());}else{s.value=i.crGetNewContents();}});this.addListener("afteredit",function(q){var i=this.crColumnHash[q.field];q.crColumn=i;a.crEditEventObject=q;if(this.crAutoCommit){o.commitChanges();}});}if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetColumnForDataIndex:function(a){return this.crColumnHash[a];},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}}});Ext.reg("crEditorGridPanel",CR.EditorGridPanel);CR.GridCheckColumn=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this,a);this.addEvents("beforeselect","select","deselect","selectionchange");CR.GridCheckColumn.superclass.constructor.call(this,a);if(!this.id){this.id=Ext.id();}this.renderer=this.renderer.createDelegate(this);},init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this);},this);},onMouseDown:function(d,c){if(Ext.fly(c).hasClass(this.createId())){d.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);if(!a.data.disabled){if(this.isSelected(b)){this.deselectRow(b,true);}else{this.selectRow(b,true);}}}},isLocked:function(){return false;},isSelected:function(b){var a=this.grid.store.getAt(b);return a.get("selected");},clearSelections:function(){this.grid.store.each(function(a){a.set("selected",false);});},selectRow:function(a,c){if(this.isLocked()||(a<0||a>=this.grid.store.getCount())||(c&&this.isSelected(a))){return;}var b=this.grid.store.getAt(a);if(b&&this.fireEvent("beforeselect",this,a,c,b)!==false){if(!c||this.singleSelect){this.clearSelections();}b.set(this.dataIndex,true);this.last=this.lastActive=a;this.fireEvent("select",this,a,b);this.fireEvent("selectionchange",this);}},deselectRow:function(a){if(this.isLocked()){return;}if(this.last===a){this.last=false;}if(this.lastActive===a){this.lastActive=false;}var b=this.grid.store.getAt(a);if(b){b.set(this.dataIndex,false);this.fireEvent("deselect",this,a,b);this.fireEvent("selectionchange",this);}},renderer:function(f,b,a,g,d,c){if(!a.data.disabled){b.css+=" x-grid3-check-col-td";return String.format('<div class="x-grid3-check-col{0} {1}">&#160;</div>',f?"-on":"",this.createId());}else{return"";}},createId:function(){return"x-grid3-cc-"+this.id;}});CR.TreePanel=Ext.extend(Ext.tree.TreePanel,{constructor:function(a){CR.TreePanel.superclass.constructor.call(this,a);this.crDestroyed=false;this.addListener({beforeclose:this.crBeforeDestroy,beforedestroy:this.crBeforeDestroy});},crBeforeDestroy:function(){this.crDestroyed=true;},crIsDestroyed:function(){return this.crDestroyed;},crShow:function(){if(!this.crDestroyed){this.show.apply(this,arguments);}},crHide:function(){if(!this.crDestroyed){this.hide.apply(this,arguments);}}});Ext.reg("crTreePanel",CR.TreePanel);CR.Menu=Ext.extend(Ext.menu.Menu,{ignoreParentClicks:true,shadow:"drop",cls:"x-menu-plain",constructor:function(a){CR.Menu.superclass.constructor.call(this,a);},crOnHide:function(){}});CR.MenuItem=Ext.extend(Ext.menu.Item,{constructor:function(a){CR.MenuItem.superclass.constructor.call(this,a);this.addListener("render",function(){if(!this.iconCls&&!this.icon){var b=this.getEl();b.addClass(this.menu?"cr-x-menu-item-with-arrow":"cr-x-menu-item");b.update(this.text);}});}});CR.MenuTextItem=Ext.extend(Ext.menu.TextItem,{constructor:function(a){CR.MenuTextItem.superclass.constructor.call(this,a);}});CR.MenuCheckItem=Ext.extend(Ext.menu.CheckItem,{constructor:function(a){CR.MenuCheckItem.superclass.constructor.call(this,a);}});CR.MenuSeparator=Ext.extend(Ext.menu.Separator,{constructor:function(a){CR.MenuSeparator.superclass.constructor.call(this,a);}});if(!CR.Core.extV3){CR.MenuAdapter=Ext.extend(Ext.menu.Adapter,{constructor:function(b,a){CR.MenuAdapter.superclass.constructor.call(this,b,a);}});}CR.Core.addToContainerAndShow=function(b,c,a){if(b.crIsDestroyed()){c.destroy();}else{if(a){b.insert(a,c);}else{b.add(c);}if(b.setActiveTab){b.setActiveTab(c);}if(b.rendered){b.doLayout();}if(!b.setActiveTab){b.crShow();}if(Ext.isIE&&c.isXType("crFMPanel")){c.crHide();c.crShow();}}};CR.Core.convertKeyPressEventToCharacter=function(b){var a=undefined;if(!b.ctrlKey&&!b.altKey&&b.browserEvent&&b.browserEvent.type==="keypress"){var d=b.browserEvent.charCode;if(d===undefined){d=b.browserEvent.keyCode;}if(d){a=String.fromCharCode(d);}}return a;};CR.Core.jsLiteral=function(c){var a="'";if(c){for(var d=0;d<c.length;d++){var b=c.charAt(d);if(b==="'"){a+="\\'";}else{if(b==="\\"){a+="\\\\";}else{if(b==="\n"){a+="\\n";}else{if(b==="\r"){a+="\\r";}else{a+=b;}}}}}}a+="'";return a;};CR.Core.htmlText=function(c){var a="";if(c){for(var d=0;d<c.length;d++){var b=c.charAt(d);if(b==="&"){a+="&amp;";}else{if(b==="<"){a+="&lt;";}else{if(b===">"){a+="&gt;";}else{if(b==="'"){a+="&apos;";}else{if(b==='"'){a+="&quot;";}else{a+=b;}}}}}}}return a;};CR.Core.unescapeHTML=function(b){var a=b||"";a=a.split("&amp;").join("&");a=a.split("&lt;").join("<");a=a.split("&gt;").join(">");a=a.split("&apos;").join("'");a=a.split("&quot;").join('"');return a;};CR.Core.htmlFn=function(d){var a="";if(d&&typeof d==="string"){a=a.concat(d,"(");for(var b=arguments.callee.length;b<arguments.length;b++){var c=typeof arguments[b];if(c==="undefined"){arguments[b]=null;}if(c==="object"||c==="string"){if(arguments[b]!==null){arguments[b]="'"+CR.Core.htmlText(arguments[b].toString())+"'";}}if(b!==arguments.length-1){a=a.concat(arguments[b],",");}else{a=a.concat(arguments[b]);}}a=a.concat(")");}return a;};CR.Core.htmlFunctionVariableText=function(b){var a="";if(b){a=CR.Core.htmlText(CR.Core.htmlText(b));}return a;};CR.Core.htmlCell=function(b,a){if(a&&a>1){return'<td colspan="'+a+'">'+CR.Core.htmlText(b)+"</td>";}else{return"<td>"+CR.Core.htmlText(b)+"</td>";}};CR.Core.htmlOptionCell=function(a,b){if(a){return CR.Core.htmlCell(a.text,b);}else{return CR.Core.htmlCell("",b);}};CR.Core.convertFieldToHtmlDisplayByType=function(d){var b="";if(d.crRowDescription){b=CR.Core.htmlText(d.crRowDescription);}else{if(d.newContentsDescription){b=CR.Core.htmlText(d.newContentsDescription);}else{if(d.crOptions){for(var c=0;c<d.crOptions.length;c++){var f=d.crOptions[c];if(d.crContents===f[0]){b=f[1];}}}else{if(d.crContents||d.newContents){var g=d.crContents||d.newContents;var a=(d.dataType&&d.dataType.option)||null;var h=d.xtype||null;if(h||a){if(h==="crDateField"||a==="D"){b=CR.DateField.convertToDisplay(g);}else{if(h==="crTimeField"||a==="T"){b=CR.TimeField.convertToDisplay(g);}else{if(h==="crMoneyField"||a==="M"){b=CR.MoneyField.convertToDisplay(g,true);}else{if(h==="crRateField"||a==="R"){b=CR.RateField.convertToDisplay(g,true);}else{if((h==="crSerialField"||a==="E")&&(d.newContents&&!d.newContentsDescription)){b=CR.Core.htmlText("<Missing>");}else{b=CR.Core.htmlText(g);}}}}}}else{b=CR.Core.htmlText(d.newContents);}}}}}return b;};CR.Core.tableList=[];CR.Core.tableNames={USER:"USER",DEVICE:"DEVICE",BRANCH:"BRANCH",BATCH:"BATCH",POSTING_ITEM:"POSTING_ITEM",SHARE:"SHARE",LOAN:"LOAN",GL_POSTING_GROUP:"GL_POSTING_GROUP",GL:"GL",SECURITY_EVENT:"SECURITY_EVENT"};CR.Core.retrieveTableList=function(b){b=Ext.apply({success:CR.Core.emptyFunction,failure:CR.Core.emptyFunction,scope:window,reload:false},b);if(b.reload||!CR.Core.tableList||CR.Core.tableList.length===0){var a=new CR.XML();var g=a.addContainer(a.getRootElement(),"sequence");var f=a.addContainer(g,"transaction");var d=a.addContainer(f,"step");var c=a.addContainer(d,"tableList");a.addOption(c,"includeAllColumns","N");a.addOption(c,"includeTableMetadata","Y");CR.Core.ajaxRequest({url:"TableListJSON",xmlData:a.getXMLDocument(),crOverride:{},crMask:{suppress:true},success:function(h){CR.Core.tableList=CR.JSON.parse(h.responseText);b.success.call(b.scope);CR.Core.Events.fireEvent("tablelistready");},failure:b.failure});}else{b.success.call(b.scope);}};CR.Core.findTableByName=function(a){var f=null;var d=CR.Core.tableList;for(var c=0;c<d.length&&!f;++c){var b=d[c];if(b.tableName===a){f=b;}}return f;};CR.Core.clearContainer=function(a){while(a.items&&a.items.getCount()>0){a.remove(a.getComponent(0));}};CR.Core.removeChildByCRID=function(a,d){var c=0;while(a.items&&c<a.items.getCount()){var b=a.getComponent(c);if(b.crID===d){a.remove(b);}else{++c;}}};CR.Core.findChildByCRID=function(b,f){var a=null;if(b.items){for(var d=0;d<b.items.getCount()&&!a;++d){var c=b.getComponent(d);if(c.crID===f){a=c;}}}return a;};CR.Core.findFields=function(a,b){return a.findBy(function(c){return c.crGetDataType!==undefined&&(!b||c.crColumnName===b);});};CR.Core.isField=function(a){return a.crGetDataType!==undefined;};CR.Core.defer=function(d,c,b,a){c=c||window;b=b||[];a=a||0;window.setTimeout(function(){d.apply(c,b);},a);};CR.Core.AjaxProxy=Ext.extend(Ext.data.DataProxy,{constructor:function(a){CR.Core.AjaxProxy.superclass.constructor.call(this,a);this.crConfig=a;},load:function(f,b,g,c,a){if(this.fireEvent("beforeload",this,f)===false){g.call(c||this,null,a,false);}else{var d={params:f||{},scope:this,success:this.crLoadSuccess,failure:this.crLoadFailure,crRequest:{reader:b,callback:g,scope:c||this,arg:a}};Ext.applyIf(d,this.crConfig);if(d.params.crXMLData){d.xmlData=d.params.crXMLData;delete d.params.crXMLData;}if(this.crActiveRequest){Ext.Ajax.abort(this.crActiveRequest);}this.crActiveRequest=CR.Core.ajaxRequest(d);}},crLoadSuccess:function(a,b){this.crLoadResponse(b,true,a);},crLoadFailure:function(a,b){this.crLoadResponse(b,false,a);},crLoadResponse:function(d,g,b){delete this.crActiveRequest;var a;var c;if(g){try{a=d.crRequest.reader.read(b);}catch(f){c=f;g=false;}}if(!g){this.fireEvent("loadexception",this,d,b,c);d.crRequest.callback.call(d.crRequest.scope,null,d.crRequest.arg,false);}else{this.fireEvent("load",this,d,d.crRequest.arg);d.crRequest.callback.call(d.crRequest.scope,a,d.crRequest.arg,true);}}});CR.Core.ajaxStatistics={};CR.Core.ajaxStatistics.requestCount=0;CR.Core.ajaxStatistics.responseChars=0;CR.Core.ajaxMaskPause=1000;CR.Core.ajaxTimeout=600000;CR.Core.ajaxBeforeRequestHandler=function(b,a){if(!a.crMask){a.crMask={};}if(a.crMask.suppress!==true){var c=Ext.getBody();if(a.crMask.body){c=a.crMask.body;}else{if(a.crMask.container){c=a.crMask.container.getEl();}}if(c){var f="";if(a.crMask.message){f=a.crMask.message;}var d="cr-ajax-loaderNoText";if(a.crMask.cls){d=a.crMask.cls;}else{if(f!==""){d="cr-ajax-loaderText";}}a.crMask.loadMask=new Ext.LoadMask(c,{msg:f,msgCls:d});a.crMask.delayedTask=new Ext.util.DelayedTask();a.crMask.delayedTask.delay(CR.Core.ajaxMaskPause,function(g){if(g&&g.loadMask){g.loadMask.show();}},this,[a.crMask]);}}};CR.Core.ajaxAfterRequestHandler=function(d,b,c){try{var a=CR.JSON.parse(b.responseText);if(a.query){var f=a.query;if(f.sequence&&f.sequence[0]){var i=f.sequence[0];if(i.transaction&&i.transaction[0]){var h=i.transaction[0];if(h.postingDate){CR.Login.postingDate=h.postingDate;CR.Login.setWindowTitle();}}}}}catch(g){}if(c.crMask){if(c.crMask.delayedTask){c.crMask.delayedTask.cancel();}if(c.crMask.loadMask){c.crMask.loadMask.hide();}}};Ext.Ajax.addListener("beforerequest",CR.Core.ajaxBeforeRequestHandler);Ext.Ajax.addListener("requestcomplete",CR.Core.ajaxAfterRequestHandler);Ext.Ajax.addListener("requestexception",CR.Core.ajaxAfterRequestHandler);CR.Core.ajaxRequest=function(c){var a=Ext.apply({},c);var d;if(typeof a.timeout==="undefined"){a.timeout=CR.Core.ajaxTimeout;}if(!a.method){a.method="POST";}if(a.method==="POST"){a.params=a.params||{};a.params.JSESSIONID=CR.Core.getJSessionID(true);if(a.xmlData){try{if(typeof window.CRFormatXML==="undefined"&&CR.Login.userSerial){window.CRFormatXML=(CR.Storage.handler.getItem("CRFormatXML")==="true")||CR.Storage.getItem("CRFormatXML")==="true";}if(window.CRDebug===true||window.CRFormatXML===true||window.top.CRFormatXML===true){if(typeof vkbeautify!=="undefined"){var g=new XMLSerializer().serializeToString(a.xmlData);a.xmlData=vkbeautify.xml(g,"  ");}}}catch(b){console.warn("CRFormatXML error",b);}}}if(!a.failure){a.failure=CR.Core.ajaxErrorHandler;}a.crCustomSuccess=a.success;a.success=function(m){CR.Core.ajaxStatistics.responseChars+=(m.responseText?m.responseText.length:0);var o=false;if(m.responseText&&m.responseText.length>=10&&m.responseText.charAt(0)===">"){var l=m.responseText.substring(0,7);var i=m.responseText.indexOf(">>",7);
var k=0;var j=0;if(i>=8){k=i+2;try{j=Number(m.responseText.substring(7,i));}catch(q){k=0;j=0;}}var s=k+j;var t=s;var p=m.responseText.length+1;if(k>=10&&s<=p){var n=m.responseText.substring(k,s);var r=m.responseText.substring(t,p);if(l===">>OVR<<"){o=true;CR.Core.ajaxOverrideHeaderHandler(this,c,a,m,n,r);}else{if(l===">>EXC<<"){o=true;CR.Core.ajaxExceptionHeaderHandler(this,c,a,m,n,r);}else{if(l===">>SNF<<"){o=true;if(c.crSessionNotFoundHandler){c.crSessionNotFoundHandler.apply(this,arguments);}else{CR.Login.performLogin({retainCurrentUserName:true,success:function(){if(a.method==="POST"){a.params.JSESSIONID=CR.Core.getJSessionID(true);}++CR.Core.ajaxStatistics.requestCount;Ext.Ajax.request(a);}});}}}}}}if(a.crCustomSuccess&&!o){arguments.sessionStoreId=d;a.crCustomSuccess.apply(this,arguments);}};if(a.crSessionStore){var h=a.crSessionStore;var f=h.value||h;if(f&&typeof f!=="string"){f=JSON.stringify(f);}CR.Core.ajaxRequest({url:"SessionStore",params:{value:f,id:h.id||""},success:function(j){var i=CR.JSON.parse(j.responseText);d=i.id;a.params.sessionStoreId=d;++CR.Core.ajaxStatistics.requestCount;return Ext.Ajax.request(a);}});}else{++CR.Core.ajaxStatistics.requestCount;return Ext.Ajax.request(a);}};CR.Core.ajaxOverrideHeaderHandler=function(d,h,l,b,f,s){var q=h.crOverride||{};var u={};u.status=200;u.statusText="";u.responseText=s;u.crExceptionItems=[];if(!q.successIfNotApproved){u.status=0;u.statusText="Override Required";}var j=new CR.XML({xmlText:f});var a="";var G=[];var B=null;var g;j.beginElement(j.getRootElement());while(!!(g=j.nextSubElement())){if(g.nodeName==="sequence"){j.beginElement(g);while(!!(g=j.nextSubElement())){if(g.nodeName==="transaction"){B=g;j.beginElement(g);while(!!(g=j.nextSubElement())){if(g.nodeName==="requiredOverride"){a=j.getOption(g);}else{if(g.nodeName==="exception"||g.nodeName==="warning"){var o={};if(g.nodeName==="warning"){o.warningFlag=true;}j.beginElement(g);while(!!(g=j.nextSubElement())){if(g.nodeName==="message"){o.message=j.getText(g);}else{if(g.nodeName==="amount"){o.amount=j.getMoney(g);}else{if(g.nodeName==="category"){o.category=j.getOption(g);}}}}G.push(o);}}}}}}}for(var A=0;A<G.length;++A){o=G[A];var t=o.message;if(t&&o.amount){t+=" "+CR.MoneyField.convertToDisplay(o.amount);}if(t){u.crExceptionItems.push(t);}}if(u.crExceptionItems.length===0){u.crExceptionItems.push("Unknown Failure");}if(q.suppress){if(!q.successIfNotApproved){l.failure.call(d,u,h);}else{if(l.crCustomSuccess){l.crCustomSuccess.call(d,u,h);}}}else{var C=true;var x=null;var F=null;var w=null;var E=null;if(q.disableContainer&&!q.disableContainer.crIsDestroyed()){x=q.disableContainer;if(x.body){F=x.body;if(x.getTopToolbar){w=x.getTopToolbar();if(w&&w.disable){w.disable();}}if(x.getBottomToolbar){E=x.getBottomToolbar();if(E&&E.disable){E.disable();}}}else{if(x.getEl){F=x.getEl();}}}var r=CR.Core.convertToHtmlLines(u.crExceptionItems);r.html='<span class="exception-text">'+r.html+"</span>";var y=(a==="W");var H=(y?"Warning":"Security Override Required");var m=new CR.Button({text:"Cancel"});var D;var n=null;var k=null;var v;var c="cr-override-icon";if(y){c="cr-warning-icon";D=new CR.Button({text:"Post"});v=[m,D];}else{D=new CR.Button({text:"Request Override"});n=new CR.Button({text:"Local Override"});k=new CR.Button({text:"Send Notification...",disabled:true});v=[m,D,n,k];}var p=new Ext.Toolbar({items:v,listeners:{render:function(){if(CR.Core.extV3){}else{p.getEl().child("table").wrap({tag:"center"});}}}});var z=new CR.Window({title:H,modal:C,plain:true,cls:"x-window-dlg",iconCls:c,width:800,height:100,autoHeight:true,autoScroll:true,html:r.html,buttonAlign:"center",crOverrideHandled:false,crSecurityOverrideSerial:"",crDelayedTask:new Ext.util.DelayedTask(),crDelayMilliseconds:3000,crRenderTo:F,renderTo:F,bbar:p,crOverrideCloseHandler:function(){this.crDelayedTask.cancel();if(x&&!x.crIsDestroyed()){if(w&&w.disable){w.enable();}if(E&&E.disable){E.enable();}}this.crOverrideCancel();if(q.focusFld&&!q.focusFld.crIsDestroyed()){q.focusFld.focus(true,true);}},crOverrideCancel:function(){if(this.crSecurityOverrideSerial){this.crSecurityOverrideRetract();}if(!this.crOverrideHandled){this.crOverrideHandled=true;if(!q.successIfNotApproved){u.crExceptionItems=[];l.failure.call(d,u,h);}else{if(l.crCustomSuccess){l.crCustomSuccess.call(d,u,h);}}}},crWarningOverrideApply:function(){if(!this.crOverrideHandled){j.setNamespaceDeclarationRequired(true);j.addOption(B,"warningOverride","Y");l.xmlData=j.getXMLDocument();this.crOverrideHandled=true;++CR.Core.ajaxStatistics.requestCount;Ext.Ajax.request(l);}this.crClose();},crSecurityOverrideRequest:function(i){var J="<"+j.getRootElementName()+' xmlns="'+j.getNamespaceURI()+'">';J+="<sequence>";J+="<transaction>";J+="<step>";J+="<securityOverride>\n";J+=j.serialize(B);J+="\n</securityOverride>";J+="</step>";J+="</transaction>";J+="</sequence>";J+="</"+j.getRootElementName()+">";var I=new CR.XML({xmlText:J});CR.Core.ajaxRequest({url:"DirectXMLPost",xmlData:I.getXMLDocument(),scope:this,crOverride:{suppress:true},crMask:{suppress:true},success:function(K){var N=new CR.XML({xmlText:K.responseText});var M="";var L="failed";var O;N.beginElement(N.getRootElement());while(!!(O=N.nextSubElement())){if(O.nodeName==="sequence"){N.beginElement(O);while(!!(O=N.nextSubElement())){if(O.nodeName==="transaction"){L=O.getAttribute("result");N.beginElement(O);while(!!(O=N.nextSubElement())){if(O.nodeName==="step"){N.beginElement(O);while(!!(O=N.nextSubElement())){if(O.nodeName==="securityOverride"){N.beginElement(O);while(!!(O=N.nextSubElement())){if(O.nodeName==="targetSerialResult"){M=N.getSerial(O);}}}}}}}}}}if(L!=="posted"||!M){CR.Core.displayExceptions({items:N.getExceptionList()});}else{this.crSecurityOverrideSerial=M;this.crSecurityOverrideHandled=false;k.enable();this.crDelayedTask.delay(this.crDelayMilliseconds,this.crSecurityOverrideWaitForResponse,this);if(i){this.crLocalOverride();}}}});},crLocalOverride:function(){CR.SecurityOverridePanel.showLocalSecurityOverride({overrideSerial:this.crSecurityOverrideSerial,renderTo:this.crRenderTo,securityOverrideRequestWindow:this});},crSecurityOverrideRetract:function(){if(this.crSecurityOverrideSerial){var i=new CR.XML();var L=i.addContainer(i.getRootElement(),"sequence");var J=i.addContainer(L,"transaction");var I=i.addContainer(J,"step");var K=i.addContainer(I,"securityOverride");i.addOption(K,"operation","r");i.addSerial(K,"targetSerial",this.crSecurityOverrideSerial);this.crSecurityOverrideSerial="";CR.Core.ajaxRequest({url:"DirectXMLPost",xmlData:i.getXMLDocument(),scope:this,crOverride:{suppress:true},crMask:{suppress:true},success:function(M){var O=new CR.XML({xmlText:M.responseText});var N="failed";var P;O.beginElement(O.getRootElement());while(!!(P=O.nextSubElement())){if(P.nodeName==="sequence"){O.beginElement(P);while(!!(P=O.nextSubElement())){if(P.nodeName==="transaction"){N=P.getAttribute("result");O.beginElement(P);while(!!(P=O.nextSubElement())){}}}}}if(N!=="posted"&&!this.crIsDestroyed()){CR.Core.displayExceptions({items:O.getExceptionList()});}}});}},crSecurityOverrideWaitForResponse:function(){if(!this.crIsDestroyed()&&!this.crSecurityOverrideHandled){this.crSecurityOverrideHandled=true;var i=new CR.XML();var L=i.addContainer(i.getRootElement(),"sequence");var J=i.addContainer(L,"transaction");var I=i.addContainer(J,"step");var K=i.addContainer(I,"securityOverride");i.addOption(K,"operation","S");i.addSerial(K,"targetSerial",this.crSecurityOverrideSerial);CR.Core.ajaxRequest({url:"DirectXMLPost",xmlData:i.getXMLDocument(),scope:this,crOverride:{suppress:true},crMask:{suppress:true},success:function(P){if(!this.crIsDestroyed()){var R=new CR.XML({xmlText:P.responseText});var N="";var T="";var M="";var Q="failed";var S;R.beginElement(R.getRootElement());while(!!(S=R.nextSubElement())){if(S.nodeName==="sequence"){R.beginElement(S);while(!!(S=R.nextSubElement())){if(S.nodeName==="transaction"){Q=S.getAttribute("result");R.beginElement(S);while(!!(S=R.nextSubElement())){if(S.nodeName==="step"){R.beginElement(S);while(!!(S=R.nextSubElement())){if(S.nodeName==="securityOverride"){R.beginElement(S);while(!!(S=R.nextSubElement())){if(S.nodeName==="statusResult"){N=R.getOption(S);T=R.getOptionText(S);}else{if(S.nodeName==="overrideExplanationResult"){M=R.getText(S);}}}}}}}}}}}if(Q!=="posted"){CR.Core.displayExceptions({items:R.getExceptionList()});}else{if(N==="G"||N==="g"){this.crSecurityOverrideApply();}else{if(N==="R"){this.crSecurityOverrideHandled=false;this.crDelayedTask.delay(this.crDelayMilliseconds,this.crSecurityOverrideWaitForResponse,this);}else{if(!T){T="Denied";}var O=["Security Override Request "+T];if(M){O.push(M);}this.crClose();CR.Core.displayExceptions({items:O});}}}}}});}},crSecurityOverrideApply:function(){if(!this.crOverrideHandled){j.setNamespaceDeclarationRequired(true);j.addSerial(B,"securityOverrideSerial",this.crSecurityOverrideSerial);this.crSecurityOverrideSerial="";l.xmlData=j.getXMLDocument();this.crOverrideHandled=true;++CR.Core.ajaxStatistics.requestCount;Ext.Ajax.request(l);}this.crClose();},crSecurityOverrideNotificationPrompt:function(I){if(typeof z.crDefaultNotificationGroupSerial==="undefined"){z.crDefaultNotificationGroupSerial="";z.crDefaultNotificationGroupDescription="";CR.Core.recordView({tableName:"USER",targetSerial:CR.Login.userSerial,fields:[{columnName:"SEC_OVR_REQ_NOT_GROUP_SERIAL"}],callbackFunction:function(N){if(N.tranResult==="posted"&&N.record){z.crDefaultNotificationGroupSerial=N.record["SEC_OVR_REQ_NOT_GROUP_SERIAL"]||"";z.crDefaultNotificationGroupDescription=N.record["SEC_OVR_REQ_NOT_GROUP_SERIAL_DESCRIPTION"]||"";}z.crSecurityOverrideNotificationPrompt(I);}});}else{z.crNotificationTarget="userGroup";var M=new CR.SerialField({crColumnDescription:"User Group",crTableName:"USER_GROUP",crSearchFilterName:"BY_DESCRIPTION_FOR_NOTIFICATION",crNullAllowed:true,crIncludeDescriptionParameter:false,crSearchParameters:[{columnName:"DESCRIPTION",contents:"{queryEvent}"},{columnName:"SECURITY_OVR_SERIAL",contents:z.crSecurityOverrideSerial}],crContents:z.crDefaultNotificationGroupSerial,crRowDescription:z.crDefaultNotificationGroupDescription});var L=new CR.SerialField({crColumnDescription:"User",crTableName:"USER",crSearchFilterName:"BY_USER_NAME_FOR_OVR_NOTIFICATION",crNullAllowed:true,crIncludeDescriptionParameter:false,hidden:true,crSearchParameters:[{columnName:"USERNAME",contents:"{queryEvent}"},{columnName:"SECURITY_OVR_SERIAL",contents:z.crSecurityOverrideSerial}]});var J=new CR.TextAreaField({crColumnDescription:"Message",crContents:z.crNotificationExplanation||""});var i=new CR.FormPanel({region:"center",labelWidth:120,frame:true,autoWidth:true,autoHeight:true,buttonAlign:"center",items:[{xtype:"radio",checked:true,fieldLabel:"Send To",boxLabel:"User Group",name:"sendTo",inputValue:"userGroup",handler:function(N,O){if(O){z.crNotificationTarget="userGroup";M.crShow();L.crHide();}}},{xtype:"radio",fieldLabel:"",labelSeparator:"",boxLabel:"User",name:"sendTo",inputValue:"user",handler:function(N,O){if(O){z.crNotificationTarget="user";M.crHide();L.crShow();}}},M,L,J],buttons:[{text:"Send",handler:function(P,Q){P.disable();z.crNotificationExplanation=J.crGetNewContents();var O="";var N="";if(z.crNotificationTarget==="user"){O="";N=L.crGetNewContents();}else{O=M.crGetNewContents();N="";}z.crSecurityOverrideNotification({notificationUserGroupSerial:O,notificationUserSerial:N,securityOverrideSerial:I,notificationExplanation:z.crNotificationExplanation,callbackFunction:function(R){if(R.notificationFailed){P.enable();}else{P.findParentByType(CR.Window).crClose();}}});}},{text:"Cancel",handler:function(N,O){N.findParentByType(CR.Window).crClose();}}]});var K=new CR.Window({title:"Send Override Request Notification",modal:true,collapsible:false,maximizable:false,layout:"fit",plain:true,items:[i]});K.show();}},crSecurityOverrideNotification:function(I){I=Ext.apply({notificationUserGroupSerial:"",notificationUserSerial:"",securityOverrideSerial:"",notificationExplanation:"",callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},I);var i=new CR.XML();var M=i.addContainer(i.getRootElement(),"sequence");var K=i.addContainer(M,"transaction");var J=i.addContainer(K,"step");var L=i.addContainer(J,"securityOverride");i.addOption(L,"operation","N");i.addSerial(L,"targetSerial",I.securityOverrideSerial);i.addSerial(L,"notificationUserGroupSerial",I.notificationUserGroupSerial);i.addSerial(L,"notificationUserSerial",I.notificationUserSerial);i.addSerial(L,"notificationExplanation",I.notificationExplanation);CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:i.getXMLDocument(),crOverride:{suppress:true},crMask:{suppress:true},success:function(N){var R=CR.JSON.parse(N.responseText);var Q=R.query;var P="failed";var O=[];if(R.query){Ext.each(Q.sequence,function(S){Ext.each(S.transaction,function(T){P=T.$attr.result;Ext.each(T.step,function(U){if(U.tranResult&&U.tranResult.category&&U.tranResult.category.option==="E"){O.push(U.tranResult.description);}else{if(U.securityOverride){L=U.securityOverride;}}});});});}if(P!=="posted"){CR.Core.displayExceptions({items:O,callbackFunction:function(){if(I.callbackFunction){I.callbackArgs.notificationFailed=true;I.callbackFunction.call(I.callbackScope,I.callbackArgs);}}});}else{if(I.callbackFunction){I.callbackArgs.notificationFailed=false;I.callbackFunction.call(I.callbackScope,I.callbackArgs);}}}});}});z.addListener("beforedestroy",function(){this.crOverrideCloseHandler();});m.addListener("click",z.crClose,z);if(y){D.addListener("click",z.crWarningOverrideApply,z);}else{D.addListener("click",function(){this.disable();if(!z.crSecurityOverrideSerial){z.crSecurityOverrideRequest(false);}},D);n.addListener("click",function(){D.disable();if(!z.crSecurityOverrideSerial){z.crSecurityOverrideRequest(true);}else{z.crLocalOverride();}},n);k.addListener("click",function(){if(z.crSecurityOverrideSerial){z.crSecurityOverrideNotificationPrompt(z.crSecurityOverrideSerial);}else{k.disable();}},k);}z.crShow();}};CR.Core.ajaxExceptionHeaderHandler=function(g,d,b,c,f,a){var i={};i.status=500;i.statusText="Internal Server Error";i.responseText=a;i.crExceptionItems=[];while(f){var h=f.indexOf("\n");if(h<0){i.crExceptionItems.push(f);f="";}else{i.crExceptionItems.push(f.substring(0,h));f=f.substring(h+1);}}if(i.crExceptionItems.length===0){i.crExceptionItems.push("Unknown Failure");}b.failure.call(g,i,d);};CR.Core.ajaxErrorHandler=function(b){var a=b.crExceptionItems;if(!a){a=[CR.Core.getHttpStatusMessage(b)];}if(a.length>0){CR.Core.displayExceptions({items:a});}};CR.Core.getHttpStatusMessage=function(b){var a="HTTP ";if(b&&b.status){a+=b.status+" ";}a+="- ";if(b&&b.statusText){a+=b.statusText;}else{a+="Unknown error";}return a;};CR.Core.securityCheck=function(b){b=Ext.apply({securityEvent:null,securityEvents:null,securityEventDescription:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);if(!b.securityEvent&&!b.securityEvents&&b.securityEventDescription){CR.Core.recordSearch({search:{tableName:"SECURITY_EVENT",filterName:"BY_DESCRIPTION_CUSTOM",returnLimit:"1",parameter:[{columnName:"DESCRIPTION",contents:b.securityEventDescription}]},callbackFunction:function(g){if(g.record&&g.record["DESCRIPTION"]===b.securityEventDescription){b.securityEvent=g.record.targetSerial;CR.Core.securityCheck(b);}else{b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}});}else{var c=b.securityEvent?[b.securityEvent]:b.securityEvents||[];if(c.length>0){var a=new CR.XML();var f=a.addContainer(a.getRootElement(),"sequence");var d=a.addContainer(f,"transaction");Ext.each(c,function(g){var h=a.addContainer(d,"step");var i=a.addContainer(h,"securityCheck");a.addOption(i,"operation","CHECK");if(/^\d+$/.test(g)){a.addSerial(i,"securityEventSerial",g);}else{a.addOption(i,"securityEvent",g);}});CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),success:function(g){b.callbackFunction.call(b.callbackScope,b.callbackArgs);}});
}else{b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}};CR.Core.safeGet=function(c,i,a){var f=a;var g=i;if(typeof i==="string"){g=i.replace(/^\[|\]$/g,"").replace(/\[|\]\./g,".").split(".");}if(Array.isArray(g)&&g.length>0){var b=0;var h=c;while(h&&b<g.length){var d=g[b];if(typeof h==="object"&&!Array.isArray(h)&&!h.hasOwnProperty(d)){break;}h=h[d];b++;}if(b===g.length&&typeof h!=="undefined"){f=h;}}return f;};CR.Core.recordView=function(c){c=Ext.apply({tableName:undefined,targetSerial:undefined,targetSerials:undefined,targetRecord:undefined,targetRecords:undefined,fields:undefined,includeColumnMetadata:"N",includeRowDescriptions:"N",displayExceptions:true,crMask:undefined,crOverride:undefined,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{record:null,records:[]}},c);var b=new CR.XML();if(c.record){var a=Ext.isArray(c.record)?c.record:[c.record];Ext.each(a,function(g){b.addJSON({record:g});});}else{var f=b.addContainer(b.getRootElement(),"sequence");var d=b.addContainer(f,"transaction");if(c.targetRecord||c.targetRecords){if(c.targetRecord){c.targetRecords=[c.targetRecord];}c.targetRecords=c.targetRecords||[];c.targetRecords.forEach(function(h){var i=b.addContainer(d,"step");var g=b.addContainer(i,"record");b.addOption(g,"operation","V");b.addText(g,"tableName",h.tableName);b.addText(g,"targetSerial",h.targetSerial);b.addOption(g,"includeColumnMetadata",c.includeColumnMetadata);b.addOption(g,"includeRowDescriptions",c.includeRowDescriptions);if(c.fields){b.addOption(g,"includeAllColumns","N");Ext.each(c.fields,function(j){var k=b.addContainer(g,"field");b.addText(k,"columnName",j.columnName?j.columnName:j);});}else{if(h.fields){b.addOption(g,"includeAllColumns","N");Ext.each(h.fields,function(j){var k=b.addContainer(g,"field");b.addText(k,"columnName",j.columnName?j.columnName:j);});}else{b.addOption(g,"includeAllColumns","Y");}}});}else{if(c.targetSerial){c.targetSerials=[c.targetSerial];}c.targetSerials=c.targetSerials||[""];c.targetSerials.forEach(function(h){var i=b.addContainer(d,"step");var g=b.addContainer(i,"record");b.addOption(g,"operation","V");b.addText(g,"tableName",c.tableName);b.addText(g,"targetSerial",h);b.addOption(g,"includeColumnMetadata",c.includeColumnMetadata);b.addOption(g,"includeRowDescriptions",c.includeRowDescriptions);if(c.fields){b.addOption(g,"includeAllColumns","N");Ext.each(c.fields,function(j){var k=b.addContainer(g,"field");b.addText(k,"columnName",j.columnName?j.columnName:j);});}else{b.addOption(g,"includeAllColumns","Y");}});}}CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),crMask:c.crMask,crOverride:c.crOverride,success:function(h){var g=CR.JSON.parse(h.responseText);var j="failed";var i=[];var k=g.query;if(k){Ext.each(k.sequence,function(l){Ext.each(l.transaction,function(m){j=m.$attr.result;Ext.each(m.step,function(o){if(o.tranResult&&o.tranResult.category&&o.tranResult.category.option&&o.tranResult.category.option==="E"){i.push(o.tranResult.description);}if(o.record){var n=o.record;Ext.each(n.field,function(p){n[p.columnName]=p.newContents||"";if(p.newContentsDescription){n[p.columnName+"_DESCRIPTION"]=p.newContentsDescription;}});c.callbackArgs.records.push(n);}});});});}if(c.callbackArgs.records.length>0){c.callbackArgs.record=c.callbackArgs.records[0];}c.callbackArgs.tranResult=j;c.callbackArgs.errorArray=i;if(j!=="posted"&&c.displayExceptions){CR.Core.displayExceptions({items:i,callbackFunction:c.callbackFunction,callbackFunctionScope:c.callbackScope,callbackFunctionArgs:c.callbackArgs});}else{c.callbackFunction.call(c.callbackScope,c.callbackArgs);}}});};CR.Core.recordUpdate=function(b){b=Ext.apply({tableName:undefined,targetSerial:undefined,targetSerials:undefined,fields:undefined,includeColumnMetadata:"Y",includeRowDescriptions:"Y",includeAllColumns:"Y",displayExceptions:true,crMask:undefined,crOverride:undefined,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{record:null,records:[]}},b);b.postingMode=b.postingMode||"P";if(typeof b.displayExceptions==="undefined"){b.displayExceptions=true;}if(b.targetSerial){b.targetSerials=[b.targetSerial];}b.targetSerials=b.targetSerials||[""];var a=new CR.XML();var d=a.addContainer(a.getRootElement(),"sequence");var c=a.addContainer(d,"transaction");a.addOption(c,"postingMode",b.postingMode);b.targetSerials.forEach(function(g){var h=a.addContainer(c,"step");var f=a.addContainer(h,"record");a.addOption(f,"operation","U");a.addText(f,"tableName",b.tableName);a.addText(f,"targetSerial",g);a.addOption(f,"includeColumnMetadata",b.includeColumnMetadata);a.addOption(f,"includeRowDescriptions",b.includeRowDescriptions);a.addOption(f,"includeAllColumns",b.includeAllColumns);Ext.each(b.fields,function(i){var j=a.addContainer(f,"field");a.addOption(j,"operation","S");a.addText(j,"columnName",i.columnName);if(i.newContents){a.addText(j,"newContents",i.newContents);}if(typeof i.oldContents!=="undefined"){a.addOption(j,"verifyOldContents","Y");a.addText(j,"oldContents",i.oldContents);}});});CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),crMask:b.crMask,crOverride:b.crOverride,success:function(g){var f=CR.JSON.parse(g.responseText);var i="failed";var h=[];var j=f.query;if(j){Ext.each(j.sequence,function(k){Ext.each(k.transaction,function(l){i=l.$attr.result;Ext.each(l.step,function(n){if(n.tranResult&&n.tranResult.category&&n.tranResult.category.option&&n.tranResult.category.option==="E"){h.push(n.tranResult.description);}if(n.record){var m=n.record;Ext.each(m.field,function(o){m[o.columnName]=o.newContents||"";if(o.newContentsDescription){m[o.columnName+"_DESCRIPTION"]=o.newContentsDescription;}});b.callbackArgs.records.push(m);}});});});}if(b.callbackArgs.records.length>0){b.callbackArgs.record=b.callbackArgs.records[0];}b.callbackArgs.tranResult=i;b.callbackArgs.errorArray=h;if(i!=="posted"&&i!=="verified"&&b.displayExceptions){CR.Core.displayExceptions({items:h,callbackFunction:b.callbackFunction,callbackFunctionScope:b.callbackScope,callbackFunctionArgs:b.callbackArgs});}else{b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}});};CR.Core.record=function(b){b=Ext.apply({operation:"V",tableName:undefined,targetSerial:undefined,targetSerials:undefined,targetRecord:undefined,targetRecords:undefined,targetParentSerial:undefined,targetParentSerials:undefined,fields:undefined,includeColumnMetadata:"Y",includeRowDescriptions:"Y",includeAllColumns:"Y",displayExceptions:true,crMask:undefined,crOverride:undefined,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{record:null,records:[]}},b);b.postingMode=b.postingMode||"P";if(typeof b.displayExceptions==="undefined"){b.displayExceptions=true;}if(b.targetSerial){b.targetSerials=[b.targetSerial];}b.targetSerials=b.targetSerials||[""];if(b.targetParentSerial){b.targetParentSerials=[b.targetParentSerial];}b.targetParentSerials=b.targetParentSerials||[""];var a=new CR.XML();var f=a.addContainer(a.getRootElement(),"sequence");var d=a.addContainer(f,"transaction");a.addOption(d,"postingMode",b.postingMode);var c=b.targetSerials;if(b.operation==="I"){c=b.targetParentSerials;}c.forEach(function(h){var i=a.addContainer(d,"step");var g=a.addContainer(i,"record");a.addOption(g,"operation",b.operation);a.addText(g,"tableName",b.tableName);if(b.operation==="I"){a.addText(g,"targetParentSerial",h);}else{a.addText(g,"targetSerial",h);}a.addOption(g,"includeRowDescriptions",b.includeRowDescriptions);a.addOption(g,"includeColumnMetadata",b.includeColumnMetadata);if(b.fields){if(b.operation==="V"){a.addOption(g,"includeAllColumns","N");}Ext.each(b.fields,function(j){var k=a.addContainer(g,"field");a.addText(k,"columnName",j.columnName);if(b.operation!=="V"){a.addOption(k,"operation","S");if(j.newContents){a.addText(k,"newContents",j.newContents);}if(b.operation==="U"&&typeof j.oldContents!=="undefined"){a.addOption(k,"verifyOldContents","Y");a.addText(k,"oldContents",j.oldContents);}}});}else{if(b.operation==="V"){a.addOption(g,"includeAllColumns",b.includeAllColumns);}}});if(b.targetRecord){b.targetRecords=[b.targetRecord];}b.targetRecords=b.targetRecords||[];b.targetRecords.forEach(function(h){var i=a.addContainer(d,"step");var g=a.addContainer(i,"record");a.addOption(g,"operation","V");a.addText(g,"tableName",h.tableName);a.addText(g,"targetSerial",h.targetSerial);a.addOption(g,"includeColumnMetadata",b.includeColumnMetadata);a.addOption(g,"includeRowDescriptions",b.includeRowDescriptions);if(b.fields||h.fields){if(b.operation==="V"){a.addOption(g,"includeAllColumns","N");}Ext.each(b.fields||h.fields,function(j){var k=a.addContainer(g,"field");a.addText(k,"columnName",j.columnName?j.columnName:j);});}else{if(b.operation==="V"){a.addOption(g,"includeAllColumns",b.includeAllColumns);}}});CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),crMask:b.crMask,crOverride:b.crOverride,success:function(h){var g=CR.JSON.parse(h.responseText);var j="failed";var i=[];var k=g.query;if(k){Ext.each(k.sequence,function(l){Ext.each(l.transaction,function(m){j=m.$attr.result;Ext.each(m.step,function(o){if(o.tranResult&&o.tranResult.category&&o.tranResult.category.option&&o.tranResult.category.option==="E"){i.push(o.tranResult.description);}if(o.record){var n=o.record;Ext.each(n.field,function(p){n[p.columnName]=p.newContents||"";if(p.newContentsDescription){n[p.columnName+"_DESCRIPTION"]=p.newContentsDescription;}});b.callbackArgs.records.push(n);}});});});}if(b.callbackArgs.records.length>0){b.callbackArgs.record=b.callbackArgs.records[0];}b.callbackArgs.tranResult=j;b.callbackArgs.errorArray=i;if(j!=="posted"&&j!=="verified"&&b.displayExceptions){CR.Core.displayExceptions({items:i,callbackFunction:b.callbackFunction,callbackFunctionScope:b.callbackScope,callbackFunctionArgs:b.callbackArgs});}else{b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}});};CR.Core.recordSearch=function(b){b=Ext.apply({search:undefined,displayExceptions:true,crMask:undefined,crOverride:undefined,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{record:null,records:[]}},b);var a=new CR.XML();a.addJSON({search:b.search});CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),crMask:b.crMask,crOverride:b.crOverride,success:function(d){var c=CR.JSON.parse(d.responseText);var g="failed";var f=[];var h=c.query;if(h){Ext.each(h.sequence,function(i){Ext.each(i.transaction,function(j){g=j.$attr.result;Ext.each(j.step,function(k){if(k.tranResult&&k.tranResult.category&&k.tranResult.category.option&&k.tranResult.category.option==="E"){f.push(k.tranResult.description);}if(k.search){b.callbackArgs.searchResults=k.search;}});});});}b.callbackArgs.tranResult=g;b.callbackArgs.errorArray=f;if(b.callbackArgs.searchResults&&b.callbackArgs.searchResults.resultRow){b.targetSerials=[];b.callbackArgs.searchResults.resultRow.forEach(function(i){b.targetSerials.push(i.serial);});}if(g!=="posted"&&g!=="verified"&&b.displayExceptions){CR.Core.displayExceptions({items:f,callbackFunction:b.callbackFunction,callbackFunctionScope:b.callbackScope,callbackFunctionArgs:b.callbackArgs});}else{b.tableName=b.tableName||b.search.tableName;if(b.targetSerials&&b.targetSerials.length>0){CR.Core.recordView(b);}else{b.callbackArgs.record=null;b.callbackArgs.records=[];b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}}});};CR.Core.recordTree=function(b){b=Ext.apply({recordTree:undefined,displayExceptions:true,crMask:undefined,crOverride:undefined,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{recordTree:null,records:[]}},b);var a=new CR.XML();a.addJSON({recordTree:b.recordTree});CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),crMask:b.crMask,crOverride:b.crOverride,success:function(h){var d=null;var f={};var g="failed";var n=[];var m=CR.JSON.parse(h.responseText);var l=m.query;if(l){Ext.each(l.sequence,function(o){Ext.each(o.transaction,function(p){g=p.$attr.result;Ext.each(p.exception,function(q){n.push(q.message);});Ext.each(p.step,function(s){if(s.tranResult&&s.tranResult.category&&s.tranResult.category.option&&s.tranResult.category.option==="E"){n.push(s.tranResult.description);}else{if(s.recordTree){d=s.recordTree;}else{if(s.record){var q=s.record;var r={};Ext.each(q.field,function(t){r[t.columnName]=t.newContents||"";if(t.newContentsDescription){r[t.columnName+"_DESCRIPTION"]=t.newContentsDescription;}});r["ROW_DESCRIPTION"]=q.rowDescription;f[q.$attr.label]=r;}}}});});});}if(g!=="posted"||n.length>0){CR.Core.displayExceptions({items:n});}else{function j(p,o){Ext.each(p.child,function(r){var s=r.tableName;if(o[s]&&!Ext.isArray(o[s])){s+="S";}if(!o[s]){o[s]=[];}var q={};if(r.detailLabel){q=f[r.detailLabel]||{};}else{q={SERIAL:r.serial,ROW_DESCRIPTION:r.rowDescription};}o[s].push(q);j(r,q);});}var c=d.resultTree;var i=f[c.detailLabel]||{};j(c,i);var k={};k[c.tableName]=i;b.callbackArgs=k;b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}});};CR.Core.displayHTML=function(a){a=Ext.apply({title:"Message",modal:true,renderTo:Ext.getBody(),plain:true,cls:"x-window-dlg",width:800,height:100,boxMinWidth:a.minWidth||400,boxMaxWidth:a.maxWidth||800,boxMaxHeight:600,autoHeight:false,autoScroll:true,layout:"fit",bodyCfg:{style:{"padding":"5px","background-color":"white"}},keys:{key:Ext.EventObject.ENTER,handler:function(){b.crClose();}},listeners:{close:function(){if(a.callbackFunction){a.callbackFunction.call(a.callbackFunctionScope,a.callbackFunctionArgs);}if(a.focusFld&&a.focusFld.focus&&!a.focusFld.crIsDestroyed()){a.focusFld.focus(true,true);}}},buttonAlign:"center",buttons:[{text:"Close",handler:function(){b.crClose();}}]},a);var b=new CR.Window(a);b.crShow();b.center();};CR.Core.displayExceptions=function(i){var m=800;var a=200;var o=100;var p=i.cls||"exception-text";var g=Ext.id();var q=CR.Core.convertToHtmlLines(i.items);if(q.count>0){q.html='<span class="'+p+'">'+q.html+"</span>";if(i.additionalInfo){var d=Ext.id();q.html+="<br/><br/>";q.html+='<a href="javascript:void(0)" ';q.html+="onclick=\"this.style.display='none';";q.html+="return Ext.getCmp('"+g+"').crResizeAdditionalInfo('"+d+"')\">";q.html+="Additional Information...</a>";q.html+='<div style="width:800px;display:none" id="'+d+'" style="">';q.html+="<pre>"+CR.Core.htmlText(i.additionalInfo)+"</pre></div>";}var l="";if(i.title){l=i.title;}else{l="Exception";if(q.count>1){l+="s";}}var j=i.renderTo||Ext.getBody();if(typeof j.getEl==="function"){j=j.getEl();}var h=new CR.Window({id:g,title:l,modal:true,renderTo:j,plain:true,cls:"x-window-dlg",width:m,height:o,autoHeight:true,autoScroll:true,html:q.html,keys:{key:Ext.EventObject.ENTER,handler:function(){h.crClose();}},listeners:{close:function(){if(i.callbackFunction){i.callbackFunction.call(i.callbackFunctionScope,i.callbackFunctionArgs);}if(i.focusFld&&i.focusFld.focus&&!i.focusFld.crIsDestroyed()){i.focusFld.focus(true,true);}}},buttonAlign:"center",buttons:[{text:"Close",handler:function(){h.crClose();}}],crResizeAdditionalInfo:function(u){var r=Ext.get(u);r.show();var w=r.getWidth()+r.getMargins("lr");var t=h.getFrameWidth("lr");var v=h.body.getFrameWidth("lr");var s=w+t+v;s=s>m?m:(s<a?a:s);h.setSize(s,"auto").center();return false;}});h.crShow();var c=Ext.get(h.body.dom.firstChild);var n=c.getWidth()+c.getMargins("lr");var f=h.getFrameWidth("lr");var k=h.body.getFrameWidth("lr");var b=n+f+k;b=b>m?m:(b<a?a:b);h.setSize(b,"auto").center();}};CR.Core.convertToHtmlLines=function(c){var a={};a.html="";a.count=0;if(c){for(var f=0;f<c.length;++f){var h=false;for(var d=0;d<f&&!h;++d){if(c[d]===c[f]){h=true;}}if(!h&&c[f]){++a.count;if(a.html){a.html+="<br/>";}var g=c[f];if(typeof g==="object"){g=g.message?g.message:g.toString();}var b=g.split("\n");for(var k=0;k<b.length;k++){a.html+=CR.Core.htmlText(b[k]);if(k<b.length-1){a.html+="<br/>";}}}}}return a;};CR.Core.confirm=function(a){a=Ext.apply({title:"Please confirm",message:"Confirm message missing",returnIfCancel:false,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);
Ext.MessageBox.show({title:a.title,msg:a.message,buttons:{yes:true,cancel:true},icon:Ext.MessageBox.QUESTION,scope:this,fn:function(b){if(b==="yes"){a.callbackFunction.call(a.callbackScope,true);}else{if(a.returnIfCancel){a.callbackFunction.call(a.callbackScope,false);}}}});};CR.Core.searchPrompt=function(b){b=Ext.apply({tableName:"ACCOUNT",filterName:null,parameters:null,selectSingleResultRow:true,allowNullSelection:false,allowNullSelectionText:"Select none",callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);var d=null;var a=new CR.XML();var h=a.addContainer(a.getRootElement(),"sequence");var g=a.addContainer(h,"transaction");var f=a.addContainer(g,"step");var c=a.addContainer(f,"search");a.addText(c,"tableName",b.tableName);a.addText(c,"filterName",b.filterName);a.addOption(c,"includeSelectColumns","Y");a.addOption(c,"includeTotalHitCount","Y");a.addCount(c,"returnLimit","10");Ext.each(b.parameters,function(j){var i=a.addContainer(c,"parameter");a.addText(i,"columnName",j.columnName);a.addText(i,"contents",j.contents);});CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),params:{},success:function(l){var t=CR.JSON.parse(l.responseText);var k="failed";var v=[];var r=t.query;if(r){Ext.each(r.sequence,function(w){Ext.each(w.transaction,function(x){k=x.$attr.result;Ext.each(x.step,function(y){if(y.tranResult&&y.tranResult.category&&y.tranResult.category.option&&y.tranResult.category.option==="E"){v.push(y.tranResult.description);}else{if(y.search){d=y.search;}}});});});}if(k!=="posted"){CR.Core.displayExceptions({items:v});}else{var s=d.resultRow||[];if(s.length===0){b.callbackFunction.call(b.callbackScope,b.callbackArgs);}else{if(s.length===1&&b.selectSingleResultRow){b.callbackArgs.serial=s[0].serial;b.callbackArgs.resultRow=s[0];b.callbackFunction.call(b.callbackScope,b.callbackArgs);}else{var i=[{name:"serial"}];var n=[];Ext.each(d.selectColumn,function(w){i.push({name:w.columnName});n.push({header:w.columnDescription,dataIndex:w.columnName});});var q=new Ext.data.JsonReader({root:"resultRows",totalProperty:"totalHitCount",id:"serial"},i);var m=new Ext.grid.ColumnModel(n);var u=new Ext.data.Store({autoDestroy:true,autoLoad:true,baseParams:{crXMLData:a.getXMLDocument()},proxy:new CR.Core.AjaxProxy({url:"SearchJSON",crOverride:{disableContainer:this},crMask:{suppress:true}}),listeners:{loadexception:function(y,x,w){CR.Core.ajaxErrorHandler(w);},load:function(x,w,y){CR.Core.defer(function(){o.setSize();});}},reader:q});var j=new CR.GridPanel({crRowSingleSelect:true,store:u,cm:m,bbar:new Ext.PagingToolbar({pageSize:10,store:u,displayInfo:true,displayMsg:"Results {0} - {1} of {2}",emptyMsg:"No matches to display"})});j.getSelectionModel().on("selectionchange",function(w){var x=null;if(o.getBottomToolbar()){x=o.getBottomToolbar().find("crId","ok").shift();}else{if(o.buttons){x=o.buttons.filter(function(y){return y.crId==="ok";}).shift();}}if(x){x.setDisabled(w.getCount()===0);}});var p=[{crId:"ok",text:"Accept Selected",disabled:true,handler:function(x){var w=j.getSelectionModel();if(w.getCount()>0){var y=w.getSelected();b.callbackArgs.serial=y.id;b.callbackFunction.call(b.callbackScope,b.callbackArgs);x.findParentByType(CR.Window).crClose();}}}];if(b.allowNullSelection){p.push("-");p.push({crId:"nullSelection",text:b.allowNullSelectionText,handler:function(w){b.callbackArgs.serial=null;b.callbackFunction.call(b.callbackScope,b.callbackArgs);w.findParentByType(CR.Window).crClose();}});}var o=new CR.Window({title:b.title?b.title:"Make a selection",layout:"fit",height:320,autoDestroy:true,autoWidth:true,constrain:true,closable:true,resizable:true,plain:true,modal:true,renderTo:b.renderTo||Ext.getBody(),items:[j],buttons:p});o.crShow();}}}}});};CR.Core.stringToIntCents=function(a){if(!a){return 0;}var b=a.replace(/[^0123456789-]/g,"");if(!b){return 0;}return Number(b);};CR.Core.intCentsToString=function(b){var a=b.toString();if(b>=-99&&b<=99){if(b<=-10){a="-0"+a.substr(1);}else{if(b<=-1){a="-00"+a.substr(1);}else{if(b<=9){a="00"+a;}else{a="0"+a;}}}}a=a.slice(0,a.length-2)+"."+a.slice(a.length-2,a.length);return a;};CR.Core.addMoneyValues=function(f,c){var d=CR.Core.stringToIntCents(f);var b=CR.Core.stringToIntCents(c);var a=d+b;return CR.Core.intCentsToString(a);};CR.Core.subtractMoneyValues=function(f,c){var d=CR.Core.stringToIntCents(f);var b=CR.Core.stringToIntCents(c);var a=d-b;return CR.Core.intCentsToString(a);};CR.Core.reverseSign=function(b){var a=CR.Core.stringToIntCents(b);return CR.Core.intCentsToString(a*-1);};CR.Core.applyXMLBasedOnFieldType=function(c,b,d){var f=null;if(c.crGetNewContents){f=c.crGetNewContents();}else{f=c.crContents;}if(c.crXMLLabel==="recipientCategory"&&f==="otherShare"){f="S";}else{if(c.crXMLLabel==="recipientCategory"&&f==="otherLoan"){f="L";}}var a=c.crXMLDataType||c.xtype||null;if(!a&&c.getXType){a=c.getXType();}if(c.crXMLLabel&&(c.crXMLSuppressValue&&(c.crXMLSuppressValue===f||c.crXMLSuppressValue==="all_Values"))){a=null;}if(a==="crCountField"||a==="count"){b.addCount(d,c.crXMLLabel,f);}else{if(a==="crDateField"||a==="date"){b.addDate(d,c.crXMLLabel,f);}else{if(a==="crTimeField"||a==="time"){b.addTime(d,c.crXMLLabel,f);}else{if(a==="crMoneyField"||a==="money"){b.addMoney(d,c.crXMLLabel,f);}else{if(a==="crRateField"||a==="rate"){b.addRate(d,c.crXMLLabel,f);}else{if(a==="crDocumentField"||a==="document"){b.addDocument(d,c.crXMLLabel,f);}else{if(a==="crBinaryField"||a==="binary"){b.addBinary(d,c.crXMLLabel,f);}else{if(a==="crOptionField"||a==="option"){b.addOption(d,c.crXMLLabel,f);}else{if(a==="crSerialField"||a==="serial"){b.addSerial(d,c.crXMLLabel,f);}else{if(a==="crTextField"||a==="text"){b.addText(d,c.crXMLLabel,f);}else{if(a==="crCheckbox"||a==="checkbox"){b.addOption(d,c.crXMLLabel,f);}}}}}}}}}}}return b;};CR.Core.getPostingDate=function(b){if(!b.callbackArgs){b.callbackArgs={};}b.callbackArgs.postingDate="";var a=new CR.XML();var d=a.addContainer(a.getRootElement(),"sequence");var c=a.addContainer(d,"transaction");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),crOverride:{},crMask:{container:b.maskingContainer},success:function(f){var h=CR.JSON.parse(f.responseText);var g;if(h&&h.query&&h.query.sequence&&h.query.sequence[0].transaction){g=h.query.sequence[0].transaction[0];}if(g&&g.$attr.result==="posted"){b.callbackArgs.postingDate=g.postingDate;}if(b.callbackFunction){b.callbackFunction.call(b.callbackScope||window,b.callbackArgs);}}});};CR.Core.getPostingTime=function(b){if(!b.callbackArgs){b.callbackArgs={};}b.callbackArgs.postingTime="";var a=new CR.XML();var d=a.addContainer(a.getRootElement(),"sequence");var c=a.addContainer(d,"transaction");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),crOverride:{},crMask:{container:b.maskingContainer},success:function(f){var h=CR.JSON.parse(f.responseText);var g;if(h&&h.query&&h.query.sequence&&h.query.sequence[0].transaction){g=h.query.sequence[0].transaction[0];}if(g&&g.$attr.result==="posted"){b.callbackArgs.postingTime=g.postingTime;}if(b.callbackFunction){b.callbackFunction.call(b.callbackScope||window,b.callbackArgs);}}});};CR.Core.getRowDescription=function(b){if(!b.callbackArgs){b.callbackArgs={};}b.callbackArgs.rowDescription="";var a=new CR.XML();var g=a.addContainer(a.getRootElement(),"sequence");var f=a.addContainer(g,"transaction");var d=a.addContainer(f,"step");var c=a.addContainer(d,"accessKeyResolve");a.addText(c,"tableName",b.tableName);a.addSerial(c,"targetSerial",b.targetSerial);CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),crOverride:{},crMask:{container:b.maskingContainer},success:function(h){var k=CR.JSON.parse(h.responseText);var j;if(k&&k.query&&k.query.sequence&&k.query.sequence[0].transaction){j=k.query.sequence[0].transaction[0];}var i;if(j&&j.step&&j.step[0]&&j.step[0].accessKeyResolve){i=j.step[0].accessKeyResolve;}if(i&&i.rowDescription){b.callbackArgs.rowDescription=i.rowDescription;}if(b.callbackFunction){b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}});};CR.Core.refreshComponents=function(a){a=a||{};Ext.ComponentMgr.all.each(function(d){if(d.crRefreshComponent){var i=CR.FMPanel.getDefaultContainer();var g=d;var b=false;var h=false;var f=d.findParentBy(function(j){if(j.collapsed){b=true;}if(j===i){return true;}else{g=j;}});var c=function(){if(!d.crRefreshPending){var j=function(){d.crRefreshPending=false;d.crRefreshComponent(a);};d.addListener("afterlayout",j,d,{single:true});d.crRefreshPending=true;}};if(b){c();}else{if(!f||(f&&f.getActiveTab()===g)){d.crRefreshComponent(a);}else{c();}}}return true;});};CR.Core.getJSessionID=function(f){var d="";var b=window.document.cookie;if(b.length>0){var a=b.indexOf("JSESSIONID=");if(a!==-1){if(f){a+=11;}var c=b.indexOf(";",a);if(c===-1){c=b.length;}d=b.substring(a,c);}}return d;};CR.Core.base64EncodeArray=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/","="];CR.Core.base64Encode=function(r){var b=0;var f=typeof(r)==="string";var a=r.length;var q=76;var c=Math.floor((a+2)/3)*4;c+=Math.floor(c/q);var i="";var d=0;var h=0;var p,o,n=0;while(a>0){if(f){p=r.charCodeAt(b++);}else{p=r[b++];}if(p===65533){p=0;}--a;o=0;n=0;if(a===0){h=2;}else{if(f){o=r.charCodeAt(b++);}else{o=r[b++];}if(o===65533){o=0;}--a;if(a===0){h=1;}else{if(f){n=r.charCodeAt(b++);}else{n=r[b++];}if(n===65533){n=0;}--a;}}var m=((p&255)>>>2);var l=((p&3)<<4|((o&255)>>>4));var k=((o&15)<<2|((n&255)>>>6));var j=(n&63);if(h!==0){if(h===2){k=64;}j=64;}var g="";if(d>=q){g+="\n";d=0;}g+=CR.Core.base64EncodeArray[m]+CR.Core.base64EncodeArray[l]+CR.Core.base64EncodeArray[k]+CR.Core.base64EncodeArray[j];d+=4;i+=g;}return i;};CR.Core.adjustStringCase=function(b){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ";if(!b){return"";}b=b.toUpperCase();var f="";var d=true;for(var c=0;c<b.length;c++){if(a.indexOf(b[c])>-1){if(d){f+=b[c].toUpperCase();d=false;}else{f+=b[c].toLowerCase();}}else{f+=b[c];d=true;}}return f;};CR.Core.highlightFieldChange=function(c){c=Ext.apply({fieldComponent:null,color:"#0000ff",duration:1},c);var a=c.fieldComponent;if(a&&typeof a.getEl==="function"){var d=Ext.fly(a.getEl());if(d){d.highlight(c.color,{attr:"color",duration:c.duration});if(a.ownerCt&&a.ownerCt.getEl()){var b=a.ownerCt.getEl().query('label[for="'+a.getEl().id+'"]').shift();if(b){d=Ext.fly(b);if(d){d.highlight(c.color,{attr:"color",duration:c.duration});}}}}}};CR.Core.getDevicePrinters=function(b){if(!b){b={};}if(CR.Login.deviceReceiptPrinters===undefined||CR.Login.deviceEndorsementPrinters===undefined||CR.Login.deviceCheckPrinters===undefined||CR.Login.deviceCardPrinters===undefined||CR.Login.deviceCamPrinters===undefined||CR.Login.deviceCheckScanners===undefined){CR.Login.deviceReceiptPrinters=null;CR.Login.deviceEndorsementPrinters=null;CR.Login.deviceCheckPrinters=null;CR.Login.deviceCardPrinters=null;CR.Login.deviceCamPrinters=null;CR.Login.deviceCheckScanners=null;var a=new CR.XML();var h=a.addContainer(a.getRootElement(),"sequence");var f=a.addContainer(h,"transaction");var d=a.addContainer(f,"step");var c=a.addContainer(d,"search");a.addText(c,"tableName","DEVICE_PRINTER_LINK");a.addText(c,"filterName","BY_DEVICE_SERIAL_WITH_DETAIL");a.addOption(c,"includeSelectColumns","Y");a.addOption(c,"includeTotalHitCount","Y");a.addCount(c,"returnLimit","1000");var g=a.addContainer(c,"parameter");a.addText(g,"columnName","PARENT_SERIAL");a.addSerial(g,"contents",CR.Login.deviceSerial);CR.Core.ajaxRequest({url:"SearchJSON",xmlData:a.getXMLDocument(),scope:this,crOverride:{},crMask:{suppress:true},success:function(n){var l=CR.JSON.parse(n.responseText);if(l&&l.resultRows){var q=l.resultRows;if(q.length===0){if(b.callbackFunction){b.callbackFunction.call(b.callbackScope||window,b.callbackArgs||{});}}else{var p=[];var t=[];var s=[];var u=[];var r=[];var j=[];for(var o=0;o<q.length;o++){var m=q[o].LINK_CATEGORY;var k={serial:q[o].PRINTER_SERIAL,description:q[o].PRINTER_ROW_DESCRIPTION,category:q[o].PRINTER_CATEGORY,identifier:q[o].PRINTER_IDENTIFIER,linkCategory:q[o].LINK_CATEGORY,linkSerial:q[o].serial};if(m==="REC"){p.push(k);}else{if(m==="CEN"){t.push(k);}else{if(m==="CHK"){s.push(k);}else{if(m==="CPL"){u.push(k);}else{if(m==="CAM"){r.push(k);}else{if(m==="CSC"){j.push(k);}}}}}}}if(p.length>0){CR.Login.deviceReceiptPrinters=p;}else{CR.Login.deviceReceiptPrinters=null;}if(t.length>0){CR.Login.deviceEndorsementPrinters=t;}else{CR.Login.deviceEndorsementPrinters=null;}if(s.length>0){CR.Login.deviceCheckPrinters=s;}else{CR.Login.deviceCheckPrinters=null;}if(u.length>0){CR.Login.deviceCardPrinters=u;CR.CardManager.getCardPrinterInterface();}else{CR.Login.deviceCardPrinters=null;}if(r.length>0){CR.Login.deviceCamPrinters=r;}else{CR.Login.deviceCamPrinters=null;}if(j.length>0){CR.Login.deviceCheckScanners=j;CR.TellerCapture.getCheckScannerInterface();}else{CR.Login.deviceCheckScanners=null;}if(b.callbackFunction){b.callbackFunction.call(b.callbackScope||window,b.callbackArgs||{});}}}}});}else{if(b.callbackFunction){b.callbackFunction.call(b.callbackScope||window,b.callbackArgs||{});}}};CR.Core.getDeviceInteractionChannel=function(c){if(!c){c={};}var b=new CR.XML();var h=b.addContainer(b.getRootElement(),"sequence");var g=b.addContainer(h,"transaction");var d=b.addContainer(g,"step");var a=b.addContainer(d,"record");b.addOption(a,"operation","V");b.addText(a,"tableName","DEVICE");b.addSerial(a,"targetSerial",CR.Login.deviceSerial);var f=b.addContainer(a,"field");b.addText(f,"columnName","INTERACTION_CHANNEL_SERIAL");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),crMask:{},params:{},success:function(i){var m=CR.JSON.parse(i.responseText);var l=m.query;var k="failed";var j=[];if(m.query){Ext.each(l.sequence,function(n){Ext.each(n.transaction,function(o){k=o.$attr.result;Ext.each(o.step,function(q){if(q.tranResult&&q.tranResult.category&&q.tranResult.category.option==="E"){j.push(q.tranResult.description);}else{if(q.record){var p=q.record;if(p.tableName==="DEVICE"){Ext.each(p.field,function(r){if(r.columnName==="INTERACTION_CHANNEL_SERIAL"){CR.Login.deviceInteractionChannelSerial=r.newContents||null;}});}}}});});});}if(k!=="posted"){CR.Core.displayExceptions({items:j});}else{if(c.callbackFunction){c.callbackFunction.call(c.callbackScope,c.callbackArgs);}}}});};CR.Core.convertXMLtoJSON=function(k){var q;var o;var f={};if(k.nodeType===1){if(k.attributes.length>0){for(var g=0;g<k.attributes.length;g++){var b=k.attributes.item(g);var n=b.nodeName;if(n.indexOf(":")>0){n=n.substring(n.indexOf(":")+1);}var c=b.value;if(n==="option"){q=c;f["option"]=q;}else{if(n==="type"){o=c;}else{if(n==="xmlns"){var d=c;}else{if(!f["$attr"]){f["$attr"]={};}f["$attr"][n]=c;}}}}}}else{if(k.nodeType===3){f=k.nodeValue;}}if(k.hasChildNodes()){for(var h=0;h<k.childNodes.length;h++){var r=k.childNodes.item(h);var p=r.nodeName;if(p.indexOf(":")>0){p=p.substring(p.indexOf(":")+1);}if(r.nodeType===3&&/^\s+$/.test(r.nodeValue)){}else{var l=CR.Core.convertXMLtoJSON(r)||null;try{if(l&&typeof l==="object"&&Object.keys(l).length===0&&JSON.stringify(l)===JSON.stringify({})){l=null;}}catch(m){l=null;}if(q){l={option:q,text:l};}if(typeof(f[p])==="undefined"){var a=k.nodeName;if(a.indexOf(":")>0){a=a.substring(a.indexOf(":")+1);}if(!Ext.isArray(l)&&((a==="query"&&p==="sequence")||(a==="sequence"&&p==="transaction")||(a==="transaction"&&p==="step")||(a==="record"&&p==="field"))){f[p]=[l];}else{f[p]=l;}}else{if(!Ext.isArray(f[p])){f[p]=[f[p]];}if(Ext.isArray(l)&&l.length===1){f[p].push(l[0]);}else{f[p].push(l);}}}}}if(f["#text"]){f=f["#text"];}else{if(o==="a"){f=[f];}}return f;};CR.Core.setLoginImageCookie=function(a){CR.Storage.handler.setItem("image_CorelationDemoLoginLogo",a);};CR.Core.getLoginImageCookie=function(){var a=CR.Storage.handler.getItem("image_CorelationDemoLoginLogo");if(a!==null&&a!==undefined){a="data:image/png;base64,"+a;
}else{a=null;}return a;};CR.Core.setLoginImageSrc=function(){var a=document.getElementById("image_CorelationDemoLoginLogo");if(a){var b=CR.Core.getLoginImageCookie("image_CorelationDemoLoginLogo");if(b){a.src=b;}}};CR.Core.loginImageWorkarea=function(){var h=new CR.Panel({title:"Image Conversion Tool",region:"west",width:750,split:true,html:'<iframe width="100%" height="100%" src="http://www.opinionatedgeek.com/dotnet/tools/base64encode/" />'});var g=new CR.Panel({title:"Current Image",layout:"fit",html:'<img width="275" src="'+CR.Core.getLoginImageCookie()+'" />',autoScroll:true,height:618});var c=new CR.TextAreaField({crColumnDescription:"Base64 Representation of Image",grow:false,width:280,height:100});var d=new CR.Button({text:"Submit"});d.addListener("click",function(){CR.Core.setLoginImageCookie(c.crGetNewContents());g.body.update('<img width="275" src="'+CR.Core.getLoginImageCookie()+'" />');});var b=new CR.Panel({title:"Update Image",layout:"form",items:[c],buttons:[d],labelWidth:200,bodyStyle:"padding:5px;",height:200});var a=new CR.Panel({region:"center",items:[b,g]});var f=new CR.Window({title:"Store Login Image",layout:"border",items:[h,a],height:800,width:1280});f.crShow();};CR.Core.setTheme=function(f){var g=document.getElementsByTagName("head")[0];var a=document.getElementsByTagName("link");for(var b=0;b<a.length;b++){var c=a[b];if(c.href.indexOf("xtheme")!==-1){g.removeChild(c);}}if(f){if(document.getElementById("corelation-theme")){Ext.util.CSS.swapStyleSheet("corelation-theme",f);}else{var d={};d=document.createElement("link");d.setAttribute("rel","stylesheet");d.setAttribute("type","text/css");d.setAttribute("href",f);d.id="corelation-theme";g.appendChild(d);}}CR.Settings.set("Corelation_Theme",f);};CR.Core.workAreaConfig=null;CR.Core.getWorkAreaConfig=function(a){a=Ext.apply({reload:false,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);if(!CR.Core.workAreaConfig||a.reload){CR.Core.recordSearch({search:{tableName:"WORK_AREA_CONFIG",returnLimit:"1"},callbackFunction:function(b){CR.Core.workAreaConfig=b.record||{};a.callbackFunction.call(a.callbackScope,CR.Core.workAreaConfig);}});}else{a.callbackFunction.call(a.callbackScope,CR.Core.workAreaConfig);}};CR.Core.isLiveDatabase=function(){return CR.Login.databaseName&&CR.Login.databaseName.endsWith("LIV");};CR.Core.sendEmailNotification=function(d){var c=function(q,k){var n=new CR.Button({text:q,columnWidth:0.1,style:"margin: 5px"});var r=new CR.TextField({grow:false,columnWidth:0.9,style:"margin: 5px"});var j=new CR.Window({title:"Select Recipients",layout:"form",buttonAlign:"center",collapsible:false,maximizable:false,width:500,height:650,plain:true,items:[]});var m=new CR.SearchPanel({header:false,crID:"searchPanel",crTableName:"USER",crTableDescription:"User",crTableNames:["USER","USER_GROUP"],crUseCheckboxSelectionModel:true,crInsertButtonCreate:false});var p={};var o={};var l=function(u){u=u||{};var s=u.recipients||r.crGetNewContents().split(";").map(function(x){return x.trim().endsWith(")")?x.slice(0,x.lastIndexOf("(")).trim():x.trim();});if(s[s.length-1]===""){s.pop();}var t=new CR.XML();var w=t.addContainer(t.getRootElement(),"sequence");var v=t.addContainer(w,"transaction");s.forEach(function(z){if(!p[z]&&!o[z]){var y=t.addContainer(v,"step");var x=t.addContainer(y,"search");t.addText(x,"tableName","USER");t.addText(x,"filterName","BY_USER_NAME");t.addOption(x,"includeSelectColumns","Y");t.addOption(x,"includeTotalHitCount","Y");t.addCount(x,"returnLimit","100");var A=t.addContainer(x,"parameter");t.addText(A,"columnName","USERNAME");t.addText(A,"contents",z);}});CR.Core.ajaxRequest({url:"DirectXMLPostJSONSteps",xmlData:t.getXMLDocument(),success:function(B){var x=JSON.parse(B.responseText);var y=x.exceptions;if(y&&y.length){CR.Core.displayExceptions({items:y.map(function(I){return I.message;})});}else{if(x.steps){for(var E=0;E<x.steps.length;E++){var H=x.steps[E].search;var D=H.parameter[0].contents;if(H.resultRow){var G=H.resultRow.find(function(I){return I.selectColumn[0].contents===D;});if(G){p[D]={serial:G.serial};}}}}for(var C in p){if(!s.includes(C)){delete p[C];}}var F=new CR.XML();var A=F.addContainer(F.getRootElement(),"sequence");var z=F.addContainer(A,"transaction");s.forEach(function(K){if(!p[K]&&!o[K]){var J=F.addContainer(z,"step");var I=F.addContainer(J,"search");F.addText(I,"tableName","USER_GROUP");F.addText(I,"filterName","BY_EXACT_DESCRIPTION");F.addOption(I,"includeSelectColumns","Y");F.addOption(I,"includeTotalHitCount","Y");F.addCount(I,"returnLimit","1");var L=F.addContainer(I,"parameter");F.addText(L,"columnName","DESCRIPTION");F.addText(L,"contents",K);}});CR.Core.ajaxRequest({url:"DirectXMLPostJSONSteps",xmlData:F.getXMLDocument(),success:function(O){var I=JSON.parse(O.responseText);var L=I.exceptions;if(L&&L.length){CR.Core.displayExceptions({items:L.map(function(V){return V.message;})});}else{if(I.steps){for(var Q=0;Q<I.steps.length;Q++){var U=I.steps[Q].search;if(U.resultRow){var J=U.parameter[0].contents;o[J]={serial:U.resultRow[0].serial};}}}for(var S in o){if(!s.includes(S)){delete o[S];}}var T=new CR.XML();var N=T.addContainer(T.getRootElement(),"sequence");var M=T.addContainer(N,"transaction");for(var P in p){if(!p[P].email){var K=T.addContainer(M,"step");var R=T.addContainer(K,"record");T.addText(R,"tableName","USER");T.addOption(R,"operation","V");T.addText(R,"targetSerial",p[P].serial);T.addOption(R,"includeTableMetadata","N");T.addOption(R,"includeColumnMetadata","N");T.addOption(R,"includeRowDescriptions","Y");T.addOption(R,"includeAllColumns","Y");}}CR.Core.ajaxRequest({url:"DirectXMLPostJSONSteps",xmlData:T.getXMLDocument(),success:function(aa){var V=JSON.parse(aa.responseText);var Z=V.exceptions;if(Z&&Z.length){CR.Core.displayExceptions({items:Z.map(function(ag){return ag.message;})});}else{if(V.steps){for(var ab=0;ab<V.steps.length;ab++){var Y=V.steps[ab];var af=Y.record.field.find(function(ag){return ag.columnName==="EMAIL_ADDRESS";});p[Y.record.rowDescription].email=af.newContents||"No email found";}}var W="";for(var ac in p){W+=ac+" ("+p[ac].email+"); ";}for(var ae in o){W+=ae+" (Group); ";}r.crSetContents(W.trim());var ad=[];s.forEach(function(ag){if(!p[ag]&&!o[ag]){ad.push(ag);}});if(ad.length>0){var X="Unable to find the following <b>Users</b> or <b>User Groups</b>:<br><ul>";for(var ab=0;ab<ad.length;ab++){X+='<li>&emsp;<font color="red">&bull; '+ad[ab]+"</font></li>";}X+="</ul>";Ext.Msg.show({title:"Warning",msg:X,buttons:Ext.Msg.OK,icon:Ext.MessageBox.WARNING});}else{if(u.callbackFunction){u.callbackFunction.call(u.callbackScope,u.callbackArgs);}}}}});}}});}}});};if(k.length>0){l({recipients:k});}r.addListener("blur",l);r.addListener("afterrender",function(s){new Ext.ToolTip({target:s.getEl(),html:'Separate recipients with ";"'});s.getEl().dom.setAttribute("spellcheck","false");});j.addListener("add",function(u,t){if(t.crID==="searchParametersFieldSet"){m.crInitiateSearch();j.center();}else{if(t.crID==="searchResultsFieldSet"){var s=CR.Core.findChildByCRID(t,"searchResultGrid");j.crSelectionModel=s.getSelectionModel();j.crSelectionModel.addListener("rowselect",function(x,w,v){if(m.crGetTableName()==="USER"){p[v.get("ROW_DESCRIPTION")]={serial:v.get("serial")};}else{o[v.get("ROW_DESCRIPTION")]={serial:v.get("serial")};}});j.crSelectionModel.addListener("rowdeselect",function(x,w,v){if(m.crGetTableName()==="USER"){delete p[v.get("ROW_DESCRIPTION")];}else{delete o[v.get("ROW_DESCRIPTION")];}});s.getStore().addListener("load",function(A,w,x){var z=[];if(m.crGetTableName()==="USER"){for(var y=0;y<w.length;y++){var v=w[y];if(Object.keys(p).includes(v.get("ROW_DESCRIPTION"))){z.push(v);}}}else{for(var y=0;y<w.length;y++){var v=w[y];if(Object.keys(o).includes(v.get("ROW_DESCRIPTION"))){z.push(v);}}}j.crSelectionModel.selectRecords(z,false);});}}});j.addListener("beforeclose",function(){j.hide();return false;});m.addListener("beforerender",function(){var s=CR.Core.findChildByCRID(m,"searchTableSelectFieldSet");s.hidden=false;});j.add(m);j.addButton({text:"Select",handler:function(){l({recipients:Object.keys(p).concat(Object.keys(o))});j.hide();}});n.addListener("click",function(){l({callbackFunction:function(){if(j.crSelectionModel){var s=j.crSelectionModel.getSelections().filter(function(u){for(var t in p){if(t.serial===u.get("serial")){return true;}}});j.crSelectionModel.selectRecords(s,false);}j.show();}});});return new Ext.Container({layout:"column",crID:q,items:[n,r],crValidateRecipients:l,crGetRecipients:function(){var s={userSerials:[],userGroupSerials:[]};for(var t in p){s.userSerials.push(p[t].serial);}for(var u in o){s.userGroupSerials.push(o[u].serial);}return s;}});};var h=new CR.TextField({crContents:d.subject||"",grow:false,columnWidth:0.9,style:"margin: 5px"});var f=new Ext.Container({layout:"column",crID:"subject",items:[new Ext.form.DisplayField({value:"Subject",columnWidth:0.1,style:"margin: 5px; padding-top: 3px; text-align:center; font: normal 11px arial,helvetica,sans-serif;"}),h],crGetSubject:function(){return h.crGetNewContents();}});var g=new CR.TextAreaField({crContents:d.body||"",height:220,columnWidth:1,grow:false,style:"margin: 5px",hideLabel:true,emptyText:d.body?"":"Enter your message here..."});var a=new Ext.Container({layout:"column",crID:"body",items:[g],crGetBody:function(){return g.crGetNewContents();}});var b=new CR.Panel({layout:"form",frame:true,width:600,height:400,buttonAlign:"center",items:[c("To...",d.toRecipients||[]),c("Cc...",d.ccRecipients||[]),c("Bcc...",d.bccRecipients||[]),f,a],buttons:[{text:"Send",handler:function(q){var o=function(x,y,u){for(var v=0;v<x.length;v++){var w=r.addContainer(s,"recipient");r.addOption(w,"toOption",y);r.addText(w,"tableName",u);r.addText(w,"targetSerial",x[v]);}};var l=q.findParentByType(CR.Panel);var j=CR.Core.findChildByCRID(l,"subject").crGetSubject();var k=CR.Core.findChildByCRID(l,"body").crGetBody();var r=new CR.XML();var p=r.addContainer(r.getRootElement(),"sequence");var n=r.addContainer(p,"transaction");var m=r.addContainer(n,"step");var s=r.addContainer(m,"sendEmail");r.addText(s,"subject",j);r.addText(s,"body",k);var t=CR.Core.findChildByCRID(q.ownerCt.ownerCt,"To...");t.crValidateRecipients({callbackFunction:function(){var u=t.crGetRecipients();o(u.userSerials,"To","USER");o(u.userGroupSerials,"To","USER_GROUP");t=CR.Core.findChildByCRID(q.ownerCt.ownerCt,"Cc...");t.crValidateRecipients({callbackFunction:function(){u=t.crGetRecipients();o(u.userSerials,"Cc","USER");o(u.userGroupSerials,"Cc","USER_GROUP");t=CR.Core.findChildByCRID(q.ownerCt.ownerCt,"Bcc...");t.crValidateRecipients({callbackFunction:function(){u=t.crGetRecipients();o(u.userSerials,"Bcc","USER");o(u.userGroupSerials,"Bcc","USER_GROUP");CR.Core.ajaxRequest({url:"DirectXMLPostJSONSteps",xmlData:r.getXMLDocument(),success:function(v){var x=JSON.parse(v.responseText);var w=x.exceptions;if(w&&w.length){CR.Core.displayExceptions({items:w.map(function(y){return y.message;})});}else{q.findParentByType(CR.Window).crClose();Ext.Msg.show({title:"Success",msg:"Email notification sent successfully",buttons:Ext.Msg.OK});}}});}});}});}});}},{text:"Cancel",handler:function(j){j.findParentByType(CR.Window).crClose();}}]});var i=new CR.Window({title:"Send Email Notification",collapsible:true,layout:"fit",plain:true,width:600,items:[b]});i.show();};CR.GridPanel.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:false,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,getRowBodyContent:null,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});CR.GridPanel.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl==="string"){this.tpl=new Ext.Template(this.tpl);}this.tpl.compile();}this.state={};this.bodyContent={};},getRowClass:function(a,f,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,f);}if(b){d.body=b;}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed";},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this);},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{"enter":this.onEnter,scope:this});}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this);}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav;}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this);}},onRowDblClick:function(a,b,c){this.toggleRow(b);},onEnter:function(h){var f=this.grid;var j=f.getSelectionModel();var b=j.getSelections();for(var c=0,a=b.length;c<a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d);}},getBodyContent:function(a,b){if(!this.enableCaching){if(this.tpl){return this.tpl.apply(a.data);}else{if(this.getRowBodyContent){return this.getRowBodyContent(a,b);}}}var c=this.bodyContent[a.id];if(!c){if(this.tpl){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c;}else{if(this.getRowBodyContent){c=this.getRowBodyContent(a,b);this.bodyContent[a.id]=c;}}}return c;},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c);},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>';},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if((this.tpl||this.getRowBodyContent)&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c);}return true;}else{return false;}},toggleRow:function(a){if(typeof a==="number"){a=this.grid.view.getRow(a);}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a);},expandRow:function(c){if(typeof c==="number"){c=this.grid.view.getRow(c);}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex);}},collapseRow:function(c){if(typeof c==="number"){c=this.grid.view.getRow(c);}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex);}},toggleAll:function(g){var c=this;var f=c.grid;var b=f.getStore();var a=b.getRange();for(var d=0;d<a.length;d++){if(g){c.expandRow(d);}else{c.collapseRow(d);}}},expandAllRows:function(){this.toggleAll(true);},collapseAllRows:function(){this.toggleAll(false);}});CR.FMPanel=Ext.extend(CR.FormPanel,{crPostingMode:"P",crRequestType:"update",crTableName:"",crTableDescription:"",crTargetSerial:"",crRowDescription:"",crParentSerial:"",crDefaultsSerial:"",crNewLocationOption:"",crNewLocationSerial:"",crPanelTitle:"",crPanelTitleSuppress:false,crPanelCloseOnUpdateOrInsert:true,crSuppressButtons:false,crOfacNeeded:false,crOnFMPostSuccess:function(a,b){a.crFMPostSuccessHandler(b);},crCallbackFunction:CR.Core.emptyFunction,crCallbackFunctionArgs:{},crCallbackFunctionScope:"",crFieldDefaultValuesFirstApplyColumnName:null,crFieldDefaultValues:null,crDefaultViewGroups:null,crOriginalContents:null,crFieldDefaultValuesCopyHiddenAndDisabledState:false,crFocusColumnName:"",crUpdateGridRowOnSubmit:false,crSuppressExternalRefreshOnSubmit:false,crReturnRecord:[],crFMPanelContainer:null,crFMPanelContainerId:null,crLayout:"form",crIsACHLookupInsertFromWorkPostingException:false,crAdditionalListeners:null,crFMScriptSerial:null,closable:true,frame:true,bodyStyle:"padding:5px 5px 0",autoScroll:true,labelAlign:"left",labelWidth:175,buttonAlign:"left",minButtonWidth:100,constructor:function(b){var j=Ext.apply({},b);
if(CR.KeyStoneLauncherParameters&&CR.KeyStoneLauncherParameters.actionFmPanelColumnFocus){j.crFocusColumnName=CR.KeyStoneLauncherParameters.actionFmPanelColumnFocus.columnName;CR.KeyStoneLauncherParameters.actionFmPanelColumnFocus=null;}if(j.crRequestType!=="insert"&&j.crRequestType!=="delete"&&j.crRequestType!=="view"){j.crRequestType="update";}if(!j.crTargetSerial){j.crRequestType="insert";}j.layout=j.crLayout;if(!j.crPanelTitle){if(j.crRequestType==="insert"){j.crPanelTitle="Insert";}else{if(j.crRequestType==="delete"){j.crPanelTitle="Delete";}else{if(j.crRequestType==="view"){j.crPanelTitle="View";}else{j.crPanelTitle="Update";}}}if(j.crRowDescription){j.crPanelTitle+=" "+j.crRowDescription;}else{if(j.crTableDescription){j.crPanelTitle+=" "+j.crTableDescription;}}}j.title="";if(!j.crPanelTitleSuppress){j.title=j.crPanelTitle;}j.items=j.crItems;if(!j.crSuppressButtons){var c=[];var m="Update";if(j.crRequestType==="insert"){m="Insert";}else{if(j.crRequestType==="delete"){m="Delete";}else{if(j.crRequestType==="view"){m="Submit";}}}var d=new CR.ToolbarButton({text:m});c.push(d);if(j.crRequestType==="update"){var l=new CR.ToolbarButton({text:"Delete"});c.push("-",l);}if(j.crTargetSerial){var k=new CR.ToolbarButton({text:"Print"});c.push("-",k);}if(j.crRequestType!=="insert"){var h=new CR.ToolbarButton({text:"References"});c.push("-",h);var f=new CR.ToolbarButton({text:"History"});c.push("-",f);}var a=new CR.Menu();var g=new CR.ToolbarButton({iconCls:"exception-icon",tooltip:"Exceptions",text:"&nbsp;",hidden:true,menu:a});c.push("-",g);j.bbar=new Ext.Toolbar({items:c});}CR.FMPanel.superclass.constructor.call(this,j);var i=this;i.crApplyFieldListeners();if(!i.crSuppressButtons){d.addListener("click",function(n){i.crSubmitHandler(i.crRequestType);},i);i.crDeleteButton=null;if(i.crRequestType==="update"){l.addListener("click",function(n){i.crSubmitHandler("delete");},i);i.crDeleteButton=l;}i.crPrintButton=null;if(i.crTargetSerial){k.addListener("click",function(){CR.Panel.printTwoFieldSetColumns(i);},i);i.crPrintButton=k;}i.crReferencesButton=null;if(i.crRequestType!=="insert"){h.addListener("click",function(){var n=i.findParentByType(CR.TabPanel)||CR.FMPanel.getDefaultContainer();CR.RecordReferencePanel.openWindow({tableName:i.crTableName,targetSerial:i.crTargetSerial,rowDescription:i.crRowDescription,containerForViewSelections:n});},i);i.crReferencesButton=h;f.addListener("click",function(){CR.HistorySearchPanel.showHistory({searchContainer:CR.FMPanel.getDefaultContainer(),fmPanelContainer:CR.FMPanel.getDefaultContainer(),defaultSearch:i.crTableName==="GL"?"advanced":"record",submitDefaultSearch:true,tableName:i.crTableName,targetSerial:i.crTargetSerial,rowDescription:i.crRowDescription});},i);}i.crExceptionMenu=a;i.crExceptionButton=g;i.crSetupCustomButtons();}if(i.crTargetSerial&&i.crRowDescription){CR.Settings.addRecentRow(i.crTableName,i.crTargetSerial,i.crRowDescription);}i.crApplyCustomListeners();CR.FMScript.setup(i.crTableName,i);},crSetupCustomButtons:function(){var a=this;if(CR.Scanning){CR.Scanning.setupFMPanelButton(a);}if(CR.AddressValidation){CR.AddressValidation.setupFMPanelButton(a);}if(CR.PDFDocument){CR.PDFDocument.setupFMPanelButton(a);}if(CR.LoanProjectionPanel2){CR.LoanProjectionPanel2.setupFMPanelButton(a);}if(CR.Disputes){CR.Disputes.setupFMPanelButton(a);}if(CR.Workflow&&typeof CR.Workflow.setupFMPanelButton==="function"){CR.Workflow.setupFMPanelButton(a);}if(CR.RMDCalculation){CR.RMDCalculation.setupFMPanelButton(a);}if(CR.IndirectApplication){CR.IndirectApplication.setupFMPanelButton(a);}if(CR.HylandOnBaseServices){CR.HylandOnBaseServices.setupFMPanelButton(a);}if(CR.EMCServices){CR.EMCServices.setupFMPanelButton(a);}if(CR.TeSignLite){CR.TeSignLite.setupFMPanelButton(a);}if(CR.DocuSign){CR.DocuSign.setupFMPanelButton(a);}if(CR.SigniX){CR.SigniX.setupFMPanelButton(a);}if(CR.VisualGAPService){CR.VisualGAPService.setupFMPanelButton(a);}if(CR.CarfaxHistory){CR.CarfaxHistory.setupFMPanelButton(a);}if(CR.CarSolutionsService){CR.CarSolutionsService.setupFMPanelButton(a);}if(CR.Route66){CR.Route66.setupFMPanelButton(a);}if(CR.ASGService){CR.ASGService.setupFMPanelButton(a);}if(CR.ConstructionLoans){CR.ConstructionLoans.setupFMPanelButton(a);}if(CR.EDocLogicServices){CR.EDocLogicServices.setupFMPanelButton(a);}if(CR.SynergyService){CR.SynergyService.setupFMPanelButton(a);}if(CR.CUNA){CR.CUNA.setupFMPanelButton(a);}if(CR.AlliediQQService){CR.AlliediQQService.setupFMPanelButton(a);}if(CR.AlliediQQRealtimeService){CR.AlliediQQRealtimeService.setupFMPanelButton(a);}if(CR.Covenant){CR.Covenant.setupFMPanelButton(a);}if(CR.LoanChangeProjection){CR.LoanChangeProjection.setupFMPanelButton(a);}},crApplyCustomListeners:function(){var h=this;if(CR.NADA&&CR.VehicleValuation&&(h.crGetTableName()==="LR_COLLATERAL"||h.crGetTableName()==="COLLATERAL")){var a=function(){if(CR.NADA.externalUrls){var m=function(q,s){var p;var r;if(s){if(q.crNADALinkNode){Ext.removeNode(q.crNADALinkNode);q.crNADALinkNode=null;}}else{r=q.getEl();p='&nbsp;<a href="javascript:void(0)" onclick="CR.NADA.openLink()">NADA</a>';if(q.crNADALinkNode){q.crNADALinkNode.nodeValue=p;}else{var o=new Ext.DomHelper.createDom({html:p});q.crNADALinkNode=r.insertSibling(o,"after",true);}}};h.cascade(function(o){if(o.crGetColumnName&&o.crGetColumnName()==="CATEGORY"){if(o.crGetNewContents()==="V"){h.cascade(function(p){if(p.crGetColumnName&&p.crGetColumnName()==="AMOUNT"){if(!p.rendered){p.addListener("afterrender",function(){m(p);});}else{m(p);}}});}o.addListener("select",function(){if(o.crGetNewContents()==="V"){h.cascade(function(p){if(p.crGetColumnName&&p.crGetColumnName()==="AMOUNT"){m(p);}});}else{h.cascade(function(p){if(p.crGetColumnName&&p.crGetColumnName()==="AMOUNT"){m(p,true);}});}});}});}if(CR.VehicleValuation.interfaceSerial){var n=function(){var s=false;var p=h.find("crColumnName","CATEGORY").shift();if(p&&p.crGetNewContents()==="V"){s=true;}if(!h.crVehicleValuationButton){h.crVehicleValuationButton=new CR.Button({fieldLabel:"&nbsp;",labelSeparator:"",width:CR.Field.DEFAULT_TEXT_WIDTH,text:"Get Valuation...",tooltip:"Valuation for Vehicles, Boats, Trailers etc...",scope:h,handler:function(t,u){CR.VehicleValuation.show({collateralPanel:h});}});var r=h.find("crColumnName","VALUATION_DATE").shift();var q=r.ownerCt;var o=q.items.indexOf(r)+1;q.insert(o,h.crVehicleValuationButton);h.doLayout();}h.crVehicleValuationButton.setVisible(s);};var l=h.find("crColumnName","CATEGORY").shift();if(l){n.call(h);l.addListener("select",function(){n.call(h);});}}};CR.VehicleValuation.checkInterface({callbackFunction:function(){CR.NADA.checkInterfaces({callbackFunction:a,callbackScope:h});},callbackScope:h});var i=function(n,p){var m;var o;if(p){if(n.crHMDAGeocodeLinkNode){Ext.removeNode(n.crHMDAGeocodeLinkNode);n.crHMDAGeocodeLinkNode=null;}}else{o=n.getEl();m='&nbsp;<a target="_blank" href="https://geomap.ffiec.gov/FFIECGeocMap/GeocodeMap1.aspx" >HMDA Geocoding System</a>';if(n.crHMDAGeocodeLinkNode){n.crHMDAGeocodeLinkNode.nodeValue=m;}else{var l=new Ext.DomHelper.createDom({html:m});n.crHMDAGeocodeLinkNode=o.insertSibling(l,"after",true);}}};var f=function(n,p){var m;var o;if(p){if(n.crHMDARateSpreadCalculatorLinkNode){Ext.removeNode(n.crHMDARateSpreadCalculatorLinkNode);n.crHMDARateSpreadCalculatorLinkNode=null;}}else{o=n.getEl();m='&nbsp;<a target="_blank" href="https://ffiec.cfpb.gov/tools/rate-spread" >HMDA Rate Spread Calculator</a>';if(n.crHMDARateSpreadCalculatorLinkNode){n.crHMDARateSpreadCalculatorLinkNode.nodeValue=m;}else{var l=new Ext.DomHelper.createDom({html:m});n.crHMDARateSpreadCalculatorLinkNode=o.insertSibling(l,"after",true);}}};h.cascade(function(l){if(l.crGetColumnName&&l.crGetColumnName()==="CATEGORY"){if(l.crGetNewContents()==="R"){h.cascade(function(m){if(m.crGetColumnName&&m.crGetColumnName()==="HMDA_MSA_MD_CODE"){if(!m.rendered){m.addListener("afterrender",function(){i(m);});}else{i(m);}}else{if(m.crGetColumnName&&m.crGetColumnName()==="HMDA_RATE_SPREAD"){if(!m.rendered){m.addListener("afterrender",function(){f(m);});}else{f(m);}}}});}l.addListener("select",function(){if(l.crGetNewContents()==="R"){h.cascade(function(m){if(m.crGetColumnName&&m.crGetColumnName()==="HMDA_MSA_MD_CODE"){i(m);}else{if(m.crGetColumnName&&m.crGetColumnName()==="HMDA_RATE_SPREAD"){f(m);}}});}else{h.cascade(function(m){if(m.crGetColumnName&&m.crGetColumnName()==="HMDA_MSA_MD_CODE"){i(m,true);}else{if(m.crGetColumnName&&m.crGetColumnName()==="HMDA_RATE_SPREAD"){f(m,true);}}});}},h);}});}else{if(h.crGetTableName()==="FUNDING"){h.cascade(function(l){if(l.crGetColumnName&&l.crGetColumnName()==="PAYEE"){l.addListener("keyup",function(){if(h.crGetNewContents()!==h.crGetOldContents()){h.cascade(function(m){if(m.crGetColumnName&&m.crGetColumnName()==="OFAC_CHECK_STATUS"){m.crSetContents("-");}});}});}});}else{if((h.crGetTableName()==="PERSON_CONTACT"||h.crGetTableName()==="APPLICANT_CONTACT")){var d=["PC","BC"];var c=["PE","BE"];var k=["C","B"];var j=["E","B"];var g="N";var b="N";if(CR.Core.workAreaConfig){g=CR.Core.workAreaConfig["PER_CONT_DEF_CARD_FRAUD_OPTION"];b=CR.Core.workAreaConfig["PER_CONT_DEF_MRKT_OPTION"];}h.cascade(function(l){if(l.crGetColumnName&&l.crGetColumnName()==="CATEGORY"){l.crOnContentsChange=function(){var m=l.crGetNewContents();if(g!=="N"){h.cascade(function(o){var n=false;if((o.rendered||!h.crTargetSerial)&&o.crGetColumnName&&o.crGetColumnName()==="CARD_FRAUD_ALERT_OPTION"){if(o.crGetNewContents){n=o.crGetNewContents();}if(o&&o.crSetContents&&m&&((d.includes(m)&&k.includes(g))||(c.includes(m)&&j.includes(g)))){o.crSetContents("Y");}else{if(o&&o.crSetContents){o.crSetContents("N");}}if(n&&n!==o.crGetNewContents()){CR.Core.highlightFieldChange({color:CR.Field.FIELD_HIGHLIGHT_COLOR,fieldComponent:o});}}});}};}else{if(h.crRequestType==="insert"&&l.crGetColumnName&&l.crGetColumnName()==="MARKETING_OPTION"){if(l&&l.crSetContents){l.crSetContents(b);}}}});}}}},crImportDataFromScanner:function(b){var a=this;if(b){var c=function(d){a.cascade(function(g){for(var f=0;f<d.length;f++){if(g.crGetColumnName&&g.crGetColumnName()===d[f].crColumnName){if(!b.crSuppressOverwrite||(b.crSuppressOverwrite&&d[f].crContents)){if((a.crTableName==="PERSON_ID"||a.crTableName==="APPLICANT_ID")&&(d[f].crColumnName==="IMAGE"||d[f].crColumnName==="BACK_IMAGE")){g.crAsBase64String=true;g.crBinaryFormat="jpeg";}g.crSetContents(d[f].crContents);}break;}}});};if(b.crPersonData&&(a.crTableName==="PERSON"||a.crTableName==="APPLICANT")){c(b.crPersonData);}if(b.crIdData&&(a.crTableName==="PERSON_ID"||a.crTableName==="APPLICANT_ID")){c(b.crIdData);}if(b.crAddressData&&a.crTableName==="ADDRESS"){c(b.crAddressData);}}},crApplyFieldListeners:function(){var b=this;if(!this.crSuppressButtons){var n=this.findBy(function(i){return i.crGetDataType!==undefined;});for(var g=0;g<n.length;++g){var d=n[g];d.addListener("specialkey",function(i,j){if(j.getKey()===Ext.EventObject.ENTER){b.crSubmitHandler(b.crRequestType);}});}}n=this.findBy(function(i){return i.crColumnHide&&i.crColumnHide.length>0;});for(g=0;g<n.length;++g){CR.Field.columnHideUpdate(n[g]);}if(this.crDefaultViewGroups){var c=this.crDefaultViewGroups;for(g=0;g<c.length;g++){var h=this.findBy(function(i){return i.crViewGroup===c[g].viewGroup;});for(f=0;f<h.length;f++){if(this.crFieldDefaultValuesCopyHiddenAndDisabledState){if(c[g].hidden){h[f].crHide();}if(c[g].disabled){h[f].disable();}}}}}if(this.crFieldDefaultValues){var l=this.crFieldDefaultValuesFirstApplyColumnName;var a=this.crFieldDefaultValues;if(this.crFieldDefaultValuesFirstApplyColumnName){for(g=0;g<a.length;g++){if(a[g].crColumnName===this.crFieldDefaultValuesFirstApplyColumnName){n=this.findBy(function(i){return i.crGetColumnName&&i.crGetColumnName()===l;});for(var f=0;f<n.length;f++){if(n[f].crSetSerial&&"crContents" in a[g]&&a[g].crRowDescription){n[f].crSetSerial(a[g].crContents,a[g].crRowDescription);}else{if(n[f].crSetContents&&"crContents" in a[g]){n[f].crSetContents(a[g].crContents);}}n[f].disable();}}}}for(g=0;g<a.length;g++){n=this.findBy(function(i){return i.crGetColumnName&&i.crGetColumnName()===a[g].crColumnName;});for(f=0;f<n.length;f++){if(n[f].crSetSerial&&typeof a[g].crContents!=="undefined"&&typeof a[g].crRowDescription!=="undefined"){n[f].crSetSerial(a[g].crContents,a[g].crRowDescription);}else{if(n[f].crSetContents&&typeof a[g].crContents!=="undefined"){n[f].crSetContents(a[g].crContents);}}n[f].crOriginalContents=a[g].crOriginalContents;if(this.crFieldDefaultValuesCopyHiddenAndDisabledState){if(a[g].hidden){n[f].crHide();}if(a[g].disabled){n[f].disable();}}if(a[g].placeholder){var m=a[g].placeholder;var o=n[f];o.on("afterrender",function(){var i=o.getEl();if(i){i.set({placeholder:m});}},o,{single:true});}}}}if(this.crAdditionalListeners&&this.crAdditionalListeners.length>0){for(g=0;g<this.crAdditionalListeners.length;g++){var k=this.crAdditionalListeners[g];k.call(this);}}},crGetRequestType:function(){return this.crRequestType;},crGetTableName:function(){return this.crTableName;},crGetTableDescription:function(){return this.crTableDescription;},crGetTargetSerial:function(){return this.crTargetSerial;},crGetRowDescription:function(){return this.crRowDescription;},crGetPanelTitle:function(){return this.crPanelTitle;},crSetTargetSerial:function(a){this.crTargetSerial=a;},crSubmitHandler:function(a){this.crFMType=a;if(this.crFMType!=="delete"){this.crPreFMPost();}else{Ext.MessageBox.show({title:"Delete Confirmation",msg:"Are you sure you want to permanently delete this record?",buttons:Ext.MessageBox.YESNOCANCEL,icon:Ext.MessageBox.QUESTION,scope:this,fn:function(b){if(b==="yes"){this.crFMPost();}}});}},crPreFMPost:function(){var t=this;var u=this.findBy(function(i){return i.getXType!==undefined&&i.getXType()==="crPropertyField"&&i.crPreviouslyExpanded;});if(u.length>0){var d=new CR.XML();var m=d.addContainer(d.getRootElement(),"sequence");var q=d.addContainer(m,"transaction");for(var p=0;p<u.length;p++){d=u[p].crPropertyContainerRequestXML({xml:d,sequence:m,transaction:q});CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:d.getXMLDocument(),scope:this,crOverride:{disableContainer:this,successIfNotApproved:true},crMask:{container:this},success:function(D){if(!this.crIsDestroyed()){var z=CR.JSON.parse(D.responseText);var I=z.query;var J="failed";var K=[];var F=[];if(z.query){m=I.sequence;if(m){for(var G=0;G<m.length;G++){q=m[G].transaction;if(q){for(var E=0;E<q.length;E++){J=q[E].$attr.result;var y=q[E].step;for(var C=0;C<y.length;C++){var H=y[C].propertyContainerRequest;if(H){H=y[C].propertyContainerRequest;F.push(H);}var B=y[C].tranResult;if(B&&B.category&&B.category.option==="E"){K.push(B.description);}}}}}}}if(J==="posted"){for(G=0;G<F.length;G++){var A=Ext.getCmp(F[G].$attr.label);if(A){A.crPropertyContainerRequest=F[G];A.crProcessVerifyResponse();}}this.crFMPost();}else{}}}});}}else{if(this.crTableName==="FUNDING"||this.crTableName==="CHECK"){var r=null;var l=null;var b=null;var x=null;var j=CR.Core.findFields(this);Ext.each(j,function(i){if(i.crGetColumnName){if(i.crGetColumnName()==="PAYEE"){r=i;}else{if(i.crGetColumnName()==="OFAC_CHECK_STATUS"){l=i;}else{if(i.crGetColumnName()==="OFAC_CHECK_STATUS_EXPLANATION"){b=i;}else{if((t.crTableName==="FUNDING"&&i.crGetColumnName()==="CHECKING_ACCOUNT_SERIAL")||t.crTableName==="CHECK"&&i.crGetColumnName()==="CHECK_ACCOUNT_SERIAL"){x=i;}}}}}});if(x.crGetNewContents()&&r.crGetNewContents()!==""&&l.crGetNewContents()==="-"){var d=new CR.XML();var m=d.addContainer(d.getRootElement(),"sequence");var q=d.addContainer(m,"transaction");var k=d.addContainer(q,"step");var c=d.addContainer(k,"record");d.addOption(c,"operation","V");d.addText(c,"tableName","CHECK_ACCOUNT");d.addSerial(c,"targetSerial",x.crGetNewContents());var a=d.addContainer(c,"field");d.addText(a,"columnName","OFAC_CHECK_REQUIRED");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:d.getXMLDocument(),scope:this,crMask:{container:this.ownerCt},params:{},success:function(i){var D=CR.JSON.parse(i.responseText);var A=D.query;
var z="failed";var y=[];var C=false;if(D.query){Ext.each(A.sequence,function(E){Ext.each(E.transaction,function(F){z=F.$attr.result;Ext.each(F.step,function(H){if(H.tranResult&&H.tranResult.category&&H.tranResult.category.option==="E"){y.push(H.tranResult.description);}else{if(H.record){var G=H.record.field;Ext.each(G,function(I){if(I.columnName==="OFAC_CHECK_REQUIRED"){C=I.newContents;}});}}});});});}if(z!=="posted"){CR.Core.displayExceptions({items:y});}else{if(C==="Y"){var B=new CR.Window({layout:"fit",modal:true,closable:false,height:Ext.getBody().getHeight()-50,width:Ext.getBody().getWidth()-50});B.crShow();B.addListener("close",function(){t.crFMPost();});CR.OfacWorkarea.show({container:B,panelArgs:{crIsCheckDisburseTransactionOrFMPanel:true,crPayee:r.crGetNewContents(),crContinueFunctionScope:t,crContinueFunction:function(E,G,F){r.crSetContents(G);l.crSetContents(E);b.crSetContents(F);B.crClose();},crCancelPayeeFunctionScope:t,crCancelPayeeFunction:function(E){r.crSetContents(E);B.crClose();}}});}else{this.crFMPost();}}}});}else{this.crFMPost();}}else{if(this.crTableName==="PERSON"&&this.crFMType==="update"&&CR.Login.personOFACCheckOnInsertUpdate==="Y"||CR.Login.personOFACCheckOnInsertUpdate==="C"){var f=false;var n=false;var h=false;var s=false;var j=CR.Core.findFields(this);Ext.each(j,function(i){if(i.crGetColumnName){if(i.crGetColumnName()==="FIRST_NAME"&&(i.crGetOldContents()!==i.crGetNewContents())){f=true;}else{if(i.crGetColumnName()==="MIDDLE_NAME"&&(i.crGetOldContents()!==i.crGetNewContents())){n=true;}else{if(i.crGetColumnName()==="LAST_NAME"&&(i.crGetOldContents()!==i.crGetNewContents())){h=true;}else{if(i.crGetColumnName()==="BIRTH_DATE"&&(i.crGetOldContents()!==i.crGetNewContents())){s=true;}}}}}});if(f||n||h||s){this.crOfacNeeded=true;}this.crFMPost();}else{if(this.crTableName==="ACH_LOOKUP"&&this.crFMType==="insert"&&this.crIsACHLookupInsertFromWorkPostingException){var v="";var w="";var j=CR.Core.findFields(this);Ext.each(j,function(i){if(i.crGetColumnName){if(i.crGetColumnName()==="DFI_ROUTING_NUMBER"){v=i.crGetNewContents();}else{if(i.crGetColumnName()==="DFI_ACCOUNT_NUMBER"){w=i.crGetNewContents();}}}});var d=new CR.XML();var m=d.addContainer(d.getRootElement(),"sequence");var q=d.addContainer(m,"transaction");var k=d.addContainer(q,"step");var o=d.addContainer(k,"search");d.addText(o,"tableName",this.crTableName);d.addText(o,"filterName","BY_ACCOUNT_NUMBER_ROUTING_NUMBER");d.addOption(o,"includeSelectColumns","N");d.addOption(o,"includeTotalHitCount","N");d.addCount(o,"returnLimit","50");var g=d.addContainer(o,"parameter");d.addText(g,"columnName","DFI_ROUTING_NUMBER");d.addText(g,"contents",v);g=d.addContainer(o,"parameter");d.addText(g,"columnName","DFI_ACCOUNT_NUMBER");d.addText(g,"contents",w);CR.Core.ajaxRequest({url:"SearchJSON",xmlData:d.getXMLDocument(),crOverride:{},crMask:{container:this},scope:this,success:function(i){var A=CR.JSON.parse(i.responseText);if(A.resultRows&&A.resultRows.length===0){this.crFMPost();}else{var y='<table><tr><td><img src="images/Icons/icon-info.gif" /></td>';y+="<td>There are "+A.resultRows.length+" existing ACH Lookups matching this one. <br />"+"Would you like to resolve the conflicts?</td></tr></table>";var z=new CR.Window({title:"ACH Lookup Conflict",html:y,bodyStyle:"padding:5px;background-color:white",buttonAlign:"center",modal:true,buttons:[new CR.Button({text:"Resolve Conflicts",handler:function(){var B=25;var C=25;Ext.each(A.resultRows,function(D){CR.FMPanel.showInsertUpdateWindow({tableName:"ACH_LOOKUP",updateInsert:"update",targetSerial:D.serial,modal:false,collapsible:true,titleCollapse:true,x:B,y:C});z.crClose();B+=25;C+=25;});}}),new CR.Button({text:"Post",handler:function(){t.crFMPost();z.crClose();}}),new CR.Button({text:"Cancel",handler:function(){z.crClose();}})]});z.crShow();}}});}else{this.crFMPost();}}}}},crFMPost:function(){if(!this.crIsDestroyed()&&this.crExceptionMenu){this.crExceptionButton.hide();this.crExceptionMenu.removeAll();}var h;if(this.crFMType==="insert"){h="I";}else{if(this.crFMType==="delete"){h="D";}else{if(this.crFMType==="view"){h="V";}else{h="U";this.crFMType="update";}}}this.crReturnRecord=[];var k=new CR.XML();var g=k.addContainer(k.getRootElement(),"sequence");var c=k.addContainer(g,"transaction");var a=k.addContainer(c,"step");if(this.crPostingMode==="V"||this.crUpdateGridRowOnSubmit){k.addOption(c,"postingMode","V");}var l=k.addContainer(a,"record");k.setAttribute(l,"label","Main");k.addOption(l,"operation",h);k.addOption(l,"includeRowDescriptions","Y");k.addText(l,"tableName",this.crTableName);k.addSerial(l,"defaultsSerial",this.crDefaultsSerial);k.addSerial(l,"targetSerial",this.crTargetSerial);if(this.crTableName!=="ACCOUNT"&&this.crTableName!=="CARD"){k.addSerial(l,"targetParentSerial",this.crParentSerial);}k.addOption(l,"newLocationOption",this.crNewLocationOption);k.addSerial(l,"newLocationSerial",this.crNewLocationSerial);var o=false;var d=CR.Core.findFields(this);for(var j=0;j<d.length;++j){var b=d[j];if(b.clearInvalid&&b.crColumnName){b.clearInvalid();}var f=b.crGetNewContents();var n=b.crGetOldContents();if(f!==n&&!b.crExcludeFromFMPanel){o=true;var p=k.addContainer(l,"field");k.addText(p,"columnName",b.crGetColumnName());k.addOption(p,"operation","S");k.addText(p,"newContents",f);if(b.crBinaryFormat&&b.crBinaryFormat!=="none"&&b.crBinaryFormatColumnName){var p=k.addContainer(l,"field");k.addText(p,"columnName",b.crBinaryFormatColumnName);k.addOption(p,"operation","S");k.addText(p,"newContents",b.crBinaryFormat);}}if(this.crUpdateGridRowOnSubmit){var m={};m.crColumnName=b.crGetColumnName();m.crContents=f;if(b.crGetNewRowDescription){m.crRowDescription=b.crGetNewRowDescription(f);}else{if(b.crGetOptionDescription){m.crRowDescription=b.crGetOptionDescription(f);m.crTitle=b.crRowDescription;}}this.crReturnRecord.push(m);}}if(this.crSecurityEvent&&h!=="V"&&this.crPostingMode!=="V"){var a=k.addContainer(c,"step");var q=k.addContainer(a,"securityCheck");k.addOption(q,"operation","CHECK");k.addOption(q,"securityEvent",this.crSecurityEvent);}if(!o&&this.crFMType==="update"){Ext.MessageBox.alert("Update Exception","No fields have been updated, transaction not posted.");}else{if(this.crTableName==="ADDRESS"&&(this.crFMType==="insert"||this.crFMType==="update")){if(CR.AddressValidation&&CR.AddressValidation.isLicensed()&&!this.crAddressValidated&&CR.AddressValidation.needsValidation(this,this.crFMType)){CR.AddressValidation.validateAddress({fieldPanel:this,callbackScope:this,callbackFunction:function(i){if(i.addressValidated){if(i.validatedAddress){CR.AddressValidation.setFields(this,i.validatedAddress);this.crAddressValidated=true;}this.crFMPost();}else{if(!i.cancel&&!i.edit){this.crConfirmAddressReferences(k,i.overrideRequired);}}}});}else{this.crConfirmAddressReferences(k);}}else{this.crFMPostAttempt(k,this.crOverrideScope);}}},crConfirmAddressReferences:function(c,d){var a=this;var f=this.crFMType;var h=function(s,w,m){var p;if(f==="insert"){p="I";}else{if(f==="update"){p="U";if(w&&w.length>0&&w.length<m){f="insert";p="I";}}}var o,l,k,q,i,n,r,t,u,j;c=new CR.XML();o=c.addContainer(c.getRootElement(),"sequence");l=c.addContainer(o,"transaction");k=c.addContainer(l,"step");q=c.addContainer(k,"record");c.setAttribute(q,"label","Main");c.addOption(q,"operation",p);c.addOption(q,"includeRowDescriptions","Y");c.addText(q,"tableName","ADDRESS");if(f==="update"){c.addSerial(q,"targetSerial",this.crTargetSerial);}Ext.each(CR.Core.findFields(s),function(x){if(x.clearInvalid&&x.crColumnName){x.clearInvalid();}n=x.crGetNewContents();r=x.crGetOldContents();if(!x.crExcludeFromFMPanel&&n!==r||(f==="insert"&&x.crGetColumnName()!=="LAST_FM_DATE")){var y=c.addContainer(q,"field");c.addText(y,"columnName",x.crGetColumnName());c.addOption(y,"operation","S");c.addText(y,"newContents",n);if(x.crBinaryFormat&&x.crBinaryFormat!=="none"&&x.crBinaryFormatColumnName){var y=c.addContainer(q,"field");c.addText(y,"columnName",x.crBinaryFormatColumnName);c.addOption(y,"operation","S");c.addText(y,"newContents",x.crBinaryFormat);}}});if(w&&p==="I"){Ext.each(w,function(x){k=c.addContainer(l,"step");i=c.addContainer(k,"record");c.addText(i,"tableName",x.data.tableName);c.addOption(i,"operation","U");c.addSerial(i,"targetSerial",x.data.serial);j=null;if(x.data.tableName==="PERSON_ADDRESS_LINK"){j="ADDRESS_SERIAL";}else{if(x.data.tableName==="APPLICANT_ADDRESS"){j="SOURCE_ADDRESS_SERIAL";}else{if(x.data.tableName==="COLLATERAL"||x.data.tableName==="LR_COLLATERAL"){j="PROPERTY_ADDRESS_SERIAL";}}}t=c.addContainer(i,"field");c.addText(t,"columnName",j);c.addOption(t,"operation","S");u=c.addContainer(t,"newContentsFrom");c.addText(u,"label","Main");c.addOption(u,"resultValue","TargetSerial");});}if(d){var k=c.addContainer(l,"step");var v=c.addContainer(k,"securityCheck");c.addOption(v,"operation","CHECK");c.addOption(v,"securityEvent","ADD_UFM");var t=c.addContainer(q,"field");c.addText(t,"columnName","ADDRESS_CONFIRMATION_OPTION");c.addOption(t,"operation","S");c.addText(t,"newContents","N");}return c;};var b=function(){var j=new CR.Window({title:"This Address record contains the following references",width:700,height:300,layout:"fit",autoScroll:true,modal:true,items:[g]});var i=j.addButton({text:"Update",disabled:true,scope:a,handler:function(){var m=g.getSelectionModel().getSelections();if(m.length===0){CR.Core.displayExceptions({items:["You must select at least one reference"]});}else{var l=g.getStore().getCount();var k=h.call(this,a,m,l);a.crFMPostAttempt(k,CR.FMPanel.getDefaultContainer());j.crClose();}}});j.addButton({text:"Cancel",scope:a,handler:function(){j.crClose();}});g.getSelectionModel().on("selectionchange",function(k){i.setDisabled(k.getSelections().length===0);});j.crShow();};if(this.crFMType==="update"){var g=new CR.RecordReferencePanel({title:"Select References to Update",crTableName:this.crTableName,crTargetSerial:this.crTargetSerial,crUseCheckboxSelectionModel:true,frame:false,collapsible:false,titleCollapse:false,autoHeight:false,autoScroll:true,crPageSize:1000});g.getBottomToolbar().hide();g.getStore().load({scope:this,callback:function(i,k,l){if(l&&i.length>0){b.call(this);}else{var j=h.call(this,a);a.crFMPostAttempt(j,CR.FMPanel.getDefaultContainer());}}});}else{var c=h.call(this,a);a.crFMPostAttempt(c,CR.FMPanel.getDefaultContainer());}},crFMPostAttempt:function(f,c,g){var a=this;if(!g&&CR.FMScript.isScriptUsed(a)){CR.FMScript.sendMessage({component:a,message:{event:"beforepost",responseRequired:true,query:f.toJSON()},callbackFunction:function(h){if(h.post&&h.query){var i=new CR.XML();i.addJSON(h.query);a.crFMPostAttempt(i,a,true);}}});}else{var d=c||a;var b=null;if(f.getXMLDocument){b=f;}else{b=new CR.XML();b.addJSON(f);}CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),scope:a,crOverride:{disableContainer:d,successIfNotApproved:true},crMask:{container:a},success:function(l){var k="failed";var h="";var x=a.crRowDescription;var u=[];var o=null;var t=null;var k="failed";var v=[];var s=CR.JSON.parse(l.responseText);var r=s.query;if(r){Ext.each(r.sequence,function(i){Ext.each(i.transaction,function(j){k=j.$attr.result;Ext.each(j.exception,function(y){v.push(y.message);});Ext.each(j.step,function(y){if(y.tranResult&&y.tranResult.category&&y.tranResult.category.option&&y.tranResult.category.option==="E"){v.push(y.tranResult.description);}else{if(y.record&&y.record.$attr&&y.record.$attr.label==="Main"){t=y.record;h=t.targetSerialResult||"";x=t.rowDescription||a.crRowDescription;Ext.each(t.field,function(G){var z=G.columnName||"";var F=CR.Core.findFields(a,z);if(F.length>0){var D=F[0];var C=G.exception||[];if(C.length>0&&!a.crIsDestroyed()){if(D.markInvalid){var B="";for(var E=0;E<C.length;++E){var A=C[E].message||"";if(B){B+="<br/>";}B+=CR.Core.htmlText(A);u.push(A);}D.markInvalid(B);if(!o){o=D;}if(a.crFMType!=="delete"){a.crAddExceptionMenuItem({field:D,html:B});}}}}});}}});});});}for(var n=0;n<u.length;++n){var m=0;while(m<v.length){if(v[m]===u[n]){v.splice(m,1);}else{++m;}}}if(a.crFMType!=="delete"){for(n=0;n<v.length;++n){a.crAddExceptionMenuItem({field:null,html:CR.Core.htmlText(v[n])});}}if(!a.crIsDestroyed()&&a.crExceptionMenu&&a.crExceptionMenu.items.getCount()>0){a.crExceptionButton.show();}if(k!=="posted"&&k!=="verified"){if(v.length>0){CR.Core.displayExceptions({items:v,callbackFunction:function(){if(o){o.focus();}}});}else{if(o){o.focus();}}}else{var w=function(){a.crPosted=true;if(h){a.crTargetSerial=h;}if(x){a.crRowDescription=x;}if(a.crFMType!=="view"&&!a.crUpdateGridRowOnSubmit&&!a.crSuppressExternalRefreshOnSubmit){a.crRefreshAllExternalReferences();if(a.crPostingMode!=="V"){var j="Update";var i="updated";if(a.crFMType==="insert"){j="Insert";i="inserted";}else{if(a.crFMType==="delete"){j="Delete";i="deleted";}}Ext.MessageBox.alert(j+" Confirmation","The "+x+" record has been "+i+" successfully.");}if(a.crTargetSerial){if(a.crFMType==="delete"){CR.Settings.removeRecentRow(a.crTableName,a.crTargetSerial);}else{if(a.crRowDescription){CR.Settings.addRecentRow(a.crTableName,a.crTargetSerial,a.crRowDescription);}}}}a.crAfterFMPost(s);a.crOnFMPostSuccess(a,s);};if(a.crOfacNeeded){var p=new CR.Window({layout:"fit",modal:true,closable:false,hidden:true,height:Ext.getBody().getHeight()-50,width:Ext.getBody().getWidth()-50,items:[],bbar:new Ext.Toolbar({buttonAlign:"center",items:[new CR.ToolbarButton({text:"Continue",handler:function(){var i=true;if(CR.Login.personOFACCheckOnInsertUpdate==="C"){i=q.crCheckRequireMatchConfirmOrDeny();}if(i){w();p.crClose();}else{CR.Core.displayExceptions({items:["You must confirm or reject OFAC match"]});}}})]})});var q=CR.OfacWorkarea.show({container:p,panelArgs:{crIsPersonCreate:true,crSourcePersonSerial:a.crTargetSerial,crContinueFunctionScope:p,crContinueFunction:function(){p.crClose();w();}}});}else{w();}}}});}},crAfterFMPost:function(c){var b=this;if(b.crFMType==="insert"&&(b.crTableName==="USER"||b.crTableName==="LOGIN")){if(b.crTableName==="LOGIN"){var d=new CR.XML();var i=d.addContainer(d.getRootElement(),"sequence");var h=d.addContainer(i,"transaction");var f=d.addContainer(h,"step");var a=d.addContainer(f,"record");d.addOption(a,"operation","V");d.addText(a,"tableName",b.crTableName);d.addSerial(a,"targetSerial",b.crTargetSerial);var g=d.addContainer(a,"field");d.addText(g,"columnName","CHANNEL_SERIAL");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:d.getXMLDocument(),scope:b,params:{},success:function(t){var o=CR.JSON.parse(t.responseText);var x=o.query;var s="failed";var z=[];var A="";if(o.query){var r=x.sequence;if(r){for(var v=0;v<r.length;v++){var n=r[v].transaction;if(n){for(var u=0;u<n.length;u++){s=n[u].$attr.result;var m=n[u].step;if(m){for(var q=0;q<m.length;q++){var w=m[q].record;if(w){var y=w.field;if(y){for(var p=0;p<y.length;p++){if(y[p].columnName==="CHANNEL_SERIAL"){A=y[p].newContents;}}}}else{if(m[q].tranResult&&m[q].tranResult.category&&m[q].tranResult.category.option&&m[q].tranResult.category.option==="E"){z.push(m[q].tranResult.description);}}}}}}}}}if(s!=="posted"){CR.Core.displayExceptions({items:z});}else{d=new CR.XML();r=d.addContainer(d.getRootElement(),"sequence");n=d.addContainer(r,"transaction");m=d.addContainer(n,"step");w=d.addContainer(m,"record");d.addOption(w,"operation","V");d.addText(w,"tableName","LOGIN_CHANNEL");d.addSerial(w,"targetSerial",A);y=d.addContainer(w,"field");d.addText(y,"columnName","PASSWORD_POLICY_SERIAL");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:d.getXMLDocument(),scope:b,params:{},success:function(I){var D=CR.JSON.parse(I.responseText);var M=D.query;var H="failed";var O=[];var P=null;if(D.query){var G=M.sequence;if(G){for(var K=0;K<G.length;K++){var C=G[K].transaction;if(C){for(var J=0;J<C.length;J++){H=C[J].$attr.result;var B=C[J].step;if(B){for(var F=0;F<B.length;F++){var L=B[F].record;if(L){var N=L.field;if(N){for(var E=0;E<N.length;E++){if(N[E].columnName==="PASSWORD_POLICY_SERIAL"){P=N[E].newContents;}}}}else{if(B[F].tranResult&&B[F].tranResult.category&&B[F].tranResult.category.option&&B[F].tranResult.category.option==="E"){O.push(B[F].tranResult.description);
}}}}}}}}}if(H!=="posted"){CR.Core.displayExceptions({items:O});}else{if(P){CR.Login.resetLogin({tableName:b.crTableName,targetSerial:b.crTargetSerial,targetRowDescription:b.crRowDescription});}}}});}}});}else{CR.Login.resetLogin({tableName:b.crTableName,targetSerial:b.crTargetSerial,targetRowDescription:b.crRowDescription});}}if(c&&c.query){CR.FMScript.sendMessage({component:b,message:{event:"afterpost",query:c.query}});}},crAddExceptionMenuItem:function(b){var a=this;if(!a.crIsDestroyed()&&a.crExceptionMenu){a.crExceptionMenu.addItem(new CR.MenuItem({text:b.html,iconCls:"exception-icon",handler:function(){var d=true;if(this.parentMenu.items.getCount()<=1){a.crExceptionButton.hide();d=false;}this.parentMenu.remove(this);var c=b.field;if(c&&!c.crIsDestroyed()){if(d){c.addListener("blur",function(){if(a.crExceptionMenu.items.getCount()>0){a.crExceptionButton.showMenu();var f=a.crExceptionMenu.items.first();a.crExceptionMenu.setActiveItem(f);}},c,{single:true});}c.focus(false,true);}}}));}},crFMPostSuccessHandler:function(b){var a=this;if(a.crFMType!=="view"){a.crRefreshRecordInquiry();}if(a.crCallbackFunction&&a.crCallbackFunctionScope){if(a.crUpdateGridRowOnSubmit){a.crCallbackFunctionArgs.results=a.crReturnRecord;}else{a.crCallbackFunctionArgs.serial=a.crTargetSerial;a.crCallbackFunctionArgs.rowDescription=a.crRowDescription;a.crCallbackFunctionArgs.defaultsSerial=a.crDefaultsSerial;if(b){a.crCallbackFunctionArgs.fmQuery=b;}}a.crCallbackFunction.call(a.crCallbackFunctionScope,a.crCallbackFunctionArgs);}},crRefreshRecordInquiry:function(){var b=this;var c=b.crTableName;var d=b.crTargetSerial;var f=b.crFMType;var g=b.crPanelCloseOnUpdateOrInsert;var a=b.ownerCt;if(a&&!b.crIsDestroyed()){a.remove(b);if(a.crClose){a.crClose();}else{if(f!=="delete"&&!g){CR.FMPanel.open({container:a,fmRequest:{requestType:"update",tableName:c,targetSerial:d}});}}}},crRefreshAllExternalReferences:function(){var a=this;CR.Core.refreshComponents({mode:a.crFMType,tableName:a.crTableName,targetSerial:a.crTargetSerial,rowDescription:a.crRowDescription});},crFieldModifiedHandler:function(b){var a=this;if(a.crDeleteButton){a.crDeleteButton.disable();}if(a.crPrintButton){a.crPrintButton.disable();}if(a.crLoanProjectButton){a.crLoanProjectButton.disable();}}});Ext.reg("crFMPanel",CR.FMPanel);CR.FMPanel.open=function(i){if(!i.fmRequest.targetSerial){i.fmRequest.requestType="insert";}else{if(!i.fmRequest.requestType){i.fmRequest.requestType="update";}}i.fmRequest.panelType="FMPanel";if(!i.onFMPanelLoad){i.onFMPanelLoad=CR.Core.emptyFunction;}var h=null;if(!i.container||i.container.crIsDestroyed()){i.onFMPanelLoad(null);}else{h=CR.FMPanel.findMatch(i.container,i.fmRequest);if(h&&i.fmRequest.requestType!==h.crGetRequestType()){h.ownerCt.remove(h);h=null;}if(h){if(i.container.setActiveTab){i.container.setActiveTab(h);}else{if(i.container.crShow){i.container.crShow();}}i.onFMPanelLoad(h);}else{var j=null;if(i.fmRequest.requestType==="insert"&&!i.fmRequest.defaultsSerial&&!i.suppressDefaults){j=CR.Core.findTableByName(i.fmRequest.tableName);}if(j&&j.defaultsTableName){function a(m){m=Ext.apply({crColumnDescription:"Defaults",crColumnName:j.tableDescription+" Defaults",crTableName:j.defaultsTableName,crNullAllowed:true,crEnterKeyHandler:function(){n.crContinueHandler();}},m);var l=new CR.SerialField(m);var k=new CR.FormPanel({autoHeight:true,autoWidth:true,frame:true,bodyStyle:"padding:10px",items:[l]});var n=new CR.Window({title:"Defaults for New "+j.tableDescription,height:125,width:400,constrain:true,modal:true,crOnDefaultsWindowClose:function(){if(!this.crOnFMPanelLoadHandled&&i.onFMPanelLoad){this.crOnFMPanelLoadHandled=true;i.onFMPanelLoad(null);}},crContinueHandler:function(){i.fmRequest.defaultsSerial=l.crGetNewContents();this.crOnFMPanelLoadHandled=true;i.suppressDefaults=true;CR.FMPanel.open(i);this.crClose();}});n.addListener("beforedestroy",n.crOnDefaultsWindowClose);n.add(k);n.addButton({text:"Continue",handler:function(){n.crContinueHandler();}});n.addButton({text:"Cancel",handler:function(){n.crClose();}});n.crShow();l.focus(true,true);}if(i.fmRequest&&(i.fmRequest.tableName==="SHARE"||i.fmRequest.tableName==="LOAN")&&i.fmRequest.parentSerial){CR.Core.recordView({tableName:"ACCOUNT",targetSerial:i.fmRequest.parentSerial,fields:[{columnName:"TYPE_SERIAL"}],callbackFunction:function(l){if(l.tranResult==="posted"){var k=l.record["TYPE_SERIAL"];var m={crIncludeDescriptionParameter:false,crSearchFilterName:"BY_ACCOUNT_TYPE_PRODUCT_LIST_DEFAULTS_NAME",crSearchParameters:[{columnName:"ACCOUNT_TYPE_SERIAL",contents:k},{columnName:"DEFAULTS_NAME",contents:"{queryEvent}"}]};a(m);}}});}else{a();}}else{if(j&&j.customFMHandler&&!i.suppressCustomFM){i.cancelCustomFM=CR.FMPanel.open;j.customFMHandler.call(this,i);}else{i.fmRequest.recordLabel="Main";i.fmRequest.userScript=!!CR.Script;var g=new CR.XML();var d=g.addContainer(g.getRootElement(),"sequence");var c=g.addContainer(d,"transaction");var b=g.addContainer(c,"step");var f=g.addContainer(b,"record");g.setAttribute(f,"label",i.fmRequest.recordLabel);g.addOption(f,"operation","V");g.addOption(f,"includeColumnMetadata","Y");g.addOption(f,"includeAllColumns","Y");g.addOption(f,"includeRowDescriptions","Y");g.addText(f,"tableName",i.fmRequest.tableName);if(i.fmRequest.targetSerial){g.addSerial(f,"targetSerial",i.fmRequest.targetSerial);}if(i.fmRequest.defaultsSerial){g.addSerial(f,"defaultsSerial",i.fmRequest.defaultsSerial);}CR.Core.ajaxRequest({url:"RecordInquiry",xmlData:g.getXMLDocument(),params:i.fmRequest,crOverride:{},crMask:{container:i.container},success:function(l){var k=null;if(!i.container.crIsDestroyed()){k=CR.FMPanel.findMatch(i.container,i.fmRequest);if(k){if(i.container.setActiveTab){i.container.setActiveTab(k);}}else{var m=CR.JSON.parse(l.responseText);if(i.fmPanelConfig){for(var n in i.fmPanelConfig){m[n]=i.fmPanelConfig[n];}}k=new CR.FMPanel(m);CR.Core.addToContainerAndShow(i.container,k);}if(k.crFocusColumnName){k.cascade(function(o){if(o.crGetColumnName&&o.crGetColumnName()===k.crFocusColumnName){o.focus(true,true);}},k);}else{k.crFocusFirstField();}}i.onFMPanelLoad(k);},failure:function(k){i.onFMPanelLoad(null);CR.Core.ajaxErrorHandler(k);}});}}}}};CR.FMPanel.findMatch=function(d,f,g){g=g||"crFMPanel";var c=null;if(f.targetSerial){var b=d.findByType(g);for(var h=0;h<b.length&&!c;++h){var a=b[h];if(a.crGetTableName()===f.tableName&&a.crGetTargetSerial()===f.targetSerial){c=a;}}}return c;};CR.FMPanel.setDefaultContainer=function(a){CR.FMPanel.defaultContainer=a;};CR.FMPanel.getDefaultContainer=function(){return CR.FMPanel.defaultContainer;};CR.FMPanel.CompleteView=Ext.extend(CR.Panel,{crTableName:"",crTargetSerial:"",crRowDescription:"",crMetadataTree:null,crExpandedFieldSets:null,crFilterOptions:null,crDefaultCols:4,crContainerWidth:"",crRecordTreeDetail:null,crIncludeSubRecords:true,crUseFieldSet:true,crRecordTreeCallback:null,crRecordTreeCallbackScope:null,crAdditionalTBarItems:null,autoScroll:true,bodyStyle:"padding:10px;",constructor:function(b){var j=Ext.apply({crIncludeSubRecords:true},b);j.crExpandedFieldSets=[{}];var c=new CR.ToolbarButton({text:"Expand All"});var d=new CR.ToolbarButton({text:"Collapse All"});var m=new CR.ToolbarButton({text:"Print"});var a=new CR.Menu();var k=new CR.ToolbarButton({text:"Filter",menu:a,crIsFilterButton:true});j.crFilterOptions={open:true,closed:false,chargedOff:false,voided:false,expired:false,effectiveInFuture:false};var l=new CR.ToolbarButton({text:"OK",crIsFilterOkButton:true});var g=new CR.FormPanel({crIsFilterOptions:true,labelWidth:1,bodyStyle:"padding:3px;",defaultType:"crCheckbox",defaults:{crCheckedValue:true,crUncheckedValue:false},items:[{boxLabel:"Open",crRowStatusFilterVal:"open",crContents:j.crFilterOptions.open},{boxLabel:"Closed",crRowStatusFilterVal:"closed",crContents:j.crFilterOptions.closed},{boxLabel:"Charged Off",crRowStatusFilterVal:"chargedOff",crContents:j.crFilterOptions.chargedOff},{boxLabel:"Voided",crRowStatusFilterVal:"voided",crContents:j.crFilterOptions.voided},{boxLabel:"Expired",crRowStatusFilterVal:"expired",crContents:j.crFilterOptions.expired},{boxLabel:"Effective In Future",crRowStatusFilterVal:"effectiveInFuture",crContents:j.crFilterOptions.effectiveInFuture}],buttonAlign:"left",buttons:[l]});a.addItem(g);var i=new CR.ToolbarButton({text:"References"});var f=new CR.ToolbarButton({text:"History"});if(j.crIncludeSubRecords){j.tbar=[c,"-",d,"-",new CR.ToolbarButton({text:"Refresh",listeners:{click:function(){CR.Core.refreshComponents();}}}),"-",k,"-",i,"-",f,"-",m];}else{j.tbar=[new CR.ToolbarButton({text:"Refresh",listeners:{click:function(){CR.Core.refreshComponents();}}}),"-",i,"-",f,"-",m];}if(j.crAdditionalTBarItems){j.tbar.push(j.crAdditionalTBarItems);}j.crDefaultCols=Math.ceil(Math.max(1,(j.crContainerWidth-270)/500));CR.FMPanel.CompleteView.superclass.constructor.call(this,j);var h=this;c.addListener("click",function(){this.crOnClickExpandAllButton();},this);d.addListener("click",function(){this.crOnClickCollapseAllButton();},this);m.addListener("click",function(){h.crDefaultCols=2;h.cascade(function(n){if(n.getXType&&n.getXType()==="crFieldSet"&&!n.collapsed){n.crDefaultCols=h.crDefaultCols;n.crUpdateHtml.call(n);}});CR.Core.defer(function(){CR.Panel.printInnerHTML(h.body.dom.innerHTML);h.crDefaultCols=Math.ceil(Math.max(1,(h.ownerCt.getWidth()-270)/500));h.cascade(function(n){if(n.getXType&&n.getXType()==="crFieldSet"&&!n.collapsed){n.crDefaultCols=h.crDefaultCols;n.crUpdateHtml.call(n);}});});});this.crRefreshComponent();this.addListener("afterrender",function(){CR.Core.defer(function(){this.addListener("resize",function(){var n=this;this.crDefaultCols=Math.ceil(Math.max(1,(this.ownerCt.getWidth()-270)/500));this.cascade(function(o){if(o.getXType&&o.getXType()==="crFieldSet"&&!o.collapsed){o.crDefaultCols=n.crDefaultCols;o.crUpdateHtml.call(o);}});},this);},this);},this);l.addListener("click",function(){h.crUpdateFilterOptions(g,a);});i.addListener("click",function(){var n=this.findParentByType(CR.TabPanel)||CR.FMPanel.getDefaultContainer();CR.RecordReferencePanel.openWindow({tableName:h.crTableName,targetSerial:h.crTargetSerial,rowDescription:h.crRowDescription,containerForViewSelections:n});});f.addListener("click",function(){var n=this.findParentByType(CR.TabPanel)||CR.FMPanel.getDefaultContainer();CR.HistorySearchPanel.showHistory({searchContainer:n,fmPanelContainer:n,defaultSearch:h.crTableName==="GL"?"advanced":"record",submitDefaultSearch:true,tableName:h.crTableName,targetSerial:h.crTargetSerial,rowDescription:h.crRowDescription});});},crUpdateFilterOptions:function(c,b){var a=this;c.cascade(function(d){if(d.crRowStatusFilterVal){a.crFilterOptions[d.crRowStatusFilterVal]=d.crGetNewContents();}});b.hide();a.cascade(function(d){if(d.crRowStatus){if(!a.crFilterOptions[d.crRowStatus]){d.hide();}else{d.show();}}});},crOnClickExpandAllButton:function(){var a=0;this.cascade(function(b){if(b.getXType&&b.getXType()==="crFieldSet"&&b.collapsed){a++;b.expand();}});},crOnClickCollapseAllButton:function(){this.cascade(function(a){if(a.getXType&&a.getXType()==="crFieldSet"&&!a.collapsed&&(a.initialConfig&&a.initialConfig.collapsible===true)){a.collapse();}});},crRefreshComponent:function(){if(!this.crMetadataTree){CR.Core.getRecordTreeMetaData({tableName:this.crTableName,callbackFunction:this.crAfterGetRecordTreeMetaData,callbackArgs:{},callbackScope:this});}else{this.crGetTreeDetail();}},crAfterGetRecordTreeMetaData:function(a){this.crMetadataTree=a.metadataTree;this.crGetTreeDetail();},crGetTreeDetail:function(){var a={tableName:this.crTableName,targetSerial:this.crTargetSerial,metadataTree:this.crMetadataTree,callbackFunction:this.crAfterGetRecordTreeDetail,callbackArgs:{},callbackScope:this};if(this.rendered&&this.ownerCt&&this.ownerCt.getXType&&this.ownerCt.getXType()==="crTabPanel"){a.crItemForRemoval=this;a.crRemoveItemOnError=true;a.crOwnerCt=this.ownerCt;}CR.Core.getRecordTreeDetail(a);},crAfterGetRecordTreeDetail:function(a){this.crRecordTreeDetail=a.recordTreeDetail;this.crCreateDisplay();if(this.crRecordTreeCallback&&this.crRecordTreeCallbackScope){this.crRecordTreeCallback.call(this.crRecordTreeCallbackScope,this.crRecordTreeDetail);}},crCreateDisplay:function(){var a=this.body;if(this.ownerCt&&this.ownerCt.getXType()==="crWindow"){a=this.ownerCt.body;}var c=a.getScroll();CR.Core.clearContainer(this);var d=this;var f={};var b=this.crRecordTreeDetail;Ext.each(b,function(h){if(h.recordTree){if(h.recordTree.resultTree){f=h.recordTree.resultTree;}}});var g=function(i,q){var m=null;Ext.each(b,function(y){if(y.record&&y.record.$attr&&y.record.$attr.label===i.detailLabel){m=y.record;}});var o=false;var p=i.rowStatus&&i.rowStatus.option||null;var w="";var j="open";if(p){if(p==="C"){w="cr-standardHtmlDisplay-closed";j="closed";}else{if(p==="O"){w="cr-standardHtmlDisplay-chargedOff";j="chargedOff";}else{if(p==="V"){w="cr-standardHtmlDisplay-voided";j="voided";}else{if(p==="E"){w="cr-standardHtmlDisplay-expired";j="expired";}else{if(p==="F"){w="cr-standardHtmlDisplay-effectiveInFuture";j="effectiveInFuture";}}}}}o=!d.crFilterOptions[j];}var k=true;var x=true;var r=true;if(d.crTableName===i.tableName){k=false;x=false;r=false;o=false;j=null;d.crRowDescription=i.rowDescription;if(d.ownerCt&&d.ownerCt.getXType&&d.ownerCt.getXType()==="crWindow"){d.ownerCt.setTitle(CR.Core.htmlText(i.tableDescription+": "+i.rowDescription));}else{d.setTitle(CR.Core.htmlText(i.tableDescription+": "+i.rowDescription));}}Ext.each(d.crExpandedFieldSets,function(y){if(y.tableName===i.tableName&&y.targetSerial===i.serial){k=false;}});var h=CR.Core.htmlText(i.tableDescription+": "+i.rowDescription);if(q&&q.crTableDescription&&i.tableDescription.indexOf(q.crTableDescription)>-1){h=CR.Core.htmlText(i.tableDescription.replace(q.crTableDescription,"")+": "+i.rowDescription);}var u={};var n=function(y){if(y.tableName===i.tableName){u=CR.JSON.stringify(y);u=CR.JSON.parse(u);}Ext.each(y.child,function(z){n(z);});};n(d.crMetadataTree);var l=CR.FMPanel.CompleteView.createRecHtml({record:m,cols:d.crDefaultCols,recMetaDataTree:u,container:d.crFMPanelContainer});if(i.child&&d.crIncludeSubRecords){l+="<br />";}var t=new Ext.BoxComponent({html:l});var v=CR.FieldSet;if(!d.crUseFieldSet||!d.crIncludeSubRecords){v=CR.Panel;}var s=new v({crTableDescription:i.tableDescription,crViewGroup:h,crRowStatus:j,crRecMetadataTree:u,crRecord:m,crDefaultCols:d.crDefaultCols,crHTMLUpdated:false,cls:w,crTableName:i.tableName,crTargetSerial:i.serial,collapsible:x,collapsed:k,hidden:o,titleCollapse:r,bodyStyle:"padding:5px;",items:[t],crUpdateHtml:function(A){if(!A){A={};}var B=this;var z=A.recordTreeDetail||null;var y="";if(this.crRecord&&!A.isRefresh){y=CR.FMPanel.CompleteView.createRecHtml({record:this.crRecord,cols:B.crDefaultCols,recMetaDataTree:this.crRecMetadataTree,container:d.crFMPanelContainer});if(d.crIncludeSubRecords){y+="<br />";}}else{if(A.recordTreeDetail){Ext.each(z,function(C){if(C.record&&C.record.tableName===B.crTableName){B.crRecord=C.record;y=CR.FMPanel.CompleteView.createRecHtml({record:C.record,cols:B.crDefaultCols,recMetaDataTree:this.crRecMetadataTree,container:d.crFMPanelContainer});if(d.crIncludeSubRecords){y+="<br />";}}});}}CR.Core.defer(function(){t.update(y);});this.crHTMLUpdated=true;},crGetRecordTreeDetail:function(){CR.Core.getRecordTreeDetail({tableName:this.crTableName,targetSerial:this.crTargetSerial,metadataTree:this.crRecMetadataTree,callbackFunction:this.crUpdateHtml,callbackScope:this,callbackArgs:{isRefresh:true}});},listeners:{afterrender:function(){this.addListener("expand",function(){if(!this.crHTMLUpdated){this.crGetRecordTreeDetail();}});if(!this.collapsed&&!this.crHTMLUpdated){this.crGetRecordTreeDetail();}}}});if(!k){}q.add(s);if(d.crIncludeSubRecords){Ext.each(i.child,function(y){g(y,s);});}};g(f,this);this.doLayout();this.cascade(function(h){if(h.getXType()==="crFieldSet"){h.addListener("expand",function(){d.crAddExpandedFieldSets({tableName:h.crTableName,targetSerial:h.crTargetSerial});},d);
h.addListener("collapse",function(){d.crRemoveExpandedFieldSets({tableName:h.crTableName,targetSerial:h.crTargetSerial});},d);}});CR.Core.defer(function(){a.dom.scrollTop=c.top;});},crAddExpandedFieldSets:function(a){this.crExpandedFieldSets.push({tableName:a.tableName,targetSerial:a.targetSerial});},crRemoveExpandedFieldSets:function(b){var d=null;for(var c=0;c<this.crExpandedFieldSets.length;c++){var a=this.crExpandedFieldSets[c];if(a.tableName===b.tableName&&a.targetSerial===b.targetSerial){d=c;}}if(d){this.crExpandedFieldSets.splice(d,1);}},crGetTableName:function(){return this.crTableName;},crGetTargetSerial:function(){return this.crTargetSerial;}});Ext.reg("crCompleteView",CR.FMPanel.CompleteView);CR.FMPanel.CompleteView.onClickUpdateField=function(d,f,c,b){var a;if(b){a=Ext.getCmp(b);}CR.FMPanel.showInsertUpdatePanel({tableName:d,targetSerial:f,columnName:c,container:a});};CR.FMPanel.showInsertUpdatePanel=function(j){var i=j.updateInsert||"update";var n=j.tableName||"";var l=j.targetSerial||null;var f=j.columnName||null;var b=j.defaultValues||null;var m=j.parentSerial||null;var h=j.fmRequest||null;var c=j.container||null;if(!h){h={requestType:i,tableName:n,targetSerial:l};}var p=j.fmPanelConfig||null;if(!p){p={crPanelTitleSuppress:false,crPostingMode:"P",crFocusColumnName:f,crFieldDefaultValues:b,crFieldDefaultValuesCopyHiddenAndDisabledState:true,crParentSerial:m,autoScroll:true};}if(!c){p.crPanelTitleSuppress=true;p.listeners={afterrender:function(){var s=this.crPanelTitle;c.setTitle(CR.Core.htmlText(s));k.hide();var r=this.getBottomToolbar();var q=c.getBottomToolbar();r.cascade(function(t){if(t.getXType){if(t.getXType()==="crToolbarButton"){var u=new CR.ToolbarButton({text:t.getText(),disabled:t.disabled,hidden:t.hidden,handler:function(){t.fireEvent("click");if(t.handler){t.handler.call(t.scope||t,t);}}});t.addListener("disable",function(){u.disable();});t.addListener("enable",function(){u.enable();});t.addListener("show",function(){u.show();});t.addListener("hide",function(){u.hide();});q.add(u);}else{if(t.getXType()==="tbseparator"){q.add("-");}}}});r.hide();c.setSize(c.getSize().width+10,c.getSize().height);}};var g=!!j.callCallbackIfCanceled||false;var k=new CR.ToolbarButton({text:"&nbsp;"});var a=new Ext.Toolbar({forceLayout:true,items:[k]});var o=true;if(j.modal!==null&&j.modal!==undefined){o=j.modal;}c=new CR.Window({title:"Loading...",closable:true,width:500,autoHeight:true,autoScroll:true,resizable:true,modal:o,renderTo:j.renderTo,collapsible:j.titleCollapse||false,titleCollapse:j.titleCollapse||false,pageX:j.x||null,pageY:j.y||null,listeners:{show:function(){this.autoHeight=false;if(this.getHeight()>Ext.getBody().getHeight()){this.setHeight(Ext.getBody().getHeight()-50);}if(!j.x){this.center();}},close:function(){var q=c.findByType(CR.FMPanel).shift();if(g&&q&&!q.crPosted&&q.crCallbackFunction){q.crCallbackFunctionArgs=q.crCallbackFunctionArgs||{};q.crCallbackFunctionArgs["canceled"]=true;q.crCallbackFunction.call(q.crCallbackFunctionScope||q,q.crCallbackFunctionArgs);}}},bbar:a});}var d={container:c,fmRequest:h,fmPanelConfig:p};CR.FMPanel.open(d);return d;};CR.FMPanel.showInsertUpdateWindow=function(a){CR.FMPanel.showInsertUpdatePanel(a);};CR.FMPanel.CompleteView.show=function(h){var c=h.container;var i=Ext.getBody().getWidth()-50;var k=Ext.getBody().getHeight()-50;var j=h.modal||false;var f=false;if(c){i=h.container.getWidth()-50;k=h.container.getHeight()-50;f=true;}else{var b=new CR.ToolbarButton({text:"&nbsp;"});var d=new Ext.Toolbar({forceLayout:true,items:[b]});c=new CR.Window({title:"Loading...",items:[],width:i,height:k,autoScroll:true,bodyStyle:"background-color:white;",modal:j,listeners:{afterrender:function(){this.addListener("resize",function(){a.fireEvent("resize");});}},tbar:d});c.crShow();}var g=CR.FMPanel.findMatch(c,h,"crCompleteView");if(g){if(h.container.setActiveTab){h.container.setActiveTab(g);}else{if(h.container.crShow){h.container.crShow();}}}else{if(h.closable!==undefined){f=h.closable;}if(typeof h.crIncludeSubRecords==="undefined"){h.crIncludeSubRecords=true;}var a=new CR.FMPanel.CompleteView({crTableName:h.tableName,crTargetSerial:h.targetSerial,crContainerWidth:i,closable:f,crRecordTreeCallback:h.recordTreeCallback,crRecordTreeCallbackScope:h.recordTreeCallbackScope,crAdditionalTBarItems:h.additionalTBarItems,crIncludeSubRecords:h.crIncludeSubRecords,crFMPanelContainer:h.crFMPanelContainer});if(!h.container){a.addListener("afterrender",function(){c.setTitle(CR.Core.htmlText(this.crRowDescription));b.hide();var m=this.getTopToolbar();var l=c.getTopToolbar();m.cascade(function(n){if(n.getXType){if(n.getXType()==="crToolbarButton"){var o=new CR.ToolbarButton({text:n.getText(),disabled:n.disabled,menu:n.menu||null,handler:function(){n.fireEvent("click");}});n.addListener("disable",function(){o.disable();});n.addListener("enable",function(){o.enable();});if(o.menu){o.menu.cascade(function(p){if(p.buttons){Ext.each(p.buttons,function(q){if(q.crIsFilterOkButton){q.addListener("click",function(){o.menu.cascade(function(r){if(r.crIsFilterOptions){a.crUpdateFilterOptions.call(a,r,n.menu);}});});}});}});}l.add(o);}else{if(n.getXType()==="tbseparator"){l.add("-");}}}});m.hide();c.setSize(c.getSize().width+10,c.getSize().height);});c.add(a);c.crShow();}else{CR.Core.addToContainerAndShow(h.container,a);}}};CR.Core.getRecordTreeMetaData=function(b){var f=b.callbackArgs||{};var a=new CR.XML();var h=a.addContainer(a.getRootElement(),"sequence");var g=a.addContainer(h,"transaction");var d=a.addContainer(g,"step");var c=a.addContainer(d,"recordTree");a.addText(c,"tableName",b.tableName);CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),success:function(i){var m=CR.JSON.parse(i.responseText);var l=m.query;var k="failed";var j=[];if(m.query){Ext.each(l.sequence,function(n){Ext.each(n.transaction,function(o){k=o.$attr.result;Ext.each(o.step,function(p){if(p.tranResult&&p.tranResult.category&&p.tranResult.category.option==="E"){j.push(p.tranResult.description);}else{if(p.recordTree&&p.recordTree.metadataTree){f.metadataTree=p.recordTree.metadataTree;}}});});});}if(k!=="posted"){CR.Core.displayExceptions({items:j});}else{if(b.callbackFunction){b.callbackFunction.call(b.callbackScope,f);}}}});};CR.Core.getRecordTreeDetail=function(k){var d=k.callbackArgs||{};var l=k.metadataTree;var a=k.includeAllRecordDetail;var g=new CR.XML();var f=g.addContainer(g.getRootElement(),"sequence");var c=g.addContainer(f,"transaction");var b=g.addContainer(c,"step");var j=g.addContainer(b,"recordTree");g.addText(j,"tableName",k.tableName);g.addSerial(j,"targetSerial",k.targetSerial);g.addOption(j,"includeRecordDetail","Y");g.addOption(j,"includeColumnMetadata","Y");g.addOption(j,"includeRowDescriptions","Y");b=g.addContainer(c,"step");var i=g.addContainer(j,"recordDetail");g.addText(i,"tableName",l.tableName);if(a){var h=function(m){i=g.addContainer(j,"recordDetail");g.addText(i,"tableName",m.tableName);Ext.each(m.child,function(n){h(n);});};if(l.child){Ext.each(l.child,function(m){h(m);});}}CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:g.getXMLDocument(),success:function(n){var r=CR.JSON.parse(n.responseText);var q=r.query;var p="failed";var o=[];var m=[];if(r.query){Ext.each(q.sequence,function(s){Ext.each(s.transaction,function(t){p=t.$attr.result;m=t.step;Ext.each(t.step,function(u){if(u.tranResult&&u.tranResult.category&&u.tranResult.category.option==="E"){o.push(u.tranResult.description);}});});});}if(p!=="posted"){if(k.crOwnerCt&&k.crItemForRemoval&&k.crRemoveItemOnError){k.crOwnerCt.remove(k.crItemForRemoval);}else{CR.Core.displayExceptions({items:o});}}else{d.recordTreeDetail=m;if(k.callbackFunction){k.callbackFunction.call(k.callbackScope,d);}}}});};CR.FMPanel.CompleteView.createRecHtml=function(c){var d=c.record||null;var u=c.recMetaDataTree||null;var l=c.columns||2;var m=[];if(d){var g="contentTableEven";var q=JSON.stringify(d.field);q=CR.JSON.parse(q);var r=[];for(var t=0;t<q.length;t++){var a=q[t];if(a.userInterfaceCategory&&a.userInterfaceCategory.option==="S"){r.push(t);}}if(r.length>0){while(r.length>0){q.splice(r.pop(),1);}}Ext.each(d.field,function(w){if(w.columnHide){var v=w.newContents;if(!v&&w.defaultContents){v=w.defaultContents;}var j=[];var i=[];Ext.each(w.columnHide,function(y){Ext.each(y.criteria,function(B){if(B.contents===v){if(y.columnName){j.push(y.columnName);}else{if(y.viewGroup){i.push(y.viewGroup);}}}});var x=[];for(var A=0;A<q.length;A++){var z=q[A];if(z.userInterfaceCategory&&z.userInterfaceCategory.option==="S"){x.push(A);}else{Ext.each(j,function(B){if(B===z.columnName){x.push(A);}});Ext.each(i,function(B){if(B===z.viewGroup){x.push(A);}});}}if(x.length>0){while(x.length>0){q.splice(x.pop(),1);}}});}});var o={};Ext.each(q,function(j){var i=j.viewGroup||"General";if(!o[i]){o[i]=[];}o[i].push(j);});for(var f in o){var p=o[f];var b=o[f].length;var l=c.cols||2;var k=Math.ceil(b/l);m.push('<div class="cr-standardHtmlDisplay">');m.push('<table class="mainViewGroupTable"><tr><td width="150px;" class="sideHeader">');m.push(CR.Core.htmlText(f));if(g==="contentTableEven"){g="contentTableOdd";}else{g="contentTableEven";}m.push('</td><td><table class="'+g+'"><tr>');var n=function(j,i){if(i.referenceTableName==="TRANSACTION"&&i.columnName==="TRANSACTION_SERIAL"){m.push(" onclick=\"CR.HistoryResultPanel.tranSerialClick(null,'"+i.newContents+"')\" ");}else{if(c.container&&c.container.id){m.push(" onclick=\"CR.FMPanel.CompleteView.onClickUpdateField('"+d.tableName+"','"+d.targetSerial+"','"+j+"','"+c.container.id+"')\" ");}else{m.push(" onclick=\"CR.FMPanel.CompleteView.onClickUpdateField('"+d.tableName+"','"+d.targetSerial+"','"+j+"')\" ");}}m.push(' style="cursor:pointer;" ');};var h=100/(l*2);for(var t=0;t<k;t++){if(t!==0){m.push("</tr><tr>");}for(var s=0;s<l;s++){if(p[(s*k)+t]){m.push('<td width="'+h+'%" class="label" ');n(p[(s*k)+t].columnName,p[(s*k)+t]);m.push(">"+CR.Core.htmlText(p[(s*k)+t].columnDescription)+"</td>");m.push('<td width="'+h+'%" class="value"');n(p[(s*k)+t].columnName,p[(s*k)+t]);m.push(">"+CR.Core.convertFieldToHtmlDisplayByType(p[(s*k)+t])+"</td>");}else{m.push('<td width="'+h+'%"></td><td width="'+h+'%"></td>');}}}m.push("</tr></table></td></tr></table>");m.push("</div>");}m.push('<div class="cr-standardHtmlDisplay">');m.push('<table class="finalMainViewGroupTable" width="100%"><tr><td></td></tr></table></div>');}return m.join("");};CR.HistorySearchPanel=Ext.extend(CR.FormPanel,{crTableName:"",crTargetSerial:"",crRowDescription:"",crUserSerial:"",crUserName:"",crTitle:"",crSearchType:"",crDefaultReturnLimit:"20",crResultContainer:null,crFMPanelContainerID:"",crPostingDateStart:"",crPostingDateEnd:"",autoScroll:true,bodyStyle:"padding:5px",autoHeight:true,width:800,constructor:function(aj){var aB=Ext.apply({},aj);aB.title=aB.crTitle;var aF=new CR.ToolbarButton({text:"Search"});var ab=new CR.ToolbarButton({text:"Clear Results"});if(aB.crSearchType==="advanceSearch"){var am=new CR.ToolbarButton({text:"Reset Values"});aB.bbar=[aF,"-",ab,"-",am];}else{aB.bbar=[aF,"-",ab];}var aA=new CR.ToolbarButton({text:"Search by Transaction Serial"});aB.bbar.push("->");aB.bbar.push(aA);CR.HistorySearchPanel.superclass.constructor.call(this,aB);this.crSearchButton=aF;aF.addListener("click",this.crSubmit,this);ab.addListener("click",this.crClearResults,this);aA.addListener("click",this.crTransactionSerialSearch,this);var aL=false;var B=false;var aM=false;var Z=false;if(this.crSearchType==="advanceSearch"){aL=true;am.addListener("click",this.crResetValues,this);}else{if(this.crSearchType==="recordSearch"){B=true;}else{if(this.crSearchType==="balancingSearch"){aM=true;}else{if(this.crSearchType==="monetarySearch"){Z=true;}}}}this.crTableOptions=[];if(!Z&&!B){this.crTableOptions.push([""," "]);}if(Z){this.crTableOptions.push(["ACCOUNT","Account"]);this.crTableOptions.push(["SHARE",CR.Login.shareSavingsText]);this.crTableOptions.push(["LOAN","Loan"]);}else{for(var V=0;V<CR.Core.tableList.length;++V){var af=CR.Core.tableList[V];this.crTableOptions.push([af.tableName,af.tableDescription]);}}if(!this.crIsValidTableName(this.crTableName)){this.crTableName=this.crTableOptions[0][0];this.crTargetSerial="";this.crRowDescription="";}var aN=aL&&this.crTableName==="GL"&&this.crTargetSerial?true:false;if(aL||B||Z){var ax=new CR.OptionField({crColumnDescription:"Table",crColumnName:"tableName",crOptions:this.crTableOptions,crContents:this.crTableName});var Q=new CR.SerialField({crColumnDescription:"Target Record",crColumnName:"targetSerial",crNullAllowed:!Z,crTableName:this.crTableName,crContents:this.crTargetSerial,crRowDescription:this.crRowDescription});var A=this;ax.addListener("select",function(){var i=ax.crGetNewContents();Q.crSetTableName(i);A.ownerCt.crEnableSearchTabs(i);});var h=new CR.DateField({crColumnDescription:"Posting Date Start",crColumnName:"postingDateMinimum",crContents:this.crPostingDateStart});var ay=new CR.DateField({crColumnDescription:"Posting Date End",crColumnName:"postingDateMaximum",crContents:this.crPostingDateEnd});}var y=new CR.OptionField({crColumnDescription:"Order Option",crColumnName:"orderOption",crOptions:[["T","Transaction posting order"],["RT","Reverse transaction posting order"]],crContents:"RT"});if(aL||B){var al=new CR.Checkbox({crColumnDescription:"Include Subrecords",crColumnName:"includeTargetSubrecords",crContents:"Y"});}if(aL||Z){var t=new CR.TextField({crColumnDescription:"Starting "+CR.Login.draftCheckText+" #",crColumnName:"targetDraftNumber",crTextNumericOnly:true,width:100});var aP=new CR.TextField({crColumnDescription:"Ending "+CR.Login.draftCheckText+" #",crColumnName:"targetEndingDraftNumber",crTextNumericOnly:true,width:100,disabled:true});var aw=new CR.Panel({layout:{type:"hbox",pack:"start",align:"top"},defaults:{margins:"0 5 0 0"},items:[new CR.Panel({layout:"form",items:[t]}),new CR.Panel({layout:"form",items:[aP]})]});var K=new CR.OptionField({crColumnDescription:"Monetary Type",crColumnName:"monetaryTypeFilterOption",crOptions:[["-"," "],["D","Deposits"],["DV",CR.Login.dividendInterestText+" deposits"],["W","Withdrawals"],["WA","ATM withdrawals"],["WD",CR.Login.draftCheckingText+" withdrawals"],["WC","Credit or debit card withdrawals"],["WCP","Credit or debit card PIN-based withdrawals"],["WCS","Credit or debit card signature-based withdrawals"]],crContents:"-",style:"margin-bottom: 6px;",disabled:!Z});var ac=new CR.MoneyField({crColumnDescription:"Min Amount",crColumnName:"monetaryAmountMinimum",width:100,disabled:!Z});var S=new CR.MoneyField({crColumnDescription:"Max Amount",crColumnName:"monetaryAmountMaximum",width:100,disabled:!Z});var au=new CR.Panel({layout:{type:"hbox",pack:"start",align:"top"},defaults:{margins:"0 5 0 0"},style:"margin-top:10px;",items:[new CR.Panel({layout:"form",items:[ac]}),new CR.Panel({layout:"form",items:[S]})]});}if(aL){var aI=new CR.SerialField({crColumnDescription:"User",crColumnName:"userSerial",crTableName:"USER",crNullAllowed:true,crContents:this.crUserSerial,crRowDescription:this.crUserName});var O=new CR.SerialField({crColumnDescription:"Batch",crColumnName:"batchSerial",crTableName:"BATCH",crNullAllowed:true});var E=new CR.OptionField({crColumnDescription:"Report Option",crColumnName:"reportOption",crOptions:[["ALL","All Transactions"],["GLR","GL Register"],["GLT","GL Transactions"],["FMT","FM Transactions"],["MNT","Monetary Transactions"],["MFT","Monetary and FM Transactions"],["MST","Monetary Statement"]],crContents:aN?"GLR":"ALL"});var ae=new CR.CountField({crColumnDescription:"Return Limit",crColumnName:"returnLimit",crNegativeAllowed:false,crContents:this.crDefaultReturnLimit});var ak=new Ext.grid.CheckboxSelectionModel({singleSelect:false,sortable:true});ak.on("selectionchange",function(aQ){var aT=[];var aS=aQ.getSelections();for(var aR=0;aR<aS.length;aR++){aT.push(aS[aR].data.option);}A.ownerCt.crDefaultValues.monetaryCategoryList.contents=aT;A.crHandleSelectionLabels("category");});this.monetaryCategorySelectionModel=ak;var k=[["D","Deposit"],["W","Withdrawal"],["P","Payment"],["A","Advance"],["R","Refinance"],["N","New loan"],["C","Comment"]];
var d=new Ext.data.ArrayStore({fields:[{name:"option"},{name:"category"}]});d.loadData(k);var aD=[ak,{dataIndex:"category",header:"Category",menuDisabled:true}];var G=new Ext.grid.ColumnModel(aD);var n=new CR.GridPanel({sm:ak,cm:G,store:d,autoHeight:true,disabled:true});this.monetaryCategoryGridPanel=n;var av=new Ext.grid.CheckboxSelectionModel({singleSelect:false,sortable:true});av.on("selectionchange",function(aQ){var aT=[];var aS=aQ.getSelections();for(var aR=0;aR<aS.length;aR++){aT.push(aS[aR].data.option);}A.ownerCt.crDefaultValues.monetarySourceList.contents=aT;A.crHandleSelectionLabels("source");});this.monetarySourceSelectionModel=av;var a=[["J","Journal voucher"],["S","Cash"],["K","Check"],["k","Cash and check"],["D","Draft"],["C","Credit or debit card"],["P","Payroll"],["B","Bill payment"],["T","Audio"],["H","Online banking"],["M","Mobile banking"],["s","Shared branch"],["A","ATM"],["a","ACH"],["o","ACH origination"],["O","POS"],["I","Insurance"],["F","Fee"],["R","Interest refund"],["V","Dividend"],["W","Federal backup withholding"]];var aa=new Ext.data.ArrayStore({fields:[{name:"option"},{name:"source"}]});aa.loadData(a);var aJ=[av,{dataIndex:"source",header:"Source",menuDisabled:true}];var J=new Ext.grid.ColumnModel(aJ);var F=new CR.GridPanel({sm:av,cm:J,store:aa,autoHeight:true,disabled:true});this.monetarySourceGridPanel=F;var f=new CR.Menu();var g=new CR.ToolbarButton({fieldLabel:"Monetary Category",tooltip:"Monetary Category Options",style:"position: absolute; top: -16px; left:119px;",menu:f,crIsFilterButton:true});var aH=new CR.FormPanel({crIsFilterOptions:true,width:270,height:173,items:[n]});f.addItem(aH);this.monetaryCategoryMenuButton=g;var C=new CR.Menu();var v=new CR.ToolbarButton({fieldLabel:"Monetary Source",tooltip:"Monetary Source Options",style:"position: absolute; top: -16px; left:119px;",menu:C,crIsFilterButton:true});var I=new CR.FormPanel({crIsFilterOptions:true,width:270,height:467,items:[F]});C.addItem(I);this.monetarySourceMenuButton=v;var P=new Ext.form.Label({crSuppressPrompt:true,style:{color:"black",fontSize:"11px"},text:""});this.monetaryCategoryLabel=P;var aC=new Ext.form.Label({crSuppressPrompt:true,style:{color:"black",fontSize:"11px"},text:""});this.monetarySourceLabel=aC;}if(aL||aM){var ah=new CR.TimeField({crColumnDescription:"Posting Time Start",crColumnName:"postingTimeMinimum"});var ad=new CR.TimeField({crColumnDescription:"Posting Time End",crColumnName:"postingTimeMaximum"});}if(aL){var T=new CR.DateField({crColumnDescription:"GL Effective Date Start",crColumnName:"glEffectiveDateMinimum",disabled:!aN});var aE=new CR.DateField({crColumnDescription:"GL Effective Date End",crColumnName:"glEffectiveDateMaximum",disabled:!aN});var c=new CR.OptionField({crColumnDescription:"GL Entry Option",crColumnName:"glOriginalEntryOption",crOptions:[["N","Final entries only"],["Y","Original and final entries"],["O","Original entries only"]],crContents:aN?"N":"Y",disabled:!aN});var aK=new CR.Checkbox({crColumnDescription:"Include Approved",crColumnName:"includeApproved",crContents:"Y"});var Y=new CR.Checkbox({crColumnDescription:"Include Declined",crColumnName:"includeDeclined",crContents:"Y"});var N=new CR.Checkbox({crColumnDescription:"Include Posting Request",crColumnName:"includePostingRequest",crContents:"Y"});var W=new CR.Checkbox({crColumnDescription:"Include Monetary",crColumnName:"includeMonetary",crContents:"Y"});var L=new CR.Checkbox({crColumnDescription:"Include FM",crColumnName:"includeFM",crContents:"Y"});var z=new CR.Checkbox({crColumnDescription:"Include GL",crColumnName:"includeGL",crContents:"Y"});var X=new CR.Checkbox({crColumnDescription:"Include Currency",crColumnName:"includeCurrency",crContents:"Y"});var M=new CR.Checkbox({crColumnDescription:"Include Transaction Result",crColumnName:"includeTranResult",crContents:"Y"});var H=new CR.Checkbox({crColumnDescription:"Ignore Monetary Signs",crColumnName:"monetaryAmountSignIgnore",crContents:"N",disabled:E.crGetNewContents()!=="MST"});var aO=new CR.Checkbox({crColumnDescription:"Include Only Adjustments",crColumnName:"monetaryAdjustmentsOnly",crContents:"N"});}if(aL||aM){var D=new CR.OptionField({crOptions:this.crGlCategoryOptions,crColumnDescription:"GL Category",crColumnName:"glCategory",crContents:"",disabled:aL});var ag=new CR.MoneyField({crColumnDescription:"GL Amount Min",crColumnName:"glAmountMinimum",crContents:"0.00",width:100,disabled:aL});var U=new CR.MoneyField({crColumnDescription:"GL Amount Max",crColumnName:"glAmountMaximum",crContents:"0.00",width:100,disabled:aL});var w=new CR.Panel({layout:{type:"hbox",pack:"start",align:"top"},defaults:{margins:"0 5 0 0"},items:[new CR.Panel({layout:"form",items:[ag]}),new CR.Panel({layout:"form",items:[U]})]});}this.crGLLineItemFormatFld=null;if(aL||aM){this.crGLLineItemFormatFld=new CR.Checkbox({crColumnDescription:"GL Line Item Format",crContents:"N",crClickedChange:true,disabled:aL,crForceChange:function(i){this.crClickedChange=false;this.crSetContents(i);this.crClickedChange=true;},listeners:{check:function(aQ,i){if(this.crClickedChange){CR.Settings.set("history_glLineItemFormat_contents",i?"Y":"N");}}}});}var b=this.crGLLineItemFormatFld;this.crEnableDisableFields=function(){var aW=false;var aS=false;var aU=false;var aX=false;var aY=false;var i=false;var aV=false;var aQ=false;if(aM||(E&&E.crGetNewContents()==="GLT")||(ax&&ax.crGetNewContents()==="GL")){aS=true;}if(aM||(E&&E.crGetNewContents()==="GLT")){if(D&&D.crGetNewContents()){aW=true;}}if(aL&&E&&E.crGetNewContents()==="GLR"&&ax&&Q&&ax.crGetNewContents()==="GL"){aU=true;}if(Z||(E&&E.crGetNewContents()==="MST")){aX=true;}if(E&&E.crGetNewContents()==="MST"){i=true;aY=true;}if(ax&&Q){if(ax.crGetNewContents()==="ACCOUNT"||ax.crGetNewContents()==="SHARE"||ax.crGetNewContents()==="LOAN"){if(Q.crGetNewContents()){aV=true;}}}if(aV&&t&&t.crGetNewContents()){aQ=true;}if(D){if(aS){D.enable();}else{D.crSetContents("");D.disable();}}if(ag){if(aS){ag.enable();}else{ag.crSetContents("0.00");ag.disable();}}if(U){if(aS){U.enable();}else{U.crSetContents("0.00");U.disable();}}if(b){if(aW){var aT=CR.Settings.get("history_glLineItemFormat_contents","N");b.crForceChange(aT);b.enable();}else{b.crForceChange("N");b.disable();}}if(T){if(aU){if(T.disabled){var aR=CR.DateField.convertToJavaScript(CR.Login.postingDate);aR=new Date(aR.getFullYear(),aR.getMonth(),1);aR=CR.DateField.convertFromJavaScript(aR);T.crSetContents(aR);}T.enable();}else{T.crSetContents("");T.disable();}}if(aE){if(aU){aE.enable();}else{aE.crSetContents("");aE.disable();}}if(c){if(aU){if(c.disabled){c.crSetContents("N");}c.enable();}else{c.crSetContents("Y");c.disable();}}if(K){if(aX){K.enable();}else{K.crSetContents("");K.disable();}}if(n){if(i){n.enable();}else{if(A.monetaryCategorySelectionModel&&A.monetaryCategorySelectionModel.getSelections().length>0){A.crResetMonetaryGridPanels("category");}n.disable();}}if(F){if(i){F.enable();}else{if(A.monetarySourceSelectionModel&&A.monetarySourceSelectionModel.getSelections().length>0){A.crResetMonetaryGridPanels("source");}F.disable();}}if(ac){if(aX){ac.enable();}else{ac.crSetContents("0.00");ac.disable();}}if(S){if(aX){S.enable();}else{S.crSetContents("0.00");S.disable();}}if(H){if(aY){H.enable();}else{H.crSetContents("N");H.disable();}}if(t){if(aV){t.enable();}else{t.crSetContents("");t.disable();}}if(aP){if(aQ){aP.enable();}else{aP.crSetContents("");aP.disable();}}};if(ax){ax.addListener("select",this.crEnableDisableFields);}if(Q){Q.addListener("select",this.crEnableDisableFields);}if(E){E.addListener("select",this.crEnableDisableFields);}if(D){D.addListener("select",this.crEnableDisableFields);}if(t){t.addListener("keyup",this.crEnableDisableFields);}if(aL){var q=new CR.Panel({columnWidth:0.2,layout:"form",border:false,items:[ax,Q,aw,aI]});var o=new CR.Panel({columnWidth:0.2,layout:"form",border:false,items:[O,E,y,ae]});var m=new CR.Panel({columnWidth:0.2,layout:"form",border:false,items:[h,ay,ah,ad]});var l=new CR.Panel({columnWidth:0.2,layout:"form",border:false,items:[D,w,K,g,P,v,aC,au]});var j=new CR.Panel({columnWidth:0.2,layout:"form",border:false,items:[T,aE,c]});var az=new CR.Panel({layout:"column",labelAlign:"top",border:false,items:[q,o,m,l,j]});var at=new CR.Panel({columnWidth:0.166,layout:"form",border:false,items:[aK,Y]});var ar=new CR.Panel({columnWidth:0.166,layout:"form",border:false,items:[N,W]});var aq=new CR.Panel({columnWidth:0.166,layout:"form",border:false,items:[L,z]});var ap=new CR.Panel({columnWidth:0.166,layout:"form",border:false,items:[X,M]});var ao=new CR.Panel({columnWidth:0.166,layout:"form",border:false,items:[al,this.crGLLineItemFormatFld]});var an=new CR.Panel({columnWidth:0.166,layout:"form",border:false,items:[H,aO]});var x=new CR.Panel({layout:"column",border:false,labelAlign:"right",labelWidth:175,items:[at,ar,aq,ap,ao,an]});this.add(az);this.add(x);this.crActiveTabListener=this.crAdvanceSearchTagActiveListener;}else{if(aM){var s=new CR.Panel({columnWidth:0.33,layout:"form",border:false,items:[y,D]});var r=new CR.Panel({columnWidth:0.33,layout:"form",border:false,items:[ah,ad]});var p=new CR.Panel({columnWidth:0.33,layout:"form",border:false,items:[w,this.crGLLineItemFormatFld]});az=new CR.Panel({layout:"column",labelAlign:"top",border:false,items:[s,r,p]});this.add(az);this.crActiveTabListener=this.crBalancingSearchTagActiveListener;}else{if(Z){var u=new CR.Panel({columnWidth:0.25,layout:"form",border:false,items:[ax,Q]});var aG=new CR.Panel({columnWidth:0.25,layout:"form",border:false,items:[h,ay]});var R=new CR.Panel({columnWidth:0.25,layout:"form",border:false,items:[y,aw]});var ai=new CR.Panel({columnWidth:0.25,layout:"form",border:false,items:[K,au]});az=new CR.Panel({layout:"column",labelAlign:"top",border:false,items:[u,aG,R,ai]});this.add(az);this.crActiveTabListener=this.crMonetarySearchTagActiveListener;}else{u=new CR.Panel({columnWidth:0.4,layout:"form",border:false,items:[ax,Q]});aG=new CR.Panel({columnWidth:0.2,layout:"form",border:false,items:[h,ay]});R=new CR.Panel({columnWidth:0.4,layout:"form",border:false,items:[y,al]});az=new CR.Panel({layout:"column",labelAlign:"top",border:false,items:[u,aG,R]});this.add(az);this.crActiveTabListener=this.crRecordSearchTagActiveListener;}}}this.addListener("deactivate",this.crDeactivateListener,this);},crSubmit:function(){this.crDeactivateListener();this.crSearchButton.disable();var j=this.ownerCt.crDefaultValues;if(this.ownerCt.crIncludeGL){j.includeGL.contents="Y";}var d=false;var n=null;var p=null;var k=j.returnLimit.contents;if(j.reportOption.contents==="MST"){d=true;}else{if(j.reportOption.contents==="GLT"&&j.glCategory.contents&&this.crGLLineItemFormatFld&&this.crGLLineItemFormatFld.crGetNewContents()==="Y"){n=j.glCategory.contents;p=j.glCategory.description;j.returnLimit.contents="1000";j.includePostingRequest.contents="N";j.includeMonetary.contents="N";j.includeFM.contents="N";j.includeGL.contents="Y";j.includeCurrency.contents="N";j.includeTranResult.contents="N";}}var m=new CR.XML();var h=m.addContainer(m.getRootElement(),"sequence");var g=m.addContainer(h,"transaction");var f=m.addContainer(g,"step");var o=m.addContainer(f,"tranHistory");for(var b in j){if(j[b].contents){var a=o;if(b==="monetaryCategoryList"||b==="monetarySourceList"){var c=(b==="monetaryCategoryList")?"category":"source";for(var l=0;l<j[b].contents.length;l++){a=m.addContainer(o,b);m.addData(a,c,j[b].dataType,j[b].contents[l]);}}else{if(b==="userSerial"){a=m.addContainer(o,"userList");}else{if(b==="batchSerial"){a=m.addContainer(o,"batchList");}}m.addData(a,b,j[b].dataType,j[b].contents);}}}if(j.glCategory.contents){m.addOption(o,"glCategoryFilterOption","Y");}if(j.glAmountMinimum.contents!=="0.00"||j.glAmountMaximum.contents!=="0.00"){m.addOption(o,"glAmountFilterOption","Y");}if(j.monetaryAmountMinimum.contents!=="0.00"||j.monetaryAmountMaximum.contents!=="0.00"){m.addOption(o,"monetaryAmountFilterOption","Y");}j.returnLimit.contents=k;if(!this.crResultContainer){this.crResultContainer=this.ownerCt.crResultPanel;}CR.Core.ajaxRequest({url:"TranHistoryHTML",xmlData:m.getXMLDocument(),scope:this,params:CR.CheckView.addInterfaceParameters({fmPanelContainerID:this.crResultContainer.getId(),voidContainerID:this.crResultContainer.getId(),isHistory:true,isMonetary:d,glCategoryListValue:n,glCategoryListDescription:p}),crMask:{container:this.crResultContainer},success:function(i){var r=false;if(this.crSearchType==="balancingSearch"){r=true;}var q=i.responseText;CR.HistorySearchPanel.displayHistory({expandResults:r,container:this.crResultContainer,fmPanelContainerID:this.crResultContainer.getId(),xmlDocument:m.getXMLDocument(),glCategoryListValue:n,glCategoryListDescription:p,historyHTML:q});this.crSearchButton.enable();},failure:function(q){var i=q.crExceptionItems;if(!i){var r="";if(q.status!==0){r="Error "+q.status+" - ";}r+=q.statusText||"Unknown error";i=[r];}if(i.length>0){CR.Core.displayExceptions({items:i});}this.crSearchButton.enable();}});},crClearResults:function(){var a=this.ownerCt.crResultPanel;while(a.getComponent(1)){a.remove(a.getComponent(1));}},crResetValues:function(){var a=this.ownerCt.crDefaultValues;a.tableName.contents="";a.targetSerial.contents="";a.targetSerial.rowDescription="";a.orderOption.contents="RT";a.postingDateMinimum.contents="";a.postingDateMaximum.contents="";a.includeTargetSubrecords.contents="Y";a.targetDraftNumber.contents="";a.targetEndingDraftNumber.contents="";a.userSerial.contents="";a.userSerial.rowDescription="";a.batchSerial.contents="";a.batchSerial.rowDescription="";a.reportOption.contents="ALL";a.returnLimit.contents=this.crDefaultReturnLimit;a.postingTimeMinimum.contents="";a.postingTimeMaximum.contents="";a.includeApproved.contents="Y";a.includeDeclined.contents="Y";a.includePostingRequest.contents="Y";a.includeMonetary.contents="Y";a.includeFM.contents="Y";a.includeGL.contents="Y";a.includeCurrency.contents="Y";a.includeTranResult.contents="Y";a.glCategory.contents="";a.glCategory.description="";a.glAmountMinimum.contents="0.00";a.glAmountMaximum.contents="0.00";a.glEffectiveDateMinimum.contents="";a.glEffectiveDateMaximum.contents="";a.glOriginalEntryOption.contents="Y";a.monetaryTypeFilterOption.contents="-";a.monetaryAmountMinimum.contents="0.00";a.monetaryAmountMaximum.contents="0.00";a.monetaryAmountSignIgnore.contents="N";a.monetaryAdjustmentsOnly.contents="N";if(a.monetaryCategoryList.contents.length>0){this.crResetMonetaryGridPanels("category");a.monetaryCategoryList.contents=[];}if(a.monetarySourceList.contents.length>0){this.crResetMonetaryGridPanels("source");a.monetarySourceList.contents=[];}this.crActiveTabListener();},crDeactivateListener:function(){var a=this.ownerCt.crDefaultValues;this.cascade(function(b){if(b.crColumnName){if(b.crSetSerial){a[b.crColumnName].contents="";a[b.crColumnName].rowDescription="";if(b.crGetNewContents()){a[b.crColumnName].contents=b.crGetNewContents();a[b.crColumnName].rowDescription=b.crGetNewRowDescription();}}else{a[b.crColumnName].contents=b.crGetNewContents();if(b.crColumnName==="glCategory"){a[b.crColumnName].description=b.crGetNewDisplayContents();}}}});},crAdvanceSearchTagActiveListener:function(){this.crSetFieldsFromDefaults();},crBalancingSearchTagActiveListener:function(){var a=this.ownerCt.crDefaultValues;if(this.crTableName==="GL"){a.tableName.contents=this.crTableName;a.targetSerial.contents=this.crTargetSerial;a.targetSerial.rowDescription=this.crRowDescription;}else{a.tableName.contents="";a.targetSerial.contents="";a.targetSerial.rowDescription="";}this.ownerCt.crEnableSearchTabs(a.tableName.contents);a.postingDateMinimum.contents=this.ownerCt.crPostingDateStart;a.postingDateMaximum.contents=this.ownerCt.crPostingDateEnd;a.includeTargetSubrecords.contents="Y";a.targetDraftNumber.contents="";a.targetEndingDraftNumber.contents="";a.userSerial.contents=this.ownerCt.crUserSerial;a.userSerial.rowDescription=this.ownerCt.crUserName;a.batchSerial.contents="";a.batchSerial.rowDescription="";a.reportOption.contents="GLT";a.includeApproved.contents="Y";
a.includeDeclined.contents="Y";a.includePostingRequest.contents="N";a.includeMonetary.contents="N";a.includeFM.contents="N";a.includeGL.contents="Y";a.includeCurrency.contents="N";a.includeTranResult.contents="N";a.glEffectiveDateMinimum.contents="";a.glEffectiveDateMaximum.contents="";a.glOriginalEntryOption.contents="Y";a.monetaryAdjustmentsOnly.contents="N";a.monetaryAmountSignIgnore.contents="N";this.crSetFieldsFromDefaults();},crMonetarySearchTagActiveListener:function(){var a=this.ownerCt.crDefaultValues;a.includeTargetSubrecords.contents="Y";a.userSerial.contents="";a.userSerial.rowDescription="";a.batchSerial.contents="";a.batchSerial.rowDescription="";a.reportOption.contents="MST";a.postingTimeMinimum.contents="";a.postingTimeMaximum.contents="";a.includeApproved.contents="Y";a.includeDeclined.contents="Y";a.includePostingRequest.contents="N";a.includeMonetary.contents="Y";a.includeFM.contents="N";a.includeGL.contents="N";a.includeCurrency.contents="N";a.includeTranResult.contents="N";a.glCategory.contents="";a.glCategory.description="";a.glAmountMinimum.contents="0.00";a.glAmountMaximum.contents="0.00";a.glEffectiveDateMinimum.contents="";a.glEffectiveDateMaximum.contents="";a.glOriginalEntryOption.contents="Y";a.monetaryAdjustmentsOnly.contents="N";a.monetaryAmountSignIgnore.contents="N";this.crSetFieldsFromDefaults();},crRecordSearchTagActiveListener:function(){var a=this.ownerCt.crDefaultValues;a.targetDraftNumber.contents="";a.targetEndingDraftNumber.contents="";a.userSerial.contents="";a.userSerial.rowDescription="";a.batchSerial.contents="";a.batchSerial.rowDescription="";a.reportOption.contents="ALL";a.postingTimeMinimum.contents="";a.postingTimeMaximum.contents="";a.includeApproved.contents="Y";a.includeDeclined.contents="Y";a.includePostingRequest.contents="Y";a.includeMonetary.contents="Y";a.includeFM.contents="Y";a.includeGL.contents="Y";a.includeCurrency.contents="Y";a.includeTranResult.contents="Y";a.glCategory.contents="";a.glCategory.description="";a.glAmountMinimum.contents="0.00";a.glAmountMaximum.contents="0.00";a.glEffectiveDateMinimum.contents="";a.glEffectiveDateMaximum.contents="";a.glOriginalEntryOption.contents="Y";a.monetaryTypeFilterOption.contents="-";a.monetaryAmountMinimum.contents="0.00";a.monetaryAmountMaximum.contents="0.00";a.monetaryAdjustmentsOnly.contents="N";a.monetaryAmountSignIgnore.contents="N";this.crSetFieldsFromDefaults();},crSetFieldsFromDefaults:function(){var c=this.ownerCt.crDefaultValues;if(!this.crIsValidTableName(c.tableName.contents)){c.tableName.contents=this.crTableOptions[0][0];c.targetSerial.contents="";c.targetSerial.rowDescription="";}var a=null;for(var d in c){var b=this.find("crColumnName",d);if(b.length>=1){b=b[0];if(d==="targetSerial"){a=b;}else{if(b.crSetSerial){b.crSetSerial(c[d].contents,c[d].rowDescription);}else{b.crSetContents(c[d].contents);}}}}if(a){a.crSetTableName(c.tableName.contents);a.crSetSerial(c.targetSerial.contents,c.targetSerial.rowDescription);}this.crEnableDisableFields();},crIsValidTableName:function(a){var c=false;for(var b=0;!c&&b<this.crTableOptions.length;++b){if(this.crTableOptions[b][0]===a){c=true;}}return c;},crTransactionSerialSearch:function(){var b=new CR.Window({title:"History Search by Transaction Serial",layout:"fit",width:350,height:120,autoDestroy:true,closable:true,resizable:false,modal:false});var c=new CR.TextField({crColumnDescription:"Transaction Serial",width:200,regex:/\d+/,maskRe:/\d+/,regexText:"Invalid Serial",stripCharsRe:/[^\d]/g,crEnterKeyHandler:function(){var d=c.crGetNewContents();if(/^\d+$/.test(d)){CR.HistoryResultPanel.tranSerialClick(null,d);}else{CR.Core.displayExceptions({items:["Serial has to be Numbers only"]});}b.crClose();}});var a=new CR.FormPanel({frame:true,items:[c],buttons:[{text:"Search",handler:function(){var d=c.crGetNewContents();if(/^\d+$/.test(d)){CR.HistoryResultPanel.tranSerialClick(null,d);}else{CR.Core.displayExceptions({items:["Serial has to be Numbers only"]});}b.crClose();}},{text:"Cancel",handler:function(){b.crClose();}}]});b.add(a);b.crShow(undefined,function(){CR.Core.defer(function(){b.center();c.focus(false);},b,null,400);});},crResetMonetaryGridPanels:function(d){var a;var c;if(d==="category"){a=this.monetaryCategorySelectionModel;c=this.monetaryCategoryGridPanel;}else{if(d==="source"){a=this.monetarySourceSelectionModel;c=this.monetarySourceGridPanel;}}if(a.getSelections().length>0){a.clearSelections();}var f=c.getView().getHeaderCell(0);var b=f.getElementsByClassName("x-grid3-hd-checker-on")[0];if(b){b.classList.remove("x-grid3-hd-checker-on");}},crHandleSelectionLabels:function(g){var j;var c;var k;var n=3;var a=5;if(g==="category"){j=this.monetaryCategoryLabel;c=this.monetaryCategorySelectionModel;k=this.monetaryCategoryMenuButton;}else{if(g==="source"){j=this.monetarySourceLabel;c=this.monetarySourceSelectionModel;k=this.monetarySourceMenuButton;}}var d="";var b=c.getSelections();for(var f=0;f<b.length;f++){d+=b[f].data[g];if(f!==b.length-1){d+=", ";}var p=b.length-1-f;if(f===1&&p>0){d+="... + "+p.toString()+" more";break;}}j.setText(d);var h=k.getResizeEl();var o=h.dom.offsetParent.offsetParent.childNodes;var m=o[n];var l=o[a];if(b.length>0){if(g==="category"){m.style.marginBottom="0px";l.style.marginTop="10px";}else{if(g==="source"){l.style.marginBottom="0px";}}}else{if(g==="category"){m.style.marginBottom="4px";l.style.marginTop="0px";}else{if(g==="source"){l.style.marginBottom="4px";}}}}});CR.HistorySearchPanel.showHistory=function(b){var a=function(f){var d=new CR.XML();var j=d.addContainer(d.getRootElement(),"sequence");var i=d.addContainer(j,"transaction");var g=d.addContainer(i,"step");var c=d.addContainer(g,"record");d.addOption(c,"operation","V");d.addText(c,"tableName","GL_DETAIL");d.addOption(c,"includeColumnMetadata","Y");var h=d.addContainer(c,"field");d.addText(h,"columnName","CATEGORY");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:d.getXMLDocument(),crOverride:{},crMask:{container:f.searchContainer},success:function(s){var n=CR.JSON.parse(s.responseText);var w=n.query;var r="failed";var o=[];o.push([""," "]);var x=[];if(n.query){var q=w.sequence;if(q){for(var u=0;u<q.length;u++){var m=q[u].transaction;if(m){for(var t=0;t<m.length;t++){f.postingDate=m[t].postingDate;r=m[t].$attr.result;var l=m[t].step;for(var p=0;p<l.length;p++){if(l[p].tranResult&&l[p].tranResult.category&&l[p].tranResult.category.option&&l[p].tranResult.category.option==="E"){x.push(l[p].tranResult.description);}else{if(l[p].record){var v=l[p].record;}}}}}}}}if(r!=="posted"){CR.Core.displayExceptions({items:x});}else{if(v&&v.field&&v.field[0].options){var y=v.field[0].options;for(u=0;u<y.length;u++){o.push([y[u].value.option,y[u].value.text]);}}f.glCategoryOptions=o;CR.HistorySearchPanel.showHistory2(f);}}});};CR.Interface.checkAll({functions:[CR.PSCUService.checkForInterface,CR.FICSService.checkForInterface,CR.MViServices.checkForInterfaces,CR.HylandServices.checkForInterface,CR.Alloya.checkForInterface,CR.PaylogicCheckImage.checkForInterface,CR.HeartlandLeagueCheckImage.checkForInterface,CR.BluepointImagePoint.checkForInterface,CR.VSoftCheckImaging.checkForInterface,CR.Vertifi.checkForInterface,CR.SynergyService.checkForInterface,CR.NorthwestBankCheckImage.checkForInterface],callbackFunction:a,callbackArgs:b});};CR.HistorySearchPanel.showHistory2=function(c){var l=null;var r="";if(!c.suppressTitle){r="History Search Options";}var p=c.searchContainer;var i=c.resultContainer;if(!p||p.crIsDestroyed()){l=new CR.Window({title:r,autoHeight:true,width:812});r="";p=l;}var a=new CR.HistorySearchPanel({crTableName:c.tableName,crTargetSerial:c.targetSerial,crRowDescription:c.rowDescription,crGlCategoryOptions:c.glCategoryOptions,crUserSerial:c.userSerial,crUserName:c.userName,crPostingDateStart:c.postingDateStart,crPostingDateEnd:c.postingDateEnd,crResultContainer:i,crTitle:"Advanced Search",crSearchType:"advanceSearch"});var k=new CR.HistorySearchPanel({crTableName:c.tableName,crTargetSerial:c.targetSerial,crRowDescription:c.rowDescription,crUserSerial:c.userSerial,crUserName:c.userName,crGlCategoryOptions:c.glCategoryOptions,crPostingDateStart:c.postingDateStart,crPostingDateEnd:c.postingDateEnd,crResultContainer:i,crTitle:"Record Search",crSearchType:"recordSearch"});if(c.includeBalancingSearch){var o=new CR.HistorySearchPanel({crTableName:c.tableName,crTargetSerial:c.targetSerial,crRowDescription:c.rowDescription,crUserSerial:c.userSerial,crUserName:c.userName,crGlCategoryOptions:c.glCategoryOptions,crPostingDateStart:c.postingDateStart,crPostingDateEnd:c.postingDateEnd,crResultContainer:i,crTitle:"Balancing Search",crSearchType:"balancingSearch"});}var n=new CR.HistorySearchPanel({crTableName:c.tableName,crTargetSerial:c.targetSerial,crRowDescription:c.rowDescription,crUserSerial:c.userSerial,crUserName:c.userName,crGlCategoryOptions:c.glCategoryOptions,crPostingDateStart:c.postingDateStart,crPostingDateEnd:c.postingDateEnd,crResultContainer:i,crTitle:"Monetary Search",crSearchType:"monetarySearch"});if(c.tableName==="LOAN"&&c.isPSCULoan){c.includePSCUSearch=true;c.defaultSearch="pscu";}if(c.tableName==="LOAN"&&c.isFICSLoan){c.includeFICSSearch=true;c.defaultSearch="fics";}if(c.includePSCUSearch){var m=new CR.PSCUSearchPanel({crTableName:c.tableName,crTargetSerial:c.targetSerial,crRowDescription:c.rowDescription,crPostingDateStart:c.postingDateStart,crPostingDateEnd:c.postingDateEnd,crResultContainer:i,crTitle:"PSCU Statement",crSearchType:"statementSearch"});}if(c.includeFICSSearch){var b=new CR.FICSSearchPanel({crTableName:c.tableName,crTargetSerial:c.targetSerial,crRowDescription:c.rowDescription,crPostingDateStart:c.postingDateStart,crPostingDateEnd:c.postingDateEnd,crResultContainer:i,crTitle:"FICS History",crSearchType:"ficsSearch"});}var h=new CR.TabPanel({border:false,title:r,autoHeight:true,collapsible:true,crDefaultValues:{},crPostingDate:c.postingDate,crPostingDateStart:c.postingDateStart||"",crPostingDateEnd:c.postingDateEnd||"",crTableName:c.tableName||"",crTargetSerial:c.targetSerial||"",crRowDescription:c.rowDescription||"",crUserSerial:c.userSerial||"",crUserName:c.userName||"",crGlCategoryOptions:c.glCategoryOptions,crIncludeGL:c.includeGL||false,crEnableSearchTabs:function(u){for(var v=0;v<this.items.getCount();++v){var t=this.items.itemAt(v);if(!t.crIsDestroyed()){if(!t.crIsValidTableName(u)){t.disable();}else{t.enable();}}}}});if(!h.crTableName||!h.crTargetSerial||!h.crRowDescription){h.crTargetSerial="";h.crRowDescription="";}if(!h.crUserName){h.crUserSerial="";}var d=(c.defaultSearch==="advanced"&&h.crTableName==="GL"&&h.crTargetSerial?true:false);var f="";if(d){f=CR.DateField.convertToJavaScript(CR.Login.postingDate);f=new Date(f.getFullYear(),f.getMonth(),1);f=CR.DateField.convertFromJavaScript(f);}h.crDefaultValues={tableName:{contents:h.crTableName,dataType:"S"},targetSerial:{contents:h.crTargetSerial,rowDescription:h.crRowDescription,dataType:"E"},glOriginalEntryOption:{contents:d?"N":"Y",dataType:"O"},orderOption:{contents:"RT",dataType:"O"},postingDateMinimum:{contents:h.crPostingDateStart,dataType:"D"},postingDateMaximum:{contents:h.crPostingDateEnd,dataType:"D"},includeTargetSubrecords:{contents:"Y",dataType:"O"},targetDraftNumber:{contents:"",dataType:"S"},targetEndingDraftNumber:{contents:"",dataType:"S"},userSerial:{contents:h.crUserSerial,rowDescription:h.crUserName,dataType:"E"},batchSerial:{contents:"",rowDescription:"",dataType:"E"},reportOption:{contents:d?"GLR":"ALL",dataType:"O"},returnLimit:{contents:"20",dataType:"C"},postingTimeMinimum:{contents:"",dataType:"T"},postingTimeMaximum:{contents:"",dataType:"T"},includeApproved:{contents:"Y",dataType:"O"},includeDeclined:{contents:"Y",dataType:"O"},includePostingRequest:{contents:"Y",dataType:"O"},includeMonetary:{contents:"Y",dataType:"O"},includeFM:{contents:"Y",dataType:"O"},includeGL:{contents:"Y",dataType:"O"},includeCurrency:{contents:"Y",dataType:"O"},includeTranResult:{contents:"Y",dataType:"O"},glCategory:{contents:"",description:"",dataType:"O"},glAmountMinimum:{contents:"0.00",dataType:"M"},glAmountMaximum:{contents:"0.00",dataType:"M"},glEffectiveDateMinimum:{contents:f,dataType:"D"},glEffectiveDateMaximum:{contents:"",dataType:"D"},monetaryTypeFilterOption:{contents:"-",dataType:"O"},monetarySourceList:{contents:[],dataType:"O"},monetaryCategoryList:{contents:[],dataType:"O"},monetaryAmountMinimum:{contents:"0.00",dataType:"M"},monetaryAmountMaximum:{contents:"0.00",dataType:"M"},monetaryAmountSignIgnore:{contents:"N",dataType:"O"},monetaryAdjustmentsOnly:{contents:"N",dataType:"O"}};var s=new CR.Panel({title:"Information",html:CR.initialTabHtml});var q=new CR.TabPanel({enableTabScroll:true,border:false,autoWidth:true,items:[s]});q.setActiveTab(s);h.crResultPanel=q;q.crParamPanel=h;var g=new CR.Panel({border:false,title:r,closable:true,items:[h,q],crSizeOffset:0,crParentingPanel:c.crParentingPanel,crPanelReSize:function(){g.crSizeOffset=0;},crPanelSizing:function(){var u=g.getInnerHeight();var t=h.getSize().height;q.setHeight(u-t-g.crSizeOffset);}});g.addListener("resize",g.crPanelReSize,g);g.addListener("activate",g.crPanelSizing,g);g.addListener("afterlayout",g.crPanelSizing,g);k.addListener("afterlayout",g.crPanelSizing,g);if(c.includeBalancingSearch){o.addListener("afterlayout",g.crPanelSizing,g);}a.addListener("afterlayout",g.crPanelSizing,g);n.addListener("afterlayout",g.crPanelSizing,g);if(c.includePSCUSearch){m.addListener("afterlayout",g.crPanelSizing,g);}if(c.includeFICSSearch){b.addListener("afterlayout",g.crPanelSizing,g);}h.addListener("collapse",g.crPanelSizing,g);h.addListener("expand",g.crPanelSizing,g);if(c.includeBalancingSearch){h.add(o);}h.add(k);h.add(n);h.add(a);if(c.includePSCUSearch){h.add(m);}if(c.includeFICSSearch){h.add(b);}h.crEnableSearchTabs(h.crTableName);var j=null;if(c.defaultSearch==="balancing"&&!o.disabled&&c.includeBalancingSearch){j=o;}else{if(c.defaultSearch==="monetary"&&!n.disabled){j=n;}else{if(c.defaultSearch==="record"&&!k.disabled){j=k;}else{if(c.defaultSearch==="advanced"&&!a.disabled){j=a;}else{if(c.defaultSearch==="pscu"&&!m.disabled){j=m;}else{if(c.defaultSearch==="fics"&&!b.disabled){j=b;}else{if(!k.disabled){j=k;}else{j=a;}}}}}}}h.setActiveTab(j);h.addListener("tabchange",function(t,u){u.crActiveTabListener();if(h.expand){h.expand();}u.doLayout();if(l){l.crHide();l.crShow();}});if(l){h.addButton({text:"Cancel",minWidth:100,handler:function(){l.crClose();}});}if(c.onlyAddDoNotActivate){p.add(g);}else{CR.Core.addToContainerAndShow(p,g);}if(c.submitDefaultSearch){j.crSubmit();}};CR.HistorySearchPanel.displayHistory=function(a){if(a.container&&!a.container.crIsDestroyed()){var c=false;if(a.container.setActiveTab){c=true;}var b=new CR.HistoryResultPanel({closable:c,crRequestXMLDocument:a.xmlDocument,crFMPanelContainerID:a.fmPanelContainerID,crGLCategoryListValue:a.glCategoryListValue,crGLCategoryListDescription:a.glCategoryListDescription,html:a.historyHTML});CR.Core.addToContainerAndShow(a.container,b);if(a.container.setActiveTab){a.container.setActiveTab(b);}if(a.expandResults){b.crExpandItems({expandSteps:true});}b.crSetBookmarkValue();}};CR.HistoryResultPanel=Ext.extend(CR.Panel,{border:false,title:"History Search Results",iconCls:"history-row-icon",autoScroll:true,autoWidth:true,constructor:function(b){var g=Ext.apply({},b);var c=new CR.ToolbarButton({text:"Collapse Transactions"});var j=new CR.ToolbarButton({text:"Collapse Steps"});var d=new CR.ToolbarButton({text:"Expand Transactions"});var a=new CR.ToolbarButton({text:"Expand Steps"});var i=new CR.ToolbarButton({text:"Print"});var h=new CR.ToolbarButton({cls:"",iconCls:"x-tbar-page-prev",disabled:true});var f=new CR.ToolbarButton({cls:"",iconCls:"x-tbar-page-next"});g.tbar=[h,f,"-",c,"-",j,"-",d,"-",a,"-",i,"-"];CR.HistoryResultPanel.superclass.constructor.call(this,g);var k=this;this.crPreviousPageButton=h;this.crNextPageButton=f;c.addListener("click",function(){k.crCollapseItems({collapseTrans:true});});j.addListener("click",function(){k.crCollapseItems({collapseSteps:true});
});d.addListener("click",function(){k.crExpandItems({expandTrans:true});});a.addListener("click",function(){k.crExpandItems({expandSteps:true});});i.addListener("click",k.crPrintRequest,k);h.addListener("click",function(){k.crResumeBookmarkArray.pop();if(!k.crNextPageButton.disabled){k.crResumeBookmarkArray.pop();}k.crRequestMore();if(k.crResumeBookmarkArray.length===0){k.crPreviousPageButton.disable();}});f.addListener("click",function(){k.crRequestMore();k.crPreviousPageButton.enable();});this.crResumeBookmarkNext=null;this.crResumeBookmarkArray=[];},crCollapseItems:function(f){var c=false;if(f.collapseTrans){c=true;}var a=false;if(f.collapseSteps){a=true;}var h=this.body.dom;var g=h.getElementsByTagName("div");if(a){for(var d=0;d<g.length;d++){var b=g[d];if(b.className.indexOf("expanded")!==-1){b.className=b.className.replace(/expanded/,"collapsed");}}var k=h.getElementsByTagName("td");for(d=0;d<k.length;d++){var j=k[d];if(j.className.indexOf("expandedIcon")!==-1){j.className=j.className.replace(/expandedIcon/,"collapsedIcon");}}}if(c){for(d=0;d<g.length;d++){b=g[d];if(b.className.indexOf("stepsExpanded")!==-1){b.className=b.className.replace(/stepsExpanded/,"stepsCollapsed");}}k=h.getElementsByTagName("td");for(d=0;d<k.length;d++){j=k[d];if(j.className.indexOf("stepsExpandedIcon")!==-1){j.className=j.className.replace(/stepsExpandedIcon/,"stepsCollapsedIcon");}}}},crExpandItems:function(c){var j=false;if(c.expandTrans){j=true;}var f=false;if(c.expandSteps){f=true;}var g=this.body.dom;var d=g.getElementsByTagName("div");if(f){for(var b=0;b<d.length;b++){var a=d[b];if(a.className.indexOf("collapsed")!==-1){a.className=a.className.replace(/collapsed/,"expanded");}}var k=g.getElementsByTagName("td");for(b=0;b<k.length;b++){var h=k[b];if(h.className.indexOf("collapsedIcon")!==-1){h.className=h.className.replace(/collapsedIcon/,"expandedIcon");}}}if(j||f){for(b=0;b<d.length;b++){a=d[b];if(a.className.indexOf("stepsCollapsed")!==-1){a.className=a.className.replace(/stepsCollapsed/,"stepsExpanded");}}k=g.getElementsByTagName("td");for(b=0;b<k.length;b++){h=k[b];if(h.className.indexOf("stepsCollapsedIcon")!==-1){h.className=h.className.replace(/stepsCollapsedIcon/,"stepsExpandedIcon");}}}},crRequestMore:function(){if(!this.crIsDestroyed()){if(this.crRequestXMLDocument){var c=new CR.XML({xmlDocument:this.crRequestXMLDocument});var b=null;var h=null;var d;var i=null;var g=false;c.beginElement(c.getRootElement());while(!!(d=c.nextSubElement())){if(c.nameEquals(d,"sequence")){c.beginElement(d);while(!!(d=c.nextSubElement())){if(c.nameEquals(d,"transaction")){c.beginElement(d);while(!!(d=c.nextSubElement())){if(c.nameEquals(d,"step")){c.beginElement(d);while(!!(d=c.nextSubElement())){if(c.nameEquals(d,"tranHistory")){b=d;c.beginElement(d);while(!!(d=c.nextSubElement())){if(c.nameEquals(d,"resumeBookmark")){h=d;}if(c.nameEquals(d,"reportOption")){i=d;}}}}}}}}}}if(h){c.removeElement(h);}var f=this.crResumeBookmarkArray[this.crResumeBookmarkArray.length-1]||{};if(f.resumeBookmark){c.addText(b,"resumeBookmark",f.resumeBookmark);}if(i&&i.getAttribute("option")==="MST"){g=true;}var a=this.crFMPanelContainerID;CR.Core.ajaxRequest({url:"TranHistoryHTML",xmlData:c.getXMLDocument(),params:CR.CheckView.addInterfaceParameters({fmPanelContainerID:a,voidContainerID:a,glCategoryListValue:this.crGLCategoryListValue,glCategoryListDescription:this.crGLCategoryListDescription,isHistory:true,isMonetary:g,glBalanceOption:f.glBalanceOption||"",glBalance:f.glBalance||""}),scope:this,crMask:{container:this},success:function(j){if(!this.crIsDestroyed()){this.body.dom.innerHTML=j.responseText;this.body.scrollTo("top");this.crSetBookmarkValue();}}});}}},crSetBookmarkValue:function(){var g="";var f="";var d="";var a=this.body.dom.getElementsByTagName("input");var h=a.length;for(var c=0;c<h;++c){var b=a[c];if(b.className==="resumeBookmarkNext"){g=b.defaultValue;}else{if(b.className==="glBalanceOption"){f=b.defaultValue;}else{if(b.className==="glBalance"){d=b.defaultValue;}}}}if(g){this.crResumeBookmarkArray.push({resumeBookmark:g,glBalanceOption:f,glBalance:d});this.crNextPageButton.enable();}else{this.crNextPageButton.disable();}},crPrintRequest:function(){CR.Panel.printInnerHTML('<div class="cr-historyPrint">'+this.body.dom.innerHTML+"</div>");}});CR.HistoryResultPanel.showPersonProfile=function(c,b,a){if(CR.Script){CR.Script.showWorkArea({workArea:"transaction",parameters:{personSerial:b}});}else{CR.TransactionPanel.showPersonProfile({containerId:c,targetSerial:b,newTab:true});}};CR.HistoryResultPanel.serialInquiry=function(d,b,c){var a=null;if(d){a=Ext.getCmp(d);}else{a=CR.FMPanel.getDefaultContainer();}if(a){CR.FMPanel.open({container:a,fmRequest:{requestType:"update",tableName:b,targetSerial:c}});}};CR.HistoryResultPanel.tranSerialClick=function(h,i,k){var a=Ext.getCmp(h);var g=new CR.XML();var d=g.addContainer(g.getRootElement(),"sequence");var c=g.addContainer(d,"transaction");var b=g.addContainer(c,"step");var f=g.addContainer(b,"record");g.addText(f,"tableName","TRANSACTION");g.addText(f,"targetSerial",i);g.addOption(f,"includeAllColumns","N");var j=g.addContainer(f,"field");g.addText(j,"columnName","STATUS");j=g.addContainer(f,"field");g.addText(j,"columnName","PERSON_SERIAL");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:g.getXMLDocument(),params:{},success:function(n){var E=CR.JSON.parse(n.responseText);var t=E.query;var o="failed";var m=[];var F=[];var x="P";var p=null;if(E.query){var v=t.sequence;if(v){for(var C=0;C<v.length;C++){var D=v[C].transaction;if(D){for(var B=0;B<D.length;B++){o=D[B].$attr.result;var u=D[B].step;if(u){for(var A=0;A<u.length;A++){var q=u[A].record;if(u[A].tranResult&&u[A].tranResult.category){if(u[A].tranResult.category.option&&u[A].tranResult.category.option==="E"){m.push(u[A].tranResult.description);}}else{if(q){if(q.tableName==="TRANSACTION"){var y=q.field;if(y){for(var z=0;z<y.length;z++){if(y[z].columnName==="STATUS"){x=y[z].newContents;}else{if(y[z].columnName==="PERSON_SERIAL"){p=y[z].newContents;}}}}}}}}}}}}}}if(o!=="posted"){CR.Core.displayExceptions({items:m});}else{var r=new CR.XML();v=r.addContainer(r.getRootElement(),"sequence");D=r.addContainer(v,"transaction");u=r.addContainer(D,"step");var w=r.addContainer(u,"search");r.addText(w,"tableName","RECEIPT");r.addText(w,"filterName","BY_TRANSACTION_SERIAL");r.addOption(w,"includeSelectColumns","N");r.addOption(w,"includeTotalHitCount","N");r.addCount(w,"returnLimit","1");var s=r.addContainer(w,"parameter");r.addText(s,"columnName","TRANSACTION_SERIAL");r.addText(s,"contents",i);CR.Core.ajaxRequest({url:"SearchJSON",xmlData:r.getXMLDocument(),crOverride:{disableContainer:a},crMask:{container:a},success:function(l){var G="";var H=CR.JSON.parse(l.responseText);if(H.resultRows&&H.resultRows.length>=1){G=H.resultRows[0].serial;}CR.HistoryResultPanel.showTranSerialClickWindow({container:a,transactionStatus:x,targetSerial:i,receiptSerial:G,tranPersonSerial:p,format:k});},failure:function(l){CR.HistoryResultPanel.showTranSerialClickWindow({container:a,transactionStatus:x,targetSerial:i,format:k});}});}}});};CR.HistoryResultPanel.showTranSerialClickWindow=function(c){var b=new CR.XML();var g=b.addContainer(b.getRootElement(),"sequence");var f=b.addContainer(g,"transaction");var d=b.addContainer(f,"step");var a=b.addContainer(d,"tranHistory");b.addText(a,"tableName","TRANSACTION");b.addSerial(a,"targetSerial",c.targetSerial);b.addOption(a,"reportOption","TRN");b.addOption(a,"includeCompleteTransaction","Y");CR.Core.ajaxRequest({url:"TranHistoryHTML",xmlData:b.getXMLDocument(),params:CR.CheckView.addInterfaceParameters({fmPanelContainerID:"",voidContainerID:"",isHistory:true,format:c.format||"",startExpanded:true}),crOverride:{disableContainer:c.container},crMask:{container:c.container},success:function(j){var m=[];if(c.receiptSerial){var q=[];if(CR.Login.receiptConfigEmailEnabled&&c.tranPersonSerial){var h=new CR.ReceiptPanel.EmailReceiptPanel({crPersonSerial:c.tranPersonSerial,crReceiptSerial:c.receiptSerial,region:"south",height:150});q.push(h);}var n="RetrieveBinary?"+"targetSerial="+encodeURIComponent(c.receiptSerial)+"&tableName="+encodeURIComponent("RECEIPT")+"&columnName="+encodeURIComponent("IMAGE")+"&session="+encodeURIComponent(CR.Login.sessionID);var l=new CR.BinaryField({crParentTableName:"RECEIPT",crParentTargetSerial:c.receiptSerial,crColumnName:"IMAGE",crBinaryURL:n,crBinaryFormat:"pdf",crSuppressMouseHoverOver:true});var i=new CR.Panel({title:"Receipt",border:true,layout:"fit",region:"center",items:[l]});q.push(i);var r=new CR.Panel({layout:"border",region:"west",width:250,minSize:200,maxSize:600,split:true,collapsible:true,collapsed:false,items:q});m.push(r);}var p=new CR.Panel({layout:"fit",region:"center",autoScroll:true,html:j.responseText});m.push(p);var o=new CR.Window({layout:"border",title:c.title||("Transaction "+c.targetSerial),items:m,height:600,width:1000,modal:true,buttonAlign:"center",listeners:{afterlayout:function(){this.removeClass("x-window-mc");},afterrender:function(){if(h){h.crRefreshComponent();}}}});var k=true;if(c.transactionStatus!=="V"){k=false;}o.addButton({text:"Void Transaction",disabled:k,handler:function(){var s=function(){var u=new CR.XML();var y=u.addContainer(u.getRootElement(),"sequence");var x=u.addContainer(y,"transaction");var v=u.addContainer(x,"step");var w=u.addContainer(v,"transactionVoid");u.addSerial(w,"transactionSerial",c.targetSerial);CR.Core.ajaxRequest({url:"DirectXMLPostJSONSteps",xmlData:u.getXMLDocument(),crOverride:{disableContainer:c.container},crMask:{container:c.container},success:function(z){var A=JSON.parse(z.responseText);var G=A.exceptions;var E=[];var I=/CHECK_IMAGE:\S+/;if(G&&G.length){CR.Core.displayExceptions({items:G.map(function(L){return L.message;})});}else{if(A.steps){var J;var D=CR.TellerCapture.getCheckScanner();var H=false;var C="";if(D){J=CR.TellerCapture.getTellerCaptureVendor(D);if(J&&typeof J.voidCapture==="function"){H=true;C=J.VENDOR_ABBR;}}if(H){for(var K=0;K<A.steps.length;K++){var B=A.steps[K];if(B.gl){var F=B.gl;if(F.glDetail){F.glDetail.forEach(function(Q){if(Q.reference){var L=I.exec(Q.reference);if(L&&L[0]){try{var N=L[0].split(":")[1];var M=N.split(",");var O={};var R=false;M.forEach(function(S){var T=S.split("=");O[T[0]]=T[1];if(T[0]==="VENDOR"&&T[1]===C){R=true;}});if(R){if(!E.find(function(S){return S.UID===O.UID;})){E.push(O);}}}catch(P){}}}});}}}}o.crClose();CR.Core.refreshComponents({mode:"void"});if(E.length){t(c.targetSerial,E);}else{Ext.MessageBox.alert("Void Confirmation","Transaction "+c.targetSerial+" has successfully been Voided.");}}}}});};function t(u,v){if(u){CR.Core.recordView({tableName:"TRANSACTION",targetSerial:u,fields:[{columnName:"POSTING_TIME"}],callbackFunction:function(w){v.forEach(function(x){if(x.UID){CR.TellerCapture.voidCapture({transactionSequenceNumber:x.UID,transactionSequenceNumberHost:c.targetSerial,postingDate:w.record.POSTING_TIME,branchID:CR.Login.branchName,promptsPanel:c.container,transactionSerial:c.targetSerial});}});}});}}if(CR.Login.voidConfirmation&&CR.Login.voidConfirmation==="Y"){Ext.MessageBox.show({title:"Void Confirmation",msg:"Are you sure you want to void this transaction?",buttons:Ext.MessageBox.YESNO,icon:Ext.MessageBox.CONFIRMATION,closable:false,fn:function(u){if(u==="yes"){s();}}});}else{s();}}});o.addButton({text:c.cancelButtonText||"Cancel",handler:function(){o.crClose();}});o.addButton({text:"Print",handler:function(){CR.Panel.printInnerHTML('<div class="cr-historyPrint">'+p.body.dom.innerHTML+"</div>");}});o.crShow();}});};CR.HistoryResultPanel.toggleTransaction=function(g,f){var d=g.parentNode;while(!d.className&&d.className.indexOf("oddRow")===-1&&d.className.indexOf("evenRow")===-1){d=d.parentNode;}var c=d.getElementsByTagName("div");for(var a=0;a<c.length;a++){var j=c[a];if(j.className.indexOf("stepsExpanded")!==-1){j.className=j.className.replace(/stepsExpanded/,"stepsCollapsed");}else{if(j.className.indexOf("stepsCollapsed")!==-1){j.className=j.className.replace(/stepsCollapsed/,"stepsExpanded");}}}if(g.className.indexOf("stepsCollapsedIcon")!==-1){g.className=g.className.replace(/stepsCollapsedIcon/,"stepsExpandedIcon");}else{g.className=g.className.replace(/stepsExpandedIcon/,"stepsCollapsedIcon");}if(f){c=d.getElementsByTagName("div");for(a=0;a<c.length;a++){j=c[a];if(j.className.indexOf("collapsed")!==-1){j.className=j.className.replace(/collapsed/,"expanded");}}var b=d.getElementsByTagName("td");for(a=0;a<b.length;a++){var h=b[a];if(h.className.indexOf("collapsedIcon")!==-1){h.className=h.className.replace(/collapsedIcon/,"expandedIcon");}}}};CR.HistoryResultPanel.toggleMonetaryRow=function(f){var c=f.parentNode;while(!c.className&&c.className.indexOf("oddRow")===-1&&c.className.indexOf("evenRow")===-1){c=c.parentNode;}var b=c.getElementsByTagName("div");for(var a=0;a<b.length;a++){var d=b[a];if(d.className.indexOf("expanded")!==-1){d.className=d.className.replace(/expanded/,"collapsed");}else{if(d.className.indexOf("collapsed")!==-1){d.className=d.className.replace(/collapsed/,"expanded");}}}if(f.className.indexOf("collapsedIcon")!==-1){f.className=f.className.replace(/collapsedIcon/,"expandedIcon");}else{f.className=f.className.replace(/expandedIcon/,"collapsedIcon");}};CR.HistoryResultPanel.toggleRow=function(f){var c=f.parentNode;while(c.className.indexOf("step")===-1){c=c.parentNode;}var b=c.getElementsByTagName("div");for(var a=0;a<b.length;a++){var d=b[a];if(d.className.indexOf("expanded")!==-1){d.className=d.className.replace(/expanded/,"collapsed");}else{if(d.className.indexOf("collapsed")!==-1){d.className=d.className.replace(/collapsed/,"expanded");}}}if(f.className.indexOf("collapsedIcon")!==-1){f.className=f.className.replace(/collapsedIcon/,"expandedIcon");}else{f.className=f.className.replace(/expandedIcon/,"collapsedIcon");}};CR.HistoryResultPanel.showReturnItemChargeback=function(a,b,g,f,d,c){var h=[];if(a==="SHARE"){h.push({crColumnName:"SHARE_SERIAL",crContents:b,crRowDescription:g,disabled:true});h.push({crColumnName:"LOAN_SERIAL",crContents:"",crRowDescription:"",disabled:true});}else{h.push({crColumnName:"SHARE_SERIAL",crContents:"",crRowDescription:"",disabled:true});h.push({crColumnName:"LOAN_SERIAL",crContents:b,crRowDescription:g,disabled:true});}h.push({crColumnName:"MONETARY_SERIAL",crContents:f,crRowDescription:"Monetary",disabled:true});h.push({crColumnName:"RECEIVED_DATE",crContents:d,disabled:true});h.push({crColumnName:"AMOUNT",crContents:c});CR.FMPanel.showInsertUpdateWindow({tableName:"RETURNED_ITEM_CHARGEBACK",defaultValues:h,updateInsert:"insert"});};CR.HistoryResultPanel.showHoldFMPopUp=function(c){if(c){var b=new CR.XML();var h=b.addContainer(b.getRootElement(),"sequence");var g=b.addContainer(h,"transaction");b.addOption(g,"postingMode","V");var d=b.addContainer(g,"step");var f=b.addContainer(d,"postingStatus");b.addText(f,"tableName","POSTING_POLICY");d=b.addContainer(g,"step");var a=b.addContainer(d,"tranHistory");b.addText(a,"tableName","TRANSACTION");b.addSerial(a,"targetSerial",c);b.addOption(a,"reportOption","TRN");b.addOption(a,"includeCompleteTransaction","Y");CR.Core.ajaxRequest({url:"DirectXMLPostJSONSteps",xmlData:b.getXMLDocument(),success:function(n){var q=JSON.parse(n.responseText);var z=q.exceptions;var w=[];var x={};if(z&&z.length){CR.Core.displayExceptions({items:z.map(function(i){return i.message;})});}else{if(q.steps){var H=q.steps;for(var F=0;F<H.length;F++){var r=CR.Core.safeGet(H,[F,"tranHistory","transaction"]);var p=CR.Core.safeGet(H,[F,"postingStatus","postingPolicy"]);if(r){for(var l=0;l<r.length;l++){var k=r[l];if(k.serial===c){var H=k.step;for(var m=0;m<H.length;m++){var G=H[m].monetary;var A=CR.Core.safeGet(G,["source","option"]);var C=CR.Core.safeGet(G,["category","option"]);if(G&&A==="a"&&C==="W"){var I=CR.Core.safeGet(G,["monetaryDetail"],[]);var K=CR.Core.safeGet(G,["targetCategory","option"],"S");x.targetTable=K;x.targetSerial=G.targetSerial;x.targetDesc=G.targetAccessKeyDescription;for(var u=0;
u<I.length;u++){var s=CR.Core.safeGet(I,[u,"field"],[]);for(var y=0;y<s.length;y++){var o=s[y];switch(o.columnDescription){case"Account Number":x.accountNumber=o.contents;break;case"ACH Company Name":x.companyName=o.contents;break;case"ACH Company ID":x.companyID=o.contents;break;}}}}}}}}else{if(p){var t=p.holdPlacementPolicy;for(var E=0;E<t.length;E++){var B=CR.Core.safeGet(t,[E,"holdCategory"]);if(B&&B.option==="AS"){w.push([t[E],(E+1)+". "+t[E].holdCategory.text]);}}}}}if(w.length===1){CR.HistoryResultPanel.openACHStop({crHoldPlacementPolicy:w[0][0],crMonetaryFields:x});}else{if(w.length>1){var L=new CR.OptionField({crColumnDescription:"Hold Placement Policy",width:120,crOptions:w});var D=new CR.ToolbarButton({text:"Continue",handler:function(){if(L.crGetNewContents()){CR.HistoryResultPanel.openACHStop({crHoldPlacementPolicy:L.crGetNewContents(),crMonetaryFields:x});J.crClose();}else{CR.Core.displayExceptions({items:["Please select a Hold Placement Policy"]});}}});var v=new CR.ToolbarButton({text:"Cancel",handler:function(){J.crClose();}});var J=new CR.Window({title:"Select a Hold Placement Policy for the ACH Stop",bodyStyle:"padding:10px;background:#ffffff;",layout:"fit",width:400,height:200,shadow:false,autoScroll:true,items:[new CR.FormPanel({items:[L]})],bbar:["->",D,v]});J.crShow();}}}}}});}};CR.HistoryResultPanel.openACHStop=function(a){a=Ext.apply({crMonetaryFields:{},crHoldPlacementPolicy:{}},a);var t=new CR.OptionField({crTranDescPrompt:true,crColumnDescription:"Hold Category",crXMLDataType:"option",crXMLLabel:"holdCategory",crOptions:[["AS","ACH Stop"]]});t.disable();var c=new CR.OptionField({crColumnDescription:CR.Login.shareSavingsText+" or Loan",crXMLDataType:"option",crXMLLabel:"targetCategory",crOptions:[["S",CR.Login.shareSavingsText],["L","Loan"]],crContents:a.crMonetaryFields.targetTable,crOnContentsChange:function(){var D=true;if(c.crGetNewContents()==="L"){D=false;h.setVisible(D);x.setVisible(!D);}o.setVisible(D);u.setVisible(!D);f();}});var m=a.crMonetaryFields.accountNumber?"BY_ACCOUNT_NUMBER_ID_OPEN":null;var i=a.crMonetaryFields.accountNumber?[{columnName:"ACCOUNT_NUMBER",contents:a.crMonetaryFields.accountNumber},{columnName:"ID",contents:""}]:null;var o=new CR.SerialField({crTableName:"SHARE",crColumnDescription:CR.Login.shareSavingsText,crXMLDataType:"serial",crXMLLabel:"targetSerial",crIncludeDescriptionParameter:false,crSearchFilterName:m,crSearchParameters:i,crContents:a.crMonetaryFields.targetTable==="S"?a.crMonetaryFields.targetSerial:null,crRowDescription:a.crMonetaryFields.targetTable==="S"?a.crMonetaryFields.targetDesc:null,crOnContentsChange:function(){A();}});var u=new CR.SerialField({crTableName:"LOAN",crColumnDescription:"Loan",crXMLDataType:"serial",crXMLLabel:"targetSerial",hidden:true,crIncludeDescriptionParameter:false,crSearchFilterName:m,crSearchParameters:i,crContents:a.crMonetaryFields.targetTable==="L"?a.crMonetaryFields.targetSerial:null,crRowDescription:a.crMonetaryFields.targetTable==="L"?a.crMonetaryFields.targetDesc:null});var z=new CR.TextField({crColumnDescription:"Company ID",crXMLDataType:"text",crXMLLabel:"achCompanyId",crContents:a.crMonetaryFields.companyID});var j=new CR.TextField({crColumnDescription:"Company Name",crXMLDataType:"text",crXMLLabel:"achCompanyName",crContents:a.crMonetaryFields.companyName});var s=new CR.OptionField({crColumnDescription:"Transactions",crXMLDataType:"option",crXMLLabel:"holdACHOption",crOptions:[["-","All"],["D","Debits only"],["C","Credits only"]],crContents:"-"});var p=new CR.CountField({crNegativeAllowed:false,crTextNumericOnly:true,crColumnDescription:"Stop Count",crXMLDataType:"count",crXMLLabel:"holdACHStopCount",crContents:0});var q=CR.Core.safeGet(a,["crHoldPlacementPolicy","expirationOption","option"],"N");var r=new CR.OptionField({crColumnDescription:"Expiration Option",crXMLDataType:"option",crXMLLabel:"holdExpirationOption",crOptions:[["M","Months"],["D","Days"],["m","Minutes"],["N","Never"]],crContents:q,crOnContentsChange:function(){if(r.crGetNewContents()==="N"){w.crSetContents("");w.disable();}else{w.enable();}}});var C=CR.Core.safeGet(a,["crHoldPlacementPolicy","expirationPeriod"],"");var w=new CR.TextField({crTextNumericOnly:true,crColumnDescription:"Expiration Period",crXMLDataType:"text",crXMLLabel:"holdExpirationPeriod",crContents:C});var l=new CR.MoneyField({crColumnDescription:"Amount",crTextNumericOnly:true,crXMLDataType:"money",crXMLLabel:"amount"});var x=new CR.MoneyField({crContents:a.transactionFeeDefault,crColumnDescription:"Fee",crTextNumericOnly:true,crXMLDataType:"money",crXMLLabel:"specifiedTransactionFeeAmount",crOnContentsChange:f});var h=new CR.OptionField({crColumnDescription:"Usage",crXMLDataType:"option",crXMLLabel:"specifiedTransactionFeeOption",crOptions:[["C","Count"],["W","Waive"]],crContents:"W",hidden:true});var d=new CR.SerialField({crTranDescPrompt:true,crTableName:"SHARE",crColumnDescription:CR.Login.shareSavingsText+" To Fee",crXMLDataType:"serial",crXMLLabel:"specifiedTransactionFeeTargetSerial",crIncludeDescriptionParameter:false,crSearchFilterName:m,crSearchParameters:i,crContents:a.crMonetaryFields.targetTable==="S"?a.crMonetaryFields.targetSerial:null,crRowDescription:a.crMonetaryFields.targetTable==="S"?a.crMonetaryFields.targetDesc:null,hidden:a.crMonetaryFields.targetTable==="S"?false:true});var k=[t,c,o,u,z,j,s,p,r,w,l,x,h,d];var v=new CR.ToolbarButton({text:"Continue",handler:function(){var F=b();var H=CR.Login.deviceReceiptPrinters?CR.Login.deviceReceiptPrinters[0].serial:null;var E=CR.Login.deviceReceiptPrinters?CR.Login.deviceReceiptPrinters[0].identifier:null;var D=CR.Login.deviceReceiptPrinters?CR.Login.deviceReceiptPrinters[0].category:null;var G=B([o,u,d]);CR.Core.ajaxRequest({url:"DirectXMLPostJSONReceipt",xmlData:F.getXMLDocument(),scope:g,crMask:{container:y},crSessionStore:{receiptPrinterSerial:H,receiptPrinterIdentifier:E,receiptPrinterCategory:D,camPrinterSerial:CR.Login.deviceCamPrinters?CR.Login.deviceCamPrinters[0].serial:null,camPrinterCategory:CR.Login.deviceCamPrinters?CR.Login.deviceCamPrinters[0].category:null},success:function(O){if(!g.crIsDestroyed()){var J=CR.JSON.parse(O.responseText);var R=J.query;var N="failed";var S=[];if(J.query){var M=R.sequence;if(M){for(var Q=0;Q<M.length;Q++){var K=M[Q].transaction;if(K){for(var P=0;P<K.length;P++){N=K[P].$attr.result;var I=K[P].step;if(I){for(var L=0;L<I.length;L++){if(I[L].tranResult&&I[L].tranResult.category&&I[L].tranResult.category.option&&I[L].tranResult.category.option==="E"){S.push(I[L].tranResult.description);}}}}}}}}else{if(J.receiptSerial){N="posted";}}if(N!=="posted"){CR.Core.displayExceptions({items:S});}else{if(!H||(H&&D!=="RPS")){CR.ReceiptPanel.showReceipt({crTransactedAccounts:G,crReceiptSerial:J.receiptSerial,crReceiptContentStr:J.sigPadString,crReceiptPrinterCategory:D,crReceiptPrinterIdentifier:E,crFileTransferRequest:J.fileTransferRequest?J.fileTransferRequest.fileTransferRequest:null,crCallbackFunction:function(){Ext.MessageBox.show({title:"Posting Confirmation",msg:"Your ACH Stop Payment posted successfully.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.CONFIRMATION,fn:function(){y.crClose();}});}});}else{Ext.MessageBox.show({title:"Posting Confirmation",msg:"Your ACH Stop Payment posted successfully.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.CONFIRMATION,fn:function(){y.crClose();}});}CR.Core.refreshComponents();}}}});}});var n=new CR.ToolbarButton({text:"Cancel",handler:function(){y.crClose();}});var g=new CR.FormPanel({items:k});var y=new CR.Window({title:"Insert ACH Stop Payment",bodyStyle:"padding:10px;background:#ffffff;",layout:"fit",width:400,height:450,shadow:false,autoScroll:true,items:[g],bbar:["->",v,n]});y.crShow();A();function B(D){var H=[];for(var E=0;E<D.length;E++){var G=D[E];if(!G.hidden&&G.crGetNewRowDescription()){var F=G.crGetNewRowDescription().split(" ");if(F[0]){H.push([F[0],F[0]]);}}}return H;}function f(){if(c.crGetNewContents()==="S"&&(x.crGetNewContents()!=="0.00"&&x.crGetNewContents()!=="0"&&x.crGetNewContents())){if(o.crGetNewContents()&&!o.hidden){d.crSetSerial(o.crGetNewContents(),o.crGetNewRowDescription());}d.setVisible(true);}else{d.setVisible(false);}}function A(){var D=b(true);CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:D.getXMLDocument(),scope:g,crOverride:{disableContainer:y,suppress:true,successIfNotApproved:true},crMask:{container:g},success:function(G){if(!g.crIsDestroyed()){var J=CR.JSON.parse(G.responseText);var F=J.query.sequence[0].transaction[0].step;var H="N";var E=null;Ext.each(F,function(K){if(K.postingRequest){var L=K.postingRequest;if(L.transactionFeeApplicable){H=K.postingRequest.transactionFeeApplicable.option;}if(L.transactionFeeDefault){E=K.postingRequest.transactionFeeDefault;}}});if(H==="Y"){x.setVisible(true);x.crSetContents(E);h.setVisible(false);}else{if(H==="C"){var I=!E||E==="0.00"?"W":"C";x.setVisible(false);h.crSetContents(I);h.setVisible(true);}else{x.setVisible(true);h.setVisible(false);}}f();}}});}function b(L){var J=new CR.XML();var G=J.addContainer(J.getRootElement(),"sequence");var F=J.addContainer(G,"transaction");if(L){J.addOption(F,"postingMode","V");}var E=J.addContainer(F,"step");var I=J.addContainer(E,"postingRequest");J.addOption(I,"category","H");for(var H=0;H<g.items.getCount();H++){var K=g.getComponent(H);var D=I;if(!K.hidden){J=CR.Core.applyXMLBasedOnFieldType(K,J,D);}}if(h.hidden&&(x.crGetNewContents()!=="0.00"&&x.crGetNewContents()!=="0"&&x.crGetNewContents())){J.addOption(I,"specifiedTransactionFeeOption","Y");}else{if(!L&&h.hidden&&x.crGetNewContents()){J.addOption(I,"specifiedTransactionFeeOption","Y");}}return J;}};Ext.namespace("CR.KeyStoneService");CR.KeyStoneService={SERVICE_VERSION_REQUIRED:"1.0.0.0",USER_SERVICE_VERSION_REQUIRED:"2.0.0.0",FORM_VERSION_REQUIRED:"2.4.0.0",FORM_MONITOR_VERSION_REQUIRED:"2.4.4.0",SCANSHELL_VERSION_REQUIRED:"2.4.0.0",TOPAZ_VERSION_REQUIRED:"2.4.0.0",SECUGEN_VERSION_REQUIRED:"2.5.1.0",FORM_STATUS_FREQUENCY_MS:2*1000,FORM_STATUS_MAX_WAIT_MS:600*1000,SERVICE_BASE_URL:"https://127.0.0.1:51763",deviceInformation:null,userServiceInformation:null,isAdobeAcrobatPluginAvailable:function(){var a=false;try{if(window.navigator&&window.navigator.plugins&&window.navigator.plugins["Adobe Acrobat"]){a=true;}}catch(b){console.warn("Error checking for Adobe Acrobat Plugin",b);}return a;},isJavaPluginAvailable:function(){var b=false;try{if(window.navigator&&window.navigator.mimeTypes&&window.navigator.mimeTypes["application/x-java-applet"]){b=true;}}catch(a){console.warn("Error checking for Java Plugin",a);}return b;},dataURLtoBlob:function(a){var d=atob(a);var c=[];for(var b=0;b<d.length;b++){c.push(d.charCodeAt(b));}return new Blob([new Uint8Array(c)],{type:"image/png"});},getServiceURL:function(b){var a=CR.KeyStoneService.SERVICE_BASE_URL;if(b){if(b.baseService){a+="/"+b.baseService;}if(b.service){a+="/"+b.service;}if(b.action){a+="/"+b.action;}if(b.spawn){a+="?spawn";}}return a;},getServiceInstallerURL:function(){var c=window.location.protocol;var b=window.location.port;var a=c+"//"+window.location.hostname+":"+b+"/"+CR.Login.locationName+"/CorelationWindowsService.msi";return a;},_callService:function(f){f=Ext.apply({async:true,method:"GET",baseService:"",service:"",action:"",data:null,timeout:null,mask:null,retryFunction:CR.Core.emptyFunction,retryScope:this,retryCount:0,retryDelay:500,retryArgs:{},callbackFunction:CR.Core.emptyFunction,callbackScope:this},f);var d=!!f.baseService;var a=d?"KeyStone User Service":"Corelation KeyStone Service";var c=CR.KeyStoneService.getServiceURL(f);var i=new XMLHttpRequest();if(f.timeout){i.timeout=f.timeout;}if("withCredentials" in i){i.open(f.method,c,f.async);}else{if(typeof XDomainRequest!=="undefined"){i=new XDomainRequest();i.open(f.method,c);}else{CR.Core.displayExceptions({title:a,items:["Unable to create service request","CORS not supported"]});}}if(!i){return;}var h=null;if(f.mask){h={crMask:f.mask};CR.Core.ajaxBeforeRequestHandler(i,h);}function g(){if(h&&h.crMask){if(h.crMask.delayedTask){h.crMask.delayedTask.cancel();}if(h.crMask.loadMask){h.crMask.loadMask.hide();}}}function b(j){if(typeof f.retryCount==="number"&&f.retryCount>0){f.retryArgs.retryCount=f.retryCount-1;window.setTimeout(function(){f.retryFunction.call(f.retryScope,f.retryArgs);},f.retryDelay);}else{g();CR.KeyStoneService.displayServiceError(Ext.apply(f,{userService:f.baseService==="UserService",timout:j.timout,error:j.error}));}}i.onload=function(){if(i.status===200){var l=i.responseText;var j=l;try{j=CR.JSON.parse(l);}catch(k){try{j=new CR.XML({xmlText:l}).toJSON();}catch(k){console.warn("Unable to parse KeyStone Service response as JSON");}}g();f.callbackFunction.call(f.callbackScope,j);}else{b({error:"HTTP Status "+i.status});}};i.onerror=function(j){b({error:j});};i.ontimeout=function(){b({error:"Request timeout",timout:true});};if(f.data){i.send(JSON.stringify(f.data));}else{i.send();}if(!f.async){if(i.readyState===4&&i.status===200){return i.responseText;}else{return"";}}},getDeviceInformation:function(a){a=Ext.apply({service:"GetDeviceInformation",versionRequired:CR.KeyStoneService.SERVICE_VERSION_REQUIRED,retryFunction:CR.KeyStoneService.getDeviceInformation,retryScope:this,retryArgs:a,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},a);function b(g){var f="";if(g.device&&g.device.$attr){f=g.device.$attr.version;}a.callbackArgs.response=g;a.callbackArgs.serviceVersion=f;if(CR.KeyStoneService.versionCompare(f,a.versionRequired)>=0){a.callbackArgs.success=true;}else{a.callbackArgs.success=false;a.callbackArgs.versionMismatch=true;a.callbackArgs.openUrl=CR.KeyStoneService.getServiceInstallerURL();}if(a.callbackArgs.success){CR.KeyStoneService.deviceInformation=g;a.callbackFunction.call(a.callbackScope,a.callbackArgs);}else{CR.KeyStoneService.displayServiceError(Ext.apply(a,{userService:false,versionMismatch:a.callbackArgs.versionMismatch,versionRequired:a.versionRequired}));}}if(!CR.KeyStoneService.deviceInformation){var d=CR.KeyStoneService.getRetryCount(a,2);var c=Ext.isIE?3000:null;CR.KeyStoneService._callService({service:"GetDeviceInformation",timeout:c,mask:a.mask,retryFunction:CR.KeyStoneService.getDeviceInformation,retryScope:this,retryArgs:a,retryCount:d,callbackFunction:function(f){if(f&&f.canceled){a.callbackArgs.success=false;a.callbackFunction.call(a.callbackScope,a.callbackArgs);}else{b(f);}}});}else{b(CR.KeyStoneService.deviceInformation);}},getRetryCount:function(a,b){var c=0;if(typeof a.retryCount==="undefined"){c=b;}else{c=a.retryCount;}return c;},getUserServiceInformation:function(a){a=Ext.apply({versionRequired:CR.KeyStoneService.USER_SERVICE_VERSION_REQUIRED,retryFunction:CR.KeyStoneService.getUserServiceInformation,retryScope:this,retryArgs:a,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},a);function b(d){var f="";if(d.version){f=d.version;}a.callbackArgs.response=d;a.callbackArgs.userServiceVersion=f;if(CR.KeyStoneService.versionCompare(f,a.versionRequired)>=0){a.callbackArgs.success=true;}else{a.callbackArgs.success=false;a.callbackArgs.versionMismatch=true;a.callbackArgs.openUrl=CR.KeyStoneService.getServiceInstallerURL();}if(a.callbackArgs.success){CR.KeyStoneService.userServiceInformation=d;a.callbackFunction.call(a.callbackScope,a.callbackArgs);}else{CR.KeyStoneService.displayServiceError(Ext.apply(a,{userService:true,versionMismatch:a.callbackArgs.versionMismatch,versionRequired:a.versionRequired}));}}if(!CR.KeyStoneService.userServiceInformation){var c=CR.KeyStoneService.getRetryCount(a,2);CR.KeyStoneService._callService({method:"POST",baseService:"UserService",service:"service",action:"version",mask:a.mask,retryFunction:CR.KeyStoneService.getUserServiceInformation,retryScope:this,retryArgs:a,retryCount:c,callbackFunction:function(d){if(d&&d.canceled){a.callbackArgs.success=false;a.callbackFunction.call(a.callbackScope,a.callbackArgs);}else{b(d);}}});}else{b(CR.KeyStoneService.userServiceInformation);}},getVersionInformation:function(b){b=Ext.apply({callbackFunction:CR.Core.emptyFunction,callbackArgs:{},callbackScope:this},b);
var c=new XMLHttpRequest();var a=CR.KeyStoneService.getServiceURL({baseService:"UserService",service:"service",action:"version"});c.open("POST",a,true);c.send();c.addEventListener("load",function(){var g={};if(c.status===200){var h=c.responseText;var d=h;try{d=CR.JSON.parse(h);}catch(f){try{d=new CR.XML({xmlText:h}).toJSON();}catch(f){console.warn("Unable to parse KeyStone Service response as JSON");}}g.version=d.version;}else{g.error="(HTTP/"+c.status;if(c.statusText){g.error+=" "+c.statusText;}g.error+=")";}b.callbackFunction.call(b.callbackScope,g);});},callUserService:function(a){a=Ext.apply({userService:true,versionRequired:CR.KeyStoneService.USER_SERVICE_VERSION_REQUIRED,method:"POST",baseService:"UserService",service:"",action:"",data:null,timeout:null,mask:null,retryFunction:CR.KeyStoneService.callUserService,retryScope:this,retryArgs:a,retryCount:2,retryDelay:1000,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},a);CR.KeyStoneService.getDeviceInformation({versionRequired:CR.KeyStoneService.SERVICE_VERSION_REQUIRED,callbackFunction:function(b){if(b.success){CR.KeyStoneService.getUserServiceInformation({versionRequired:a.versionRequired,callbackFunction:function(c){if(c.success){CR.KeyStoneService._callService(a);}else{a.callbackArgs.success=false;a.callbackArgs.message="Unable get KeyStone User Service Information";a.callbackFunction.call(a.callbackScope,a.callbackArgs);}}});}else{a.callbackArgs.success=false;a.callbackArgs.message="Unable get Device Information";a.callbackFunction.call(a.callbackScope,a.callbackArgs);}}});},runForm:function(a){a=Ext.apply({uid:null,filename:null,pdf:null,fdf:null,monitor:false,callbackFunction:null,callbackScope:this},a);var b=new Date().getTime();var d=CR.KeyStoneService.FORM_VERSION_REQUIRED;if(a.monitor){d=CR.KeyStoneService.FORM_MONITOR_VERSION_REQUIRED;}function c(){CR.KeyStoneService.callUserService({versionRequired:d,service:"acrobat",action:"isformclosed",data:{uid:a.uid,filename:a.filename,wid:a.wid,pid:a.pid},callbackFunction:function(g){if(g.success){if(g.message==="closed"){CR.Core.ajaxRequest({method:"GET",url:"SessionStore",params:{id:a.uid,json:true,remove:true},success:function(j){var i=CR.JSON.parse(j.responseText);var l={success:true,closed:true};if(i&&i.value){var k=CR.JSON.parse(i.value);Ext.apply(l,k);}a.callbackFunction.call(a.callbackScope,l);}});}else{var h=new Date().getTime();if(h-b>CR.KeyStoneService.FORM_STATUS_MAX_WAIT_MS){a.callbackFunction.call(a.callbackScope,{success:true,timeout:true});}else{setTimeout(c,CR.KeyStoneService.FORM_STATUS_FREQUENCY_MS);}}}else{a.callbackFunction.call(a.callbackScope,{success:true});}}});}function f(){CR.KeyStoneService.callUserService({versionRequired:d,service:"acrobat",action:"monitorstatus",data:{uid:a.uid,filename:a.filename},callbackFunction:function(g){if(g.success){if(g.message==="complete"){a=Ext.apply(a,g);setTimeout(c,CR.KeyStoneService.FORM_STATUS_FREQUENCY_MS);}else{var h=new Date().getTime();if(h-b>CR.KeyStoneService.FORM_STATUS_MAX_WAIT_MS){a.callbackFunction.call(a.callbackScope,{success:true,timeout:true});}else{setTimeout(f,CR.KeyStoneService.FORM_STATUS_FREQUENCY_MS);}}}else{CR.Core.displayExceptions({title:"KeyStone User Service",items:["Unable to Run PDF Form",g.message]});}}});}CR.KeyStoneService.callUserService({versionRequired:d,service:"acrobat",action:"runform",data:{uid:a.uid,filename:a.filename,pdf:a.pdf,fdf:a.fdf,monitor:a.monitor},callbackFunction:function(g){if(g.success){a=Ext.apply(a,g);if(typeof a.callbackFunction==="function"){if(a.monitor){setTimeout(f,CR.KeyStoneService.FORM_STATUS_FREQUENCY_MS);}else{setTimeout(c,CR.KeyStoneService.FORM_STATUS_FREQUENCY_MS);}}}else{CR.Core.displayExceptions({title:"KeyStone User Service",items:["Unable to Run PDF Form",g.message]});}}});},openForm:function(a){a=Ext.apply({uid:null,filename:null,pdf:null,printer:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);CR.KeyStoneService.callUserService({versionRequired:CR.KeyStoneService.FORM_VERSION_REQUIRED,service:"acrobat",action:"openform",data:{uid:a.uid,filename:a.filename,pdf:a.pdf,printer:a.printer},callbackFunction:function(b){if(b.success){a.callbackFunction.call(a.callbackScope,a.callbackArgs);}else{CR.Core.displayExceptions({title:"KeyStone User Service",items:["Unable to Open PDF Form",b.message]});}}});},printForm:function(a){a=Ext.apply({uid:null,filename:null,pdf:null,printer:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);CR.KeyStoneService.callUserService({versionRequired:CR.KeyStoneService.FORM_VERSION_REQUIRED,service:"acrobat",action:"printform",data:{uid:a.uid,filename:a.filename,pdf:a.pdf,printer:a.printer},callbackFunction:function(b){if(b.success){a.callbackFunction.call(a.callbackScope,a.callbackArgs);}else{CR.Core.displayExceptions({title:"KeyStone User Service",items:["Unable to Print PDF Form",b.message]});}}});},scanShell:function(b){b=Ext.apply({action:null,mask:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},b);var a=CR.Settings.getDeviceSetting("acuant_scanshell_spawn",false);CR.KeyStoneService.callUserService({versionRequired:CR.KeyStoneService.SCANSHELL_VERSION_REQUIRED,service:"scanshell",action:b.action,mask:b.mask,spawn:a,callbackFunction:function(c){b.callbackFunction.call(b.callbackScope,c);}});},topazSigPad:function(a){a=Ext.apply({action:null,mask:null,handleError:true,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);var f=false;var b=a.data||{};b.debug=!!CR.TopazSigPad.debug;b.basic=CR.TopazSigPad.isBasic();b.eventInterval=CR.TopazSigPad.eventInterval||100;function d(){CR.KeyStoneService.callUserService({async:true,versionRequired:CR.KeyStoneService.TOPAZ_VERSION_REQUIRED,service:"topaz",action:a.action,mask:a.mask,data:b,callbackFunction:function(g){if(g.success||!a.handleError){a.callbackFunction.call(a.callbackScope,g);}else{CR.Core.displayExceptions({title:"KeyStone User Service",items:["Unable to communicate with Signature Pad",g.message]});}}});}if(b&&b.image){if(!b.pixelDepth){b.pixelDepth=CR.TopazSigPad.getPixelDepth();}var c=b.image;if(typeof c.getContext==="function"){b.image=c.toDataURL();}}if(!f){d();}},secuGenService:function(a){a=Ext.apply({action:null,mask:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);CR.KeyStoneService.callUserService({versionRequired:CR.KeyStoneService.SECUGEN_VERSION_REQUIRED,service:"secugen",action:a.action,data:a.data,mask:a.mask,callbackFunction:function(b){if(!b.success){CR.Core.displayExceptions({title:"SecuGen",items:[b.message||"Unknown error"],callbackFunction:function(){a.callbackFunction.call(a.callbackScope,b);}});}else{a.callbackFunction.call(a.callbackScope,b);}}});},imageURLtoBase64:function(b){b=Ext.apply({url:null,type:"image/png",callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);var a=new Image();a.crossOrigin="Anonymous";a.onload=function(){var d=document.createElement("CANVAS");var c=d.getContext("2d");var f;d.height=this.naturalHeight;d.width=this.naturalWidth;c.drawImage(this,0,0);f=d.toDataURL(b.type);console.log("dataURL",f);b.callbackFunction.call(b.callbackScope,f);};a.src=b.url;if(a.complete||a.complete===undefined){a.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.src=b.url;}},versionCompare:function(g,c){g=g||"";c=c||"";if(g===c){return 0;}if(typeof g!=="string"){g="";}if(typeof c!=="string"){c="";}var h=g.split(".");var f=c.split(".");var i=Math.min(h.length,f.length);for(var d=0;d<i;d++){var a=parseInt(h[d]);var b=parseInt(f[d]);if(a>b){return 1;}else{if(a<b){return -1;}}}if(h.length>f.length){return 1;}else{if(h.length<f.length){return -1;}}return 0;},displayServiceError:function(b){b=Ext.apply({userService:false,versionMismatch:false,versionRequired:null,error:null,cancelable:true,retryFunction:CR.Core.emptyFunction,retryScope:this,retryArgs:{},callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);if(b.userService){CR.KeyStoneService.userServiceInformation=null;}else{CR.KeyStoneService.deviceInformation=null;}var f=!!b.userService;var a=f?"KeyStone User Service":"Corelation KeyStone Service";var c=b.exceptions||[];if(b.error&&typeof b.error==="string"){c.push(b.error);}if(b.versionMismatch){c.push("Corelation KeyStone Service version "+b.versionRequired+" or newer must be loaded.","Click 'Install' to download the installation file");}else{c.push("The "+a+" is not responding","You can 'Retry', 'Test' or 'Install' the service");}function g(h){Ext.MessageBox.show({title:a+" Setup",msg:h,buttons:Ext.MessageBox.OKCANCEL,fn:function(i){if(i==="ok"){b.timeout=null;CR.KeyStoneService.userServiceInformation=null;b.retryFunction.call(b.retryScope,b.retryArgs);}else{b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}});}var d=[{text:"Retry",handler:function(h){h.findParentByType(CR.Window).crClose();b.timeout=null;CR.KeyStoneService.userServiceInformation=null;b.retryFunction.call(b.retryScope,b.retryArgs);}},{text:"Test",handler:function(h){h.findParentByType(CR.Window).crClose();var i=CR.KeyStoneService.getServiceURL();if(f){i=CR.KeyStoneService.getServiceURL({baseService:"UserService",service:"service",action:"test"});}window.open(i);g("After successful test press 'OK' to retry the "+a);}},{text:"Install",handler:function(h){h.findParentByType(CR.Window).crClose();window.open(CR.KeyStoneService.getServiceInstallerURL());g("After installation is complete press 'OK' to retry the "+a);}}];if(b.cancelable){d.push({text:"Cancel",handler:function(h){h.findParentByType(CR.Window).crClose();if(b.callbackFunction){b.callbackArgs.canceled=true;b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}});}CR.KeyStoneService.displayExceptions({title:a+" Failure",items:c,buttons:d,callbackFunction:b.callbackFunction,callbackScope:b.callbackScope,callbackArgs:b.callbackArgs});},displayExceptions:function(h){var l=800;var a=360;var n=100;var o=CR.Core.convertToHtmlLines(h.items);if(o.count>0){o.html='<span class="exception-text">'+o.html+"</span>";var k="";if(h.title){k=h.title;}else{k="Exception";if(o.count>1){k+="s";}}var i=Ext.getBody();if(h.renderTo){i=h.renderTo;}var f={title:k,modal:true,renderTo:i,plain:true,cls:"x-window-dlg",width:l,height:n,autoHeight:true,autoScroll:true,html:o.html,buttonAlign:"center",closable:false};if(h.buttons){f.buttons=h.buttons;}else{f.buttons=[{text:"Close",handler:function(){g.crClose();}}];f.listeners={close:function(){if(h.callbackFunction){h.callbackArgs.canceled=true;h.callbackFunction.call(h.callbackScope,h.callbackArgs);}if(h.focusFld&&h.focusFld.focus&&!h.focusFld.crIsDestroyed()){h.focusFld.focus(true,true);}}};f.keys={key:Ext.EventObject.ENTER,handler:function(){g.crClose();}};}var g=new CR.Window(f);g.crShow();var c=Ext.get(g.body.dom.firstChild);var m=c.getWidth()+c.getMargins("lr");var d=g.getFrameWidth("lr");var j=g.body.getFrameWidth("lr");var b=m+d+j;b=b>l?l:(b<a?a:b);g.setSize(b,"auto").center();}}};Ext.namespace("CR.Login");CR.Login.clearValues=function(){CR.Login.userName="";CR.Login.userSerial="";CR.Login.deviceName="";CR.Login.deviceSerial="";CR.Login.defaultTimeZone={};CR.Login.defaultTimeZone.option="";CR.Login.defaultTimeZone.text="";CR.Login.sessionID="";CR.Login.postingDate="";var a=window.location.pathname.split("/");CR.Login.locationName=a[0]||a[1];CR.Storage.setUser(CR.Login.userSerial);};CR.Login.setTerminology=function(a){CR.Login.shareSavingsText=a.shareSavingsText;CR.Login.sharesSavingsText=a.sharesSavingsText;CR.Login.draftCheckingText=a.draftCheckingText;CR.Login.draftCheckText=a.draftCheckText;CR.Login.draftsChecksText=a.draftsChecksText;CR.Login.dividendInterestText=a.dividendInterestText;CR.Login.dividendsInterestText=a.dividendsInterestText;CR.Login.impoundText=a.impoundText;CR.Core.setTranCodeOptions();};CR.Login.clearValues();CR.Login.mainPageLogin=function(a){window.document.title=CR.Login.locationName;CR.Core.ajaxRequest({url:"UserLogin",params:{loginStatus:"Y"},crOverride:{suppress:true},crMask:{suppress:true},success:function(c){var b=CR.JSON.parse(c.responseText);CR.Login.activeDirectoryLogonEnabled=b.activeDirectoryLogonEnabled||false;if(!b.success){CR.Login.performLogin({success:a,logonHTML:b.logonHTML,databaseName:b.databaseName});CR.Login.setTerminology(b);}else{CR.Login.processSuccessResponse({userLoginResult:b,success:a,failure:function(){CR.Login.performLogin({success:a});}});}},failure:function(b){CR.Login.performLogin({success:a});},crSessionNotFoundHandler:function(b){CR.Login.performLogin({success:a});}});};CR.Login.performLogin=function(c){c=c||{};if(c.logonHTML){CR.Login.logonHTML=c.logonHTML;}var b=c.scope||window;var h=c.success||CR.Core.emptyFunction;if(CR.Login.loginWindow){CR.Login.loginWindow.crSuccessList.push({success:h,scope:b});}else{var u=false;var o=c.retainCurrentUserName?CR.Login.userName:"";var f=c.retainCurrentUserName&&o;var s=new CR.Window({title:"Please log in to "+CR.Login.locationName,layout:"fit",autoWidth:true,autoHeight:true,constrain:true,closable:false,resizable:false,plain:true,modal:true,crLoggingIn:false,crSuccessList:[{success:h,scope:b}],crLoginSubmit:function(){var x=this;if(x.crLoggingIn||!u){return;}x.crLoggingIn=true;x.crLoginButton.disable();if(!p.crGetNewContents()||!w.crGetNewContents()){x.crHandleLoginFailure(["Username and Password are both required"]);}else{if(v.crGetNewContents()==="Y"&&t.crGetNewContents()!==a.crGetNewContents()){x.crHandleLoginFailure(["New Password values do not match"]);}else{CR.Core.ajaxRequest({url:"UserLogin",params:{loginUsername:p.crGetNewContents(),loginPassword:w.crGetNewContents(),loginNewPassword:t.crGetNewContents(),loginDeviceIdentifier:x.crDeviceIdentifier,loginDeviceInsertOption:n.crGetNewContents()},scope:x,crOverride:{suppress:true},crMask:{},success:function(z){var y=CR.JSON.parse(z.responseText);x.crHandleLoginResponse(y);},failure:function(y){x.crHandleLoginFailure([CR.Core.getHttpStatusMessage(y)]);},crSessionNotFoundHandler:function(y){x.crHandleLoginFailure(["Session Not Found"]);}});}}},crHandleLoginResponse:function(x){var y=this;y.crLoggingIn=false;if(!x.success){y.crShow();y.crHandleLoginFailure(x.exception);if(x.passwordChangeRequired&&x.passwordChangeRequired.option==="Y"&&v.crGetNewContents()==="N"){v.crSetContents("Y");r();}if(x.deviceInsertResult&&x.deviceInsertResult.option==="A"){n.crShow();}}else{CR.Login.processSuccessResponse({userLoginResult:x,scope:y,success:function(){if(t.crGetNewContents()&&t.crGetNewContents()!==w.crGetNewContents()){Ext.MessageBox.alert("Password Change Confirmation","Your password has been changed successfully.");}w.crSetContents("");t.crSetContents("");a.crSetContents("");var B=y.crSuccessList;y.crSuccessList=[];CR.Login.loginWindow=null;y.crClose();if(!x.deviceInsertResult||x.deviceInsertResult.option!=="I"){for(var A=0;A<B.length;++A){var C=B[A];C.success.call(C.scope);}}else{var z=new CR.Window({title:"Update New Device Inserted During Login",closable:true,autoWidth:true,autoHeight:true,autoScroll:true,modal:true});z.addListener("close",function(){for(var D=0;D<B.length;++D){var E=B[D];E.success.call(E.scope);}});CR.FMPanel.open({container:z,fmRequest:{requestType:"update",tableName:"DEVICE",targetSerial:x.deviceSerial}});}},failure:function(z){y.crHandleLoginFailure([CR.Core.getHttpStatusMessage(z)]);}});}},crHandleLoginFailure:function(y,x){var z=this;z.crLoginButton.enable();z.crLoggingIn=false;w.crSetContents("");t.crSetContents("");a.crSetContents("");if(!y||y.length===0){y=["Unknown Exception"];}CR.Core.displayExceptions({title:"Login Failure",items:y,callbackFunction:x});},crKerberosLogin:function(x){x=Ext.apply({loginDeviceInsertOption:"N"},x);var y=this;y.crHide();CR.KeyStoneService.getDeviceInformation({mask:{container:CR.FMPanel.defaultContainer,message:"Device identification..."},callbackFunction:function(A){if(A.success&&A.response&&A.response.device&&A.response.device.deviceInformation&&A.response.device.deviceInformation.identifier){var z=A.response.device.deviceInformation.identifier||"";
CR.Login.kerberosLogin({loginDeviceIdentifier:z,loginDeviceInsertOption:x.loginDeviceInsertOption,callbackFunction:function(B){CR.Storage.handler.setItem("cr_kerberosUser",B.userName);CR.Login.activeDirectoryLogon=B.success;if(!B.success&&B.deviceInsertResult&&B.deviceInsertResult.option==="A"){CR.Login.showKerberosPopup({insertDevicePrompt:true});y.crHandleLoginFailure(B.exception);}else{y.crHandleLoginResponse(B);}}});}}});}});var k=new CR.Button({text:"Login",disabled:true,handler:function(){s.crLoginSubmit();}});var j=new CR.FormPanel({labelWidth:80,frame:true,autoWidth:true,autoHeight:true,buttonAlign:"center",buttons:[k]});s.crLoginButton=k;var p=new CR.TextField({crColumnDescription:"Username",crTextBlankAllowed:true,width:150,crContents:o,disabled:f,crEnterKeyHandler:function(){s.crLoginSubmit();}});var w=new CR.TextField({crColumnDescription:"Password",crTextBlankAllowed:true,width:150,inputType:"password",crEnterKeyHandler:function(){s.crLoginSubmit();}});var v=new CR.Checkbox({crColumnDescription:"Change",crContents:"N",crEnterKeyHandler:function(){s.crLoginSubmit();}});var t=new CR.TextField({crColumnDescription:"New Password",crTextBlankAllowed:true,width:150,inputType:"password",hidden:true,crEnterKeyHandler:function(){s.crLoginSubmit();}});var a=new CR.TextField({crColumnDescription:"Reenter New Password",crTextBlankAllowed:true,width:150,inputType:"password",hidden:true,crEnterKeyHandler:function(){s.crLoginSubmit();}});var n=new CR.Checkbox({crColumnDescription:"Insert New Device",crContents:"N",hidden:true,crEnterKeyHandler:function(){s.crLoginSubmit();}});var m=function(){var x=true;var y=false;if(p.crGetNewContents()&&w.crGetNewContents()){if(v.crGetNewContents()==="N"){x=false;}else{if(t.crGetNewContents()||a.crGetNewContents()){if(t.crGetNewContents()===a.crGetNewContents()){x=false;}else{y=true;}}}}if(!u){x=true;}if(s.crLoggingIn){x=true;}k.setDisabled(x);if(y){t.markInvalid("New password values do not match");a.markInvalid("New password values do not match");}else{t.clearInvalid();a.clearInvalid();}};var r=function(){if(v.crGetNewContents()==="N"){t.crSetContents("");a.crSetContents("");t.crHide();a.crHide();}else{t.crShow();a.crShow();}m();};p.addListener("keyup",m);w.addListener("keyup",m);t.addListener("keyup",m);a.addListener("keyup",m);v.addListener("check",r);var g={autoEl:{tag:"img",src:CR.Core.LOGIN_LOGO}};if(c.logonHTML){g={html:c.logonHTML};}var d=new Ext.BoxComponent(g);var i=new Ext.BoxComponent({autoEl:{html:"<br>"}});j.add(d);j.add(i);j.add(p);j.add(w);j.add(v);j.add(t);j.add(a);j.add(n);s.add(j);s.crShow(undefined,function(){s.crDeviceIdentifier="";CR.KeyStoneService.getDeviceInformation({mask:{container:k.ownerCt,message:"Device identification..."},callbackFunction:function(x){if(x.success&&x.response&&x.response.device&&x.response.device.deviceInformation&&x.response.device.deviceInformation.identifier){s.crDeviceIdentifier=x.response.device.deviceInformation.identifier||"";}u=true;m();}});CR.Core.defer(function(){if(s&&!s.crIsDestroyed()){s.center();if(f){w.focus(false);}else{p.focus(false);}}},s,null,400);});CR.Login.loginWindow=s;if(CR.Login.activeDirectoryLogonEnabled){var q=CR.Storage.handler.getItem("cr_switchUser");if(q&&q==="true"){CR.Storage.handler.removeItem("cr_switchUser");}else{var l=c.retainCurrentUserName;if(!l||CR.Login.activeDirectoryLogon||CR.Storage.handler.getItem("cr_kerberosUser")===o){s.crKerberosLogin();}}}}};CR.Login.kerberosLogin=function(b){b=Ext.apply({loginDeviceName:"",loginDeviceIdentifier:"",loginDeviceInsertOption:"N",callbackFunction:CR.Core.emptyFunction,callbackScope:this},b);var a="UserLogin?"+"loginDeviceName="+encodeURIComponent(b.loginDeviceName||"")+"&loginDeviceIdentifier="+encodeURIComponent(b.loginDeviceIdentifier||"")+"&loginDeviceInsertOption="+encodeURIComponent(b.loginDeviceInsertOption||"N")+"&mockError="+encodeURIComponent(window.mockError||"");var c=document.createElement("iframe");c.style.display="none";c.onload=function(){if(c&&c.contentWindow&&c.contentWindow.CR&&c.contentWindow.CR._loginResponse){var d=c.contentWindow.CR._loginResponse;b.callbackFunction.call(b.callbackScope,d);}else{b.callbackFunction.call(b.callbackScope,{success:false,exception:["Unable to get Single Sign On response","Check Browser configuration"]});}c.parentNode.removeChild(c);};c.src=a;document.body.appendChild(c);};CR.Login.processSuccessResponse=function(c){c=Ext.apply({userLoginResult:{},success:CR.Core.emptyFunction},c);var a=c.userLoginResult;var b=c.success;CR.Login.userName=a.userName;CR.Login.userSerial=a.userSerial;CR.Login.databaseName=a.databaseName;CR.Login.deviceName=a.deviceName;CR.Login.deviceSerial=a.deviceSerial;CR.Login.defaultTimeZone=a.defaultTimeZone;CR.Login.sessionID=a.sessionID;CR.Login.JSESSIONID=a.JSESSIONID;CR.Login.postingDate=a.postingDate;if(a.jaspersoftBaseURL){CR.Login.jaspersoftBaseURL=a.jaspersoftBaseURL;}else{if(a.jaspersoftHTTPSPort&&window.location.protocol==="https:"){CR.Login.jaspersoftBaseURL="https://"+window.location.hostname+":"+a.jaspersoftHTTPSPort;}else{if(a.jaspersoftHTTPPort){CR.Login.jaspersoftBaseURL="http://"+window.location.hostname+":"+a.jaspersoftHTTPPort;}}}if(a.jaspersoftInternalBaseURL){CR.Login.jaspersoftInternalBaseURL=a.jaspersoftBaseURL;}else{if(a.jaspersoftHTTPSPort&&window.location.protocol==="https:"){CR.Login.jaspersoftInternalBaseURL="https://127.0.0.1:"+a.jaspersoftHTTPSPort;}else{if(a.jaspersoftHTTPPort){CR.Login.jaspersoftInternalBaseURL="http://127.0.0.1:"+a.jaspersoftHTTPPort;}}}if(a.globalHTTPPort&&window.location.protocol==="https:"){CR.Login.globalHTTPURL="http://"+window.location.hostname+":"+a.globalHTTPPort;}if(a.queryServerURL){CR.Core.queryServerURL=a.queryServerURL;}CR.Login.setWindowTitle();CR.Storage.setUser(CR.Login.userSerial);CR.Settings.initialize();CR.Login.setTerminology(a);CR.Login.getUserInterfaceParameters({success:function(){CR.Core.retrieveTableList({success:function(){CR.Login.getReceiptConfig({callbackFunction:function(){CR.Core.getWorkAreaConfig({callbackFunction:function(){CR.Settings.getUserRole({callbackFunction:function(d){if(d){CR.Settings.getRoleSettings({roleSerial:d,callbackFunction:function(f){CR.Settings.setCurrentRoleSettings(f);b();}});}else{b();}}});}});}});},failure:function(){CR.Login.performLogin({success:b});}});},failure:function(){CR.Login.performLogin({success:b});}});};CR.Login.setWindowTitle=function(){window.document.title=CR.Login.locationName+" "+CR.DateField.convertToDisplay(CR.Login.postingDate)+" - "+CR.Login.userName;};CR.Login.showKerberosPopup=function(b){b=Ext.apply({logonHTML:"",logOff:false,insertDevicePrompt:false},b);var c=function(){CR.Login.clearValues();try{var h=window.location.href;if(h.length>1&&h.substring(h.length-1)==="#"){h=h.substring(0,h.length-1);}window.location=h;}finally{CR.Core.defer(CR.mainPage);}};if(b.logOff){if(CR.Core.viewPort){CR.Core.viewPort.destroy();CR.Core.viewPort=null;}CR.Core.viewPort=new Ext.Viewport({layout:"fit"});CR.Core.viewPort.doLayout();}var a={autoEl:{tag:"img",src:CR.Core.LOGIN_LOGO}};if(b.logonHTML){a={html:b.logonHTML};}else{if(CR.Login.logonHTML){a={html:CR.Login.logonHTML};}}var d=new CR.FormPanel({labelWidth:80,frame:true,autoWidth:true,autoHeight:true,buttonAlign:"center"});d.add(new Ext.BoxComponent(a));var g=new CR.Checkbox({crColumnDescription:"Insert New Device",crContents:"N",hidden:!b.insertDevicePrompt});d.add(g);d.addButton({text:"Login",handler:function(){f.crHide();if(b.insertDevicePrompt){CR.Login.loginWindow.crKerberosLogin({loginDeviceInsertOption:g.crGetNewContents()});}else{c();}}});d.addButton({text:"Switch User",hidden:!b.logOff,handler:function(){f.crHide();CR.Storage.handler.setItem("cr_kerberosUser",CR.Login.userName);CR.Storage.handler.setItem("cr_switchUser",true);c();}});var f=new CR.Window({title:"You are Logged Off from "+CR.Login.locationName,layout:"fit",autoWidth:true,autoHeight:true,constrain:true,closable:false,resizable:true,plain:true,modal:true,items:[d]});f.crShow();CR.Core.defer(function(){if(f&&!f.crIsDestroyed()){f.center();f.doLayout();}},f,null,400);};CR.Login.performLogoff=function(){var a=function(){CR.Login.clearValues();try{var b=window.location.href;if(b.length>1&&b.substring(b.length-1)==="#"){b=b.substring(0,b.length-1);}window.location=b;}finally{CR.Core.defer(CR.mainPage);}};CR.Settings.saveCurrentUserSettings({callbackFunction:function(){CR.Core.ajaxRequest({url:"UserLogin",params:{logoff:"Y"},crOverride:{suppress:true},crMask:{},success:function(c){CR.Settings.reset();var b=CR.JSON.parse(c.responseText);if(b.success){if(CR.Login.activeDirectoryLogonEnabled){CR.Login.showKerberosPopup({logOff:true});}else{a();}}else{var d=b.exception;if(!d||d.length===0){d=["Unknown Exception"];}CR.Core.displayExceptions({title:"Logoff Failure",items:d,callbackFunction:a});}},failure:function(b){var c="";if(b.status!==0){c="Error "+b.status+" - ";}c+=b.statusText||"Unknown error";CR.Core.displayExceptions({title:"Logoff Failure",items:[c],callbackFunction:a});},crSessionNotFoundHandler:function(b){CR.Core.displayExceptions({title:"Logoff Failure",items:["Session Not Found"],callbackFunction:a});}});}});};CR.Login.resetLogin=function(i){var k="Reset Login or Password";if(i.tableName){k="Set Password for "+i.targetRowDescription;}var g=new CR.FormPanel({title:k,closable:true,frame:true,bodyStyle:"padding:5px 5px 0",autoScroll:true,labelAlign:"left",labelWidth:150,buttonAlign:"left",minButtonWidth:100});var o=[];o.push(["USER","User"]);o.push(["DEVICE","Device"]);o.push(["LOGIN","Login"]);var j=new CR.OptionField({crColumnDescription:"Reset Option",crOptions:o,crContents:i.tableName||"USER",hidden:i.tableName?true:false});var d=new CR.SerialField({crColumnDescription:"User",crNullAllowed:false,crTableName:"USER",crContents:i.tableName==="USER"?i.targetSerial:"",crRowDescription:i.tableName==="USER"?i.targetRowDescription:"",hidden:i.tableName?true:false});var m=new CR.SerialField({crColumnDescription:"Device",crNullAllowed:false,crTableName:"DEVICE",crContents:"",crRowDescription:"",hidden:true});var b=new CR.SerialField({crColumnDescription:"Login",crNullAllowed:false,crTableName:"LOGIN",crContents:i.tableName==="LOGIN"?i.targetSerial:"",crRowDescription:i.tableName==="LOGIN"?i.targetRowDescription:"",hidden:true});var c=new CR.TextField({crColumnDescription:"Old Password",crTextBlankAllowed:false,width:150,inputType:"password",hidden:true});var a=new CR.TextField({crColumnDescription:"New Password",crTextBlankAllowed:true,width:150,inputType:"password"});var h=new CR.TextField({crColumnDescription:"Reenter New Password",crTextBlankAllowed:true,width:150,inputType:"password"});var l=g.addButton({text:i.tableName?"Set Password":"Reset",disabled:true,handler:function(){var q=new CR.XML();var t=q.addContainer(q.getRootElement(),"sequence");var s=q.addContainer(t,"transaction");var r=q.addContainer(s,"step");var p=q.addContainer(r,"securityReset");q.addText(p,"tableName",j.crGetNewContents());if(j.crGetNewContents()==="DEVICE"){q.addSerial(p,"targetSerial",m.crGetNewContents());}else{if(j.crGetNewContents()==="LOGIN"){q.addSerial(p,"targetSerial",b.crGetNewContents());q.addText(p,"newPassword",a.crGetNewContents());}else{q.addSerial(p,"targetSerial",d.crGetNewContents());q.addText(p,"oldPassword",c.crGetNewContents());q.addText(p,"newPassword",a.crGetNewContents());}}CR.Core.ajaxRequest({url:"DirectXMLPost",xmlData:q.getXMLDocument(),crOverride:{disableContainer:g,successIfNotApproved:true},crMask:{container:g},success:function(u){var w=new CR.XML({xmlText:u.responseText});var v="failed";var x;w.beginElement(w.getRootElement());while(!!(x=w.nextSubElement())){if(x.nodeName==="sequence"){w.beginElement(x);while(!!(x=w.nextSubElement())){if(x.nodeName==="transaction"){v=x.getAttribute("result");w.beginElement(x);while(!!(x=w.nextSubElement())){}}}}}if(!g.crIsDestroyed()){if(v!=="posted"){CR.Core.displayExceptions({items:w.getExceptionList()});}else{if(!g.ownerCt.crIsDestroyed()){if(i.container){g.ownerCt.remove(g);}else{f.crClose();}}}}}});}});var n=function(){var p=false;var q=false;if(j.crGetNewContents()==="DEVICE"){if(m.crGetNewContents()){p=true;}}else{if(j.crGetNewContents()==="LOGIN"){if(b.crGetNewContents()){if(a.crGetNewContents()===h.crGetNewContents()){p=true;}else{q=true;}}}else{if(d.crGetNewContents()){if(d.crGetNewContents()===CR.Login.userSerial&&!c.crGetNewContents()){p=false;}else{if(!a.crGetNewContents()&&!h.crGetNewContents()){p=true;}else{if(a.crGetNewContents()===h.crGetNewContents()){p=true;}else{q=true;}}}}}}if(p){l.enable();}else{l.disable();}if(q){a.markInvalid("New password values do not match");h.markInvalid("New password values do not match");}else{a.clearInvalid();h.clearInvalid();}};j.addListener("select",function(){if(j.crGetNewContents()==="USER"){m.crHide();b.crHide();d.crShow();if(d.crGetNewContents()===CR.Login.userSerial){c.crShow();}else{c.crHide();}a.crShow();h.crShow();}else{if(j.crGetNewContents()==="LOGIN"){d.crHide();m.crHide();c.crHide();b.crShow();a.crShow();h.crShow();}else{d.crHide();b.crHide();c.crHide();a.crHide();h.crHide();m.crShow();}}n();});d.addListener("select",function(){if(d.crGetNewContents()===CR.Login.userSerial){c.crShow();}else{c.crSetContents("");c.crHide();}n();});m.addListener("select",n);b.addListener("select",n);c.addListener("keyup",n);a.addListener("keyup",n);h.addListener("keyup",n);g.add(j);g.add(d);g.add(m);g.add(b);g.add(c);g.add(a);g.add(h);g.addListener("beforedestroy",function(){c.crSetContents("");a.crSetContents("");h.crSetContents("");});g.addListener("beforeclose",function(){c.crSetContents("");a.crSetContents("");h.crSetContents("");});if(i.container){CR.Core.addToContainerAndShow(i.container,g);}else{var f=new CR.Window({autoHeight:true,resizable:true,collapsible:false,width:500,items:[g]});f.crShow();f.center();}};CR.Login.refreshSessionID=function(b){b=Ext.apply({callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);var a=new CR.XML();var c=a.addContainer(a.getRootElement(),"sequence");a.addContainer(c,"transaction");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),success:function(f){var d=CR.JSON.parse(f.responseText);var g=d.query;if(g&&g.$attr&&g.$attr.sessionId){CR.Login.sessionID=g.$attr.sessionId;}b.callbackFunction.call(b.callbackScope,b.callbackArgs);}});};CR.Login.securityCheck=function(b){b=Ext.apply({operation:"CHECK",securityEvent:null,securityEventSerial:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},b);var a=new CR.XML();var g=a.addContainer(a.getRootElement(),"sequence");var f=a.addContainer(g,"transaction");var c=a.addContainer(f,"step");var d=a.addContainer(c,"securityCheck");a.addOption(d,"operation",b.operation);if(b.securityEvent){a.addOption(d,"securityEvent",b.securityEvent);}else{if(b.securityEventSerial){a.addSerial(d,"securityEventSerial",b.securityEventSerial);}}CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),scope:this,success:function(i){if(b.operation==="VIEW"){var m=true;var h=CR.JSON.parse(i.responseText);var k="failed";var j=[];var l=h.query;if(l){Ext.each(l.sequence,function(n){Ext.each(n.transaction,function(o){k=o.$attr.result;Ext.each(o.step,function(p){if(p.tranResult&&p.tranResult.category&&p.tranResult.category.option&&p.tranResult.category.option==="E"){j.push(p.tranResult.description);}else{if(p.securityCheck&&p.securityCheck.accessResult&&p.securityCheck.accessResult.option==="D"){m=false;}}},this);},this);},this);}if(k!=="posted"){CR.Core.displayExceptions({items:j});}else{b.callbackFunction.call(b.callbackScope,{success:m});}}else{b.callbackFunction.call(b.callbackScope,{success:true});}},failure:function(){b.callbackFunction.call(b.callbackScope,{success:false});}});};CR.Login.receiptConfig=null;CR.Login.getReceiptConfig=function(a){a=Ext.apply({callbackFunction:CR.Core.emptyFunction,reload:false,callbackScope:this},a);if(CR.Login.receiptConfig===null||a.reload){CR.Core.recordSearch({search:{tableName:"RECEIPT_CONFIG",returnLimit:"1"},callbackFunction:function(b){if(b.record){delete b.record.field;
CR.Login.receiptConfig=b.record;CR.Login.receiptConfigEmailEnabled=CR.Login.receiptConfig["EMAIL_ENABLED"]==="Y";}a.callbackFunction.call(a.callbackScope,CR.Login.receiptConfig);}});}else{a.callbackFunction.call(a.callbackScope,CR.Login.receiptConfig);}};CR.Login.userInterfaceLogonValues=null;CR.Login.getUserInterfaceParameters=function(c){c=Ext.apply({success:CR.Core.emptyFunction,failure:CR.Core.emptyFunction,reload:false,scope:window},c);if(CR.Login.userInterfaceLogonValues&&!c.reload){c.success.apply(c.scope,arguments);}else{var b=new CR.XML();var g=b.addContainer(b.getRootElement(),"sequence");var f=b.addContainer(g,"transaction");var d=b.addContainer(f,"step");var a=b.addContainer(d,"userInterface");b.setAttribute(a,"label","VIEW_LOGON_VALUES");b.addOption(a,"operation","VIEW_LOGON_VALUES");CR.Core.ajaxRequest({url:"LoginUserInterface",xmlData:b.getXMLDocument(),scope:c.scope,crOverride:{},crMask:{suppress:true},success:function(r){var m=CR.JSON.parse(r.responseText);var v=m.query;var q="failed";var w=[];var u={};var n=null;if(m.query){var p=v.sequence;if(p){for(var t=0;t<p.length;t++){var l=p[t].transaction;if(l){for(var s=0;s<l.length;s++){q=l[s].$attr.result;n=l[s].branchSerial;var h=l[s].step;for(var o=0;o<h.length;o++){if(h[o].tranResult&&h[o].tranResult.category&&h[o].tranResult.category.option&&h[o].tranResult.category.option==="E"){w.push(h[o].tranResult.description);}else{if(h[o].userInterface&&h[o].userInterface.$attr&&h[o].userInterface.$attr.label==="VIEW_LOGON_VALUES"){u=h[o].userInterface;}}}}}}}}if(q!=="posted"){CR.Core.displayExceptions({items:w});}else{CR.Login.userInterfaceLogonValues=u;CR.Login.adHocReportingUserName=u.adHocReportingUserName;CR.Login.adHocReportingPassword=u.adHocReportingPassword;CR.Login.adHocReportingDashboardName=u.adHocReportingDashboardName;CR.Login.profileAccessInteractionTypeSerial=u.profileAccessInteractionTypeSerial;CR.Login.accountListInPersonVerification=(u.accountListInPersonVerification&&u.accountListInPersonVerification.option)||"N";CR.Login.voidConfirmation=(u.voidConfirmation&&u.voidConfirmation.option)||"N";CR.Login.personOFACCheckOnInsertUpdate=(u.personOFACCheckOnInsertUpdate&&u.personOFACCheckOnInsertUpdate.option)||"N";CR.Login.personHouseholdCheckOnInsert=(u.personHouseholdCheckOnInsert&&u.personHouseholdCheckOnInsert.option)||"N";CR.Login.personVerificationOption=(u.personVerificationOption&&u.personVerificationOption.option)||"N";CR.Login.institutionLicense=u.institutionLicense||{};CR.Settings.parseUserInterfaceResponse(u);if(n){CR.Core.getRowDescription({tableName:"BRANCH",targetSerial:n,callbackFunction:function(i){CR.Login.branchSerial=n;CR.Login.branchName=i.rowDescription;}});}CR.Login.setupTransactionDenominationTracking();c.success.apply(c.scope,arguments);}},failure:c.failure});}};CR.Login.setupTransactionDenominationTracking=function(){var a=CR.Settings.get("transactionDenominationTracking");if(!a){CR.Login.securityCheck({securityEvent:"CA_WD",operation:"VIEW",callbackFunction:function(b){if(b.success){CR.Settings.set("transactionDenominationTracking","none");}else{CR.Settings.set("transactionDenominationTracking","count");}}});}};CR.SearchPanel=Ext.extend(CR.FormPanel,{crTableName:"",crTableDescription:"",crTableNames:null,crUseCheckboxSelectionModel:false,crInsertButtonCreate:true,crInsertFMPanelContainer:null,crOnTableChange:function(b,a){},crRowSingleSelect:false,crOnSelect:function(a){},crOnSelectionChange:function(a){},crOnResizeEvent:function(){},crFieldWidth:CR.Field.STANDARD_WIDTH,crSuppressPagingToolbarMessage:false,crFMWestPanel:false,title:"Search Options",frame:true,collapsible:true,titleCollapse:true,autoWidth:true,autoScroll:true,constructor:function(a){var g=Ext.apply({},a);CR.SearchPanel.superclass.constructor.call(this,g);this.crSearchListResponseDocument=null;this.crFilterName="";this.crFilterDescription="";var k=[];for(var c=0;c<CR.Core.tableList.length;++c){var j=CR.Core.tableList[c];if(this.crTableNames){if(this.crTableNames.includes(j.tableName)){k.push([j.tableName,j.tableDescription]);}}else{k.push([j.tableName,j.tableDescription]);}if(j.tableName===this.crTableName){this.crTableDescription=j.tableDescription;}}var h=false;if(this.crTableName){h=true;}else{j=CR.Core.findTableByName("PERSON");if(j){this.crTableName=j.tableName;this.crTableDescription=j.tableDescription;}else{this.crTableName=k[0][0];this.crTableDescription=k[0][1];}}var d=new CR.SearchPanel.TableOptionField({crSearchPanel:this,crColumnDescription:"Table",crOptions:k,crContents:this.crTableName,width:this.crFieldWidth,hideLabel:true,typeAheadDelay:500});var b=this;d.addListener("select",function(i){var l=i.crGetNewContents();var m=b.crTableName;if(l!==m){b.crTableName=l;b.crTableDescription=i.crGetOptionDescription(l);b.crOnTableChange(m,l);b.crRefreshSearchMethod();}});var f=new CR.FieldSet({crID:"searchTableSelectFieldSet",crViewGroup:"Table",collapsible:false,hidden:h});f.add(d);this.add(f);this.addListener("render",this.crRefreshSearchMethod);},crGetTableName:function(){return this.crTableName;},crGetTableDescription:function(){return this.crTableDescription;},crFireSelectEvent:function(){if(!this.crIsDestroyed()){var b=CR.Core.findChildByCRID(this,"searchResultsFieldSet");if(b&&!b.crIsDestroyed()){var a=CR.Core.findChildByCRID(b,"searchResultGrid");if(a&&!a.crIsDestroyed()){this.crGridSelectHandler(a);}}}},crRefreshSearchMethod:function(){this.crSearchListResponseDocument=null;this.crFilterName="";this.crFilterDescription="";if(!this.crIsDestroyed()){CR.Core.removeChildByCRID(this,"searchMethodFieldSet");CR.Core.removeChildByCRID(this,"searchParametersFieldSet");CR.Core.removeChildByCRID(this,"searchResultsFieldSet");}var a=new CR.XML();var f=a.addContainer(a.getRootElement(),"sequence");var d=a.addContainer(f,"transaction");var c=a.addContainer(d,"step");var b=a.addContainer(c,"searchList");a.addText(b,"tableName",this.crTableName);CR.Core.ajaxRequest({url:"DirectXMLPost",xmlData:a.getXMLDocument(),scope:this,crOverride:{disableContainer:this},crMask:{container:this},success:function(n){var r=new CR.XML({xmlText:n.responseText});this.crSearchListResponseDocument=r.getXMLDocument();var m="failed";var g="";var v=[];var p;r.beginElement(r.getRootElement());while(!!(p=r.nextSubElement())){if(p.nodeName==="sequence"){r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="transaction"){m=p.getAttribute("result");r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="step"){r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="searchList"){r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="standardFilterName"){g=r.getText(p);}}}else{if(p.nodeName==="search"){var q="";var o="";var t="";r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="filterName"){q=r.getText(p);}else{if(p.nodeName==="filterDescription"){o=r.getText(p);}else{if(p.nodeName==="filterUserInterfaceCategory"){t=r.getOption(p);}}}}if(t!=="S"){v.push([q,o]);}}}}}}}}}}if(m!=="posted"){CR.Core.displayExceptions({items:r.getExceptionList()});}else{if(!this.crIsDestroyed()){if(g!=="BY_SINGLE_ROW"){var s=new CR.OptionField({crColumnDescription:this.crTableDescription+" Search Method",crOptions:v,crContents:g,width:this.crFieldWidth,hideLabel:true});var k=this;s.addListener("select",function(w){if(w.crGetNewContents()!==k.crFilterName){k.crRefreshSearchParameters(w);}});var h=new CR.FieldSet({crID:"searchMethodFieldSet",crViewGroup:this.crTableDescription+" Search Method",collapsible:false,items:[s]});this.add(h);this.crRefreshSearchParameters(s);}else{r=new CR.XML();var l=r.addContainer(r.getRootElement(),"sequence");var j=r.addContainer(l,"transaction");var i=r.addContainer(j,"step");var u=r.addContainer(i,"search");r.addText(u,"tableName",this.crTableName);r.addOption(u,"includeSelectColumns","Y");r.addOption(u,"includeTotalHitCount","Y");r.addCount(u,"returnLimit","10");CR.Core.ajaxRequest({url:"DirectXMLPost",xmlData:r.getXMLDocument(),scope:this,crOverride:{disableContainer:this},crMask:{container:this},success:function(w){var z=new CR.XML({xmlText:w.responseText});var y="failed";var x="";var B="";var A;z.beginElement(z.getRootElement());while(!!(A=z.nextSubElement())){if(A.nodeName==="sequence"){z.beginElement(A);while(!!(A=z.nextSubElement())){if(A.nodeName==="transaction"){y=A.getAttribute("result");z.beginElement(A);while(!!(A=z.nextSubElement())){if(A.nodeName==="step"){z.beginElement(A);while(!!(A=z.nextSubElement())){if(A.nodeName==="search"){z.beginElement(A);while(!!(A=z.nextSubElement())){if(A.nodeName==="resultRow"){z.beginElement(A);while(!!(A=z.nextSubElement())){if(A.nodeName==="serial"){x=z.getSerial(A);}else{if(A.nodeName==="selectColumn"){z.beginElement(A);while(!!(A=z.nextSubElement())){if(A.nodeName==="contents"){B=z.getText(A);}}}}}}}}}}}}}}}if(y!=="posted"||!x){CR.Core.displayExceptions({items:z.getExceptionList()});}else{if(!this.crIsDestroyed()){this.crOnSelect({tableName:this.crTableName,targetSerial:x,rowDescription:B,selectionIndex:0,selectionCount:1});}}}});}}}}});},crRefreshSearchParameters:function(h){if(!this.crIsDestroyed()){this.crFilterName=h.crGetNewContents();this.crFilterDescription=h.crGetOptionDescription(this.crFilterName);CR.Core.removeChildByCRID(this,"searchParametersFieldSet");CR.Core.removeChildByCRID(this,"searchResultsFieldSet");var d=this;var b=new CR.FieldSet({crViewGroup:this.crTableDescription+" Search Parameters",crID:"searchParametersFieldSet",labelAlign:"top",buttonAlign:"left",collapsible:false});var g=new CR.XML({xmlDocument:this.crSearchListResponseDocument});var f;g.beginElement(g.getRootElement());while(!!(f=g.nextSubElement())){if(f.nodeName==="sequence"){g.beginElement(f);while(!!(f=g.nextSubElement())){if(f.nodeName==="transaction"){g.beginElement(f);while(!!(f=g.nextSubElement())){if(f.nodeName==="step"){g.beginElement(f);while(!!(f=g.nextSubElement())){if(f.nodeName==="search"){var j=f;var k="";g.beginElement(f);while(!!(f=g.nextSubElement())){if(f.nodeName==="filterName"){k=g.getText(f);}}if(k===this.crFilterName){g.beginElement(j);while(!!(f=g.nextSubElement())){if(f.nodeName==="parameter"){var c=CR.Field.getFieldFromXML(g,f,{width:this.crFieldWidth});if(c){c.addListener("specialkey",function(l,m){if(m.getKey()===Ext.EventObject.ENTER){d.crInitiateSearch();}});b.add(c);}}}}}}}}}}}}b.addButton({text:"Search",handler:function(){d.crInitiateSearch();}});if(this.crInsertButtonCreate){var a=CR.SearchPanel.createInsertButtonConfig({tableName:this.crTableName,fmPanelContainer:this.crInsertFMPanelContainer});if(a){b.addButton(a);}}this.add(b);if(this.crTableName==="TABLES"){var i=new CR.Button({text:"Browse",tooltip:"Open Table Browser...",width:56,handler:function(){CR.TableBrowser.developerSecurityCheck({callbackFunction:function(l){CR.TableBrowser.show({container:CR.FMPanel.getDefaultContainer(),crDeveloperMode:l});}});}});b.addButton(i);}this.doLayout();this.crOnResizeEvent();b.getComponent(0).focus(false,true);}},crInitiateSearch:function(){if(!this.crIsDestroyed()){CR.Core.removeChildByCRID(this,"searchResultsFieldSet");var z=CR.Core.findChildByCRID(this,"searchParametersFieldSet");var j=new CR.XML();var u=j.addContainer(j.getRootElement(),"sequence");var B=j.addContainer(u,"transaction");var q=j.addContainer(B,"step");var v=j.addContainer(q,"search");j.addText(v,"tableName",this.crTableName);j.addText(v,"filterName",this.crFilterName);j.addOption(v,"includeSelectColumns","Y");j.addOption(v,"includeTotalHitCount","Y");j.addCount(v,"returnLimit","10");if(z){for(var A=0;A<z.items.getCount();++A){var b=z.getComponent(A);if(b.crGetNewContents){var m=j.addContainer(v,"parameter");j.addText(m,"columnName",b.crGetColumnName());j.addText(m,"contents",b.crGetNewContents());}}}var t=j;j=new CR.XML({xmlDocument:this.crSearchListResponseDocument});var E=0;var x=[];x.push({name:"serial"});var F=[];var f;j.beginElement(j.getRootElement());while(!!(f=j.nextSubElement())){if(f.nodeName==="sequence"){j.beginElement(f);while(!!(f=j.nextSubElement())){if(f.nodeName==="transaction"){j.beginElement(f);while(!!(f=j.nextSubElement())){if(f.nodeName==="step"){j.beginElement(f);while(!!(f=j.nextSubElement())){if(f.nodeName==="search"){var s=f;var w="";j.beginElement(f);while(!!(f=j.nextSubElement())){if(f.nodeName==="filterName"){w=j.getText(f);}}if(w===this.crFilterName){j.beginElement(s);while(!!(f=j.nextSubElement())){if(f.nodeName==="selectColumn"){var k="";var g="";var y="";j.beginElement(f);while(!!(f=j.nextSubElement())){switch(f.nodeName){case"columnName":k=j.getText(f);break;case"columnDescription":g=j.getText(f);break;case"dataType":y=j.getOption(f);break;}}x.push({name:k});F.push({header:g,dataIndex:k,renderer:function(I,G,i){var H=CR.Core.safeGet(i,["json","rowStatus","option"]);switch(H){case"C":G.css+="cr-rowStatus-closed";break;case"O":G.css+="cr-rowStatus-chargedOff";break;case"V":G.css+="cr-rowStatus-voided";break;case"E":G.css+="cr-rowStatus-expired";break;case"F":G.css+="cr-rowStatus-effectiveInFuture";break;}return I;}});++E;}}}}}}}}}}}var l=new Ext.data.JsonReader({root:"resultRows",totalProperty:"totalHitCount",id:"serial"},x);var D;if(this.crUseCheckboxSelectionModel){D=new Ext.grid.CheckboxSelectionModel({singleSelect:false});F.splice(0,0,D);}var r=new Ext.grid.ColumnModel(F);var C=this;var p=new Ext.data.Store({autoDestroy:true,baseParams:{crXMLData:t.getXMLDocument()},proxy:new CR.Core.AjaxProxy({url:"SearchJSON",crOverride:{disableContainer:this},crMask:{suppress:true}}),listeners:{loadexception:function(H,G,i){CR.Core.ajaxErrorHandler(i);}},reader:l});var a=this;var d=true;var n="Results {0} - {1} of {2}";var o="No matches to display";if(this.crSuppressPagingToolbarMessage){d=false;n="";o="";}var h=new CR.GridPanel({crID:"searchResultGrid",crRowSingleSelect:this.crRowSingleSelect,autoHeight:true,autoWidth:true,store:p,cm:r,sm:D,bbar:new Ext.PagingToolbar({pageSize:10,store:p,displayInfo:d,displayMsg:n,emptyMsg:o}),listeners:{click:function(){a.crOnSelectionChange(h.getSelectionModel());},rowclick:function(){if(a.crRowSingleSelect){a.crGridSelectHandler(h);}},dblclick:function(){a.crGridSelectHandler(h);}},keys:{key:Ext.EventObject.ENTER,handler:function(){a.crGridSelectHandler(h);}}});var c=new CR.FieldSet({crID:"searchResultsFieldSet",crViewGroup:this.crFilterDescription+" Search Results",collapsible:false});c.add(h);this.add(c);this.doLayout();p.load({params:{start:0,limit:10},callback:function(){if(!a.crIsDestroyed()&&!h.crIsDestroyed()){a.crOnResizeEvent();var i=h.getSelectionModel();if(this.getCount()===1){if(!a.crUseCheckboxSelectionModel){i.selectFirstRow();}a.crGridSelectHandler(h);}else{if(this.getCount()>0){if(!a.crUseCheckboxSelectionModel){i.selectFirstRow();}a.crOnSelectionChange(i);h.getView().focusRow(0);}}}}});}},crGridSelectHandler:function(a){if(!this.crIsDestroyed()&&!a.crIsDestroyed()){var c=a.getSelectionModel().getSelections();for(var b=0;b<c.length;++b){this.crFinalSelectProcess(c[b],b,c.length);}}},crFinalSelectProcess:function(f,a,b){if(!a&&!b){a=0;b=1;}var c=f.data.serial;var d=f.data.ROW_DESCRIPTION;this.crOnSelect({tableName:this.crTableName,targetSerial:c,rowDescription:d,selectionIndex:a,selectionCount:b});}});CR.SearchPanel.openWindow=function(c){if(!CR.Core.tableList||!CR.Core.tableList.length){function b(){CR.SearchPanel.openWindow(c);}CR.Core.retrieveTableList({success:b,failure:function(){CR.Login.performLogin({success:b});}});return;}var g=null;if(c.parentComponent){g=c.parentComponent.crSearchWindow;}if(!g){var h="select";g=new CR.Window({title:c.tableDescription+" Inquiry",width:500,height:400,modal:true});if(c.parentComponent){c.parentComponent.crSearchWindow=g;}g.addListener("beforedestroy",function(){if(c.parentComponent){c.parentComponent.crSearchWindow=null;}if(c.callbackFunction){c.callbackFunction.call(c.callbackScope,{mode:"destroy"});}});if(c.clearButtonCreate&&c.callbackFunction){g.addButton({text:"Clear",handler:function(){c.callbackFunction.call(c.callbackScope,{mode:"clear",serial:"",rowDescription:""});
g.crClose();}});}var f=CR.SearchPanel.createInsertButtonConfig({tableName:c.tableName,callbackFunction:c.callbackFunction,callbackScope:c.callbackScope,onFMPanelLoad:function(j){if(j){g.crClose();}}});if(f){g.addButton(f);}var i=g.addButton({text:"Select",disabled:true,handler:function(){if(a){h="select";a.crFireSelectEvent();}}});var d=g.addButton({text:"View Selections",disabled:true,handler:function(){if(a){h="view";a.crFireSelectEvent();}}});g.addButton({text:"Cancel",handler:function(){g.crClose();}});var a=new CR.SearchPanel({header:false,crTableName:c.tableName,crTableDescription:c.tableDescription,crInsertButtonCreate:false,crOnSelect:function(j){if(h==="view"){if(c.containerForViewSelections){CR.FMPanel.open({container:c.containerForViewSelections,fmRequest:{requestType:"update",tableName:j.tableName,targetSerial:j.targetSerial}});}}else{if(c.callbackFunction){c.callbackFunction.call(c.callbackScope,{mode:"select",serial:j.targetSerial,rowDescription:j.rowDescription});}}if(j.selectionIndex===j.selectionCount-1){CR.Core.defer(function(){g.crClose();});}},crOnSelectionChange:function(j){var k=j.getSelections().length;if(d){if(k>0){d.enable();}else{d.disable();}}if(i){if(k===1){i.enable();}else{i.disable();}}},crOnResizeEvent:function(){var m=125;var j=225;if(this.items){for(var l=0;l<this.items.getCount();++l){var k=this.getComponent(l).getSize();m+=k.height;if(k.width>j){j=k.width+50;}}}if(j>500){j=500;}k=g.getSize();if(m>k.height||j>k.width){g.setSize({height:m,width:j});g.center();}}});g.add(a);}g.crShow();return g;};CR.SearchPanel.createInsertButtonConfig=function(a){var b=null;var c=CR.Core.findTableByName(a.tableName);if(c&&!c.parentTableName){b={text:"Insert New",handler:function(){var d=null;var g=a.fmPanelContainer;if(!g){d=new CR.Window({title:"Insert "+c.tableDescription,modal:true,autoScroll:true,width:500,autoHeight:true,constrain:true,listeners:{afterlayout:function(){var i=Ext.getBody().getHeight();var h=this.getSize().height;if(h>i){this.autoHeight=false;this.setHeight(i-50);}this.center();}},crWinResizeHandler:function(){var j=this.getComponent(0).getEl().getHeight();var i=this.getInnerHeight();var l=this.getFrameHeight();if(j<i){this.setHeight(j+l);}var k=Ext.getBody().getHeight();var h=this.getSize().height;if(h>k){this.autoHeight=false;this.setHeight(k-50);}this.center();}});g=d;}var f=false;if(d){f=true;}if(c.tableName==="PERSON"&&!CR.Script){CR.PersonCreate({container:g});}else{CR.FMPanel.open({container:g,fmRequest:{requestType:"insert",tableName:c.tableName},fmPanelConfig:{crPanelTitleSuppress:f,crOnFMPostSuccess:function(h){if(a.callbackFunction){a.callbackFunction.call(a.callbackScope,{mode:"insert",serial:h.crGetTargetSerial(),rowDescription:h.crGetRowDescription()});}if(g.crFMWestPanel){var i=new CR.TreeViewPanel({crTableName:c.tableName,crTargetSerial:h.crGetTargetSerial(),crRowDescription:h.crGetRowDescription(),crFMPanelContainer:g,crHistoryContainer:g});this.ownerCt.crFMWestPanel.add(i);this.ownerCt.crFMWestPanel.setActiveTab(i);i.crInitializeRecordTree();}if(d){d.crClose();}else{h.crRefreshRecordInquiry();}}},onFMPanelLoad:function(h){if(d){if(!h){d.crClose();}else{d.crShow();}}if(a.onFMPanelLoad){a.onFMPanelLoad(h);}}});}}};}return b;};CR.SearchPanel.TableOptionField=Ext.extend(CR.OptionField,{initComponent:function(){CR.SearchPanel.TableOptionField.superclass.initComponent.call(this);this.triggerConfig={tag:"span",cls:"x-form-twin-triggers",style:"padding-right:2px",cn:[{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger"},{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-form-trigger cr-batch-trigger"}]};},getTrigger:function(a){return this.triggers[a];},initTrigger:function(){var a=this;var b=a.trigger.select(".x-form-trigger",true);a.wrap.setStyle("overflow","hidden");b.each(function(d,g,c){d.hide=function(){var h=a.wrap.getWidth();a.dom.style.display="none";a.el.setWidth(h-a.trigger.getWidth());};d.show=function(){var h=a.wrap.getWidth();a.dom.style.display="";a.el.setWidth(h-a.trigger.getWidth());};var f="Trigger"+(c+1);if(a["hide"+f]){d.dom.style.display="none";}d.on("click",a["on"+f+"Click"],a,{preventDefault:true});d.addClassOnOver("x-form-trigger-over");d.addClassOnClick("x-form-trigger-click");},a);a.triggers=b.elements;},onTrigger1Click:function(){this.onTriggerClick();},onTrigger2Click:function(d){var g=this;var a=[];var c=CR.Settings.getRecentRows();var h=new CR.MenuTextItem({text:"<b>Recently Accessed "+CR.Core.htmlText(this.crGetOptionDescription(this.crGetNewContents()))+" Records</b>"});a.push(h);for(var b=0;b<c.length;b++){if(c[b].tableName===this.crGetNewContents()){a.push(new CR.MenuItem({text:c[b].rowDescription,crRowDescription:c[b].rowDescription,crTableName:c[b].tableName,crTargetSerial:c[b].targetSerial,handler:function(){if(g.crSearchPanel){CR.Settings.checkForValidRecord({tableName:this.crTableName,targetSerial:this.crTargetSerial,rowDescription:this.crRowDescription,callbackFunction:g.crSearchPanel.crFinalSelectProcess,callbackScope:g.crSearchPanel,callbackArgs:{data:{serial:this.crTargetSerial,ROW_DESCRIPTION:this.crRowDescription}}});}}}));}}var f=new CR.Menu({items:a});f.addListener("hide",f.destroy,f);f.showAt(d.getXY());}});CR.SearchPanel.toggleReversibleList=function(j,f,b,i){var h=j||window.event;if(h.target===f){h.stopPropagation();var g="personVerification.sort"+b+"List";var c=CR.Settings.getUserSetting(g);f.classList.remove(c);var l;var a="Default order";switch(c){case"descending":a="Placement Time ascending";c="ascending";l=function(o,n){return +o.getAttribute("serial")-+n.getAttribute("serial");};break;case"ascending":a="Default order";c="default";l=function(o,n){return +o.getAttribute("ordinal")-+n.getAttribute("ordinal");};break;default:a="Placement Time descending";c="descending";l=function(o,n){return +n.getAttribute("serial")-+o.getAttribute("serial");};break;}CR.Settings.setUserSetting(g,c);f.setAttribute("title",a);f.classList.add(c);if(!f.targetEl){var k=document.getElementById(i);f.targetEl=k;}if(f.targetEl){var d=f.targetEl.children;var m=true;Array.from(d).sort(l).forEach(function(n){n.classList.remove("trEven");n.classList.remove("trOdd");n.classList.add(m?"trOdd":"trEven");f.targetEl.appendChild(n);m=!m;});}}};CR.SearchPanel.getReversibleListParams=function(){var d=CR.Settings.getUserSetting("personVerification",{});var c={};for(var a in d){if(/sort\w+List/.test(a)){var b=d[a];if(b){c[a]=b;}}}return c;};CR.SearchPanel.serialDetailInquiry=function(f,c,d,g,h){var b=null;var a="update";if(h){a="insert";}if(f){b=Ext.getCmp(f);}else{b=new CR.Window({closable:true,height:600,autoScroll:true,modal:true,onEsc:Ext.emptyFn,crCloseListener:function(){CR.TransactionPanel.SearchPanel.refreshSearchHtml({fmContainerID:f,refreshContainerId:g});}});if(g){b.addListener("close",b.crCloseListener,b);}}if(b&&!b.crIsDestroyed()){CR.FMPanel.open({container:b,fmRequest:{requestType:a,tableName:c,targetSerial:d,parentSerial:h}});}};CR.SearchPanel.displayTransactionHistory=function(b){b=Ext.apply({container:CR.FMPanel.defaultContainer,userSerial:CR.Login.userSerial,postingDate:CR.Login.postingDate,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);var a=this;CR.Interface.checkAll({functions:[CR.PSCUService.checkForInterface,CR.FICSService.checkForInterface,CR.MViServices.checkForInterfaces,CR.HylandServices.checkForInterface,CR.Alloya.checkForInterface,CR.PaylogicCheckImage.checkForInterface,CR.HeartlandLeagueCheckImage.checkForInterface,CR.BluepointImagePoint.checkForInterface,CR.VSoftCheckImaging.checkForInterface,CR.Vertifi.checkForInterface,CR.SynergyService.checkForInterface,CR.NorthwestBankCheckImage.checkForInterface],callbackFunction:function(){var d=b.container||CR.FMPanel.getDefaultContainer();var g=new CR.XML();var j=g.addContainer(g.getRootElement(),"sequence");var i=g.addContainer(j,"transaction");var h=g.addContainer(i,"step");var f=g.addContainer(h,"tranHistory");var c=g.addContainer(f,"userList");g.addSerial(c,"userSerial",b.userSerial);g.addDate(f,"postingDateMinimum",b.postingDate||"");g.addDate(f,"postingDateMaximum",b.postingDate||"");g.addOption(f,"orderOption","RT");g.addOption(f,"reportOption","ALL");g.addOption(f,"includeCompleteTransaction","Y");g.addCount(f,"returnLimit","20");CR.Core.ajaxRequest({url:"TranHistoryHTML",xmlData:g.getXMLDocument(),scope:a,params:CR.CheckView.addInterfaceParameters({fmPanelContainerID:d.getId(),voidContainerID:d.getId(),isHistory:true}),crMask:{container:d},success:function(k){CR.HistorySearchPanel.displayHistory({container:d,fmPanelContainerID:d.getId(),xmlDocument:g.getXMLDocument(),historyHTML:k.responseText});b.callbackFunction.call(b.callbackScope,b.callbackArgs);}});}});};CR.SearchPanel.displayCheckHistory=function(d){d=Ext.apply({container:CR.FMPanel.defaultContainer,personSerial:"",callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},d);var a=d.container||CR.FMPanel.getDefaultContainer();var c=new CR.XML();var i=c.addContainer(c.getRootElement(),"sequence");var h=c.addContainer(i,"transaction");var f=c.addContainer(h,"step");var b=c.addContainer(f,"tranHistory");c.addText(b,"personSerial",d.personSerial);c.addOption(b,"orderOption","RT");c.addOption(b,"reportOption","GLT");c.addOption(b,"includeCompleteTransaction","Y");c.addOption(b,"glCategoryFilterOption","Y");var g=c.addContainer(b,"glCategoryList");c.addOption(g,"glCategory","KR");g=c.addContainer(b,"glCategoryList");c.addOption(g,"glCategory","UK");g=c.addContainer(b,"glCategoryList");c.addOption(g,"glCategory","UD");g=c.addContainer(b,"glCategoryList");c.addOption(g,"glCategory","BK");c.addOption(b,"glOriginalEntryOption","O");c.addCount(b,"returnLimit","1000");CR.Core.ajaxRequest({url:"TranHistoryHTML",xmlData:c.getXMLDocument(),scope:this,params:{fmPanelContainerID:a.getId(),voidContainerID:a.getId(),isHistory:true},crMask:{container:a},success:function(j){CR.HistorySearchPanel.displayHistory({container:a,fmPanelContainerID:a.getId(),xmlDocument:c.getXMLDocument(),historyHTML:j.responseText});d.callbackFunction.call(d.callbackScope,d.callbackArgs);}});};CR.PersonSearch=Ext.extend(CR.Panel,{crParentContainer:null,crSearchWindow:null,crInTransaction:false,crQueryField:null,crQueryType:null,crQueryFieldContents:"",crQueryTypeContents:"",crFMContainerID:"",crRefreshContainerId:"",crRenderToContainerId:"",crCallbackFunction:null,crCallbackArgs:null,crCallbackNoPersonFoundFunction:null,crCallbackAccountSelectFunctionScope:null,crCallbackScope:null,crTitle:"Person Search",crForceDisplayResults:false,crOnOpenSearchPersonByName:null,crOnOpenSearchAccountSerial:null,crOnOpenSearchPersonByAccountNumber:null,crOnOpenSearchPersonByPhoneNumber:null,crExcludeSerials:[],crDisableUserQueries:false,border:false,modal:true,constructor:function(c){var i=Ext.apply({},c);i.crCallbackArgs=i.crCallbackArgs||{};this.crDisableUserQueries=!!i.crDisableUserQueries;var d=new CR.TextField({emptyText:"Search",crContents:i.crQueryFieldContents,disabled:this.crDisableUserQueries});var l=[];l.push(["LAST_FIRST_MIDDLE_NAME","By Name"]);l.push(["TIN","By TIN"]);l.push(["DRIVER_LICENSE","By Drivers License Number"]);l.push(["PHONE_NUMBER","By Phone Number"]);l.push(["EMAIL_ADDRESS","By Email Address"]);l.push(["ACCOUNT_NUMBER","By Account Number"]);l.push(["CARD_NUMBER","By Card Number"]);l.push(["CARD_NUMBER_TRAILING_DIGITS","By Card Number Trailing Digits"]);l.push(["APPLICATION_NUMBER","By Application Number"]);l.push(["VIN","By Vehicle ID Number"]);l.push(["ACCOUNT_INDEX","By Account Index"]);l.push(["DRAFT_LOOKUP","By "+CR.Login.draftCheckText+" Lookup"]);l.push(["EXTERNAL_ACCOUNT_NUMBER","By External Account Number"]);l.push(["SERIAL","By Person Serial"]);var h=new CR.OptionField({width:175,crOptions:l,crContents:i.crQueryTypeContents,disabled:this.crDisableUserQueries});var k=new CR.ToolbarButton({text:"Search",disabled:this.crDisableUserQueries});var j=new CR.ToolbarButton({text:"Insert New",disabled:!!CR.Script||this.crDisableUserQueries});var f=new CR.ToolbarButton({text:"No Person Selected",hidden:true});var b=new Ext.Toolbar.Separator({hidden:true});var g=new CR.ToolbarButton({text:"Close"});i.tbar=[d,h,k,"-",j,"-",f,b,g];this.crExcludeSerials=[];CR.SearchPanel.superclass.constructor.call(this,i);d.addListener("keyup",function(o,q){var r=d.crGetNewContents();if(r){if(r.indexOf("%E?")===0||r.indexOf("+E?")===0||r.indexOf("E?")===0){r="";o.crSetContents(r);}}var n=h.crGetNewContents();var m=CR.PersonSearch.determineFilter(r,n);var p=m.newFilter;if(p!==n){h.crSetContents(p);}if(m.cardNumber){d.crSetContents(m.cardNumber);}},this);d.addListener("specialkey",this.crFieldSpecialKeyListener,this);h.addListener("specialkey",this.crFieldSpecialKeyListener,this);g.addListener("click",this.crCloseSearch,this);k.addListener("click",this.crInitiateQuery,this);j.addListener("click",this.crInsertNew,this);this.crQueryField=d;this.crQueryType=h;this.crNoPersonSelectedButton=f;if(this.crInTransaction){f.show();b.show();f.addListener("click",function(){if(this.crQueryType&&this.crQueryType.crGetNewContents()==="ACCOUNT_NUMBER"){if(this.crCallbackAccountSelectFunction&&this.crCallbackAccountSelectFunctionScope){this.crCallbackAccountSelectFunction.call(this.crCallbackAccountSelectFunctionScope,{accountNumber:this.crQueryField.crGetNewContents(),personNotSelected:true});}}else{var m=Ext.getCmp(i.crRefreshContainerId);m.crClearAll();m.crPersonNotSelected=true;m.crTranPrompts.crFocusFirstField();}this.crCloseSearch();},this);}if(this.crParentContainer){this.crParentContainer.add(this);if(this.crParentContainer.setActiveTab){this.crParentContainer.setActiveTab(this);}}else{var a=new CR.Window({title:this.crTitle,items:[this],modal:true,renderTo:i.crRenderToContainerId,width:1000});if(this.crParentComponent){this.crParentComponent.crSearchWindow=a;a.addListener("beforedestroy",function(){this.crParentComponent.crSearchWindow=null;if(!this.crParentComponent.crIsDestroyed()&&this.crParentComponent.focus){this.crParentComponent.focus(false,true);}});}a.crShow();this.crSearchWindow=a;}if(this.crQueryFieldContents&&this.crQueryTypeContents){this.crInitiateQuery();}else{d.focus(true,500);}},crSetResultAndClose:function(a){if(this.crCallbackFunction){this.crCallbackArgs.data=a;this.crCallbackFunction.call(this.crCallbackScope,this.crCallbackArgs);}this.crCloseSearch();},crCloseSearch:function(){if(this.crSearchWindow){this.crSearchWindow.crClose();}},crFieldSpecialKeyListener:function(b,c){var a=c.getKey();if(a===Ext.EventObject.ENTER){this.crInitiateQuery();}},crInsertNew:function(){var a=this.crQueryType.crGetNewContents();var c=this;var b=new CR.Window({height:600,autoWidth:true,modal:true,autoScroll:true,crInsertCallbackFunction:function(d){c.crSetResultAndClose(d);}});CR.PersonCreate({crRenderToContainerId:this.crRenderToContainerId,crNewPersonPanelConfig:{crDefaultString:a==="LAST_FIRST_MIDDLE_NAME"?this.crQueryField.crGetNewContents():null,crCallbackFunction:b.crInsertCallbackFunction,crCallbackFunctionScope:b}});},crInitiateQuery:function(){var v=this;CR.Core.clearContainer(this);var q=this.crQueryType.crGetNewContents();var a=this;var f=new CR.XML();var o=f.addContainer(f.getRootElement(),"sequence");var s=f.addContainer(o,"transaction");var l=f.addContainer(s,"step");var p=f.addContainer(l,"search");f.addText(p,"tableName","PERSON");f.addText(p,"formatName","VERIFICATION");f.addText(p,"filterName","BY_"+q);f.addOption(p,"includeSelectColumns","N");f.addOption(p,"includeTotalHitCount","Y");f.addCount(p,"returnLimit","5");var g=f.addContainer(p,"parameter");if(q==="ACCOUNT_INDEX"){f.addText(g,"columnName","VALUE");f.addText(g,"contents",this.crQueryField.crGetNewContents());}else{if(q==="DRAFT_LOOKUP"){f.addText(g,"columnName","DRAFT_LOOKUP_ACCOUNT_NUMBER");f.addText(g,"contents",this.crQueryField.crGetNewContents());}else{f.addText(g,"columnName",this.crQueryType.crGetNewContents());f.addText(g,"contents",this.crQueryField.crGetNewContents());}}var r=[{name:"serial"},{name:"rowDescription"},{name:"email"},{name:"personInfo"},{name:"addressInfo"},{name:"contactInfo"},{name:"imageInfo"},{name:"idInfo"},{name:"toolTiphtml"},{name:"labelText"},{name:"selectHtml"}];
var h=new Ext.data.JsonReader({root:"resultRows",totalProperty:"totalHitCount",id:"serial"},r);var i=function(w){var x=0;if(Array.isArray(v.crExcludeSerials)){w.getRange().forEach(function(y,z){for(var B=0;B<v.crExcludeSerials;B++){if(v.crExcludeSerials[B]===y.data.serial){y.json.crDisabled=true;var A=c.getView().getRow(z);if(A){A.style.cssText="opacity: 0.5; pointer-events: none";}if(z===x){x++;}break;}}});}return x;};var k=new Ext.data.Store({autoDestroy:true,baseParams:Object.assign({crXMLData:f.getXMLDocument(),searchType:this.crQueryType.crGetNewContents(),fmContainerID:this.crFMContainerID,refreshContainerId:this.crRefreshContainerId,additionalFilterByPhoneNumber:this.crOnOpenSearchPersonByPhoneNumber},CR.SearchPanel.getReversibleListParams()),proxy:new CR.Core.AjaxProxy({url:"PersonVerificationSearch",crOverride:{disableContainer:this},crMask:{suppress:true}}),listeners:{load:function(w){i(w);},loadexception:function(y,x,w){CR.Core.ajaxErrorHandler(w);}},reader:h});var m=function(A,x,w,B,z,y){x.attr='ext:qtip="'+CR.Core.htmlText(w.data.toolTiphtml[z].text)+'"';return A;};var b=[{header:"Image",dataIndex:"imageInfo",width:150,renderer:m},{header:"Personal",dataIndex:"personInfo",width:200,renderer:m},{header:"Address",dataIndex:"addressInfo",width:200,renderer:m},{header:"Contact",dataIndex:"contactInfo",width:250,renderer:m},{header:"ID",dataIndex:"idInfo",width:200,renderer:m}];if(CR.Login.accountListInPersonVerification&&CR.Login.accountListInPersonVerification==="Y"){var d=function(B,x,w,C,z,y){var A=w.data.serial;B='<img src="images/Icons/information.png" onmouseover="CR.PersonSearch.getAssociatedAccountsQTip(event,\''+A+"','"+v.getId()+'\')" height="16" width="16">';return B;};b.push({header:"Info",dataIndex:"",width:50,renderer:d});}var j=new Ext.grid.ColumnModel({columns:b});var n=j;var u=new Ext.PagingToolbar({pageSize:5,store:k,displayInfo:true,displayMsg:"Results {0} - {1} of {2}",emptyMsg:"No matches to display",listeners:{render:function(){}}});var t=function(){setTimeout(function(){var w=c.getSelectionModel();var x=w.getSelected().data;if(c.tooltip){c.tooltip.hide();}a.crSetResultAndClose(x);});};var c=new CR.GridPanel({border:false,autoHeight:true,autoWidth:true,store:k,enableColumnHide:false,enableColumnMove:false,cm:n,bbar:u,listeners:{rowdblclick:function(w,y,x){x.stopPropagation();t();}},keys:{key:Ext.EventObject.ENTER,handler:function(){t();}}});this.add(c);this.doLayout();k.load({params:{start:0,limit:5},callback:function(){if(this.getCount()>0&&!c.crIsDestroyed()){var x=i(k);if(x<this.getCount()){var w=c.getSelectionModel();w.selectRow(x);if(!a.crForceDisplayResults&&this.getTotalCount()===1&&a.crQueryType.crGetNewContents()!=="ACCOUNT_NUMBER"){CR.Core.defer(t);}else{a.crSearchWindow.center();CR.Core.defer(function(){if(!c.crIsDestroyed()){c.getView().focusRow(0);c.getView().focusRow(0);}},null,null,100);}}else{if(v.crCallbackNoPersonFoundFunction&&v.crCallbackAccountSelectFunctionScope){v.crCallbackNoPersonFoundFunction.call(v.crCallbackAccountSelectFunctionScope,{personSearchPanel:v});}}}else{if(this.getCount()===0&&v.crCallbackNoPersonFoundFunction&&v.crCallbackAccountSelectFunctionScope){v.crCallbackNoPersonFoundFunction.call(v.crCallbackAccountSelectFunctionScope,{personSearchPanel:v});}}}});}});CR.PersonSearch.getAssociatedAccountsQTip=function(i,d,j){var a=Ext.getCmp(j);var g=new CR.XML();var f=g.addContainer(g.getRootElement(),"sequence");var c=g.addContainer(f,"transaction");var b=g.addContainer(c,"step");var h=g.addContainer(b,"postingStatus");g.addText(h,"tableName","PERSON");g.addSerial(h,"targetSerial",d);CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:g.getXMLDocument(),params:{},scope:this,success:function(n){var H=CR.JSON.parse(n.responseText);var t=H.query;var o="failed";var l=[];var u=null;if(H.query){var w=t.sequence;if(w){for(var F=0;F<w.length;F++){var G=w[F].transaction;if(G){for(var D=0;D<G.length;D++){o=G[D].$attr.result;var v=G[D].step;if(v){for(var C=0;C<v.length;C++){if(v[C].postingStatus){u=v[C].postingStatus;}else{if(v[C].tranResult&&v[C].tranResult.category&&v[C].tranResult.category.option&&v[C].tranResult.category.option==="E"){l.push(v[C].tranResult.description);}}}}}}}}}if(o!=="posted"){CR.Core.displayExceptions({items:l});}else{var q=d;var x=u.account;var r=true;var z='<font style="font-weight: bold;">No accounts found.</font>';if(x){z="";for(D=0;D<x.length;D++){if(p){z+="<hr>";}var p=x[D];z+='<font style="font-weight: bold;"> Account '+p.accountNumber;if(p.relationshipDescription){z+=" "+CR.Core.htmlText(p.relationshipDescription);}z+="</font>";if(p.share){z+="<br>&nbsp;&nbsp;&nbsp;&nbsp;Share(s)";for(F=0;F<p.share.length;F++){var E=p.share[F];var I=E.id+" "+E.description;if(q){r=CR.TransactionPanel.InformationPanel.crCheckIfOwner(E,q);}if(r){z+="<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+CR.Core.htmlText(I);}}}if(p.loan){z+="<br>&nbsp;&nbsp;&nbsp;&nbsp;Loan(s)";for(F=0;F<p.loan.length;F++){var s=p.loan[F];var m=s.id+" "+s.description;if(q){r=CR.TransactionPanel.InformationPanel.crCheckIfOwner(s,q);}if(r){z+="<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+CR.Core.htmlText(m);}}}}}if(a.crExistingMenu){a.crExistingMenu.destroy();a.crExistingMenu=null;}var y=i.clientX+20;var A=i.clientY;var B=new CR.Tip({crIsMouseOver:true,crMouseOverTracker:0,crLastMouseTracker:0,html:z,bodyStyle:"padding:2px;",shadow:"drop",crTimeoutFunction:function(){CR.Core.defer(function(){if(B&&!B.crIsDestroyed()){if(B.crLastMouseTracker===B.crMouseOverTracker){a.crExistingMenu.destroy();a.crExistingMenu=null;}else{B.crLastMouseTracker=B.crMouseOverTracker;B.crTimeoutFunction();}}},B,null,3000);}});B.addListener("afterlayout",function(){var k=B.el;k.addListener("mouseleave",function(){a.crExistingMenu.destroy();a.crExistingMenu=null;});k.addListener("mouseover",function(){B.crMouseOverTracker=B.crMouseOverTracker+1;});var M=CR.Core.viewPort.getOuterSize().width;var O=CR.Core.viewPort.getOuterSize().height;var N=y+B.getWidth();var J=A+B.getHeight();if(M<N||O<J){var L=y;var K=A;if(M<N){L=M-B.getWidth();}if(O<J){K=O-B.getHeight();}B.setPagePosition(L,K);k.addListener("mouseleave",function(){a.crExistingMenu.destroy();a.crExistingMenu=null;});k.addListener("mouseover",function(){B.crMouseOverTracker=B.crMouseOverTracker+1;});}});B.showAt([y,A]);a.crExistingMenu=B;B.crTimeoutFunction();}}});};CR.PersonSearch.openWindow=function(b){var c=null;if(b.crParentComponent){c=b.crParentComponent.crSearchWindow;}b.crParentContainer=null;if(!c){var a=new CR.PersonSearch(b);c=a.crSearchWindow;}return c;};CR.PersonSearch.determineFilter=function(b,c){var l="";var h=true;var j=0;var k=false;var g=false;var m=null;for(var f=0;f<b.length;++f){var a=b.charAt(f);if(a>="0"&&a<="9"){a="9";}else{h=false;if(a==="@"){j+=1;}else{if(a===" "){k=true;}else{if(a==="."&&j===1){g=true;}}}}l+=a;}var d=c;if(l.length>=1){if(k===false&&b.length===17){if(d==="LAST_FIRST_MIDDLE_NAME"||d==="PHONE_NUMBER"||d==="TIN"||d==="EMAIL_ADDRESS"||d==="ACCOUNT_NUMBER"||d==="CARD_NUMBER"){d="VIN";}}else{if((h&&b.length>10)||(b.substring(0,2)==="%B"&&b.substring(b.length-1,b.length)==="?")||(b.substring(0,1)===";"&&b.substring(b.length-1,b.length)==="?")){if(d==="LAST_FIRST_MIDDLE_NAME"||d==="PHONE_NUMBER"||d==="TIN"||d==="EMAIL_ADDRESS"||d==="ACCOUNT_NUMBER"||d==="VIN"){d="CARD_NUMBER";if(b.substring(0,2)==="%B"&&b.substring(b.length-1,b.length)==="?"){m=b.split("?;")[1].split("=")[0];}else{if(b.substring(0,1)===";"&&b.substring(b.length-1,b.length)==="?"){m=b.split("=")[0];m=m.replace(";","");}}}}else{if(h){if(d==="LAST_FIRST_MIDDLE_NAME"||d==="PHONE_NUMBER"||d==="TIN"||d==="EMAIL_ADDRESS"||d==="VIN"||d==="CARD_NUMBER"){d="ACCOUNT_NUMBER";}}else{if(l==="999-99-9999"||l==="99-9999999"){d="TIN";}else{if(l==="999.999.9999"||l==="999-999-9999"||l==="(999)999-9999"){d="PHONE_NUMBER";}else{if(!k&&g&&j===1){d="EMAIL_ADDRESS";}else{if(d==="ACCOUNT"||d==="ACCOUNT_NUMBER"||d==="TIN"||d==="PHONE_NUMBER"||d==="EMAIL_ADDRESS"||d==="VIN"||d==="CARD_NUMBER"){d="LAST_FIRST_MIDDLE_NAME";}}}}}}}}return{newFilter:d,cardNumber:m};};CR.RecordReferencePanel=Ext.extend(CR.GridPanel,{crTableName:"",crTargetSerial:"",crFieldDescriptionWidth:40,crPageSize:10,crRowSingleSelect:false,crUseCheckboxSelectionModel:false,crOnSelect:function(a){},crOnSelectionChange:function(){},crOnResizeEvent:function(){},title:"References",frame:true,collapsible:true,titleCollapse:true,autoHeight:true,autoWidth:true,constructor:function(c){var k=Ext.apply({},c);k.crPageSize=k.crPageSize||this.crPageSize;k.crFieldDescriptionWidth=k.crFieldDescriptionWidth||this.crFieldDescriptionWidth;if(k.crUseCheckboxSelectionModel){var l=new Ext.grid.CheckboxSelectionModel();k.sm=l;}var a=this;var o=function(v,r,q,w,t,s){var p="";var u=(q.get("rowStatus")||{}).option;if(u){if(u==="C"){p="cr-rowStatus-closed";}else{if(u==="O"){p="cr-rowStatus-chargedOff";}else{if(u==="V"){p="cr-rowStatus-voided";}else{if(u==="E"){p="cr-rowStatus-expired";}else{if(u==="F"){p="cr-rowStatus-effectiveInFuture";}}}}}r.css=p;}return v;};var i=new CR.XML();var g=i.addContainer(i.getRootElement(),"sequence");var d=i.addContainer(g,"transaction");var b=i.addContainer(d,"step");var h=i.addContainer(b,"recordReference");i.addText(h,"tableName",k.crTableName);i.addText(h,"targetSerial",k.crTargetSerial);i.addOption(h,"includeTotalHitCount","Y");i.addCount(h,"returnLimit",k.crPageSize);var f=[{header:"Description",dataIndex:"description",width:k.crFieldDescriptionWidth,renderer:o},{header:"Record",dataIndex:"rowDescription",renderer:o}];if(k.crUseCheckboxSelectionModel){f.unshift(l);}k.cm=new Ext.grid.ColumnModel(f);var j=new Ext.data.JsonReader({root:"resultRows",totalProperty:"totalHitCount"},[{name:"serial"},{name:"rowDescription"},{name:"rowStatus"},{name:"tableName"},{name:"description"}]);var m=new CR.Core.AjaxProxy({url:"RecordReferenceJSON",crOverride:{disableContainer:a},crMask:{suppress:true}});var n=new Ext.data.Store({autoDestroy:true,baseParams:{crXMLData:i.getXMLDocument()},proxy:m,reader:j,listeners:{loadexception:function(r,q,p){CR.Core.ajaxErrorHandler(p);}}});k.store=n;k.bbar=new Ext.PagingToolbar({pageSize:k.crPageSize,store:k.store,displayInfo:true,displayMsg:"Results {0} - {1} of {2}",emptyMsg:"No matches to display"});k.keys={key:Ext.EventObject.ENTER,handler:function(){a.crGridSelectHandler();}};if(k.listeners){k.crAdditionalListeners=k.listeners;delete k.listeners;}CR.RecordReferencePanel.superclass.constructor.call(this,k);this.addListener({click:this.crOnClick,rowclick:this.crOnRowclick,dblclick:this.crOnDblclick});if(this.crAdditionalListeners){this.addListener(this.crAdditionalListeners);}},crGetTableName:function(){return this.crTableName;},crGetTargetSerial:function(){return this.crTargetSerial;},crFireSelectEvent:function(){if(!this.crIsDestroyed()){this.crGridSelectHandler();}},crInitiateSearch:function(){if(!this.crIsDestroyed()){var a=this;this.getStore().load({params:{start:0,limit:this.crPageSize},callback:function(){if(!a.crIsDestroyed()){a.crOnResizeEvent();if(this.getCount()>0){a.getSelectionModel().selectFirstRow();a.crOnSelectionChange();a.getView().focusRow(0);}}}});}},crOnClick:function(){this.crOnSelectionChange();},crOnRowclick:function(){if(this.crRowSingleSelect){this.crGridSelectHandler();}},crOnDblclick:function(){this.crGridSelectHandler();},crGridSelectHandler:function(){if(!this.crIsDestroyed()){var b=this.getSelectionModel().getSelections();for(var a=0;a<b.length;++a){this.crFinalSelectProcess(b[a],a,b.length);}}},crFinalSelectProcess:function(c,a,b){if(!a&&!b){a=0;b=1;}this.crOnSelect({tableName:c.data.tableName,targetSerial:c.data.serial,rowDescription:c.data.rowDescription,selectionIndex:a,selectionCount:b});}});CR.RecordReferencePanel.openWindow=function(b){var d=new CR.Window({title:b.rowDescription+" References",width:800,autoHeight:true,modal:true,crOnResizeEvent:function(){}});var c=d.addButton({text:"View Selections",disabled:true,handler:function(){if(a){a.crFireSelectEvent();}}});var a=new CR.RecordReferencePanel({title:"",header:false,crTableName:b.tableName,crTargetSerial:b.targetSerial,crOnSelect:function(f){if(b.containerForViewSelections){CR.FMPanel.open({container:b.containerForViewSelections,fmRequest:{requestType:"update",tableName:f.tableName,targetSerial:f.targetSerial}});}if(f.selectionIndex===f.selectionCount-1){CR.Core.defer(function(){d.crClose();});}},crOnSelectionChange:function(){var f=this.getSelectionModel().getSelections().length;if(c){if(f>0){c.enable();}else{c.disable();}}},crOnResizeEvent:function(){d.crOnResizeEvent();}});d.add(a);d.crShow();a.crInitiateSearch();return d;};CR.SecurityOverridePanel=Ext.extend(CR.Panel,{frame:false,border:false,constructor:function(c){var b=Ext.apply({},c);b.title=b.crTitle;var d=new CR.SecurityOverridePanel.GridPanel();var a=new CR.SecurityOverridePanel.DetailPanel();b.items=[d,a];CR.SecurityOverridePanel.superclass.constructor.call(this,b);d.crOverrideDetail=a;a.addListener("afterlayout",function(){a.setHeight(this.getInnerHeight()-(d.getInnerHeight()+d.getFrameHeight()));},this);}});CR.SecurityOverridePanel.GridPanel=Ext.extend(CR.GridPanel,{frame:false,border:false,stripeRows:true,autoHeight:true,constructor:function(b){var g=Ext.apply({},b);g.title=g.crTitle;var f=new CR.XML();var d=f.addContainer(f.getRootElement(),"sequence");var c=f.addContainer(d,"transaction");var a=f.addContainer(c,"step");var k=f.addContainer(a,"search");f.addText(k,"tableName","SECURITY_OVR");f.addText(k,"filterName","BY_STATUS");f.addOption(k,"includeSelectColumns","Y");f.addOption(k,"includeTotalHitCount","Y");f.addCount(k,"returnLimit","5");var j=f.addContainer(k,"parameter");f.addText(j,"columnName","STATUS");f.addText(j,"contents","R");var h=new Ext.data.Record.create([{name:"serial"},{name:"ROW_DESCRIPTION"},{name:"USER"},{name:"BRANCH"},{name:"DEVICE"},{name:"REQUEST_TIME"},{name:"OVERRIDE_PRIVILEGE"}]);var i=new Ext.data.JsonReader({totalProperty:"totalHitCount",root:"resultRows"},h);g.store=new Ext.data.Store({autoDestroy:true,baseParams:{crXMLData:f.getXMLDocument()},proxy:new CR.Core.AjaxProxy({url:"SearchJSON",crOverride:{},crMask:{suppress:true}}),listeners:{loadexception:function(n,m,l){CR.Core.ajaxErrorHandler(l);}},reader:i});g.cm=new Ext.grid.ColumnModel([{header:"User",sortable:true,dataIndex:"USER"},{header:"Branch",sortable:true,dataIndex:"BRANCH"},{header:"Device",sortable:true,dataIndex:"DEVICE"},{header:"Request Time",sortable:true,dataIndex:"REQUEST_TIME"},{header:"Privilege",sortable:true,dataIndex:"OVERRIDE_PRIVILEGE"}]);g.bbar=[new Ext.PagingToolbar({pageSize:5,store:g.store})];CR.SecurityOverridePanel.GridPanel.superclass.constructor.call(this,g);this.addListener("rowclick",this.crRowClick,this);this.addListener("render",this.crRender,this);this.addListener("close",this.crClose,this);},crClose:function(){this.suspendEvents();},crRender:function(){var a=this.getStore();a.load({params:{start:0,limit:5}});this.doLayout();},crRowClick:function(){var a=this.getSelectionModel();var b=a.getSelected();if(b&&b.data&&b.data.serial){CR.SecurityOverridePanel.retrieveOverride({overrideSerial:b.data.serial,maskContainer:this.crOverrideDetail,fmPanelContainerID:this.crOverrideDetail.getId(),voidContainerID:this.crOverrideDetail.getId(),callbackScope:this,callbackFunction:function(c){var f;if(this.crOverrideDetail&&!this.crOverrideDetail.crIsDestroyed()){for(var d=0;d<this.crOverrideDetail.items.getCount();d++){if(this.crOverrideDetail.getComponent(d).crRequestSerial===b.data.serial){f=this.crOverrideDetail.getComponent(d);}}if(!f){f=new CR.SecurityOverridePanel.OverrideTab({crTitle:c.result.user+" Request "+c.result.requestTimeDisplay,crSummaryHtml:c.result.summaryHtml,crTransactionHtml:c.result.transactionHtml,crTransactionPersonSerial:c.result.personSerial,crTransactionPersonRowDescription:c.result.personRowDescription,crRequestSerial:b.data.serial,crGrantOption:c.result.grantOption});this.crOverrideDetail.add(f);}this.crOverrideDetail.setActiveTab(f);this.crOverrideDetail.doLayout();
}}});}}});CR.SecurityOverridePanel.DetailPanel=Ext.extend(CR.TabPanel,{enableTabScroll:true,border:false,height:500,constructor:function(b){var a=Ext.apply({},b);a.title=a.crTitle;a.html="";CR.SecurityOverridePanel.DetailPanel.superclass.constructor.call(this,a);}});CR.SecurityOverridePanel.OverrideTab=Ext.extend(CR.Panel,{closable:true,autoScroll:true,constructor:function(E){var h=Ext.apply({},E);h.title=h.crTitle;h.html=h.crHtml;var r=new CR.ToolbarButton({text:"Deny",crDecision:"D",disabled:h.crLocalOption});var w=new CR.ToolbarButton({text:"Grant Single Use",crDecision:"G",disabled:h.crLocalOption});var f=null;if(h.crGrantOption==="Y"){var q=new CR.Menu();f=new CR.ToolbarButton({text:"Grant Multiple Use (2 minutes)",crDecision:"g",crExpirationSeconds:120,disabled:h.crLocalOption,menu:q});for(var x=2;x<=10;x++){q.addItem(new CR.MenuItem({text:x+" minutes",crExpirationSeconds:x*60,crDescription:x+" minutes",handler:function(){f.crExpirationSeconds=this.crExpirationSeconds;f.setText("Grant Multiple Use ("+this.crDescription+")");}}));}h.tbar=[r,"-",w,"-",f];}else{h.tbar=[r,"-",w];}if(h.crLocalOption){h.crUserNameField=new CR.TextField({crColumnDescription:"Username",crTextBlankAllowed:false,width:150,crContents:""});h.crPasswordField=new CR.TextField({crColumnDescription:"Password",crTextBlankAllowed:false,width:150,inputType:"password"});h.crPasswordField.addListener("beforedestroy",function(){this.crSetContents("");});var a=new CR.FieldSet({crViewGroup:"Override User",items:[h.crUserNameField,h.crPasswordField]});var u=function(){if(h.crUserNameField.crGetNewContents()&&h.crPasswordField.crGetNewContents()){r.enable();w.enable();if(f){f.enable();}}else{r.disable();w.disable();if(f){f.disable();}}};h.crUserNameField.addListener("keyup",u);h.crPasswordField.addListener("keyup",u);}var s=new CR.TextAreaField({blankText:"Enter explanation here",crTextNewLineAllowed:true,crMaximumLength:4000,crMaximumLengthText:"Maximum Length is 4000 Characters",hideLabel:true,height:100,width:500});var A=new CR.Panel({columnWidth:0.5,items:[s]});var D="20";var d=new CR.XML();var l=d.addContainer(d.getRootElement(),"sequence");var y=d.addContainer(l,"transaction");var j=d.addContainer(y,"step");var m=d.addContainer(j,"search");d.addText(m,"tableName","SECURITY_OVR_EXPLANATION");d.addOption(m,"includeSelectColumns","Y");d.addOption(m,"includeTotalHitCount","Y");d.addCount(m,"returnLimit",D);var C=new Ext.data.Record.create([{name:"serial"},{name:"ROW_DESCRIPTION"}]);var n=new Ext.data.JsonReader({totalProperty:"totalHitCount",root:"resultRows"},C);var g=new Ext.data.Store({autoDestroy:true,baseParams:{crXMLData:d.getXMLDocument()},proxy:new CR.Core.AjaxProxy({url:"SearchJSON",crOverride:{},crMask:{suppress:true}}),listeners:{loadexception:function(G,F,i){CR.Core.ajaxErrorHandler(i);}},reader:n});var k=new Ext.grid.ColumnModel([{header:"Standard Explanations - Click to add",dataIndex:"ROW_DESCRIPTION",width:800}]);var z=new Ext.PagingToolbar({pageSize:D,store:g});var p=new CR.GridPanel({store:g,cm:k,height:140,bbar:[z],listeners:{render:function(){g.load({params:{start:0,limit:D}});},rowclick:function(){var F=this.getSelectionModel().getSelected();if(F&&F.data&&F.data.ROW_DESCRIPTION){var i=s.crGetNewContents();if(i){i+="\n";}s.crSetContents(i+F.data.ROW_DESCRIPTION);}}}});var b=new CR.Panel({columnWidth:0.5,items:[p]});var v=new CR.FieldSet({crViewGroup:"Override Explanation",layout:"column",collapsed:true,items:[A,b]});var B=new CR.FieldSet({crViewGroup:"Summary",html:h.crSummaryHtml});var c=null;if(h.crTransactionPersonSerial&&h.crTransactionPersonRowDescription){c=['<div class="cr-history" style="margin-bottom: 5px;">','  <span style="font-weight:bold">Person: </span>','  <a href="javascript:void(0)" class="recordlink" ',"     onclick=\"CR.HistoryResultPanel.showPersonProfile(null,'"+h.crTransactionPersonSerial+"')\">",CR.Core.htmlText(h.crTransactionPersonRowDescription),"  </a>","</div>"].join("");}var t=new CR.FieldSet({crViewGroup:"Transaction Detail",html:c?c+h.crTransactionHtml:h.crTransactionHtml});h.items=[];if(a){h.items.push(a);}h.items.push(v);h.items.push(B);h.items.push(t);CR.SecurityOverridePanel.OverrideTab.superclass.constructor.call(this,h);var o=this;this.crOverrideExplanationTextArea=s;r.addListener("click",function(){o.crSubmitDecision({decisionButton:this});});w.addListener("click",function(){o.crSubmitDecision({decisionButton:this});});if(f){q.addListener("itemclick",function(){o.crSubmitDecision({decisionButton:f});});}},crSubmitDecision:function(k){if(this.crLocalOption&&(!this.crUserNameField.crGetNewContents()||!this.crPasswordField.crGetNewContents())){CR.Core.displayExceptions({items:["Username and Password must be specified"]});}else{var g;var b;var h=this.crOverrideExplanationTextArea.crGetNewContents().replace(/\n/g," ");if(k&&k.decisionButton){g=k.decisionButton.crDecision;b=k.decisionButton.crExpirationSeconds;}var j=new CR.XML();if(this.crLocalOption){var l=j.addContainer(j.getRootElement(),"logon");j.addText(l,"userName",this.crUserNameField.crGetNewContents());j.addText(l,"password",this.crPasswordField.crGetNewContents());j.addText(l,"deviceName",CR.Login.deviceName);}var f=j.addContainer(j.getRootElement(),"sequence");var d=j.addContainer(f,"transaction");var c=j.addContainer(d,"step");var i=j.addContainer(c,"securityOverride");j.addSerial(i,"targetSerial",this.crRequestSerial);j.addOption(i,"operation",g);if(b){j.addCount(i,"expirationSeconds",b);}if(h){j.addText(i,"overrideExplanation",h);}if(!this.crLocalOption){var a="DirectXMLPost";}else{j.addContainer(j.getRootElement(),"logoff");a="LocalSecurityOverride";}CR.Core.ajaxRequest({url:a,xmlData:j.getXMLDocument(),scope:this,crOverride:{},crMask:{container:this},success:function(m){var o=new CR.XML({xmlText:m.responseText});var n="failed";var p;o.beginElement(o.getRootElement());while(!!(p=o.nextSubElement())){if(p.nodeName==="sequence"){o.beginElement(p);while(!!(p=o.nextSubElement())){if(p.nodeName==="transaction"){n=p.getAttribute("result");o.beginElement(p);while(!!(p=o.nextSubElement())){}}}}}if(n!=="posted"&&!this.crIsDestroyed()){CR.Core.displayExceptions({items:o.getExceptionList()});}else{if(!this.ownerCt.crIsDestroyed()){if(!this.crLocalOption){this.ownerCt.remove(this);}else{this.crSecurityOverrideRequestWindow.crSecurityOverrideWaitForResponse();this.ownerCt.crClose();}}}}});}}});CR.SecurityOverridePanel.showSecurityOverride=function(a){var c=new CR.SecurityOverridePanel({crTitle:"Security Override",closable:true});if(a&&a.container){CR.Core.addToContainerAndShow(a.container,c);}else{var b=new CR.Window({autoHeight:true,resizable:true,collapsible:true,title:"Security Override",width:1000,items:[c]});b.crShow();b.center();}};CR.SecurityOverridePanel.showLocalSecurityOverride=function(b){var c=b.renderTo;var a=false;CR.SecurityOverridePanel.retrieveOverride({overrideSerial:b.overrideSerial,callbackFunction:function(d){var h=new CR.SecurityOverridePanel.OverrideTab({crTitle:d.result.user+" Request "+d.result.requestTimeDisplay,crSummaryHtml:d.result.summaryHtml,crTransactionHtml:d.result.transactionHtml,crRequestSerial:d.overrideSerial,crGrantOption:d.result.grantOption,crLocalOption:true,crSecurityOverrideRequestWindow:b.securityOverrideRequestWindow});if(c&&c.getSize){var f=c.getSize();if(f.height<600||c.width<900){c=undefined;}}else{c=undefined;}if(!c){a=true;}var g=new CR.Window({resizable:true,collapsible:true,title:"Security Override",height:600,width:900,autoScroll:true,renderTo:c,modal:a,items:[h]});g.crShow();g.center();}});};CR.SecurityOverridePanel.retrieveOverride=function(c){var b=new CR.XML();var h=b.addContainer(b.getRootElement(),"sequence");var g=b.addContainer(h,"transaction");var d=b.addContainer(g,"step");var a=b.addContainer(d,"record");b.addText(a,"tableName","SECURITY_OVR");b.addSerial(a,"targetSerial",c.overrideSerial);b.addOption(a,"operation","V");b.addOption(a,"includeAllColumns","Y");b.addOption(a,"includeRowDescriptions","Y");var f=b.addContainer(a,"field");b.addText(f,"columnName","TRANSACTION_XML");b.addOption(f,"operation","G");CR.Core.ajaxRequest({url:"DirectXMLPost",xmlData:b.getXMLDocument(),crOverride:{},crMask:{container:c.maskContainer},success:function(n){var r=new CR.XML({xmlText:n.responseText});var p;var m="failed";var q="";var o="";var i="";var j="";var u="";r.beginElement(r.getRootElement());while(!!(p=r.nextSubElement())){if(p.nodeName==="sequence"){r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="transaction"){m=p.getAttribute("result");r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="step"){r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="record"){r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="field"){var k="";var l="";var v="";r.beginElement(p);while(!!(p=r.nextSubElement())){if(p.nodeName==="columnName"){k=r.getText(p);}else{if(p.nodeName==="newContents"){l=r.getText(p);}else{if(p.nodeName==="newContentsDescription"){v=r.getText(p);}}}}if(k==="TRANSACTION_XML"){q=l;}else{if(k==="USER_SERIAL"){o=v;}else{if(k==="DEVICE_SERIAL"){i=v;}else{if(k==="REQUEST_TIME"){j=l;}else{if(k==="GRANT_OPTION"){u=l;}}}}}}}}}}}}}}}if(m!=="posted"){CR.Core.displayExceptions({items:r.getExceptionList()});}else{if(q.length>=5&&q.substr(0,5)==="<?xml"){var t=q.indexOf(">");if(t!==-1){q=q.substr(t+1);}}r=new CR.XML();var s="<"+r.getRootElementName()+' xmlns="'+r.getNamespaceURI()+'">';s+="<sequence>";s+=q;s+="</sequence>";s+="</"+r.getRootElementName()+">";r=new CR.XML({xmlText:s});CR.Core.ajaxRequest({url:"TranHistoryHTML",xmlData:r.getXMLDocument(),params:{source:"request",fmPanelContainerID:c.fmPanelContainerID,voidContainerID:c.voidContainerID},crOverride:{suppress:true},crMask:{container:c.maskContainer},success:function(x){c.result=c.result||{};c.result.requestTimeDisplay=CR.TimeField.convertToDisplay(j);c.result.user=o;c.result.device=i;c.result.grantOption=u;var z=null;var w=null;var A=/<personSerial>(.*?)<\/personSerial>/g;var y=A.exec(q);if(y&&y.length>1){z=y[1];A=/<personRowDescription>(.*?)<\/personRowDescription>/g;var y=A.exec(q);if(y&&y.length>1){w=y[1];}}var B="<div>";B+="User: "+CR.Core.htmlText(c.result.user)+"<br>";B+="Device: "+CR.Core.htmlText(c.result.device)+"<br>";B+="Request Time: "+CR.Core.htmlText(c.result.requestTimeDisplay)+"<br>";B+="Grant Option: "+CR.Core.htmlText(c.result.grantOption)+"</div>";c.result.personSerial=z;c.result.personRowDescription=w;c.result.summaryHtml=B;c.result.transactionHtml=x.responseText;c.callbackFunction.call(c.callbackScope,c);}});}}});};CR.FileTransfer={getField:function(g,f,c){var d=null;var a=g.dataType;a=a?a.option:"S";a=a||"S";var b={crPanelType:"FMPanel",crColumnName:g.indexName,crColumnDescription:g.description||g.indexName,crContents:g.indexValue,crMaximumLength:g.maximumLength,crTextBlankAllowed:g.blankAllowed?true:false,crNullAllowed:g.blankAllowed?true:false,crTextNumericOnly:g.numericOnly?true:false};if(g.source&&(g.source.option==="ACN"||g.source.option==="NAI")&&f&&f.length>0){a="O";b.width=CR.Field.DEFAULT_TEXT_WIDTH;b.crOptions=f;}if(g.source&&g.source.option==="NAM"&&!g.indexValue&&c){b.crContents=c;}d=CR.Field.getFieldFromDataType(a,b);return d;},needsConfirmation:function(a){var c=false;if(a&&a.status&&a.status.option==="O"){var b=a.fileTransferRecord;if(b){if(b.confirmationOption&&b.confirmationOption.option==="S"){c=true;}else{c=!CR.FileTransfer.isValid(a);}}}return c;},isValid:function(a){var d=true;if(a&&a.status&&a.status.option==="O"){var c=a.fileTransferRecord;if(c&&c.length===1){var b=a.fileTransferRecord[0].documentIndexField;Ext.each(b,function(h){var f=h.indexValue?true:false;var g=h.blankAllowed&&h.blankAllowed.option==="Y";if(!f&&!g){d=false;}});}}return d;}};CR.FileTransfer.DocumentIndexPanel=Ext.extend(CR.FormPanel,{crReceiptSerial:null,crFormSerial:null,crFileTransferRequest:null,crFileTransferRecord:null,crFileTransferRecordsInserted:false,crFileTransferRecordsInsertionInProgress:false,crTransactedAccounts:null,frame:true,layout:"form",bodyStyle:"padding:5px 5px 0",autoScroll:true,labelAlign:"left",labelWidth:100,buttonAlign:"left",minButtonWidth:100,constructor:function(c){var b=Ext.apply({},c);b.crFileTransferRecord=b.crFileTransferRequest.fileTransferRecord;var a=[];if(b.crFileTransferRecord&&b.crFileTransferRecord.length===1){var d=b.crFileTransferRecord[0].documentIndexField;Ext.each(d,function(g){var f=CR.FileTransfer.getField(g,b.crTransactedAccounts,b.crPersonDescription);a.push(f);});}b.items=[{xtype:"crFieldSet",crViewGroup:"Document Index Fields",items:a}];CR.FileTransfer.DocumentIndexPanel.superclass.constructor.call(this,b);},crGetFileTransferRecord:function(){var a=JSON.parse(JSON.stringify(this.crFileTransferRecord[0]));a.documentIndexField=this.crGetDocumentIndexFields(a.documentIndexField);return a;},crGetDocumentIndexFields:function(a){Ext.each(a,function(b){b.indexValue=this.crGetIndexValue(b.indexName);},this);return a;},crGetIndexValue:function(c){var a="";var b=this.find("crColumnName",c).shift();if(b){a=b.crGetNewContents();}return a;},crIsValid:function(){return this.getForm().isValid();},crInsertFileTransferRecords:function(j){j=Ext.apply({callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},j);var c=this;if(!c.crFileTransferRecordsInsertionInProgress&&!c.crFileTransferRecordsInserted){c.crFileTransferRecordsInsertionInProgress=true;var i=c.crFileTransferRequest;var g=c.crGetFileTransferRecord();var h=new CR.XML();var f=h.addContainer(h.getRootElement(),"sequence");var d=h.addContainer(f,"transaction");var b=h.addContainer(d,"step");var i=h.addContainer(b,"fileTransferRequest");h.addOption(i,"operation","INSERT_FILE_TRANSFER_RECORDS");var a=h.addContainer(i,"fileTransferRecord");h.addSerial(a,"typeSerial",g.typeSerial);if(c.crReceiptSerial){h.addSerial(a,"receiptSerial",c.crReceiptSerial);}else{if(c.crFormSerial){h.addSerial(a,"formSerial",c.crFormSerial);}}Ext.each(g.documentIndexField,function(l){var k=h.addContainer(a,"documentIndexField");h.addSerial(k,"serial",l.serial);h.addText(k,"indexValue",l.indexValue);});CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:h.getXMLDocument(),scope:c,success:function(k){var o=CR.JSON.parse(k.responseText);var n=o.query;var m="failed";var l=[];if(n){Ext.each(n.sequence,function(p){Ext.each(p.transaction,function(q){m=q.$attr.result;Ext.each(q.step,function(r){if(r.tranResult&&r.tranResult.category&&r.tranResult.category.option&&r.tranResult.category.option==="E"){l.push(r.tranResult.description);}else{if(r.fileTransferRequest){}}});});});}c.crFileTransferRecordsInsertionInProgress=false;if(m!=="posted"&&m!=="verified"){CR.Core.displayExceptions({items:l});}else{c.crFileTransferRecordsInserted=true;j.callbackArgs.crFileTransferRecordsInserted=true;j.callbackFunction.call(j.callbackScope,j.callbackArgs);}}});}else{j.callbackFunction.call(j.callbackScope,j.callbackArgs);}}});CR.PDFDocument=Ext.extend(CR.Panel,{crFormTypeSerial:null,crFormTypeRowDescription:null,crPrimaryTable:null,crPrimaryRecordSerial:null,crPrimaryRecordRowDescription:null,crInteractionSerial:null,crDisputeSerial:null,crFormRequest:null,crRecordTree:null,crLoanSerial:null,crShareSerial:null,crFDFParamObj:null,crCloseOnSubmit:true,crInitiatingComponentID:null,crCustomValues:null,crSkipPrompts:false,crSkipRecordSelection:false,crRecordSelection:null,crCallbackFunction:null,crMonitor:false,closable:true,autoScroll:true,layout:"border",constructor:function(w){var f=Ext.apply({},w);f.crFormRequest=f.crFormRequest||{};f.crFDFParamObj=f.crFDFParamObj||{};var j=false;if(f.crFormTypeSerial&&f.crFormTypeRowDescription&&f.crPrimaryRecordSerial&&f.crPrimaryRecordRowDescription&&f.crPrimaryTable){j=true;}var q=new Ext.Toolbar.TextItem({text:"Form Type:"});var l=new CR.SerialField({crTableName:"FORM_TYPE",crContents:f.crFormTypeSerial,crRowDescription:f.crFormTypeRowDescription,crSearchFilterName:"BY_DESCRIPTION_WITH_OPEN_STATUS"});var b=new Ext.Toolbar({items:[q,l]});var t=new CR.Panel({title:"Form Type Options",region:"west",layout:"fit",width:300,autoScroll:true,split:true,tbar:b,html:"",border:true});
var g=new Ext.Toolbar.TextItem({text:"Primary Table:"});var d=[];d.push([null,"None"]);for(var s=0;s<CR.Core.tableList.length;++s){var v=CR.Core.tableList[s];d.push([v.tableName,v.tableDescription]);}var u=new CR.OptionField({crOptions:d,crNullAllowed:true,crContents:f.crPrimaryTable,disabled:true});var p=new Ext.Toolbar.TextItem({text:"Primary Record:"});var n=new CR.SerialField({crColumnDescription:"Primary Record",crTableName:f.crPrimaryTable,crNullAllowed:true,crContents:f.crPrimaryRecordSerial,crRowDescription:f.crPrimaryRecordRowDescription});b=new Ext.Toolbar({layout:"table",layoutConfig:{columns:2},items:[g,u,p,n]});var k=new CR.TreePanel({title:"Data Import Options",region:"center",layout:"fit",autoScroll:true,rootVisible:false,disabled:true,border:true,root:new Ext.tree.TreeNode(),tbar:b});f.items=[t,k];var r=new CR.Button({text:"Continue",disabled:!j});var m=new CR.Button({text:"GemView",disabled:!j,hidden:CR.Settings.getDeviceSetting("gemViewModel","none")==="none"});var a=new CR.Button({text:"Upload",disabled:!j,hidden:f.crDisableUpload});var h=new CR.Button({text:"Cancel"});f.buttonAlign="center";f.buttons=[r,m,a,h];CR.PDFDocument.superclass.constructor.call(this,f);var c=this;c.crWestPanel=t;c.crCenterPanel=k;c.crFormTypeSerialField=l;c.crPrimaryTableNameField=u;c.crPrimaryTableRecordField=n;c.crContinueButton=r;c.crGemViewButton=m;c.crUploadButton=a;l.crOnContentsChange=function(){c.crGetFormTypeRequestAndRecordsTree({formTypeSerial:l.crGetNewContents()});};u.addListener("select",function(){n.crTableName=u.crGetNewContents();});n.crOnContentsChange=function(){c.crPrimaryTableName=n.crGetTableName();c.crPrimaryTargetSerial=n.crGetNewContents();c.crGetFormTypeRequestAndRecordsTree({primaryTableName:u.crGetNewContents(),primaryTargetSerial:n.crGetNewContents()});};function o(x){c.crMonitor=x.text==="GemView";var i=c.crFormTypeSerialField.crGetNewContents();if(CR.Script){c.crInitiateDocument(true);}else{CR.Core.recordView({tableName:"FORM_TYPE",targetSerial:i,fields:[{columnName:"SCRIPT_SERIAL"}],callbackFunction:function(y){if(y.tranResult==="posted"){var z=y.record;if(z&&z["SCRIPT_SERIAL"]){CR.ScriptManager.showScript({workArea:"T",defaultPanel:CR.FMPanel.getDefaultContainer(),scriptSerial:z["SCRIPT_SERIAL"],crFormTypeSerial:i,crFormPrimaryTableName:c.crPrimaryTableName,crFormPrimaryTargetSerial:c.crPrimaryTargetSerial,crFormRecordSelections:c.crGetRecordSelections(),crFormMonitor:c.crMonitor});if(c.crCloseOnSubmit){if(c.ownerCt&&c.ownerCt.crClose){c.ownerCt.crClose();}}}else{c.crInitiateDocument(true);}}}});}}r.addListener("click",o);m.addListener("click",o);a.addListener("click",function(){c.crUploadDocument();});h.addListener("click",function(){if(c.ownerCt.crClose){c.ownerCt.crClose();}else{if(c.ownerCt.remove){c.ownerCt.remove(c);}}if(c.crInitiatingComponentID){Ext.getCmp(c.crInitiatingComponentID).crOpenDocumentWindow={closed:true};}});if(c.crFormTypeSerial||(c.crPrimaryTable&&c.crPrimaryRecordSerial)){c.crGetFormTypeRequestAndRecordsTree({formTypeSerial:c.crFormTypeSerial,primaryTableName:c.crPrimaryTable,primaryTargetSerial:c.crPrimaryRecordSerial,autoInitiateDocument:c.crSkipRecordSelection});}},crGetFormTypeRequestAndRecordsTree:function(c){var a=this;if(c.formTypeSerial){a.crFormTypeSerial=c.formTypeSerial;}if(c.primaryTableName){a.crPrimaryTableName=c.primaryTableName;}if(c.primaryTargetSerial){a.crPrimaryTargetSerial=c.primaryTargetSerial;}var b=new CR.XML();var i=b.addContainer(b.getRootElement(),"sequence");var h=b.addContainer(i,"transaction");var f;if(c.formTypeSerial){f=b.addContainer(h,"step");var g=b.addContainer(f,"formRequest");b.addOption(g,"operation","VIEW_FORM_TYPE");b.addSerial(g,"formTypeSerial",c.formTypeSerial);}if(c.primaryTableName&&c.primaryTargetSerial){f=b.addContainer(h,"step");var d=b.addContainer(f,"recordTree");b.addText(d,"tableName",c.primaryTableName);b.addSerial(d,"targetSerial",c.primaryTargetSerial);}CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),params:{},scope:a,success:function(r){var n=CR.JSON.parse(r.responseText);var v=n.query;var q="failed";var x=[];var w=null;var u=null;if(n.query){var p=v.sequence;if(p){for(var t=0;t<p.length;t++){var m=p[t].transaction;if(m){for(var s=0;s<m.length;s++){q=m[s].$attr.result;var l=m[s].step;if(l){for(var o=0;o<l.length;o++){if(l[o].formRequest){w=l[o].formRequest;}else{if(l[o].recordTree){u=l[o].recordTree;}else{if(l[o].tranResult&&l[o].tranResult.category&&l[o].tranResult.category.option&&l[o].tranResult.category.option==="E"){x.push(l[o].tranResult.description);}}}}}}}}}}if(q!=="posted"&&q!=="verified"){CR.Core.displayExceptions({items:x});}else{if(w){a.crFormRequest=w;a.crProcessFormRequest();if(c.autoInitiateDocument){a.crInitiateDocument(true);}}if(u){a.crRecordTree=u;a.crProcessRecordTree();}if(a.crRecordTree){a.crProcessRecordTree();}}}});},crGetTableDescription:function(b){var a=b;for(var c=0;c<CR.Core.tableList.length;++c){var d=CR.Core.tableList[c];if(b===d.tableName){a=d.tableDescription;}}return a;},crProcessFormRequest:function(){var d=this;var i=d.crFormRequest;if(i.primaryTableName){d.crFDFParamObj={};var c='<div width="100%">';c+='<table width="100%"><tr>';var l=d.crGetTableDescription(i.primaryTableName);c+="<td>Primary Table Name:</td><td>"+l+"</td>";c+="</tr></table>";var h=true;var k=i.sourceRecord;if(k){c+='<table width="100%">';c+='<tr><td colspan="5" align="center">Source Records</td></tr>';c+="<tr><td>Description</td><td>Min Count</td><td>Max Count</td><td>Selected</td></tr>";for(var b=0;b<k.length;b++){var m=k[b];d.crFDFParamObj[m.tableName]=[];var g=d.crGetTableDescription(m.tableName);var n=m.minimumRecordCount||"N/A";var f=m.maximumRecordCount||"N/A";var a=d.crGetSelectedRecordCount(m.tableName);if((n!=="N/A"&&a<n*1)||(f!=="N/A"&&a>f*1)){a='<font color="red">'+a+"</font>";h=false;}c+="<tr><td>"+g+"</td>"+'<td align="center">'+n+"</td>"+'<td align="center">'+f+"</td>"+'<td align="center">'+a+"</td></tr>";}c+="</table>";}c+="</div>";if(d.crWestPanel.body){d.crWestPanel.body.update(c);}d.crContinueButton.setDisabled(!h);d.crGemViewButton.setDisabled(!h);d.crUploadButton.setDisabled(!h);d.crCenterPanel.enable();d.crPrimaryTableNameField.crSetContents(i.primaryTableName);d.crPrimaryTableRecordField.crSetTableName(i.primaryTableName);}},crGetSelectedRecordCount:function(c){var a=this;var d=0;var b=a.crCenterPanel.getRootNode();b.cascade(function(h){var f=h.attributes;var g=h.getUI();if(f.crTableName===c&&g.isChecked()){d++;}});return d;},crAddShareLoanToRecordSelection:function(){var a=this;var f=a.crShareSerial;var c=a.crLoanSerial;var b=a.crLoanRequestSerial;d(f,"SHARE");d(c,"LOAN");d(b,"LOAN_REQUEST");function d(i,h){var g=!!CR.Core.safeGet(a,["crFDFParamObj",h],false);if(i&&g){if(!a.crRecordSelection){a.crRecordSelection={};}if(!a.crRecordSelection[h]){a.crRecordSelection[h]=[];}if(!a.crRecordSelection[h].includes(i)){a.crRecordSelection[h].push(i);}}}},crProcessRecordTree:function(){var a=this;a.crAddShareLoanToRecordSelection();var b=a.crCenterPanel.getRootNode();b.removeAll(true);var d=a.crRecordTree;var c=function(l,j,k){var h=a.crGetTableDescription(l.tableName)+": "+l.rowDescription;var m={crTableName:l.tableName,crTargetSerial:l.serial,text:h,qtip:h,checked:false,expanded:true,disabled:true,iconCls:"cr-tree-node-noIcon",listeners:{checkchange:function(n,i){a.crProcessFormRequest();},contextmenu:function(i,n){if(!i.disabled){var o=new CR.Menu();o.addItem(new CR.MenuItem({text:"Select record and subrecords",listeners:{click:function(){i.cascade(function(p){if(!p.disabled){p.getUI().toggleCheck(true);}});}}}));o.addItem(new CR.MenuItem({text:"Deselect record and subrecords",listeners:{click:function(){i.cascade(function(p){if(!p.disabled){p.getUI().toggleCheck(false);}});}}}));o.addListener("hide",o.destroy,o);o.showAt(n.getXY());}}}};if(a.crFDFParamObj[l.tableName]){m.disabled=false;}if(!m.disabled&&a.crRecordSelection&&a.crRecordSelection[l.tableName]&&a.crRecordSelection[l.tableName].includes(l.serial)){m.checked=true;}var g=new Ext.tree.TreeNode(m);j.appendChild(g);if(l.child){for(var f=0;f<l.child.length;f++){c(l.child[f],g);}}};c(d.resultTree,b);a.crProcessFormRequest();},crInitiateDocument:function(l){var j=this;if(l&&Ext.isArray(j.crCustomValues)){CR.Core.ajaxRequest({url:"SessionStore",scope:j,params:{value:CR.JSON.stringify(j.crCustomValues)},success:function(t){var i=CR.JSON.parse(t.responseText);j.crCustomValuesID=i.id;j.crInitiateDocument();}});return;}var m=j.crFormTypeSerialField.crGetNewRowDescription();var r=j.crFormRequest;if(!j.crSkipPrompts&&r.promptList){var p=[];function q(i){var t=null;Ext.each(j.crPromptsConfig,function(u){if(u.fieldNameSuffix===i){t=u;}});return t;}for(var h=0;h<r.promptList.length;h++){var b=r.promptList[h];var s=b.dataType.option;var k={crColumnDescription:b.prompt,crFieldNameSuffix:b.fieldNameSuffix,crDataType:s};if(j.crPromptsConfig){var g=q(b.fieldNameSuffix);if(g){k=Ext.apply(k,g);}}var c=CR.Field.getFieldFromDataType(s,k);p.push(c);}var n=new CR.Button({text:"Continue"});var f=new CR.Button({text:"Cancel"});var o=(j.crWindowParams&&j.crWindowParams.renderTo)||null;var a=new CR.FormPanel({frame:true,autoWidth:true,autoHeight:true,items:[p]});var d=new CR.Window({title:m+" Prompts",bodyStyle:"padding:5px;",renderTo:o,modal:true,autoScroll:true,width:350,items:[a],buttons:[n,f],listeners:{afterlayout:function(i){if(i.getHeight()>600){i.setHeight(600);}}}});n.addListener("click",function(){if(a.getForm().isValid()){var i=[];d.cascade(function(t){if(t.crFieldNameSuffix){i.push({fieldNameSuffix:t.crFieldNameSuffix,dataType:t.crDataType,contents:t.crGetNewContents()});}});CR.Core.ajaxRequest({url:"SessionStore",scope:j,params:{value:CR.JSON.stringify(i)},success:function(u){var t=CR.JSON.parse(u.responseText);j.crPromptsID=t.id;j.crShowDocument();}});d.crClose();}});f.addListener("click",function(){d.crClose();});d.crShow();}else{j.crShowDocument();}},crShowDocument:function(){var a=this;var b=false;if(a.crFormRequest&&a.crFormRequest.category&&a.crFormRequest.category.option==="L"){b=true;}if(b||CR.KeyStoneService.isAdobeAcrobatPluginAvailable()){a.crShowDocumentPlugin();}else{a.crShowDocumentService();}},crShowDocumentPlugin:function(){var l=this;var n=l.crFormTypeSerialField.crGetNewContents();var j=l.crPrimaryTableRecordField;var o="";if(j.crTableName&&j.crGetNewContents()){o+="/"+j.crTableName+"="+j.crGetNewContents();}var a=l.crGetRecordSelections();for(var m in a){o+="/"+m;for(var h=0;h<a[m].length;h++){o+="="+a[m][h];}}var k=window.location.protocol+"//"+window.location.host+"/"+CR.Login.locationName+"/PDFForm";k+="/FORM_TYPE="+n;var g=false;if(l.crFormRequest&&l.crFormRequest.category&&l.crFormRequest.category.option==="L"){g=true;}var c=k+o+"/form.fdf";var f=k+"/form.pdf"+"?__fdf="+encodeURIComponent(c);var b=f+"#FDF="+c;if(g){b=k+o+"/letter.pdf";}var d=false;if(l.crPromptsID){b+=d?"&":"?";b+="PROMPTS_ID="+encodeURIComponent(l.crPromptsID);d=true;l.crPromptsID=null;}if(l.crCustomValuesID){b+=d?"&":"?";b+="CUSTOM_VALUES_ID="+encodeURIComponent(l.crCustomValuesID);d=true;l.crCusomValuesID=null;}if(l.crSkipRecordSelection&&!l.crRecordSelection){b+=d?"&":"?";b+="skipRecords=true";d=true;}if(l.crInteractionSerial){b+=d?"&":"?";b+="interaction="+l.crInteractionSerial;d=true;}if(l.crDisputeSerial){b+=d?"&":"?";b+="dispute="+l.crDisputeSerial;d=true;}CR.Core.ajaxRequest({url:b,method:"GET",params:{"securityCheck":"securityCheck"},scope:l,success:function(i){var p=window.open(b,"_blank","scrollbars=1,location=0,status=0,menubar=1,resizable=1");if(l.crCallbackFunction){var r=setInterval(function(){if(p.closed){clearInterval(r);l.crCallbackFunction();}},500);}if(l.crInitiatingComponentID){var q=Ext.getCmp(l.crInitiatingComponentID);if(q){q.crOpenDocumentWindow=p;}}if(l.crCloseOnSubmit){if(l.ownerCt&&l.ownerCt.crClose){l.ownerCt.crClose();}}}});},crShowDocumentService:function(){var c=this;var n=c.crFormTypeSerialField.crGetNewContents();var u=c.crFormTypeSerialField.crGetNewRowDescription();var l=c.crPrimaryTableRecordField;var g=new CR.XML();var j=g.getRootElement();var m=g.addContainer(j,"sequence");var s=g.addContainer(m,"transaction");var k=g.addContainer(s,"step");var b=g.addContainer(k,"formRequest");g.setAttribute(b,"label","template");g.addOption(b,"operation","VIEW_FORM_TYPE");g.addText(b,"formTypeSerial",n);g.addOption(b,"includeTemplate","Y");var k=g.addContainer(s,"step");var b=g.addContainer(k,"formRequest");g.setAttribute(b,"label","data");g.addOption(b,"operation","EXTRACT_SOURCE_RECORDS");g.addOption(b,"includeTemplate","N");g.addText(b,"formTypeSerial",n);if(l.crTableName&&l.crGetNewContents()){g.addText(b,"tableName",l.crTableName);g.addText(b,"targetSerial",l.crGetNewContents());}var f=c.crGetRecordSelections();for(var d in f){var q=g.addContainer(b,"sourceRecord");g.addText(q,"tableName",d);for(var r=0;r<f[d].length;r++){var t=g.addContainer(q,"recordList");g.addText(t,"targetSerial",f[d][r]);}}if(l.crTableName&&l.crGetNewContents()){var k=g.addContainer(s,"step");var p=g.addContainer(k,"fileTransferRequest");g.addOption(p,"operation","EXTRACT_DOCUMENT_INDEX_FIELDS");g.addText(p,"formTypeSerial",n);if(l.crTableName==="PERSON"){g.addText(p,"personSerial",l.crGetNewContents());}else{if(l.crTableName==="ACCOUNT"){g.addText(p,"accountSerial",l.crGetNewContents());}else{if(l.crTableName==="APP"){g.addText(p,"applicationSerial",l.crGetNewContents());}}}}var a=window.location;var w=a.protocol+"//"+a.host+"/"+CR.Login.locationName;w+="/PDFForm";w+="/FORM_TYPE="+n;if(l.crTableName&&l.crGetNewContents()){w+="/"+l.crTableName+"="+l.crGetNewContents();}var f=c.crGetRecordSelections();for(var d in f){w+="/"+d;for(var r=0;r<f[d].length;r++){w+="="+f[d][r];}}w+="/form.pdf";var v=false;if(c.crFormRequest&&c.crFormRequest.category&&c.crFormRequest.category.option==="L"){v=true;}var h=CR.PDFDocument.generateUID({targetSerial:n,description:u});var o=c.crSkipRecordSelection&&!c.crRecordSelection;CR.Core.ajaxRequest({url:"PDFForm2",params:{uid:h.uid,filename:h.description,skipRecords:o,monitor:c.crMonitor,promptsID:c.crPromptsID,customValuesID:c.crCustomValuesID,interaction:c.crInteractionSerial,dispute:c.crDisputeSerial,postURL:w,letter:v},xmlData:g.getXMLDocument(),success:function(x){var i=CR.JSON.parse(x.responseText);CR.KeyStoneService.runForm({uid:h.uid,filename:h.description,pdf:i.pdf,fdf:i.fdf,monitor:c.crMonitor,callbackFunction:c.crCallbackFunction});if(c.crCloseOnSubmit){if(c.ownerCt&&c.ownerCt.crClose){c.ownerCt.crClose();}}}});},crGetRecordSelections:function(){var a=this;var c={};if(a.crRecordSelection){Ext.apply(c,a.crRecordSelection);}var b=a.crCenterPanel.getRootNode();b.cascade(function(g){var f=g.getUI();var d=g.attributes;if(f.isChecked()){if(!c[d.crTableName]){c[d.crTableName]=[];}if(!c[d.crTableName].includes(d.crTargetSerial)){c[d.crTableName].push(d.crTargetSerial);}}});return c;},crFileTransfer:function(c){var b=new CR.XML();var g=b.addContainer(b.getRootElement(),"sequence");var f=b.addContainer(g,"transaction");var d=b.addContainer(f,"step");var a=b.addContainer(d,"fileTransferRequest");b.addOption(a,"operation","EXTRACT_DOCUMENT_INDEX_FIELDS");b.addSerial(a,"formTypeSerial",c.formTypeSerial);if(c.personSerial){b.addSerial(a,"personSerial",c.personSerial);}else{if(c.accountSerial){b.addSerial(a,"accountSerial",c.accountSerial);}else{if(c.applicationSerial){b.addSerial(a,"applicationSerial",c.applicationSerial);}}}CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),success:function(k){var i=null;var m="failed";var l=[];var j=CR.JSON.parse(k.responseText);var o=j.query;if(o){Ext.each(o.sequence,function(p){Ext.each(p.transaction,function(q){m=q.$attr.result;Ext.each(q.exception,function(r){l.push(r.message);});Ext.each(q.step,function(r){if(r.tranResult&&r.tranResult.category&&r.tranResult.category.option&&r.tranResult.category.option==="E"){l.push(r.tranResult.description);}else{if(r.fileTransferRequest){i=r.fileTransferRequest;}}});});});}if(m!=="posted"||l.length>0){CR.Core.displayExceptions({items:l});
}else{if(i&&i.fileTransferRecord){var h=new CR.FileTransfer.DocumentIndexPanel({crFileTransferRequest:i,crFormSerial:c.formSerial});var n=new CR.Window({title:"Form Storage",autoScroll:true,modal:true,width:700,autoHeight:true,buttonAlign:"center",buttons:[{text:"Ok",handler:function(){if(h.crIsValid()){h.crInsertFileTransferRecords({callbackFunction:function(){Ext.MessageBox.alert("Form Storage Confirmation","The File Transfer Request record has been inserted successfully.");n.crClose();}});}}}]});CR.Core.addToContainerAndShow(n,h);}}}});},crUpdateInteractionForm:function(a,h){var c=new CR.XML();var i=c.addContainer(c.getRootElement(),"sequence");var g=c.addContainer(i,"transaction");var d=c.addContainer(g,"step");var b=c.addContainer(d,"record");c.addText(b,"tableName","INTERACTION");c.addOption(b,"operation","U");c.addText(b,"targetSerial",a);c.addOption(b,"includeTableMetadata","N");c.addOption(b,"includeColumnMetadata","N");c.addOption(b,"includeRowDescriptions","Y");var f=c.addContainer(b,"field");c.addText(f,"columnName","FORM_SERIAL");c.addOption(f,"operation","S");c.addText(f,"newContents",h);CR.Core.ajaxRequest({url:"DirectXMLPostJSONSteps",xmlData:c.getXMLDocument(),success:function(j){var l=JSON.parse(j.responseText);var k=l.exceptions;if(k&&k.length){CR.Core.displayExceptions({items:k.map(function(m){return m.message;})});}}});},crUploadDocument:function(){var h=this;var m=h.crInteractionSerial;var j=h.crFormTypeSerialField;var c=j.crGetNewRowDescription();var k=j.crGetNewContents();var g=h.crPrimaryTableRecordField;var l=g.crGetNewRowDescription();var f=null;var b=null;var a=[];a.push({crColumnName:"TYPE_SERIAL",crContents:k,crRowDescription:c});if(g.crTableName==="ACCOUNT"){f=g.crGetNewContents();a.push({crColumnName:"ACCOUNT_SERIAL",crContents:f,crRowDescription:l});}else{if(g.crTableName==="APP"){b=g.crGetNewContents();a.push({crColumnName:"APPLICATION_SERIAL",crContents:b,crRowDescription:l});}}var d=h;var i=new CR.Window({title:"Upload Form",autoScroll:true,modal:true,width:700,autoHeight:true});CR.FMPanel.open({container:i,fmRequest:{requestType:"insert",tableName:"FORM"},fmPanelConfig:{crPanelTitleSuppress:true,crFieldDefaultValues:a,crCallbackFunctionScope:d,crSuppressExternalRefreshOnSubmit:true,crOnFMPostSuccess:function(n){var o=n.crTargetSerial;d.crFileTransfer({formSerial:o,formTypeSerial:k,primaryRecordRowDescription:l,accountSerial:f,applicationSerial:b});if(m){d.crUpdateInteractionForm(m,o);}i.crClose();}}});if(h.ownerCt&&h.ownerCt.crClose){h.ownerCt.crClose();}}});CR.PDFDocument.show=function(a){if(!a.crContainer){a.height=500;a.width=700;}function b(){var d=new CR.PDFDocument(a);if(a.crContainer){CR.Core.addToContainerAndShow(a.crContainer,d);}else{var g=(a.crWindowParams&&a.crWindowParams.title)||"Process Form";var f=(a.crWindowParams&&a.crWindowParams.renderTo)||null;var c=new CR.Window({title:g,renderTo:f,modal:true,layout:"fit",items:[d]});if(!a.crSkipRecordSelection){c.crShow();}}}if(!a.crFromScript&&CR.Core.recordView){CR.Core.recordView({tableName:"FORM_TYPE",targetSerial:a.crFormTypeSerial,fields:[{columnName:"SCRIPT_SERIAL"}],callbackFunction:function(c){if(c.tranResult==="posted"){var d=c.record;if(d&&d["SCRIPT_SERIAL"]){CR.ScriptManager.showScript({workArea:"A",defaultPanel:a.defaultPanel,scriptSerial:d["SCRIPT_SERIAL"],personSerial:a.crPersonSerial,crInteractionSerial:a.crInteractionSerial,crDisputeSerial:a.crDisputeSerial,crWorkTaskSerial:a.crWorkTaskSerial,crApplicationSerial:a.crApplicationSerial,crWorkflowSerial:a.crWorkflowSerial,crFormTypeSerial:a.crFormTypeSerial,callbackFunction:a.crShowScriptCallback,callbackScope:a.defaultPanel});}else{if(CR.Core.tableList.length===0){CR.Core.retrieveTableList({success:b,failure:b});}else{b();}}}}});}else{if(CR.Core.tableList.length===0){CR.Core.retrieveTableList({success:b,failure:b});}else{b();}}};CR.PDFDocument.editForm=function(c){c=Ext.apply({formSerial:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},c);var f=c.formSerial;var b=c.fmPanel;function a(){var k=window.location.protocol+"//";k+=window.location.host+"/";k+=CR.Login.locationName+"/PDFFormEdit";k+="/FORM="+f;var i=k+"/form.fdf";var j=k+"/form.pdf"+"?__fdf="+encodeURIComponent(i);var h=j+"#FDF="+i;var g=window.open(h,"_blank","scrollbars=1,location=0,status=0,menubar=1,resizable=1");var l=setInterval(function(){if(g.closed){clearInterval(l);c.callbackFunction.call(c.callbackScope,c.callbackArgs);}},500);}function d(){var g=window.location;var h=g.protocol+"//"+g.host+"/"+CR.Login.locationName;h+="/PDFFormEdit";h+="/FORM="+f;h+="/form.pdf";CR.Core.recordView({tableName:"FORM",targetSerial:f,fields:[{columnName:"TYPE_SERIAL"},{columnName:"APPLICATION_SERIAL"},{columnName:"ACCOUNT_SERIAL"},{columnName:"TRANSACTION_SERIAL"}],callbackFunction:function(s){var i=s.record;if(i){var q=CR.PDFDocument.generateUID({targetSerial:f,description:i.rowDescription});var n=new CR.XML();var p=n.getRootElement();var l=n.addContainer(p,"sequence");var k=n.addContainer(l,"transaction");var j=n.addContainer(k,"step");var m=n.addContainer(j,"record");n.addText(m,"tableName","FORM");n.addOption(m,"operation","V");n.addText(m,"targetSerial",f);n.addOption(m,"includeTableMetadata","N");n.addOption(m,"includeColumnMetadata","N");n.addOption(m,"includeRowDescriptions","N");n.addOption(m,"includeAllColumns","N");var r=null;r=n.addContainer(m,"field");n.addText(r,"columnName","IMAGE");var j=n.addContainer(k,"step");var o=n.addContainer(j,"fileTransferRequest");n.addOption(o,"operation","EXTRACT_DOCUMENT_INDEX_FIELDS");n.addText(o,"formTypeSerial",i["TYPE_SERIAL"]);if(i["ACCOUNT_SERIAL"]){n.addText(o,"accountSerial",i["ACCOUNT_SERIAL"]);}else{if(i["APPLICATION_SERIAL"]){n.addText(o,"applicationSerial",i["APPLICATION_SERIAL"]);}}CR.Core.ajaxRequest({url:"PDFFormEdit2",params:{uid:q.uid,filename:q.description,postURL:h},xmlData:n.getXMLDocument(),success:function(u){var t=CR.JSON.parse(u.responseText);CR.KeyStoneService.runForm({uid:q.uid,filename:q.description,pdf:t.pdf,fdf:t.fdf,callbackFunction:function(v){c.callbackFunction.call(c.callbackScope,v);}});}});}}});}if(CR.KeyStoneService.isAdobeAcrobatPluginAvailable()){a();}else{d();}};CR.PDFDocument.printForm=function(a){a=Ext.apply({formSerial:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},a);var b=a.formSerial;CR.Core.recordView({tableName:"FORM",targetSerial:b,fields:[{columnName:"IMAGE"}],callbackFunction:function(c){var f=c.record;if(f){var d=CR.PDFDocument.generateUID({targetSerial:b,description:f.rowDescription});CR.KeyStoneService.printForm({uid:d.uid,filename:"F"+b+"_"+Date.now(),pdf:f["IMAGE"],printer:"Microsoft XPS Document Writer",callbackFunction:function(g){a.callbackFunction.call(a.callbackScope,g);}});}}});};CR.PDFDocument.generateUID=function(a){a=Ext.apply({targetSerial:null,description:null},a);var b=new Date().getTime();if(a.targetSerial){b=a.targetSerial+"_"+b;}var c=a.description||"";if(c){c=c.replace(/(?!\w|\s)./g,"_").replace(/\s+/g," ").substring(0,100).trim();c+=" "+b;}else{c=b;}return{uid:b,description:c};};CR.PDFDocument.setupFMPanelButton=function(a){if(a.crTableName==="FORM"&&a.crRequestType==="update"){var c=a.getBottomToolbar();var b=new CR.ToolbarButton({text:"Add Signatures",listeners:{click:function(){CR.PDFDocument.editForm({formSerial:a.crTargetSerial,callbackFunction:function(i){if(a&&!a.crIsDestroyed()){var h=a.find("crColumnName","IMAGE");if(h&&h.length>0){var f=h[0];if(f){var d=f.crGetBinaryURL()+"&cb="+new Date().getTime();var g='<iframe id="'+f.crBinaryId+'" width="100%" height="100%" frameBorder="0" src="'+d+'""/>';f.body.update(g);}}}}});}}});c.add(b,"-");c.doLayout();}};Ext.namespace("CR.Script");CR._scriptWindow=self;CR._keyStonewindow=top;if(top===self){CR._keyStonewindow=self.opener;}CR._scriptWindow.addEventListener("message",function(a){var l=a.data;if(l){if(l.coreParams&&CR.Script.getCoreParamsArgs){var i=CR.Script.getCoreParamsArgs;i.callbackFunction.call(i.callbackScope,l.coreParams);}if(l.messageType==="fm"){var b=l;var c=false;if(b.responseRequired&&b.callbackId){var g=CR._callbackEventMap||(CR._callbackEventMap={});var k=g[b.event]||(g[b.event]=[]);k.push(b.callbackId);}if(b.event==="beforepost"){CR._fmBeforePostMessage=b;}if(b.event==="afterpost"){CR._fmPosted=true;}if(CR.Script.fmMessageHandler){if(typeof CR.Script.fmMessageHandler==="object"&&typeof CR.Script.fmMessageHandler["afterpost"]==="function"){CR._fmHasAfterPost=true;}if(typeof CR.Script.fmMessageHandler==="function"){c=true;CR.Script.fmMessageHandler(b);}else{if(typeof CR.Script.fmMessageHandler==="object"&&typeof CR.Script.fmMessageHandler[b.event]==="function"){c=true;CR.Script.fmMessageHandler[b.event](b);}else{if(b.event==="beforepost"){c=true;CR.Script.fmPost({query:b.query});}else{if(b.event==="close"&&(!CR._fmPosted||!CR._fmHasAfterPost)){c=true;CR.Script.closeScript();}}}}}if(b.responseRequired&&!c){b.unhanded=true;CR.Script.sendFMResponse(b);}}else{if(l.messageType==="fmresponse"){var d=l;var h=Ext.getCmp(d.hostPanelId);if(h&&!h.crIsDestroyed()){CR.FMScript.handleValidationResponse(h,d);}}else{if(l.messageType==="workflow"){var j=l;var f=false;if(typeof CR.Script.keyStoneMessageHandler==="function"&&j.stepScript){CR.Script.keyStoneMessageHandler(j);return;}if(j.responseRequired&&j.callbackId){var g=CR._callbackEventMap||(CR._callbackEventMap={});var k=g[j.event]||(g[j.event]=[]);k.push(j.callbackId);}if(j.event==="beforepost"){CR._workflowBeforePostMessage=j;}if(j.event==="afterpost"){CR._workflowPosted=true;}if(CR.Script.workflowMessageHandler){if(typeof CR.Script.workflowMessageHandler==="object"&&typeof CR.Script.workflowMessageHandler["afterpost"]==="function"){CR._workflowHasAfterPost=true;}if(typeof CR.Script.workflowMessageHandler==="function"){f=true;CR.Script.workflowMessageHandler(j);}else{if(typeof CR.Script.workflowMessageHandler==="object"&&typeof CR.Script.workflowMessageHandler[j.event]==="function"){f=true;CR.Script.workflowMessageHandler[j.event](j);}else{if(j.event==="beforepost"){f=true;CR.Script.fmPost({query:j.query});}else{if(j.event==="close"&&(!CR._workflowPosted||!CR._workflowHasAfterPost)){f=true;CR.Script.closeScript();}}}}}if(j.responseRequired&&!f){j.unhanded=true;CR.Script.sendWorkflowResponse(j);}}}}if(l.callbackId){CR.Core.executeCallback(l.callbackId,l);}}},false);CR.Script.messageKeyStone=function(a){a=Ext.apply({scriptPanelId:CR.Script.scriptDefaultPanelId,event:null},a);a.source="script";CR._keyStonewindow.postMessage(a,window.location.href);};CR.Script.getCoreParams=function(a){CR.Script.getCoreParamsArgs=Ext.apply({callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);CR.Script.messageKeyStone({getCoreParams:true});};CR.Script.closeScript=function(a){if(top===self){self.close();}else{a=Ext.apply({closeScriptPanel:true},a);CR.Script.messageKeyStone(a);}};CR.Script.setVisible=function(a){CR.Script.messageKeyStone({setVisible:a});};CR.Script.refreshComponents=function(){CR.Script.messageKeyStone({refreshComponents:true});};CR.Script.refreshWorkflow=function(){CR.Script.messageKeyStone({refreshWorkflow:true});};CR.Script.updateApplicationContinue=function(){CR.Script.messageKeyStone({updateApplicationContinue:true});};CR.Script.setBounds=function(a){CR.Script.messageKeyStone({bounds:a});};CR.Script.runScript=function(b){b=Ext.apply({event:"runscript",scriptSerial:null,scriptDescription:null,scriptArgs:null,scriptDisplayLocation:null,scriptRunInNewPanel:false,callbackFunction:null,callbackScope:this,callbackArgs:{}},b);if(b.scriptSerial){if(b.callbackFunction){b.runScriptCallbackId=CR.Core.registerCallback({callbackFunction:b.callbackFunction,callbackScope:b.callbackScope,callbackArgs:b.callbackArgs});}delete b.callbackFunction;delete b.callbackScope;delete b.callbackArgs;CR.Script.messageKeyStone(b);}else{if(b.scriptDescription){var a=new CR.XML();var h=a.addContainer(a.getRootElement(),"sequence");var f=a.addContainer(h,"transaction");var d=a.addContainer(f,"step");var c=a.addContainer(d,"search");a.addText(c,"tableName","SCRIPT");a.addText(c,"filterName","BY_EXACT_DESCRIPTION");a.addCount(c,"returnLimit","1");var g=a.addContainer(c,"parameter");a.addText(g,"columnName","DESCRIPTION");a.addText(g,"contents",b.scriptDescription);CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),success:function(j){var n=null;var l="failed";var k=[];var i=CR.JSON.parse(j.responseText);var m=i.query;if(m){Ext.each(m.sequence,function(o){Ext.each(o.transaction,function(p){l=p.$attr.result;Ext.each(p.exception,function(q){k.push(q.message);});Ext.each(p.step,function(q){if(q.tranResult&&q.tranResult.category&&q.tranResult.category.option&&q.tranResult.category.option==="E"){k.push(q.tranResult.description);}else{if(q.search){n=q.search;}}});});});}if(l!=="posted"||k.length>0){CR.Core.displayExceptions({items:k});}else{if(n&&n.resultRow){b.scriptSerial=n.resultRow[0].serial;CR.Script.runScript(b);}}}});}}};CR.Script.runForm=function(a){a=a||{};a.crFromScript=true;if(a.crMonitor===undefined){a.crMonitor=CR.Script.formMonitor;}CR.PDFDocument.show(a);};CR.Script.runReport=function(a){a=Ext.apply({reportUnit:null,dashboardResource:null,decorate:false,parameters:{},container:"_blank"},a);a.parameters=Ext.apply({"KeyStone_workArea":"script"},a.parameters||{});CR.Jaspersoft.display(a);};CR.Script.validateAddress=function(b){b=Ext.apply({address:{},callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);var a=Ext.apply({ADDITIONAL_ADDRESS_LINE:"",STREET:"",CITY:"",STATE:"",POSTAL_CODE:"",COUNTRY:"",COUNTRY_CODE:"",callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b.address);CR.AddressValidation.validateAddress({address:a,callbackFunction:function(c){b.callbackArgs.addressValidated=!!c.addressValidated;b.callbackArgs.cancel=!!c.cancel;b.callbackArgs.edit=!!c.edit;b.callbackArgs.forceAccept=!!c.forceAccept;if(c.validatedAddress){b.callbackArgs.validatedAddress={ADDITIONAL_ADDRESS_LINE:c.validatedAddress["ADDITIONAL_ADDRESS_LINE"]||"",STREET:c.validatedAddress["STREET"]||"",CITY:c.validatedAddress["CITY"]||"",STATE:c.validatedAddress["STATE"]||"",POSTAL_CODE:c.validatedAddress["POSTAL_CODE"]||"",COUNTRY:c.validatedAddress["COUNTRY"]||"",COUNTRY_CODE:c.validatedAddress["COUNTRY_CODE"]||"",ADDRESS_CONFIRMATION_DATE:c.validatedAddress["ADDRESS_CONFIRMATION_DATE"]||"",ADDRESS_CONFIRMATION_OPTION:c.validatedAddress["ADDRESS_CONFIRMATION_OPTION"]||"",CARRIER_ROUTE:c.validatedAddress["CARRIER_ROUTE"]||"",LATITUDE:c.validatedAddress["LATITUDE"]||"",LONGITUDE:c.validatedAddress["LONGITUDE"]||""};}b.callbackFunction.call(b.callbackScope,b.callbackArgs);}});};CR.Script.includeJSCSS=function(a){a=Ext.apply({url:null,errorHandler:CR.Core.emptyFunction,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);CR.Core.includeJSCSS(a);};CR.Script.showFMPopup=function(b){b=Ext.apply({tableName:"PERSON",postingMode:"P",operation:"insert",targetSerial:null,parentSerial:null,columnName:null,defaultValues:null,defaultViewGroups:null,fmScriptSerial:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);var c=[];Ext.each(b.defaultValues,function(d){if(d.columnName){c.push({crColumnName:d.columnName,crContents:d.contents,crRowDescription:d.rowDescription,disabled:!!d.disabled,hidden:!!d.hidden,placeholder:d.placeholder});}});var a=[];Ext.each(b.defaultViewGroups,function(d){if(d.viewGroup){a.push({viewGroup:d.viewGroup,disabled:!!d.disabled,hidden:!!d.hidden});}});CR.FMPanel.showInsertUpdateWindow({callCallbackIfCanceled:true,fmRequest:{requestType:b.operation,tableName:b.tableName,targetSerial:b.targetSerial},fmPanelConfig:{crPostingMode:b.postingMode,crParentSerial:b.parentSerial,crFocusColumnName:b.columnName,crFieldDefaultValues:c,crDefaultViewGroups:a,crFieldDefaultValuesCopyHiddenAndDisabledState:true,crCallbackFunction:b.callbackFunction,crCallbackFunctionArgs:b.callbackArgs,crCallbackFunctionScope:b.callbackScope,crPanelTitleSuppress:true,crScriptPanelId:CR.Script.scriptDefaultPanelId,crFMScriptSerial:b.fmScriptSerial,autoScroll:true}});
};CR.Script.sendFMResponse=function(a){a=Ext.apply(a,{hostPanelId:CR.Script.hostPanelId||"",scriptPanelId:CR.Script.scriptPanelId||"",forward:CR.Script.forward});if(CR._callbackEventMap&&CR._callbackEventMap[a.event]){a.callbackId=CR._callbackEventMap[a.event].shift();}a.messageType="fmresponse";CR.Script.messageKeyStone(a);};CR.Script.fmSetField=function(b){b=Ext.apply({columnName:undefined,contents:undefined,error:undefined,disabled:undefined,hidden:undefined,placeholder:undefined},b);if(typeof b.columnName==="string"){var c=CR.Core.copyTo({source:b,primitive:false});var a={};a[b.columnName]=c;CR.Script.sendFMResponse({fields:a});}else{console.warn("CR.Script.fmSetField argument 'columnName' is required");}};CR.Script.fmPopupError=function(b){b=Ext.apply({title:undefined,error:undefined,errors:undefined,exception:undefined,exceptions:undefined,focusField:undefined},b);var a=CR.Core.copyTo({source:b,properties:["error","errors","exception","exceptions","title","focusField"]});CR.Script.sendFMResponse(a);};CR.Script.fmPost=function(b){b=Ext.apply({post:true,query:undefined},b);var a=CR.Core.copyTo({source:b,properties:["post","query","action","requestType","callbackId"]});a.event="beforepost";CR.Script.sendFMResponse(a);};CR.Script.fmSetViewGroup=function(c){c=Ext.apply({viewGroup:undefined,disabled:undefined,hidden:undefined},c);if(typeof c.viewGroup==="string"){var b=CR.Core.copyTo({source:c,primitive:false});var a={};a[c.viewGroup]=b;CR.Script.sendFMResponse({viewGroups:a});}else{console.warn("CR.Script.fmSetViewGroup argument 'viewGroup' is required");}};CR.Script.sendWorkflowResponse=function(a){a=Ext.apply(a,{hostPanelId:CR.Script.hostPanelId||"",scriptPanelId:CR.Script.scriptPanelId||"",forward:null});if(CR._callbackEventMap&&CR._callbackEventMap[a.event]){a.callbackId=CR._callbackEventMap[a.event].shift();}a.messageType="workflowresponse";CR.Script.messageKeyStone(a);};CR.Script.workflowSetField=function(b){b=Ext.apply({columnName:undefined,contents:undefined,error:undefined,disabled:undefined,hidden:undefined,placeholder:undefined},b);if(typeof b.columnName==="string"){var c=CR.Core.copyTo({source:b,primitive:false});var a={};a[b.columnName]=c;CR.Script.sendWorkflowResponse({fields:a});}else{console.warn("CR.Script.workflowSetField argument 'columnName' is required");}};CR.Script.workflowPopupError=function(a){a=Ext.apply({title:undefined,error:undefined,errors:undefined,exception:undefined,exceptions:undefined,focusField:undefined},a);var b=CR.Core.copyTo({source:a,properties:["error","errors","exception","exceptions","title","focusField"]});CR.Script.sendWorkflowResponse(b);};CR.Script.workflowPost=function(a){a=Ext.apply({post:true,query:undefined},a);var b=CR.Core.copyTo({source:a,properties:["post","query","action","requestType","callbackId"]});b.event="beforepost";CR.Script.sendWorkflowResponse(b);};CR.Script.workflowAfterPost=function(a){a=Ext.apply({success:true},a);var b=CR.Core.copyTo({source:a,properties:["success","action","requestType","callbackId"]});b.event="afterpost";CR.Script.sendWorkflowResponse(b);};CR.Script.showWorkTask=function(a){CR.Script.messageKeyStone({showWorkTask:a});};CR.Script.showWorkArea=function(a){a=Ext.apply({workArea:"transaction",parameters:{},callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},a);CR.Script.messageKeyStone({showWorkArea:a.workArea||a.workarea,parameters:a.parameters||a.params});};CR.Script.sigPadDisplay=function(a){a=Ext.apply({image:null,clear:true,center:false,x:0,y:0},a);var b=a.image;if(b&&typeof b.getContext==="function"){a.image=b.toDataURL();}CR.Script.messageKeyStone({sigPad:a});};Ext.namespace("CR.FMScript");CR.FMScript={scriptSerialCache:new Ext.util.Observable(),getScriptSerial:function(g){g=Ext.apply({tableName:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},g);var h=null;var d=false;if(g.tableName){h="";if(CR.FMScript.scriptSerialCache.hasOwnProperty(g.tableName)){if(CR.FMScript.scriptSerialCache[g.tableName]==="pending"){d=true;CR.FMScript.scriptSerialCache.on(g.tableName,function(){CR.FMScript.getScriptSerial(g);},this,{single:true});}else{h=CR.FMScript.scriptSerialCache[g.tableName];}}else{d=true;CR.FMScript.scriptSerialCache[g.tableName]="pending";var f=new CR.XML();var c=f.addContainer(f.getRootElement(),"sequence");var b=f.addContainer(c,"transaction");var a=f.addContainer(b,"step");var j=f.addContainer(a,"search");f.addText(j,"tableName","SCRIPT");f.addText(j,"filterName","BY_FM_VALIDATION_TABLE_NAME");f.addCount(j,"returnLimit","1");var i=f.addContainer(j,"parameter");f.addText(i,"columnName","TABLE_NAME");f.addText(i,"contents",g.tableName);CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:f.getXMLDocument(),success:function(l){var p=null;var n="failed";var m=[];var k=CR.JSON.parse(l.responseText);var o=k.query;if(o){Ext.each(o.sequence,function(q){Ext.each(q.transaction,function(r){n=r.$attr.result;Ext.each(r.exception,function(s){m.push(s.message);});Ext.each(r.step,function(s){if(s.tranResult&&s.tranResult.category&&s.tranResult.category.option&&s.tranResult.category.option==="E"){m.push(s.tranResult.description);}else{if(s.search){p=s.search;}}});});});}if(n!=="posted"||m.length>0){CR.Core.displayExceptions({items:m});CR.FMScript.scriptSerialCache[g.tableName]===null;}else{if(p&&p.resultRow&&p.resultRow.length>0&&p.resultRow[0].serial){h=p.resultRow[0].serial;}CR.FMScript.scriptSerialCache[g.tableName]=h;g.callbackFunction.call(g.callbackScope,h);CR.FMScript.scriptSerialCache.fireEvent(g.tableName,h);}}});}}if(!d){g.callbackFunction.call(g.callbackScope,h);}},setup:function(b,a){if(a.crFMScriptSerial){CR.FMScript.runScript(a);}else{if(a.crFMScriptSerial!==""){CR.FMScript.getScriptSerial({tableName:b,callbackFunction:function(c){a.crFMScriptSerial=c||"";CR.FMScript.setup(b,a);}});}}},runScript:function(a){CR.FMScript.setupListeners(a);if(CR.Script){CR.Script.runScript({scriptSerial:a.crFMScriptSerial,validationScript:true,hostPanelId:a.getId(),scriptPanelId:a.crScriptPanelId,forward:a.crScriptPanelId,hidden:true,scriptRunInNewPanel:true,scriptDisplayLocation:"P",callbackFunction:function(b){if(!b.externalWindow&&b.scriptContainerId){a.crScriptContainerId=b.scriptContainerId;CR.FMScript.sendMessage({component:a,message:{event:"afterrender"}});}}});}else{CR.ScriptManager.showScript({scriptSerial:a.crFMScriptSerial,validationScript:true,hostPanelId:a.getId(),hidden:true,workArea:"F",defaultPanel:a.crFMPanelContainer||CR.FMPanel.getDefaultContainer(),callbackFunction:function(b){a.crScriptContainer=b.scriptContainer;a.crScriptWindow=b.scriptWindow;CR.FMScript.sendMessage({component:a,message:{event:"afterrender"}});}});}},setupListeners:function(a){a.on("beforerender",function(){CR.FMScript.sendMessage({component:a,message:{event:"beforerender"}});});a.on("beforedestroy",function(){CR.FMScript.sendMessage({component:a,message:{event:"close"}});});a.on("hide",function(){CR.ScriptManager.setVisible(a,false);});a.on("show",function(){CR.ScriptManager.setVisible(a,true);});var f=a.findBy(function(g){return g.crGetDataType!==undefined;});for(var c=0;c<f.length;++c){var b=f[c];var d="change";if(b.getXType()==="crOptionField"){d="optionchange";}else{if(b.getXType()==="crSerialField"){d="serialchange";}}b.addListener(d,function(j,i,g){if(j.getXType()==="crMoneyField"){g=CR.MoneyField.convertFromDisplay(CR.MoneyField.convertToDisplay(g));i=CR.MoneyField.convertFromDisplay(CR.MoneyField.convertToDisplay(i));}else{if(j.getXType()==="crRateField"){g=CR.RateField.convertFromDisplay(CR.RateField.convertToDisplay(g));i=CR.RateField.convertFromDisplay(CR.RateField.convertToDisplay(i));}else{if(j.getXType()==="crDateField"){g=CR.DateField.convertFromDisplay(CR.DateField.convertToDisplay(g));i=CR.DateField.convertFromDisplay(CR.DateField.convertToDisplay(i));}else{if(j.getXType()==="crTimeField"){g=CR.TimeField.convertFromDisplay(CR.TimeField.convertToDisplay(g));i=CR.TimeField.convertFromDisplay(CR.TimeField.convertToDisplay(i));}}}}if(i!==g){var h={event:"fieldchange",xtype:j.getXType(),columnName:j.crColumnName,newContents:i,oldContents:g};if(j.crGetNewRowDescription){h.newRowDescription=j.crGetNewRowDescription();}if(j.crGetOldRowDescription){h.oldRowDescription=j.crGetOldRowDescription();}if(j.crGetNewDisplayContents){h.newDisplayContents=j.crGetNewDisplayContents();if(j.crGetOptionDescription){h.oldDisplayContents=j.crGetOptionDescription(g);}}CR.FMScript.sendMessage({component:a,message:h});}});b.addListener("blur",function(h){var g="";if(typeof h.crGetNewContents==="function"){g=h.crGetNewContents()||"";}var i={event:"fieldblur",xtype:h.getXType(),columnName:h.crColumnName,newContents:g};if(h.crGetNewRowDescription){i.newRowDescription=h.crGetNewRowDescription();}if(h.crGetNewDisplayContents){i.newDisplayContents=h.crGetNewDisplayContents();}CR.FMScript.sendMessage({component:a,message:i});});}},isScriptUsed:function(a){var d=false;if(CR.Script&&a.crScriptContainerId){d=true;}else{if(a.crFMScriptSerial&&(a.crScriptContainer||a.crScriptWindow)){if(!a.crScriptWindow&&a.crScriptContainer&&a.crScriptContainer.getEl){var c=a.crScriptContainer.getEl();if(c){var b=c.child("iframe");if(b&&b.dom&&b.dom.contentWindow){a.crScriptWindow=b.dom.contentWindow;}}}d=!!a.crScriptWindow;}}return d;},sendMessage:function(n){n=Ext.apply({component:null,message:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},n);var l=n.component;var b=n.message;if(!l||!b){return;}var a=CR.FMScript.isScriptUsed(l);if(!a||l.crScriptEventsDisabled){return;}if(b.responseRequired){b.callbackId=CR.Core.registerCallback(n);}var g=CR.Core.safeGet(b,["query","sequence",0,"transaction",0,"step",0,"record","operation","option"]);if(g){switch(g){case"I":g="insert";break;case"U":g="update";break;case"D":g="delete";break;}}b=Ext.apply({source:"fmpanel",requestType:g||l.crRequestType||"update",tableName:l.crTableName,tableDescription:l.crTableDescription,targetSerial:l.crTargetSerial,rowDescription:l.crRowDescription,parentSerial:l.crParentSerial,defaultsSerial:l.crDefaultsSerial},b);var o=false;var j={};var m={};var d=CR.Core.findFields(l);for(var h=0;h<d.length;++h){var c=d[h];var f=c.crGetNewContents();var k=c.crGetOldContents();if(!c.crExcludeFromFMPanel){if(f!==k){o=true;}j[c.crColumnName]={contents:f};if(c.getXType()==="crSerialField"){j[c.crColumnName]["rowDescription"]=c.crGetNewRowDescription(f);}else{if(c.getXType()==="crOptionField"){j[c.crColumnName]["text"]=c.crGetOptionDescription(f);}}}}Ext.each(l.findByType("crFieldSet"),function(i){if(i.crViewGroup){m[i.crViewGroup]={hidden:!i.isVisible()};}});b=Ext.apply({messageType:"fm",event:null,fields:j,viewGroups:m,changeFound:o,exceptions:[]},b);if(CR.Script){b.scriptPanelId=l.crScriptPanelId;b.hostPanelId=l.getId();b.forward=l.crScriptContainerId;CR.Script.messageKeyStone(b);}else{CR.ScriptManager.sendMessage({component:l,message:b});}},handleValidationResponse:function(n,g){if(n.crIsDestroyed()){return;}n.crScriptEventsDisabled=true;var b=null;var r=false;if(g.focusField){b=CR.Core.findFields(n,g.focusField).shift();}if(n.crExceptionMenu){n.crExceptionButton.hide();n.crExceptionMenu.removeAll();}if(g.viewGroups){var u=g.viewGroups;for(var l in u){if(u.hasOwnProperty(l)){var m=u[l];if(Ext.isObject(m)){var t=n.find("crViewGroup",l).shift();if(t){if(m.hasOwnProperty("disabled")){t.cascade(function(w){if(w.crGetColumnName&&w.setDisabled){w.setDisabled(w.crCoreDisabled||m.disabled);}});}if(m.hasOwnProperty("hidden")){t.setVisible(!m.hidden);}if(m.hasOwnProperty("collapsed")){if(t.collapsed!==m.collapsed){t.toggleCollapse(true);}}}}}}}if(g.fields){function h(x,z){var w=false;if((!z||z.length===0)&&x.clearInvalid){x.clearInvalid();return;}if(!Ext.isArray(z)){z=[z];}var y="";Ext.each(z,function(A){if(w){y+="<br/>";}if(A){y+=CR.Core.htmlText(A);w=true;}});if(w){if(!b){b=x;}if(x.validationTask){x.validationTask.cancel();}x.markInvalid('<span class="cr-script-invalid-msg">'+y+"</span>");if(n.crFMType!=="delete"&&typeof n.crAddExceptionMenuItem==="function"){n.crAddExceptionMenuItem({field:x,html:y});}}return w;}var o=g.fields;for(var f in o){if(o.hasOwnProperty(f)){var q=true;var c={};var p=o[f];if(Ext.isObject(p)){q=false;c=p;if(c.hasOwnProperty("contents")){p=c.contents;q=true;}}var v=CR.Core.findFields(n,f).shift();if(v){var i=false;var s=v.crGetNewContents();if(q&&s!==p){if(v.crSetSerial){var j=c["rowDescription"]||c["description"]||c["text"];if(p){v.crSetSerial(p,j||p);}else{v.crSetSerial();}}else{if(v.crSetContents){v.crSetContents(p);}}i=true;}if(c){Ext.apply(v,c);if(c.hasOwnProperty("required")){v.allowBlank=!c.required;if(typeof v.isValid==="function"){v.isValid(false);}}if(c.hasOwnProperty("disabled")){v.setDisabled(c.disabled);}if(c.hasOwnProperty("hidden")){v.setVisible(!c.hidden);}if(c.hasOwnProperty("placeholder")){var d=v.getEl();if(d){d.set({placeholder:c.placeholder});}}if(c.hasOwnProperty("exception")||c.hasOwnProperty("exceptions")||c.hasOwnProperty("error")||c.hasOwnProperty("errors")){h(v,c.exception||c.exceptions||c.error||c.errors);}}if(i){CR.Core.highlightFieldChange({fieldComponent:v});}}}}}var a=[];var k=g.exception||g.exceptions||g.error||g.errors||[];if(!Ext.isArray(k)){k=[k];}Ext.each(k,function(x){if(x){if(x.field){var w=CR.Core.findFields(n,x.field).shift();if(w&&w.markInvalid){h(w,x.message);}}else{a.push(x);}}});if(n.crExceptionMenu&&n.crExceptionMenu.items&&n.crExceptionMenu.items.getCount()>0){n.crExceptionButton.show();}if(a.length>0){CR.Core.displayExceptions({title:g.title,cls:"cr-script-exception-text",items:a,focusFld:b});r=true;}if(b&&!r){CR.Core.defer(function(){b.focus(true,false);},this,null,200);}n.crScriptEventsDisabled=false;}};CR.TransactionPanel={};CR.TransactionPanel=Ext.extend(CR.Panel,{crPersonSerial:"",crPersonRowDescription:"",crAccountSerial:"",crAccountRowDescription:"",crTaskSerial:"",crWorkarea:"",crSuppressToolbar:false,crWorkTask:null,crQueueWorkTaskFMPanelId:null,crOnOpenSearchPersonByName:null,crOnOpenSearchPersonByAccountNumber:null,crOnOpenSearchPersonByPhoneNumber:null,crOnOpenSearchAccountSerial:null,crACHLookupDefaults:null,cls:"cr-tran",layout:"border",border:false,closable:true,constructor:function(R){var h=Ext.apply({},R);h.crPersonSerial=h.crPersonSerial||"";h.crPersonRowDescription=h.crPersonRowDescription||"";h.crAccountSerial=h.crAccountSerial||"";h.crAccountRowDescription=h.crAccountRowDescription||"";h.crTaskSerial=h.crTaskSerial||"";h.crSuppressToolbar=h.crSuppressToolbar||false;h.crWorkTask=h.crWorkTask||null;h.crQueueWorkTaskFMPanelId=h.crQueueWorkTaskFMPanelId||null;if(h.crTitle){h.title=h.crTitle;}else{if(!h.crSuppressToolbar){h.title="Transaction";}}var t=[];if(h.crWorkTask){var ab="Update Work Task";if(h.crWorkTask.collectionItemRowDescription){ab="Update Collection Item";}else{if(h.crWorkTask.applicationRowDescription){ab="Update Application";}else{h.title="Work Task";}}var k=new CR.ToolbarButton({text:ab});t.push(k);t=t.concat(h.crTaskToolbarConfig||[]);}else{if(!h.crSuppressToolbar){var X=new CR.Menu();var H=new CR.ToolbarButton({menu:X});var O="";if(h.crOnOpenSearchPersonByName){O=h.crOnOpenSearchPersonByName;}else{if(h.crOnOpenSearchPersonByAccountNumber){O=h.crOnOpenSearchPersonByAccountNumber;}}var ah=new CR.TextField({emptyText:"Search",crContents:O});var F=[];F.push(["LAST_FIRST_MIDDLE_NAME","By Name"]);F.push(["TIN","By TIN"]);F.push(["DRIVER_LICENSE","By Drivers License Number"]);F.push(["PHONE_NUMBER","By Phone Number"]);F.push(["EMAIL_ADDRESS","By Email Address"]);F.push(["CARD_NUMBER","By Card Number"]);F.push(["CARD_NUMBER_TRAILING_DIGITS","By Card Number Trailing Digits"]);F.push(["APPLICATION_NUMBER","By Application Number"]);F.push(["ACCOUNT_NUMBER","Person by Account Number"]);F.push(["ACCOUNT","Account by Account Number"]);F.push(["VIN","Person by Vehicle ID Number"]);F.push(["accountVIN","Account by Vehicle ID Number"]);F.push(["ACCOUNT_INDEX","Person by Account Index"]);F.push(["accountACCOUNT_INDEX","Account by Account Index"]);F.push(["DRAFT_LOOKUP","Person by "+CR.Login.draftCheckText+" Lookup"]);
F.push(["accountDRAFT_LOOKUP","Account by "+CR.Login.draftCheckText+" Lookup"]);F.push(["EXTERNAL_ACCOUNT_NUMBER","Person by External Account Number"]);F.push(["accountEXTERNAL_ACCOUNT_NUMBER","Account by External Account Number"]);F.push(["SERIAL","Person by Person Serial"]);O="LAST_FIRST_MIDDLE_NAME";if(h.crOnOpenSearchPersonByName){O="LAST_FIRST_MIDDLE_NAME";}else{if(h.crOnOpenSearchPersonByAccountNumber){O="ACCOUNT_NUMBER";}}var y=new CR.OptionField({crContents:O,crOptions:F,width:175});var V=new CR.MenuItem({text:"Search"});var E=new CR.MenuItem({text:"Search New"});var j=new CR.Menu({ignoreParentClicks:true,items:[V,E]});var W=new CR.ToolbarButton({text:"Search",menu:j,disabled:true});var A=new CR.ToolbarButton({text:"Clear"});t.push(H,ah,y,W,"-",A);}}var a=CR.Settings.get("transactionAccessOptionsWidth",300);var al=true;if(h.crTaskSerial){al=false;}var M=new CR.MenuItem({text:"Print Complete Member Profile"});var P=new CR.MenuItem({text:"Apply For Loan"});var ac=new CR.MenuItem({text:"Apply For Membership"});var T=new CR.MenuItem({text:"View Card Relationship"});var ai=new CR.MenuItem({text:"Fee Reviewer"});var w=new CR.MenuItem({text:"Card Transaction Reviewer"});var b=new CR.MenuItem({text:"Print Starter Checks"});var C=new CR.MenuItem({text:"Collections Review"});var f=new CR.MenuItem({text:"View Pending Transactions"});var ag=new CR.MenuItem({text:"Statement Inquiry"});var p=new CR.MenuItem({text:"Bulk Deposit Verification"});var S=new CR.MenuItem({text:"Safe Deposit Box Access"});var o=new CR.MenuItem({text:"Initiate Dispute"});var d=new CR.MenuItem({text:CR.Login.shareSavingsText+"/Loan Move"});var x=new CR.MenuItem({text:"View Check Activity"});var G=new CR.MenuItem({text:"Contact Verification"});var i=new CR.MenuItem({text:"Person Consolidation"});var g=new CR.MenuItem({text:"Loan Payment Summary"});var aa=[M,P,ac,T,ai,w,b,C,f,ag,p,S,o,d,x,G,i,g];var v=new CR.Menu({items:aa});var K=new CR.Button({text:"Additional Options",menu:v});var r=true;if(CR.TransactionPanel.scriptsFound){r=false;}var z=new CR.ToolbarButton({text:"Run Script",hidden:r,menu:new CR.Menu({items:[]})});var af=new CR.SerialField({crColumnDescription:"",crTableName:"SCRIPT",crSearchFilterName:"BY_CLIENT_WORK_AREA_DESCRIPTION",crIncludeDescriptionParameter:true,crSearchParameters:[{columnName:"CLIENT_WORK_AREA",contents:"T"}],crNullAllowed:true,hidden:r});var L=new Ext.menu.DateMenu({format:"yyyy-mm-dd",showToday:false,value:CR.DateField.convertToJavaScript(CR.Login.postingDate)});var ae=new Ext.SplitButton({text:"Recent Activity",menu:L});t.push("->",K,"-",z,af,"-",ae);h.tbar=t;var U=new CR.TransactionPanel.SearchPanel({crPersonSelectedContents:h.crPersonSerial,crPersonSelectedContentsDescription:h.crPersonRowDescription,crAccountSelectedContents:h.crAccountRowDescription});var I=new CR.TransactionPanel.PromptPanel();var m=new CR.TransactionPanel.TickerPanel({root:new Ext.tree.AsyncTreeNode({text:"Steps"}),columns:[{header:"Transaction Type",dataIndex:"crTranTypeDescription",percentWidth:0.25,crAlign:"left"},{header:"Description",dataIndex:"crTranDescription",percentWidth:0.5,crAlign:"left"},{header:"Amount",dataIndex:"crTranAmountDisplay",percentWidth:0.25,crAlign:"right"}],loader:new Ext.tree.TreeLoader({uiProviders:{"col":CR.TransactionPanel.TickerPanel.ColumnNodeUI}})});var q=new CR.TransactionPanel.InformationPanel({crTaskSerial:h.crTaskSerial,region:"center"});var Z=new CR.TransactionPanel.SettingsPanel();var D=new CR.Panel({layout:"column",region:"center",items:[I,m],listeners:{afterlayout:function(){for(var am=0;am<this.items.getCount();am++){var an=this.getInnerHeight();this.getComponent(am).setHeight(an);}}}});var Q=CR.Settings.get("transactionInteractionPanelWidth",600);var aj=CR.Settings.get("transactionInteractionPanelIsCollapsed",false);var N=new CR.KeyInsight.InteractionView({crWorkarea:h.crWorkarea,title:"KeyInsight",region:"east",split:true,collapsible:true,collapsed:aj,width:Q,listeners:{resize:function(){CR.Settings.set("transactionInteractionPanelWidth",this.getWidth());},collapse:function(){CR.Settings.set("transactionInteractionPanelIsCollapsed",true);},expand:function(){CR.Settings.set("transactionInteractionPanelIsCollapsed",false);}}});var c=CR.Settings.get("transactionInfoPanelHeight",250);var Y=new CR.Panel({layout:"border",region:"south",collapsible:true,split:true,height:c,items:[q,N],listeners:{resize:function(){CR.Settings.set("transactionInfoPanelHeight",this.getHeight());}}});var u=[];var B=new CR.Panel({crIsTranPanel:true,title:"Transaction",border:false,layout:"border",items:[U,D,Y],crOkToClose:function(){return false;}});u.push(B);function l(aq,am,ao){var ap=new CR.Menu();var an=function(au,ar){var at=true;if(typeof ar.crOkToClose==="function"){at=ar.crOkToClose();}if(at){var av=ar.fireEvent("beforeclose",ar);if(av){ar.fireEvent("close",ar);au.remove(ar);}else{au.setActiveTab(ar);}}};ap.addItem(new CR.MenuItem({text:"Close Tab",handler:function(){an(aq,am);}}));ap.addItem(new CR.MenuItem({text:"Close All Tabs",handler:function(){aq.initItems();aq.items.each(function(at,ar){an(aq,at);});}}));ap.addItem(new CR.MenuItem({text:"Close All Other Tabs",handler:function(){aq.initItems();aq.items.each(function(at,ar){if(at!==am){an(aq,at);}});}}));ap.addListener("hide",ap.destroy,ap);ap.showAt(ao.getXY());}Ext.each(CR.TransactionPanel.scriptsToShowOnProfileAccess,function(am){var an=new CR.TransactionPanel.ScriptTab({crScriptSerial:am.serial,crScriptRowDescription:am.rowDescription,title:CR.Core.htmlText(am.rowDescription),border:false,html:"",crOkToClose:function(){return false;}});u.push(an);});var s=new CR.TabPanel({region:"center",border:true,items:u});s.addListener("contextmenu",l);s.setActiveTab(B);if(CR.KeyStoneLauncherParameters&&CR.KeyStoneLauncherParameters.actionTransactionTree){al=CR.KeyStoneLauncherParameters.actionTransactionTree.collapsed;CR.KeyStoneLauncherParameters.actionTransactionTree=null;}var ad=new CR.Panel({title:"Access Options",region:"west",layout:"accordion",layoutConfig:{hideCollapseTool:true},collapsible:true,collapsed:al,border:true,maxSize:600,width:a,split:true,items:[],listeners:{resize:function(){CR.Settings.set("transactionAccessOptionsWidth",this.getWidth());}}});h.items=[s,ad];CR.TransactionPanel.superclass.constructor.call(this,h);this.crRunScriptButton=z;this.crRunScriptPrompt=af;this.crSettingsPanel=Z;this.crSearchPrompts=U;this.crTranPrompts=I;this.crTranTicker=m;this.crTranInformation=q;this.crInteractionPanel=N;this.crTreePanel=ad;this.crCenterPanel=s;this.crSearchPrompts.crMainTranPanel=this;this.crSearchPrompts.crSettingsPanel=this.crSettingsPanel;this.crSearchPrompts.crTranPrompts=this.crTranPrompts;this.crSearchPrompts.crTranTicker=this.crTranTicker;this.crSearchPrompts.crTranInformation=this.crTranInformation;this.crSearchPrompts.crInteractionPanel=this.crInteractionPanel;this.crSearchPrompts.crTreePanel=this.crTreePanel;this.crSearchPrompts.crCenterPanel=s;this.crTranPrompts.crMainTranPanel=this;this.crTranPrompts.crSettingsPanel=this.crSettingsPanel;this.crTranPrompts.crSearchPrompts=this.crSearchPrompts;this.crTranPrompts.crTranTicker=this.crTranTicker;this.crTranPrompts.crTranInformation=this.crTranInformation;this.crTranPrompts.crInteractionPanel=this.crInteractionPanel;this.crTranPrompts.crTreePanel=this.crTreePanel;this.crTranPrompts.crCenterPanel=s;this.crTranTicker.crMainTranPanel=this;this.crTranTicker.crSettingsPanel=this.crSettingsPanel;this.crTranTicker.crSearchPrompts=this.crSearchPrompts;this.crTranTicker.crTranPrompts=this.crTranPrompts;this.crTranTicker.crTranInformation=this.crTranInformation;this.crTranTicker.crInteractionPanel=this.crInteractionPanel;this.crTranTicker.crTreePanel=this.crTreePanel;this.crTranTicker.crCenterPanel=s;this.crTranInformation.crMainTranPanel=this;this.crTranInformation.crSettingsPanel=this.crSettingsPanel;this.crTranInformation.crSearchPrompts=this.crSearchPrompts;this.crTranInformation.crTranPrompts=this.crTranPrompts;this.crTranInformation.crInteractionPanel=this.crInteractionPanel;this.crTranInformation.crTranTicker=this.crTranTicker;this.crTranInformation.crTreePanel=this.crTreePanel;this.crTranInformation.crCenterPanel=s;this.crSettingsPanel.crMainTranPanel=this;this.crSettingsPanel.crTranInformation=this.crTranInformation;this.crSettingsPanel.crInteractionPanel=this.crInteractionPanel;this.crSettingsPanel.crSearchPrompts=this.crSearchPrompts;this.crSettingsPanel.crTranPrompts=this.crTranPrompts;this.crSettingsPanel.crTranTicker=this.crTranTicker;this.crSettingsPanel.crTreePanel=this.crTreePanel;this.crSettingsPanel.crCenterPanel=s;this.crInteractionPanel.crMainTranPanel=this;var n=this;n.crSetScriptTabParams();if(af){af.addListener("select",function(){var am=af.crGetNewContents();CR.ScriptManager.showScript({workArea:"T",defaultPanel:s,scriptSerial:am,personSerial:n.crSearchPrompts.crPersonSelectedContents,accountSerial:n.crSearchPrompts.crAccountSelectedContentsSerial});CR.ScriptManager.setRecentScriptsForMenu({scriptIdentifier:"transactionRecentScripts",scriptRun:{targetSerial:am,rowDescription:af.crGetNewRowDescription(am)}});af.crSetSerial("","");});}if(z){z.addListener("menushow",function(){var an=this.menu;an.removeAll();var am=CR.ScriptManager.getRecentScriptsForMenu({scriptIdentifier:"transactionRecentScripts"});if(am.length===0){an.add(new Ext.menu.TextItem({text:"No scripts ran to date."}));}else{an.crRecentscripts=am;Ext.each(am,function(ao){an.add(new CR.MenuItem({text:CR.Core.htmlText(ao.rowDescription),handler:function(){CR.Core.getRowDescription({tableName:"SCRIPT",targetSerial:ao.targetSerial,callbackFunction:function(ap){if(ap.rowDescription){CR.ScriptManager.showScript({workArea:"T",defaultPanel:s,scriptSerial:ao.targetSerial,personSerial:n.crSearchPrompts.crPersonSelectedContents,accountSerial:n.crSearchPrompts.crAccountSelectedContentsSerial});}else{CR.Core.displayExceptions({title:"Run Script",items:["The Script '"+ao.rowDescription+"' was not found"]});}CR.ScriptManager.setRecentScriptsForMenu({scriptIdentifier:"transactionRecentScripts",currentRecentScriptsArray:am,remove:!ap.rowDescription,scriptRun:{targetSerial:ao.targetSerial,rowDescription:ao.rowDescription}});}});}}));});}});}if(this.crWorkTask){k.addListener("click",function(am,an){CR.CollectionMain.UpdateCollectionItemWindow.show({crWorkTask:n.crWorkTask,crQueueWorkTaskFMPanelId:n.crQueueWorkTaskFMPanelId,crRenderToId:n.getId(),crAnimateTarget:am.getId()});});}else{if(!h.crSuppressToolbar){U.crQueryField=ah;U.crQueryField.addListener("keyup",function(ao,aq){var ar=ao.crGetNewContents();if(ar){if(ar.indexOf("%E?")===0||ar.indexOf("+E?")===0||ar.indexOf("E?")===0){ar="";ao.crSetContents(ar);}}if(ar){U.crQueryButton.enable();}else{U.crQueryButton.disable();}var an=U.crQueryTypeField.crGetNewContents();var am=CR.PersonSearch.determineFilter(ar,an);var ap=am.newFilter;if(ap!==an){this.crQueryTypeField.crSetContents(ap);}if(am.cardNumber){ao.crSetContents(am.cardNumber);}},U);U.crQueryField.addListener("specialkey",function(an,ao){var ap=an.crGetNewContents();var am=ao.getKey();if(am===Ext.EventObject.ENTER&&ap){U.crInitiateSearch({updateDefaults:true});}else{if(am===Ext.EventObject.DOWN){U.crProduceRecentAccessedMenu();U.crRecentQueryButton.showMenu();}}},U);U.crQueryTypeField=y;U.crQueryTypeField.addListener("specialkey",function(an,ao){var am=ao.getKey();if(am===Ext.EventObject.ENTER){this.crInitiateSearch({updateDefaults:true});}},U);U.crQueryButton=W;V.addListener("click",function(){U.crInitiateSearch({updateDefaults:true});});E.addListener("click",function(){U.crInitiateSearch({showAllResults:true,updateDefaults:true});});X.addListener("beforeshow",this.crProduceRecentAccessedMenu,this);U.crRecentQueryButton=H;U.crRecentQueryButton.addListener("menutriggerover",U.crProduceRecentAccessedMenu,U);U.crClearButton=A;U.crClearButton.addListener("click",function(){U.crClearAll();U.crTranPrompts.crTranSettingsButton.enable();var am=n.crCenterPanel.findBy(function(an){return("crScriptSerial" in an&&"crScriptRowDescription" in an);});if(am.length){am.forEach(function(an){an.crClear();});}},U);U.crEnableSearchPrompts();}}if(this.crPersonSerial){var J=new CR.TreeViewPanel({closable:false,border:false,title:"Relationship Tree",cls:"empty",crTargetSerial:this.crPersonSerial,crTableName:"PERSON",crFMPanelContainer:this.crCenterPanel,crHistoryContainer:this.crCenterPanel,crUpdateTitleWithRowDescription:false});J.addListener({afterrender:J.crInitializeRecordTree});CR.Core.addToContainerAndShow(ad,J);q.crInitiatePersonOrAccountPostingStatus({table:"PERSON",serial:this.crPersonSerial,label:this.crPersonRowDescription,crCallbackFunction:this.crCallbackFunction});this.setTitle(this.crPersonRowDescription||"Transaction");CR.TransactionPanel.SearchPanel.refreshSearchHtml({fmContainerID:s.getId(),refreshContainerId:U.getId()});N.crSetPersonSerial(this.crPersonSerial,this.crPersonRowDescription);}else{if(this.crAccountSerial){var ak=new CR.TreeViewPanel({closable:false,border:false,title:"Relationship Tree",cls:"empty",crTargetSerial:this.crAccountSerial,crTableName:"ACCOUNT",crFMPanelContainer:this.crCenterPanel,crHistoryContainer:this.crCenterPanel,crUpdateTitleWithRowDescription:false});ak.addListener({afterrender:ak.crInitializeRecordTree});CR.Core.addToContainerAndShow(ad,ak);q.crInitiatePersonOrAccountPostingStatus({table:"ACCOUNT",serial:this.crAccountSerial,label:h.crTitle||this.crAccountRowDescription,crCallbackFunction:h.crCallbackFunction});this.setTitle("Account "+this.crAccountRowDescription);CR.TransactionPanel.SearchPanel.refreshSearchHtml({fmContainerID:s.getId(),refreshContainerId:U.getId()});N.crSetAccountSerial(this.crAccountSerial,this.crAccountRowDescription);}}M.addListener("click",function(){var am=this.crSearchPrompts.crPersonSelectedContents;if(!am){CR.Core.displayExceptions({title:"Member Profile Printing Error",items:["You can only print a members profile when on a members profile."]});}else{CR.TransactionPanel.InformationPanel.crPersonAndAccountSummaryPrint({personSerial:am});}},this);P.addListener("click",function(){var an=this.crSearchPrompts.crPersonSelectedContents;var am=this.crSearchPrompts.crPersonSelectedContentsDescription;if(!an){CR.Core.displayExceptions({title:"Application Creation Error",items:["You can only create applications when on a members profile."]});}else{CR.Workflow.insertApplication({appTypeCategory:"L",personSerial:an,personRowDescription:am,modalContainer:this,callbackFunction:CR.TransactionPanel.addTask,callbackFunctionScope:this});}},this);ac.addListener("click",function(){var an=this.crSearchPrompts.crPersonSelectedContents;var am=this.crSearchPrompts.crPersonSelectedContentsDescription;if(!an){CR.Core.displayExceptions({title:"Application Creation Error",items:["You can only create applications when on a members profile."]});}else{CR.Workflow.insertApplication({appTypeCategory:"M",personSerial:an,personRowDescription:am,modalContainer:this,callbackFunction:CR.TransactionPanel.addTask,callbackFunctionScope:this});}},this);T.addListener("click",function(){var ao=this.crSearchPrompts.crPersonSelectedContents;var an=this.crSearchPrompts.crPersonSelectedContentsDescription;if(!ao){CR.Core.displayExceptions({title:"View Card Relationship Error",items:["You can only view card relationships when on a members profile."]});}else{var am=this.crCenterPanel;var ap=new CR.CardManager.CardsByPerson({crTargetSerial:ao,crTableName:"PERSON"});CR.Core.addToContainerAndShow(am,ap);}},this);ai.addListener("click",function(){var ap=this.crSearchPrompts.crPersonSelectedContents;var an=this.crSearchPrompts.crPersonSelectedContentsDescription;var aq=this.crSearchPrompts.crAccountSelectedContentsSerial;var ao=this.crSearchPrompts.crAccountSelectedContents;if(!ap&&!aq){CR.Core.displayExceptions({title:"Fee Reviewer Error",items:["You can only use the fee reviewer when on a member or account profile."]});}else{var am=this.crCenterPanel;CR.FeeReviewer.show({targetSerial:ap?ap:aq,targetRowDescription:an?an:ao,tableName:ap?"PERSON":"ACCOUNT",container:am});
}},this);w.addListener("click",function(){var ap=this.crSearchPrompts.crPersonSelectedContents;var an=this.crSearchPrompts.crPersonSelectedContentsDescription;var aq=this.crSearchPrompts.crAccountSelectedContentsSerial;var ao=this.crSearchPrompts.crAccountSelectedContents;if(!ap&&!aq){CR.Core.displayExceptions({title:"Card Transaction Reviewer Error",items:["You can only use the card transaction reviewer when on a member or account profile."]});}else{var am=this.crCenterPanel;CR.CardTransactionReviewer.show({targetSerial:ap?ap:aq,targetRowDescription:an?an:ao,tableName:ap?"PERSON":"ACCOUNT",container:am});}},this);b.addListener("click",function(){var an=this.crSearchPrompts.crPersonSelectedContents;var am=this.crSearchPrompts.crPersonSelectedContentsDescription;if(!an){CR.Core.displayExceptions({title:"Print Starter Checks Error",items:["You can only print starter checks when on a member or account profile."]});}else{CR.Wycom.PrintStarterChecks.show({personSerial:an,renderToContainer:n});}},this);C.addListener("click",function(){var an=this.crSearchPrompts.crPersonSelectedContents;var am=this.crSearchPrompts.crPersonSelectedContentsDescription;if(!an){CR.Core.displayExceptions({title:"View Card Relationship Error",items:["You can only view collection review when on a member's profile."]});}else{CR.CollectionMain.CollectionReview.show({personSerial:an,container:s});}},this);f.addListener("click",function(){var an=this.crSearchPrompts.crPersonSelectedContents;var am=this.crSearchPrompts.crPersonSelectedContentsDescription;if(!an){CR.Core.displayExceptions({title:"View Pending Transactions Error",items:["You can only view pending transactions when on a member's profile."]});}else{CR.PendingTransactionsPanel.show({personSerial:an,container:s});}},this);ag.addListener("click",function(){var ap=this.crSearchPrompts.crPersonSelectedContents;var an=this.crSearchPrompts.crPersonSelectedContentsDescription;var aq=this.crSearchPrompts.crAccountSelectedContentsSerial;var ao=this.crSearchPrompts.crAccountSelectedContents;if(!ap&&!aq){CR.Core.displayExceptions({title:"Statement Inquiry Error",items:["You can only use the statement inquiry when on a member or account profile."]});}else{var am=this.crCenterPanel;CR.StatementInquiry.show({container:am,personSerial:ap,personRowDescription:an,accountSerial:aq,accountRowDescription:ao});}},this);p.addListener("click",function(){CR.BulkDeposit.showVerificationPanel({userSerial:CR.Login.userSerial,container:CR.FMPanel.getDefaultContainer()});},this);S.addListener("click",function(){var am=this.crSearchPrompts.crPersonSelectedContents;CR.SafetyDepositAccess.crShow({personSerial:am});},this);o.addListener("click",function(){var an=this.crSearchPrompts.crPersonSelectedContents;var am=this.crSearchPrompts.crPersonSelectedContentsDescription;if(!an){CR.Core.displayExceptions({title:"Initiate Dispute",items:["You need to be on a member profile."]});}else{CR.Disputes.initiateDispute({crPersonSerial:an,crPersonRowDescription:am,crTableName:"PERSON",crTargetSerial:an,crRowDescription:am});}},this);d.addListener("click",function(){var an=this.crSearchPrompts.crPersonSelectedContents;var am=this.crSearchPrompts.crPersonSelectedContentsDescription;if(!an){CR.Core.displayExceptions({title:CR.Login.shareSavingsText+"/Loan Move",items:["You need to be on a member profile."]});}else{CR.ShareLoanMove.initiateMove({crTableName:"LOAN",crTableDescription:"Loan",crPersonSerial:an,crPersonRowDescription:am});}},this);x.addListener("click",function(){var am=this.crSearchPrompts.crPersonSelectedContents;if(!am){CR.Core.displayExceptions({title:"View Check Activity",items:["You can only view check activity when on a member's profile."]});}else{U.crDisplayCheckHistory();}},this);G.addListener("click",function(){var am=this.crSearchPrompts.crPersonSelectedContents;if(!am){CR.Core.displayExceptions({title:"Contact Update",items:["You can only review contacts when on a member's profile."]});}else{new CR.ContactUpdate.ContactUpdateManager({ignoreVerifyFlag:true,personSerial:am,container:this,callbackFunction:function(){CR.Core.refreshComponents();}}).show();}},this);i.addListener("click",function(){var an=this.crSearchPrompts.crPersonSelectedContents;var am=this.crSearchPrompts.crPersonSelectedContentsDescription;if(!an){CR.Core.displayExceptions({title:"Loan Move",items:["You need to be on a member profile."]});}else{CR.RecordConsolidation.showPersonConsolidationPrompt({personSerial:an,personRowDescription:am});}},this);g.addListener("click",function(){CR.LoanPaymentSummary.show();});ae.addListener("click",function(){U.crDisplayRecentTransactions();L.picker.setValue(CR.DateField.convertToJavaScript(CR.Login.postingDate));});L.on("select",function(an,am){if(am){U.crDisplayRecentTransactions(CR.DateField.convertFromJavaScript(am));}});v.addListener("afterrender",function(){var am=new CR.XML();var ap=am.addContainer(am.getRootElement(),"sequence");var ao=am.addContainer(ap,"transaction");var an=["WRG_VIEWMBR_URL","WRG_TMPPWD_URL","WRG_SKIPPMT_URL","DELUXE_CHKORD_URL","CPS_CHKORD_URL","HARLAND_CHKORD_URL","LEGACY_CHKORD_URL","IMM_TOTALEATLAS_URL","HYLAND_CHECK_URL","HYLAND_DOC_RTVL_URL","EMC_APPXTENDER_URL","EDOCLOGIC_URL","SYNERGY_SYNSRCH_URL",CR.ClickSwitch.PRODUCT_NAME,CR.CubusLaunchpad.PRODUCT_NAME];an.forEach(function(at){var ar=am.addContainer(ao,"step");var aq=am.addContainer(ar,"search");am.setAttribute(aq,"label",at);am.addText(aq,"tableName","INTERFACE");am.addText(aq,"filterName","BY_DESCRIPTION_PRODUCT");am.addOption(aq,"includeTotalHitCount","Y");am.addOption(aq,"includeSelectColumns","Y");am.addCount(aq,"returnLimit",99);var au=am.addContainer(aq,"parameter");am.addText(au,"columnName","DESCRIPTION");am.addText(au,"contents","");au=am.addContainer(aq,"parameter");am.addText(au,"columnName","PRODUCT");am.addText(au,"contents",at);au=am.addContainer(aq,"parameter");am.addText(au,"columnName","STATUS");am.addText(au,"contents","O");});CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:am.getXMLDocument(),params:{},success:function(ar){var aK=CR.JSON.parse(ar.responseText);var ax=aK.query;var at="failed";var aq=[];var aQ=false;var aw=false;var aP=false;var aL=false;var aE=false;var aO=false;var aR=false;var aN=false;var aG=false;var ay=false;var aA=false;var aM=false;var au=false;var aD=false;if(aK.query){var aB=ax.sequence;if(aB){for(var aJ=0;aJ<aB.length;aJ++){var aI=aB[aJ].transaction;if(aI){for(var aH=0;aH<aI.length;aH++){at=aI[aH].$attr.result;var az=aI[aH].step;if(az){for(var aF=0;aF<az.length;aF++){if(az[aF].tranResult&&az[aF].tranResult.category&&az[aF].tranResult.category.option&&az[aF].tranResult.category.option==="E"){aq.push(az[aF].tranResult.description);}else{if(az[aF].search){var aC=az[aF].search;if(aC.totalHitCount&&(aC.totalHitCount*1)>0){if(aC.$attr&&aC.$attr.label==="WRG_VIEWMBR_URL"){aQ=true;}else{if(aC.$attr&&aC.$attr.label==="WRG_TMPPWD_URL"){aw=true;}else{if(aC.$attr&&aC.$attr.label==="WRG_SKIPPMT_URL"){aP=true;}else{if(aC.$attr&&aC.$attr.label==="DELUXE_CHKORD_URL"){aL=true;}else{if(aC.$attr&&aC.$attr.label==="CPS_CHKORD_URL"){aE=true;}else{if(aC.$attr&&aC.$attr.label==="HARLAND_CHKORD_URL"){aO=true;}else{if(aC.$attr&&aC.$attr.label==="LEGACY_CHKORD_URL"){aR=true;}else{if(aC.$attr&&aC.$attr.label==="IMM_TOTALEATLAS_URL"){aN=true;}else{if(aC.$attr&&aC.$attr.label==="HYLAND_DOC_RTVL_URL"){aG=true;}else{if(aC.$attr&&aC.$attr.label==="EMC_APPXTENDER_URL"){ay=true;}else{if(aC.$attr&&aC.$attr.label==="EDOCLOGIC_URL"){aA=true;}else{if(aC.$attr&&aC.$attr.label==="SYNERGY_SYNSRCH_URL"){aM=true;}else{if(aC.$attr&&aC.$attr.label===CR.ClickSwitch.PRODUCT_NAME){au=true;}else{if(aC.$attr&&aC.$attr.label===CR.CubusLaunchpad.PRODUCT_NAME){aD=true;}}}}}}}}}}}}}}}}}}}}}}}}if(at!=="posted"){CR.Core.displayExceptions({items:aq});}else{if(aQ){v.add(new CR.MenuItem({text:"WRG Member View",handler:function(){CR.WRG.Interface.show({productType:"WRG_VIEWMBR_URL",container:n.crCenterPanel,showInNewWindow:true,panelDefaults:{crPersonSerial:n.crSearchPrompts.crPersonSelectedContents}});}}));}if(aw){v.add(new CR.MenuItem({text:"WRG Email Temporary Password",handler:function(){CR.WRG.Interface.show({productType:"WRG_TMPPWD_URL",container:n.crCenterPanel,showInNewWindow:true,panelDefaults:{crPersonSerial:n.crSearchPrompts.crPersonSelectedContents}});}}));}if(aP){v.add(new CR.MenuItem({text:"WRG Skip a Payment",handler:function(){CR.WRG.Interface.show({productType:"WRG_SKIPPMT_URL",container:n.crCenterPanel,showInNewWindow:true,panelDefaults:{crPersonSerial:n.crSearchPrompts.crPersonSelectedContents}});}}));}if(aL){v.add(new CR.MenuItem({text:"Deluxe Check Order",handler:function(){CR.CheckOrder.show({crPersonSerial:n.crSearchPrompts.crPersonSelectedContents,container:n.crCenterPanel,crProductType:"DELUXE_CHKORD_URL"});}}));}if(aE){v.add(new CR.MenuItem({text:"CPS Check Order",handler:function(){CR.CheckOrder.show({crPersonSerial:n.crSearchPrompts.crPersonSelectedContents,container:n.crCenterPanel,crProductType:"CPS_CHKORD_URL"});}}));}if(aO){v.add(new CR.MenuItem({text:"Harland Clarke Check Order",handler:function(){CR.CheckOrder.show({crPersonSerial:n.crSearchPrompts.crPersonSelectedContents,container:n.crCenterPanel,crProductType:"HARLAND_CHKORD_URL"});}}));}if(aR){v.add(new CR.MenuItem({text:"Main Street Check Order",handler:function(){CR.CheckOrder.show({crPersonSerial:n.crSearchPrompts.crPersonSelectedContents,container:n.crCenterPanel,crProductType:"LEGACY_CHKORD_URL"});}}));}if(aN){v.add(new CR.MenuItem({text:"Open RTS Search...",handler:CR.TeSignLite.openSearchDocQURL}));}if(aG){v.add(new CR.MenuItem({text:"OnBase Document Search",handler:function(){if(n.crSearchPrompts.crPersonSelectedContents){CR.HylandOnBaseServices.show({crTableName:"PERSON",crTargetSerial:n.crSearchPrompts.crPersonSelectedContents,crRowDescription:n.crSearchPrompts.crPersonSelectedContentsDescription,container:n.crCenterPanel});}else{if(n.crSearchPrompts.crAccountSelectedContentsSerial){CR.HylandOnBaseServices.show({crTableName:"ACCOUNT",crTargetSerial:n.crSearchPrompts.crAccountSelectedContentsSerial,crRowDescription:"Account "+n.crSearchPrompts.crAccountSelectedContents,container:n.crCenterPanel});}else{CR.HylandOnBaseServices.show({container:n.crCenterPanel});}}}}));}if(ay){v.add(new CR.MenuItem({text:"EMC Document Search",handler:function(){if(n.crSearchPrompts.crPersonSelectedContents){CR.EMCServices.show({crTableName:"PERSON",crTargetSerial:n.crSearchPrompts.crPersonSelectedContents,crRowDescription:n.crSearchPrompts.crPersonSelectedContentsDescription,container:n.crCenterPanel});}else{if(n.crSearchPrompts.crAccountSelectedContentsSerial){CR.EMCServices.show({crTableName:"ACCOUNT",crTargetSerial:n.crSearchPrompts.crAccountSelectedContentsSerial,crRowDescription:"Account "+n.crSearchPrompts.crAccountSelectedContents,container:n.crCenterPanel});}else{CR.EMCServices.show({container:n.crCenterPanel});}}}}));}if(aA){v.add(new CR.MenuItem({text:"eDoc Logic Document Search",handler:function(){if(n.crSearchPrompts.crPersonSelectedContents){CR.EDocLogicServices.show({crTableName:"PERSON",crTargetSerial:n.crSearchPrompts.crPersonSelectedContents,crRowDescription:n.crSearchPrompts.crPersonSelectedContentsDescription,container:n.crCenterPanel});}else{if(n.crSearchPrompts.crAccountSelectedContentsSerial){CR.EDocLogicServices.show({crTableName:"ACCOUNT",crTargetSerial:n.crSearchPrompts.crAccountSelectedContentsSerial,crRowDescription:"Account "+n.crSearchPrompts.crAccountSelectedContents,container:n.crCenterPanel});}else{CR.EDocLogicServices.show({container:n.crCenterPanel});}}}}));}if(aM){v.add(new CR.MenuItem({text:"Synergy Document Search",handler:function(){if(n.crSearchPrompts.crPersonSelectedContents){CR.SynergyService.show({crTableName:"PERSON",crTargetSerial:n.crSearchPrompts.crPersonSelectedContents,crRowDescription:n.crSearchPrompts.crPersonSelectedContentsDescription,container:n.crCenterPanel});}else{if(n.crSearchPrompts.crAccountSelectedContentsSerial){CR.SynergyService.show({crTableName:"ACCOUNT",crTargetSerial:n.crSearchPrompts.crAccountSelectedContentsSerial,crRowDescription:"Account "+n.crSearchPrompts.crAccountSelectedContents,container:n.crCenterPanel});}else{CR.SynergyService.show({container:n.crCenterPanel});}}}}));}if(au){var av="ClickSWITCH";v.add(new CR.MenuItem({text:"Send to "+av,handler:function(){if(n.crSearchPrompts.crPersonSelectedContents){var aS=new CR.ClickSwitch({personSerial:n.crSearchPrompts.crPersonSelectedContents});aS.show();}else{Ext.Msg.alert("Send to "+av,"Please select a Person Profile before sending to "+av);}}}));}if(aD){var av="CUBUS Launchpad";v.add(new CR.MenuItem({text:"Send to "+av,handler:function(){var aS=new CR.CubusLaunchpad({personSerial:n.crSearchPrompts.crPersonSelectedContents});aS.show();}}));}}}});});this.addListener("beforeclose",function(){var an=true;var am=this;var ao=am.crTranTicker;if(ao&&ao.root&&ao.root.childNodes&&ao.root.childNodes.length>0){an=false;Ext.Msg.confirm("Warning","You have pending transactions in the Ticker. <br/>"+"Are you sure you want to abandon them without posting?",function(ap){if(ap==="yes"){CR.TellerCapture.cancelCapture();am.ownerCt.remove(am);}},this);}return an;});this.addListener("beforedestroy",function(){if(this.crTranPrompts.crSettingsWindow){this.crTranPrompts.crSettingsWindow.destroy();this.crTranPrompts.crSettingsWindow=null;}this.crSettingsPanel.destroy();this.crSettingsPanel=null;},this);if(this.crOnOpenSearchPersonByName||this.crOnOpenSearchPersonByAccountNumber||this.crOnOpenSearchPersonByPhoneNumber||this.crOnOpenSearchAccountSerial){if(this.crOnOpenSearchPersonByName){ah.crSetContents(this.crOnOpenSearchPersonByName);y.crSetContents("LAST_FIRST_MIDDLE_NAME");}else{if(this.crOnOpenSearchPersonByAccountNumber){ah.crSetContents(this.crOnOpenSearchPersonByAccountNumber);y.crSetContents("ACCOUNT_NUMBER");}else{if(this.crOnOpenSearchPersonByPhoneNumber){ah.crSetContents(this.crOnOpenSearchPersonByPhoneNumber);y.crSetContents("PHONE_NUMBER");}}}this.addListener("afterrender",function(){CR.Core.defer(function(){U.crProcessOnSearchPersonBy({updateDefaults:true,onOpenSearchPersonByName:this.crOnOpenSearchPersonByName,onOpenSearchAccountSerial:this.crOnOpenSearchAccountSerial,onOpenSearchPersonByAccountNumber:this.crOnOpenSearchPersonByAccountNumber,onOpenSearchPersonByPhoneNumber:this.crOnOpenSearchPersonByPhoneNumber});this.crOnOpenSearchPersonByName=null;this.crOnOpenSearchPersonByAccountNumber=null;this.crOnOpenSearchPersonByPhoneNumber=null;this.crOnOpenSearchAccountSerial=null;},this);},this);}this.crObtainConfigs();},crExpandWorkTask:function(a){a=Ext.apply({workTaskStepSerial:null,workTaskStepDescription:null},a);var d=this;var b=false;var c=null;d.crTreePanel.cascade(function(f){if(f.crWorkFlowRequest&&f.crWorkFlowRequest.targetSerialResult===a.workTaskSerial){c=f;}});if(c){b=true;d.crTreePanel.expand(false);CR.Core.defer(function(){c.crExpandWorkTask(a);},100);}return b;},crObtainConfigs:function(){if(CR.TransactionPanel.scriptsFound===undefined){var a=new CR.XML();var g=a.addContainer(a.getRootElement(),"sequence");var d=a.addContainer(g,"transaction");var c=a.addContainer(d,"step");var b=a.addContainer(c,"search");a.setAttribute(b,"label","TRANSACTION_SCRIPTS");a.addText(b,"tableName","SCRIPT");a.addText(b,"filterName","BY_CLIENT_WORK_AREA_DESCRIPTION");a.addOption(b,"includeTotalHitCount","Y");a.addOption(b,"includeSelectColumns","Y");a.addCount(b,"returnLimit",1);var f=a.addContainer(b,"parameter");a.addText(f,"columnName","CLIENT_WORK_AREA");a.addText(f,"contents","T");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),scope:this,params:{},success:function(q){var u=CR.JSON.parse(q.responseText);var t=u.query;var p="failed";var v=[];var h=[];if(u.query){var o=t.sequence;if(o){for(var s=0;s<o.length;s++){var m=o[s].transaction;if(m){for(var r=0;r<m.length;r++){p=m[r].$attr.result;var l=m[r].step;if(l){for(var n=0;n<l.length;n++){if(l[n].tranResult&&l[n].tranResult.category&&l[n].tranResult.category.option&&l[n].tranResult.category.option==="E"){v.push(l[n].tranResult.description);
}else{if(l[n].search){var w=l[n].search;if(w.totalHitCount&&(w.totalHitCount*1)>0){if(w.$attr&&w.$attr.label==="TRANSACTION_SCRIPTS"){h=w.resultRow;}}}}}}}}}}}if(p!=="posted"){CR.Core.displayExceptions({items:v});}else{if(h.length>0){CR.TransactionPanel.scriptsFound=true;if(this.crRunScriptPrompt){this.crRunScriptButton.show();this.crRunScriptPrompt.show();}}else{CR.TransactionPanel.scriptsFound=false;}}}});}},crSetScriptTabParams:function(){var a=this;this.crCenterPanel.cascade(function(b){if(b.crIsTransactionScriptTab&&a.crSearchPrompts){b.crSetConfigs({crPersonSelectedContents:a.crSearchPrompts.crPersonSelectedContents,crPersonSelectedContentsDescription:a.crSearchPrompts.crPersonSelectedContentsDescription,crAccountSelectedContents:a.crSearchPrompts.crAccountSelectedContents,crAccountSelectedContentsSerial:a.crSearchPrompts.crAccountSelectedContentsSerial});}});}});Ext.reg("crTransactionPanel",CR.TransactionPanel);CR.TransactionPanel.showPersonProfile=function(l){l=Ext.apply({containerId:undefined,targetSerial:undefined,targetRowDescription:undefined,newTab:false,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},l);var f=l.targetSerial;var m=l.targetRowDescription;var j=l.callbackFunction;if(f){var c=null;c=CR.FMPanel.getDefaultContainer();if(c){var h=c;var d;var i;for(var n=h.items.getCount()-1;n>=0&&(!d||!i);n--){var o=h.items.itemAt(n);if((o.crPersonSerial===f)||(o.crTableName==="PERSON"&&o.crSerialValue===f)){d=o;}if(!o.crTableName&&!o.crSerialValue&&o.crWorkarea==="transaction"){i=o;}}if(d){h.setActiveTab(d);j({personSerial:f,activeTab:d});}else{var b=i||h.activeTab;if(i){h.setActiveTab(i);}var g={crPersonSerial:f,crCallbackFunction:function(){j({personSerial:f,activeTab:h.activeTab});}};var k=null;if(!l.newTab&&b&&!b.crPersonSerial&&b.crSearchPrompts&&b.crWorkarea==="transaction"){k=function(){b.crSearchPrompts.crUpdateFromPersonVerification({data:{rowDescription:m,serial:f},updateDefaults:true,crCallbackFunction:g.crCallbackFunction});};}else{k=function(){g.crPersonRowDescription=m;var a=Object.assign({},g,{crCallbackFunction:function(){b=h.activeTab;b.crSearchPrompts.crUpdateFromPersonVerification({data:{rowDescription:m,serial:f},updateDefaults:true,crCallbackFunction:function(){j({personSerial:f,activeTab:h.activeTab});}});}});CR.TransactionPanel.show({container:h,tranPanelParams:a});};}if(!m){CR.Core.getRowDescription({tableName:"PERSON",targetSerial:f,callbackFunction:function(a){if(a&&a.rowDescription){m=a.rowDescription;k();}}});}else{k();}}}}};CR.TransactionPanel.showAccountProfile=function(n){n=Ext.apply({containerId:undefined,targetSerial:undefined,targetRowDescription:undefined,newTab:false,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},n);var h=n.targetSerial;var p=n.targetRowDescription;var d=n.id;var k=n.callbackFunction;if(h){var c=null;if(d){c=Ext.getCmp(d);}else{c=CR.FMPanel.getDefaultContainer();}if(c){var m=c;var f=null;Ext.each(m.findByType(CR.TransactionPanel),function(a){if(a.crAccountSerial===h||(a.crTableName==="ACCOUNT"&&a.crSerialValue===h)){f=i;}});var g;var j;for(var o=m.items.getCount()-1;o>=0&&(!g||!j);o--){var q=m.items.itemAt(o);if((q.crAccountSerial===h)||(q.crTableName==="ACCOUNT"&&q.crSerialValue===h)){g=q;}if(!q.crTableName&&!q.crSerialValue&&q.crWorkarea==="transaction"){j=q;}}if(g){m.setActiveTab(g);k({accountSerial:h,activeTab:g});}else{var b=j||m.activeTab;if(j){m.setActiveTab(j);}var i={crAccountSerial:h,crCallbackFunction:function(){k({accountSerial:h,activeTab:m.activeTab});}};var l;if(!n.newTab&&b&&!b.crAccountSerial&&b.crSearchPrompts&&b.crWorkarea==="transaction"){l=function(){var a=b.crSearchPrompts;var s=new CR.TreeViewPanel({closable:false,border:false,title:"Relationship Tree",cls:"empty",crTargetSerial:h,crTableName:"ACCOUNT",crFMPanelContainer:a.crCenterPanel,crHistoryContainer:a.crCenterPanel,crUpdateTitleWithRowDescription:false,crForceFilterText:n.forceFilterText});s.addListener({afterrender:s.crInitializeRecordTree});CR.Core.addToContainerAndShow(a.crTreePanel,s);a.crMainTranPanel.setTitle(CR.Core.htmlText("Account "+p));a.crMainTranPanel.crTableName="ACCOUNT";a.crMainTranPanel.crSerialValue=h;a.crMainTranPanel.crAccountSerial=h;var r=a.crTranPrompts.crTranType;r.focus(true,true);CR.Settings.addRecentRow("ACCOUNT",h,p);a.crTranInformation.crInitiatePersonOrAccountPostingStatus({serial:h,label:"Account "+p,table:"ACCOUNT"});};}else{l=function(){i.crAccountRowDescription=p;CR.TransactionPanel.show({container:m,tranPanelParams:i});};}if(!p){CR.Core.getRowDescription({tableName:"ACCOUNT",targetSerial:h,callbackFunction:function(a){if(a&&a.rowDescription){p=a.rowDescription;l();}}});}else{l();}}}}};CR.TransactionPanel.crSetActiveWorkTask=function(a){a=Ext.apply({personSerial:null,personRowDescription:null,workTaskSerial:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},a);if(!a.workTaskSerial){return;}if(!a.personSerial){CR.Core.recordView({tableName:"WORK_TASK",targetSerial:a.workTaskSerial,includeColumnMetadata:"N",includeRowDescriptions:"N",includeAllColumns:"N",fields:["APPLICATION_SERIAL"],displayExceptions:true,callbackFunction:function(b){CR.Core.recordTree({recordTree:{tableName:"APP",viewName:"STANDARD",targetSerial:b.record.APPLICATION_SERIAL,includeRecordDetail:{option:"Y"},recordDetail:{tableName:"APPLICANT"}},callbackFunction:function(c){if(c&&c.APP&&c.APP.APPLICANT&&c.APP.APPLICANT[0]&&c.APP.APPLICANT[0].SOURCE_PERSON_SERIAL){a.personSerial=c.APP.APPLICANT[0].SOURCE_PERSON_SERIAL;a.personRowDescription=c.APP.APPLICANT[0].SOURCE_PERSON_SERIAL_DESCRIPTION;CR.TransactionPanel.crSetActiveWorkTask(a);}}});}});}else{if(!a.personRowDescription){CR.Core.getRowDescription({tableName:"PERSON",targetSerial:a.personSerial,callbackFunction:function(b){if(b&&b.rowDescription){a.personRowDescription=b.rowDescription;CR.TransactionPanel.crSetActiveWorkTask(a);}}});}else{CR.TransactionPanel.showPersonProfile({containerID:a.id,targetSerial:a.personSerial,targetRowDescription:a.rowDescription,callbackFunction:function(b){if(b&&b.activeTab&&b.activeTab.crExpandWorkTask){b.activeTab.crExpandWorkTask(a);}}});}}};CR.TransactionPanel.ScriptTab=Ext.extend(CR.Panel,{crIsTransactionScriptTab:true,crScriptSerial:"",crScriptRowDescription:"",crPersonSelectedContents:null,crPersonSelectedContentsDescription:null,crAccountSelectedContents:null,crAccountSelectedContentsSerial:null,crWasActivated:false,closable:false,layout:"fit",constructor:function(b){var a=Ext.apply({},b);a.title=a.crScriptRowDescription;a.items=[];CR.TransactionPanel.ScriptTab.superclass.constructor.call(this,a);this.addListener("activate",this.crOnActivate);},crOnActivate:function(){if(!this.crWasActivated){CR.Core.clearContainer(this);CR.ScriptManager.showScript({workArea:"T",defaultPanel:this,replaceDefaultPanel:true,scriptSerial:this.crScriptSerial,personSerial:this.crPersonSelectedContents,accountNumber:this.crAccountSelectedContents,accountSerial:this.crAccountSelectedContentsSerial,suppressTitle:true});this.crWasActivated=true;}},crClear:function(){this.crSetConfigs({});this.removeAll();},crSetConfigs:function(a){this.crWasActivated=false;this.crPersonSelectedContents=a.crPersonSelectedContents;this.crPersonSelectedContentsDescription=a.crPersonSelectedContentsDescription;this.crAccountSelectedContents=a.crAccountSelectedContents;this.crAccountSelectedContentsSerial=a.crAccountSelectedContentsSerial;}});CR.TransactionPanel.addTask=function(c){var a=c.crWorkTasks;var b=this;CR.Workflow.show({crQueueWorkTaskFMPanelId:this.crQueueWorkTaskFMPanelId,crWorkTasks:a,crFlowTreeContainer:this.crTreePanel,crFlowFMPanel:this.crCenterPanel,crPersonSerial:this.crSearchPrompts.crPersonSelectedContents,crPersonRowDescription:this.crSearchPrompts.crPersonSelectedContentsDescription,crCallbackFunction:function(){b.crTreePanel.expand(false);}});};CR.TransactionPanel.show=function(c){c=Ext.apply({container:null,replacePanel:null,tranPanelParams:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this},c);var a=c.container;var d=c.replacePanel;var b=c.tranPanelParams;if(!b){b={};}if(!a){a=new CR.Window({title:"Transaction",modal:true,height:600,width:800});a.addButton({text:"ok"});a.addButton({text:"cancel",handler:function(){a.close();}});}var f=function(){var h=new CR.TransactionPanel(b);var g=null;if(d){g=a.items.indexOf(d);a.remove(d);}CR.Core.addToContainerAndShow(a,h,g);c.callbackFunction.call(c.callbackScope,h);};CR.TransactionPanel.getTransactionSalesOpportunityOption({callbackFunction:function(){CR.CFM.getCashMachineList({returnArgs:{callbackFunction:function(){CR.TransactionPanel.getTransactionScriptOptions({callbackFunction:function(){CR.Core.getDevicePrinters({callbackFunction:function(){if(CR.LeagueServiceCorp){CR.LeagueServiceCorp.checkForInterface({callbackFunction:f});}else{f();}}});}});}}});}});};CR.TransactionPanel.getTransactionSalesOpportunityOption=function(b){var a=new CR.XML();var g=a.addContainer(a.getRootElement(),"sequence");var f=a.addContainer(g,"transaction");var c=a.addContainer(f,"step");var d=a.addContainer(c,"opportunityRequest");a.addOption(d,"operation","VIEW_CONFIG");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),crMask:{},params:{},success:function(h){var m=CR.JSON.parse(h.responseText);var l=m.query;var j="failed";var i=[];var k={};if(m.query){Ext.each(l.sequence,function(n){Ext.each(n.transaction,function(o){j=o.$attr.result;Ext.each(o.step,function(p){if(p.tranResult&&p.tranResult.category&&p.tranResult.category.option==="E"){i.push(p.tranResult.description);}else{if(p.opportunityRequest){k=p.opportunityRequest;}}});});});}if(j!=="posted"){CR.Core.displayExceptions({items:i});}else{if(k&&k.salesOpportunityOption){CR.TransactionPanel.salesOpportunityOption=k.salesOpportunityOption;}if(b.callbackFunction){b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}}});};CR.TransactionPanel.getTransactionScriptOptions=function(b){if(CR.TransactionPanel.scriptsToShowOnProfileAccess===undefined){CR.TransactionPanel.scriptsToShowOnProfileAccess=[];var a=new CR.XML();var h=a.addContainer(a.getRootElement(),"sequence");var f=a.addContainer(h,"transaction");var d=a.addContainer(f,"step");var c=a.addContainer(d,"search");a.addText(c,"tableName","SCRIPT");a.addText(c,"filterName","BY_CLIENT_WORK_AREA_DESCRIPTION");a.addOption(c,"includeSelectColumns","Y");a.addOption(c,"includeTotalHitCount","Y");a.addCount(c,"returnLimit",1000);var g=a.addContainer(c,"parameter");a.addText(g,"columnName","CLIENT_WORK_AREA");a.addText(g,"contents","TT");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:a.getXMLDocument(),crMask:{},params:{},success:function(i){var n=CR.JSON.parse(i.responseText);var m=n.query;var k="failed";var j=[];var l=[];if(n.query){Ext.each(m.sequence,function(o){Ext.each(o.transaction,function(p){k=p.$attr.result;Ext.each(p.step,function(r){if(r.tranResult&&r.tranResult.category&&r.tranResult.category.option==="E"){j.push(r.tranResult.description);}else{if(r.search){var q=r.search;l=q.resultRow;}}});});});}if(k!=="posted"){CR.Core.displayExceptions({items:j});}else{Ext.each(l,function(o){CR.TransactionPanel.scriptsToShowOnProfileAccess.push({serial:o.serial,rowDescription:(o.selectColumn&&o.selectColumn[0]&&o.selectColumn[0].contents)||"Undefined"});});if(b.callbackFunction){b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}}});}else{if(b.callbackFunction){b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}};CR.Core.setTranCodeOptions=function(){CR.Core.tranCode={deposit:{code:"D",text:"Deposit (D)",stepType:"postingRequest",funds:"out"},withdrawal:{code:"W",text:"Withdrawal (W)",stepType:"postingRequest",funds:"in"},advance:{code:"A",text:"Advance (A)",stepType:"postingRequest",funds:"in"},loanSegmentAdvance:{code:"SA",text:"Loan Segment Advance (SA)",stepType:"loanSegmentAdvance",funds:"in"},payment:{code:"PA",text:"Payment (PA)",stepType:"postingRequest",funds:"out"},newLoan:{code:"N",text:"New Loan (N)",stepType:"postingRequest",funds:"in"},refinance:{code:"REF",text:"Refinance (REF)",stepType:"postingRequest",funds:"in"},transfer:{code:"TR",text:"Transfer (TR)",stepType:"postingRequest"},cashReceived:{code:"CR",text:"Cash Received (CR)",stepType:"currencyTransaction",funds:"in"},cashDisbursed:{code:"CD",text:"Cash Disbursed (CD)",stepType:"currencyTransaction",funds:"out"},machineReceived:{code:"MR",text:"Machine Received (MR)",stepType:"currencyTransaction",funds:"in"},machineDisbursed:{code:"MD",text:"Machine Disbursed (MD)",stepType:"currencyTransaction",funds:"out"},checkReceived:{code:"KR",text:"Check Received (KR)",stepType:"checkReceive",funds:"in"},checkScan:{code:"KS",text:"Check Scan (KS)",stepType:"checkReceive",funds:"in"},checkDisbursed:{code:"KD",text:"Check Disbursed (KD)",stepType:"checkDisburse",funds:"out"},onUs:{code:"ON",text:"On Us (ON)",stepType:"onUsDraft",funds:"in"},moneyOrder:{code:"MO",text:"Money Order (MO)",stepType:"negotiableInstrumentSale",funds:"out"},bondRedemption:{code:"B",text:"Bond Redemption (B)",stepType:"bondRedeem",funds:"in"},travelersCheck:{code:"TC",text:"Travelers Check (TC)",stepType:"negotiableInstrumentSale",funds:"out"},fee:{code:"F",text:"Fee (F)",stepType:"feeAssess",funds:"out"},gl:{code:"GL",text:"GL (GL)",stepType:"postingRequest",funds:"both"},dividend:{code:"V",text:CR.Login.dividendInterestText+" (V)",stepType:"postingRequest"},stopPayment:{code:"SP",text:"Stop Payment (SP)",stepType:"postingRequest",funds:"out"},certifyPayment:{code:"CP",text:"Certify Payment (CP)",stepType:"postingRequest",funds:"out"},comment:{code:"CO",text:"Comment (CO)",stepType:"postingRequest"},inventorySale:{code:"IS",text:"Inventory Sale (IS)",stepType:"negotiableInstrumentSale",funds:"out"},inventoryReload:{code:"IR",text:"Inventory Reload (IR)",stepType:"negotiableInstrumentSale",funds:"out"},bulkDeposit:{code:"BD",text:"Bulk Deposit (BD)",stepType:"bulkReceive"},bulkVerification:{code:"BV",text:"Bulk Verification (BV)",stepType:"bulkReceive",funds:"out"},effectiveDate:{code:"E",text:"Effective Date (E)"},adjustment:{code:"-",text:"Adjustment (-)"},rental:{code:"REN",text:"Rental (REN)",stepType:"rental",funds:"both"},loanExtension:{code:"LE",text:"Loan Extension (LE)",stepType:"loanExtension",funds:"out"},loanCorrection:{code:"LC",text:"Loan Correction (LC)",stepType:"shareLoanCorrection",funds:"out"},shareCorrection:{code:"SC",text:CR.Login.shareSavingsText+" Correction (SC)",stepType:"shareLoanCorrection",funds:"out"},accountClose:{code:"CL",text:"Close "+CR.Login.shareSavingsText+"/Loan (CL)",stepType:"accountClose",funds:"both"},post:{code:"PO",text:"Post (PO)"}};};CR.Core.buildTranOptions=function(c){var b=false;var a=true;var g=false;var f=false;if(c&&c.root){Ext.each(c.root.childNodes,function(j){a=false;var k=j.attributes||{};if(k.crTellerCapture){b=true;}if(k.crTranType==="BV"){Ext.each(k.crAdditionalPostingInfo,function(l){if(l.crXMLLabel==="category"){if(l.crContents==="KR"){g=true;}else{if(l.crContents==="CR"){f=true;}}}});}});}var d=[];d.push(["",""]);for(var i in CR.Core.tranCode){var h=false;if(i==="machineDisbursed"){if(CR.CFM&&CR.CFM.CashMachineList&&CR.CFM.CashMachineList.length>0){h=true;}}else{if(i==="machineReceived"){if(CR.CFM&&CR.CFM.CashRecyclerList&&CR.CFM.CashRecyclerList.length>0){h=true;}}else{if(i==="checkScan"){if(CR.Login.deviceCheckScanners&&CR.Login.deviceCheckScanners.length>0&&!b){h=true;}}else{if(i==="effectiveDate"&&!a){h=false;}else{if(i==="inventoryReload"){h=CR.LeagueServiceCorp&&CR.LeagueServiceCorp.interfaceFound;}else{h=true;}}}}}if(h&&g){switch(i){case"checkReceived":case"onUs":case"checkScan":case"post":h=true;break;default:h=false;}}if(h&&f){switch(i){case"cashReceived":case"machineReceived":case"post":h=true;break;default:h=false;}}if(h){d.push([CR.Core.tranCode[i].code,CR.Core.tranCode[i].text]);}}return d;};CR.TransactionPanel.scriptsFound=undefined;CR.TransactionPanel.scriptsToShowOnProfileAccess=undefined;CR.TransactionPanel.getReceiptPrinters=function(){var a=new CR.XML();
var g=a.addContainer(a.getRootElement(),"sequence");var d=a.addContainer(g,"transaction");var c=a.addContainer(d,"step");var b=a.addContainer(c,"search");a.addText(b,"tableName","DEVICE_PRINTER_LINK");a.addText(b,"filterName","BY_PARENT_SERIAL");a.addOption(b,"includeSelectColumns","Y");a.addOption(b,"includeTotalHitCount","Y");a.addCount(b,"returnLimit","1000");var f=a.addContainer(b,"parameter");a.addText(f,"columnName","PARENT_SERIAL");a.addSerial(f,"contents",CR.Login.deviceSerial);CR.Core.ajaxRequest({url:"SearchJSON",xmlData:a.getXMLDocument(),scope:this,crOverride:{},crMask:{suppress:true},success:function(m){var j=CR.JSON.parse(m.responseText);if(j&&j.resultRows){var q=j.resultRows;if(q.length===0){}else{var p=new CR.XML();var l=p.addContainer(p.getRootElement(),"sequence");var k=p.addContainer(l,"transaction");for(var n=0;n<q.length;n++){var h=p.addContainer(k,"step");var o=p.addContainer(h,"record");p.addOption(o,"operation","V");p.addText(o,"tableName","DEVICE_PRINTER_LINK");p.addSerial(o,"targetSerial",q[n].serial);var r=p.addContainer(o,"field");p.addText(r,"columnName","PRINTER_SERIAL");r=p.addContainer(o,"field");p.addText(r,"columnName","CATEGORY");}CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:p.getXMLDocument(),scope:this,crOverride:{},crMask:{},success:function(A){var v=CR.JSON.parse(A.responseText);var G=v.query;var z="failed";var I=[];var F=[];if(v.query){var y=G.sequence;if(y){for(var C=0;C<y.length;C++){var u=y[C].transaction;if(u){for(var B=0;B<u.length;B++){z=u[B].$attr.result;var t=u[B].step;for(var x=0;x<t.length;x++){if(t[x].tranResult&&t[x].tranResult.category&&t[x].tranResult.category.option&&t[x].tranResult.category.option==="E"){I.push(t[x].tranResult.description);}else{if(t[x].record){var E=t[x].record;var H=E.field;if(E.field){var D="";var s="";for(var w=0;w<H.length;w++){if(H[w].columnName==="PRINTER_SERIAL"){D=H[w].newContents;}else{if(H[w].columnName==="CATEGORY"){s=H[w].newContents;}}}if(s==="REC"){F.push({serial:D,description:E.rowDescription,category:s});}}}}}}}}}}if(z!=="posted"){CR.Core.displayExceptions({items:I});}else{if(D){if(F.length===0){F=null;}CR.Login.deviceReceiptPrinters=F;}}}});}}}});};CR.TransactionPanel.showCertificateBumpRate=function(a,d,k){a=Ext.getCmp(a);var h="Bump Rate for "+k;var g={certificateBumpLimit:{label:"Certificate Bump Limit",type:"count"},certificateBumpCount:{label:"Certificate Bump Count",type:"count",value:"0"},certificateBumpWaitDays:{label:"Certificate Bump Wait Days",type:"count"},certificateBumpLastDate:{label:"Certificate Bump Last Date",type:"date"},certificateBumpAllowedAfterDate:{label:"Certificate Bump Allowed After Date",type:"date"},comment:{label:"Comment",type:"text"},dividendRateOld:{label:"Dividend Rate Old",type:"rate"},dividendRateNew:{label:"Dividend Rate New",type:"rate"}};var l=new Ext.Toolbar.TextItem({text:"Effective Date:"});var i=new CR.DateField({crContents:CR.Login.postingDate});var m=new CR.Button({text:"Post"});var b=new CR.Button({text:"Cancel"});var c=new Ext.Toolbar({items:[l,i]});var j=function(q,t){var n=new CR.XML();var s=n.addContainer(n.getRootElement(),"sequence");var r=n.addContainer(s,"transaction");n.addOption(r,"postingMode",(q?"V":"P"));var p=n.addContainer(r,"step");var o=n.addContainer(p,"certificateRequest");n.addText(o,"tableName","SHARE");n.addSerial(o,"targetSerial",d);if(i&&i.crGetNewContents()){n.addDate(o,"effectiveDate",i.crGetNewContents());}CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:n.getXMLDocument(),scope:this,crMask:{container:this.crMainPanel},crOverride:{},params:{},success:function(C){if(!f.crIsDestroyed()){var x=CR.JSON.parse(C.responseText);var G=x.query;var B="failed";var K=[];var y=null;if(x.query){var A=G.sequence;if(A){for(var E=0;E<A.length;E++){var w=A[E].transaction;if(w){for(var D=0;D<w.length;D++){B=w[D].$attr.result;var v=w[D].step;if(v){for(var z=0;z<v.length;z++){if(v[z].tranResult&&v[z].tranResult.category&&v[z].tranResult.category.option&&v[z].tranResult.category.option==="E"){K.push(v[z].tranResult.description);}else{if(v[z].certificateRequest){y=v[z].certificateRequest;for(var u in y){if(g[u]){g[u].value=y[u];}}}}}}}}}}}if(y&&B==="posted"){f.crClose();Ext.MessageBox.show({title:"Confirmation",msg:"Bump rate has been applied to "+k+".",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO,fn:function(){CR.Core.refreshComponents();}});}else{var F='<div class="cr-certificateBump"><table width="100%">';F+='<tr><thead><th colspan="2">Bump Information</th></thead></tr>';for(var u in g){if(g[u].value){F+="<tr>";var I=g[u].label;var J=g[u].value;var H=g[u].type;if(H==="count"){F+='<td class="label">'+I+':</td><td class="value">'+CR.Core.htmlText(J)+"</td>";}else{if(H==="date"){F+='<td class="label">'+I+':</td><td class="value">';if(J===" "){F+="</td>";}else{F+=CR.Core.htmlText(CR.DateField.convertToDisplay(J))+"</td>";}}else{if(H==="money"){F+='<td class="label">'+I+':</td><td class="value">'+CR.Core.htmlText(CR.MoneyField.convertToDisplay(J))+"</td>";}else{if(H==="rate"){F+='<td class="label">'+I+':</td><td class="value">'+CR.Core.htmlText(CR.RateField.convertToDisplay(J))+"</td>";}else{if(H==="text"){F+='<td class="label">'+I+':</td><td class="value">'+CR.Core.htmlText(J)+"</td>";}}}}}F+="</tr>";}}F+="</table></div>";if(K&&K.length>0){F+="<br />";F+='<div class="cr-certificateBump"><table width="100%">';F+='<tr><thead><th colspan="2">Errors</th></thead></tr>';for(E=0;E<K.length;E++){F+='<tr><td class="label"><font color="red">'+CR.Core.htmlText(K[E])+"</font></td></tr>";}F+="</table></div>";m.disable();}else{m.enable();}f.body.update(F);f.center();}}}});};var f=new CR.Window({title:h,bodyStyle:"padding:5px;background:#ffffff;",renderTo:a.body||a,html:"",buttons:[m,b],buttonAlign:"center",tbar:c});f.crShow();i.addListener("change",function(){j(true);});m.addListener("click",function(){j(false);});b.addListener("click",function(){f.crClose();});j(true,true);};CR.AddressValidation={isLicensed:function(){var a=false;if(CR.Login&&CR.Login.institutionLicense&&CR.Login.institutionLicense.addressValidation&&CR.Login.institutionLicense.addressValidation.option==="Y"){a=true;}return a;},normalize:function(l){var h={INFO:0,WARNING:1,ERROR:2,FATAL:3};var k={A:{message:"Corrected ZIP code",severity:h.INFO},B:{message:"Fixed city/state spelling",severity:h.INFO},C:{message:"Invalid city/state/zip",severity:h.WARNING},D:{message:"No ZIP+4 assigned",severity:h.WARNING},E:{message:"Same ZIP for multiple",severity:h.INFO},F:{message:"Address not found",severity:h.ERROR},G:{message:"Firm data used",severity:h.INFO},H:{message:"Missing secondary number",severity:h.ERROR},I:{message:"Insufficient data",severity:h.WARNING},J:{message:"Dual address",severity:h.INFO},L:{message:"Address component was changed",severity:h.INFO},LL:{message:"Flagged for LACS<sup>Link</sup>",severity:h.INFO},M:{message:"Fixed street spelling",severity:h.INFO},N:{message:"Fixed abbreviations",severity:h.INFO},O:{message:"Multiple ZIP+4; lowest used",severity:h.INFO},P:{message:"Better address exists",severity:h.INFO},Q:{message:"Unique ZIP match",severity:h.INFO},R:{message:"No match; EWS: Match soon",severity:h.INFO},S:{message:"Bad secondary address",severity:h.ERROR},T:{message:"Magnet street syndrome",severity:h.WARNING},U:{message:"Unofficial PO name",severity:h.WARNING},V:{message:"Unverifiable city/state",severity:h.WARNING},W:{message:"Invalid delivery address",severity:h.ERROR},X:{message:"Unique ZIP default",severity:h.INFO},Y:{message:"Military match",severity:h.INFO},Z:{message:"Matched with ZIPMOVE",severity:h.INFO}};var g={Y:{message:"Confirmed Deliverable",severity:h.INFO},N:{message:"Not Deliverable",severity:h.ERROR},S:{message:"Deliverable by dropping secondary information",severity:h.ERROR},D:{message:"Deliverable but incomplete",severity:h.ERROR}};var m={AA:{message:"ZIP+4 matched",severity:h.INFO},A1:{message:"ZIP+4 did not match",severity:h.WARNING},BB:{message:"Confirmed entire address",severity:h.INFO},CC:{message:"Confirmed by dropping secondary",severity:h.ERROR},F1:{message:"Military address",severity:h.INFO},G1:{message:"General delivery address",severity:h.INFO},N1:{message:"Confirmed without secondary",severity:h.ERROR},M1:{message:"Primary number missing",severity:h.ERROR},M3:{message:"Primary number invalid",severity:h.ERROR},P1:{message:"PO, RR, or HC missing",severity:h.WARNING},P3:{message:"PO, RR, or HC invalid",severity:h.WARNING},RR:{message:"Confirmed with private mailbox",severity:h.INFO},R1:{message:"Confirmed without private mailbox",severity:h.INFO},U1:{message:"Matched to unique ZIP code",severity:h.INFO}};var i={F:{message:"Firm match for address",severity:h.INFO},S:{message:"Valid street primary number",severity:h.INFO},G:{message:"Mail to be held at local post office",severity:h.WARNING},H:{message:"Address contains apartment or building sub-units",severity:h.INFO},P:{message:"Address is a PO box",severity:h.WARNING},R:{message:"Rural Route or Highway Contract",severity:h.INFO}};var d={Y:{message:"Commercial Mail Receiving Agency (CMRA)",severity:h.WARNING},N:{message:"",severity:h.INFO}};var j={Y:{message:"Address is vacant",severity:h.WARNING},N:{message:"",severity:h.INFO}};var a={Y:{message:"",severity:h.INFO},N:{message:"Address is inactive",severity:h.WARNING}};var c={"Residential":{message:"The address is a residential address",severity:h.INFO},"Commercial":{message:"The address is a commercial address",severity:h.INFO},"Unknown":{message:"Unknown if address is residential or commercial",severity:h.INFO}};var b=l;if(!Ext.isArray(l)){b=[l];}var f=[];Ext.each(b,function(n){var s={};s["STREET"]=n.delivery_line_1;s["ADDITIONAL_ADDRESS_LINE"]="";if(n.delivery_line_2){s["ADDITIONAL_ADDRESS_LINE"]=n.delivery_line_2;}if(n.components){s["CITY"]=n.components.city_name;s["STATE"]=n.components.state_abbreviation;s["POSTAL_CODE"]=n.components.zipcode;if(n.components.zipcode&&n.components.plus4_code){s["POSTAL_CODE"]=n.components.zipcode+"-"+n.components.plus4_code;}}if(n.metadata){s["CARRIER_ROUTE"]=n.metadata.carrier_route;s["LATITUDE"]=n.metadata.latitude;s["LONGITUDE"]=n.metadata.longitude;s["ADDRESS_CONFIRMATION_DATE"]=CR.Login.postingDate;s["ADDRESS_CONFIRMATION_OPTION"]="-";}var q=[];q.error=false;q.warning=false;q.addNote=function(u){if(u){var t="<span ";if(u.severity===h.WARNING){q.warning=true;t+='style="color:orange"';}else{if(u.severity===h.ERROR){q.error=true;t+='style="color:red"';}}t+=">";t+=u.message;t+="</span>";this.push(t);}};s.editStreet=false;if(n.analysis){q.addNote(g[n.analysis.dpv_match_code]);q.addNote(d[n.analysis.dvp_cmra]);q.addNote(j[n.analysis.dpv_vacant]);q.addNote(a[n.analysis.active]);if(n.analysis.footnotes){var p=n.analysis.footnotes.split("#")||[];Ext.each(p,function(t){if(t==="H"||t==="S"){s.editStreet=true;}q.addNote(k[t]);});}if(n.analysis.dpv_footnotes){var o=n.analysis.dpv_footnotes.match(/.{1,2}/g)||[];Ext.each(o,function(t){q.addNote(m[t]);});}}if(n.metadata){q.addNote(i[n.metadata.record_type]);q.addNote(c[n.metadata.rdi]);}s.notes=q;s.error=q.error;s.warning=q.warning;f.push(s);var r="";r+=s["ADDITIONAL_ADDRESS_LINE"]+" ";r+=s["STREET"]+" ";r+=s["CITY"]+" ";r+=s["STATE"]+" ";r+=s["POSTAL_CODE"]+" ";s.mapQuery=encodeURIComponent(r);s.mapQuery="";});if(!Ext.isArray(l)){return f[0];}return f;},handleResponse:function(l){var j=["<div>",'	<h1 style="color:red">Matched 0 valid addresses</h1>',"	<br>","	<p>The address you entered is not recognized by the USPS</p>","	<br>","</div>","<div>","	<h4>Suggestions</h4>","	<ul>","	 <li>Is the <dfn>primary number</dfn> correct?</li>","	 <li>Make sure the city/state and ZIP code <dfn>don't conflict</dfn></li>","	 <li>The address should be free of <dfn>major typos/misspellings</dfn></li>","	 <li>Try adding missing information</li>","	</ul>","</div>"].join("");var m=new Ext.XTemplate("<style scoped>",".cr-addv { padding-left: 10px; font-weight: bold}","</style>","<div>","	{title}","	<br>","</div>",'<table style="width:100%">'," <tbody>",'  <tpl if="ADDITIONAL_ADDRESS_LINE">','   <tr><td>Additional Address Line:</td><td class="cr-addv">{ADDITIONAL_ADDRESS_LINE}</td></tr>',"  </tpl>",'  <tr><td>Street:</td><td  class="cr-addv">{STREET}</td>','   <tpl if="mapQuery">','    <td style="text-align:right"><a target="_blank" href="http://maps.google.com?q={mapQuery}">map</a></td></tr>',"   </tpl>","  </tr>",'  <tr><td>City:</td><td class="cr-addv">{CITY}</td></tr>','  <tr><td>State:</td><td class="cr-addv">{STATE}</td></tr>','  <tr><td>Postal Code:</td><td class="cr-addv">{POSTAL_CODE}</td></tr>'," </tbody>","</table>","<div>","	<br>","	<p>The address you entered is valid. Please review the standarized version above.</p>","	<br>","	<h4>Notes</h4>","	<ul>",'  <tpl for="notes">',"	  <li>{.}</li>","  </tpl>","	</ul>","</div>");var g={xtype:"panel",region:"center",bodyStyle:{padding:"5px"},border:true,bodyBorder:true,autoScroll:true,html:j,buttons:[{text:"Edit Address",handler:function(q,r){q.findParentByType(CR.Window).crClose();if(l.callbackFunction){l.callbackArgs=l.callbackArgs||{};l.callbackArgs.addressValidated=false;l.callbackArgs.overrideRequired=true;l.callbackArgs.cancel=true;l.callbackArgs.edit=true;l.callbackFunction.call(l.callbackScope,l.callbackArgs);}}}]};if(l.addresses.length===1){var o=CR.AddressValidation.normalize(l.addresses[0]);o.title='<h1 style="color:green">Matched single valid address</h1>';if(o.error){o.title='<h1 style="color:red">Matched address with errors</h1>';}else{if(o.warning){o.title='<h1 style="color:orange">Matched address with warnings</h1>';}}g={xtype:"panel",region:"center",bodyStyle:{padding:"5px"},border:true,bodyBorder:true,autoScroll:true,html:m.apply(o),buttons:[{text:"Edit Address",handler:function(q,r){q.findParentByType(CR.Window).crClose();if(o.editStreet&&l.fieldPanel){var s=l.fieldPanel.find("crColumnName","STREET").shift();if(s){s.focus(false);CR.Core.defer(function(){var u=s.getEl().dom;if(u.createTextRange){var t=u.createTextRange();t.move("character",100);t.select();}else{if(typeof u.selectionStart==="number"){u.focus();u.setSelectionRange(100,100);}}});}}if(l.callbackFunction){l.callbackArgs=l.callbackArgs||{};l.callbackArgs.addressValidated=false;l.callbackArgs.overrideRequired=true;l.callbackArgs.cancel=true;l.callbackArgs.edit=true;l.callbackFunction.call(l.callbackScope,l.callbackArgs);}}},{text:"Accept Matched",handler:function(q,r){l.callbackArgs.addressValidated=true;l.callbackArgs.overrideRequired=false;l.callbackArgs.validatedAddress=o;if(l.fieldPanel){CR.AddressValidation.setFields(l.fieldPanel,o);}l.callbackFunction.call(l.callbackScope,l.callbackArgs);q.findParentByType(CR.Window).crClose();}}]};}if(l.addresses.length>1){var n=CR.AddressValidation.normalize(l.addresses);var f=new Ext.data.JsonStore({fields:["STREET","CITY","STATE","POSTAL_CODE","ADDITIONAL_ADDRESS_LINE","CARRIER_ROUTE","LATITUDE","LONGITUDE","notes","mapQuery"]});f.loadData(n);var a=new Ext.XTemplate("<style scoped>",".cr-addv { padding-left: 10px; font-weight: bold}","</style>",'<table style="width:100%">'," <tbody>",'  <tpl if="ADDITIONAL_ADDRESS_LINE">','   <tr><td>Additional Line:</td><td class="cr-addv">{ADDITIONAL_ADDRESS_LINE}</td><td></td></tr>',"  </tpl>",'  <tr><td>Street:</td><td  class="cr-addv">{STREET}</td>','      <tpl if="mapQuery">','       <td style="text-align:right; padding-right:15px"><a target="_blank" href="http://maps.google.com?q={mapQuery}">map</a></td></tr>',"      </tpl>","  </tr>",'  <tr><td>City:</td><td class="cr-addv">{CITY}</td></tr>','  <tr><td>State:</td><td class="cr-addv">{STATE}</td></tr>','  <tr><td>Postal Code:</td><td class="cr-addv">{POSTAL_CODE}</td></tr>'," </tbody>","</table>");var c=new CR.GridPanel({singleSelect:true,emptyText:"No address found",autoScroll:true,editable:false,enableColumnHide:false,enableColumnMove:false,enableColumnResize:false,enableHdMenu:false,hideHeaders:false,stripeRows:true,width:"100%",height:170,flex:1,columns:[{header:"Select an Address",dataIndex:"STREET",sortable:false,filterable:false,hideable:false,renderer:function(r,s,q){return a.apply(q.data);
}}],store:f});c.on("viewready",function(q){q.getSelectionModel().selectFirstRow();},this);var d=new Ext.XTemplate("<div>","	<br>","	<h4>Notes</h4>","	<ul>",'  <tpl for="notes">',"	  <li>{.}</li>","  </tpl>","	</ul>","</div>");var b=new CR.Panel({border:false,html:"<div><br>Notes</div>"});c.getSelectionModel().on("selectionchange",function(q){var r=q.getSelected();if(r&&r.data){b.update(d.apply(r.data));}else{b.update("");}},this);g={xtype:"panel",region:"center",layout:"anchor",items:[{xtype:"panel",border:false,html:'<div><h1 style="color:orange">Matched multiple addresses</h1><br></div>'},c,b],bodyStyle:{padding:"5px"},border:true,bodyBorder:true,autoScroll:true,crId:"resultPanel",buttons:[{text:"Edit Address",handler:function(q,r){q.findParentByType(CR.Window).crClose();if(l.callbackFunction){l.callbackArgs=l.callbackArgs||{};l.callbackArgs.addressValidated=false;l.callbackArgs.overrideRequired=true;l.callbackArgs.cancel=true;l.callbackArgs.edit=true;l.callbackFunction.call(l.callbackScope,l.callbackArgs);}}},{text:"Accept Selected",scope:c,handler:function(r,s){var q=this.getSelectionModel().getSelected();if(q&&q.data){l.callbackArgs.addressValidated=true;l.callbackArgs.overrideRequired=false;l.callbackArgs.validatedAddress=q.data;if(l.fieldPanel){CR.AddressValidation.setFields(l.fieldPanel,q.data);}l.callbackFunction.call(l.callbackScope,l.callbackArgs);r.findParentByType(CR.Window).crClose();}else{Ext.Msg.alert("Address Validation","Please Select an address");}}}]};}var i=new Ext.XTemplate("<style scoped>",".cr-addv { padding-left: 10px; font-weight: bold}","</style>","<div>","	<h1>Entered Address</h1>","	<br>","</div>",'<table style="width:100%">'," <tbody>",'  <tpl if="ADDITIONAL_ADDRESS_LINE">','   <tr><td>Additional Address Line:</td><td class="cr-addv">{ADDITIONAL_ADDRESS_LINE}</td></tr>',"  </tpl>",'  <tr><td>Street:</td><td  class="cr-addv">{STREET}</td>','      <tpl if="mapQuery">','       <td style="text-align:right"><a target="_blank" href="http://maps.google.com?q={mapQuery}">map</a></td></tr>',"      </tpl>","  </tr>",'  <tr><td>City:</td><td class="cr-addv">{CITY}</td></tr>','  <tr><td>State:</td><td class="cr-addv">{STATE}</td></tr>','  <tr><td>Postal Code:</td><td class="cr-addv">{POSTAL_CODE}</td></tr>'," </tbody>","</table>");var p="";p+=l.address["ADDITIONAL_ADDRESS_LINE"]+" ";p+=l.address["STREET"]+" ";p+=l.address["CITY"]+" ";p+=l.address["STATE"]+" ";p+=l.address["POSTAL_CODE"]+" ";l.address.mapQuery="";var k=i.apply(l.address);var h=new CR.Window({title:"Address Validation",collapsible:false,closable:false,draggable:true,shadow:true,resizable:true,modal:true,buttons:[{text:"Cancel",handler:function(q,r){q.findParentByType(CR.Window).crClose();if(l.callbackFunction){l.callbackArgs=l.callbackArgs||{};l.callbackArgs.addressValidated=false;l.callbackArgs.overrideRequired=true;l.callbackArgs.cancel=true;l.callbackFunction.call(l.callbackScope,l.callbackArgs);}}}],layout:"fit",tools:[{id:"close",scope:this,handler:function(t,s,r,q){r.crClose();if(l.callbackFunction){l.callbackArgs=l.callbackArgs||{};l.callbackArgs.addressValidated=false;l.callbackArgs.overrideRequired=true;l.callbackArgs.cancel=true;l.callbackFunction.call(l.callbackScope,l.callbackArgs);}}}],items:{xtype:"panel",layout:"border",width:640,height:350,frame:false,border:false,bodyBorder:false,items:[{xtype:"panel",region:"west",collapsible:false,split:true,autoScroll:true,width:300,bodyStyle:{padding:"5px"},border:true,bodyBorder:true,html:k,buttons:[{text:"Accept as Entered",handler:function(q){l.callbackArgs.addressValidated=false;l.callbackArgs.overrideRequired=true;l.callbackArgs.forceAccept=true;l.callbackFunction.call(l.callbackScope,l.callbackArgs);q.findParentByType(CR.Window).crClose();}}]},g]}});h.show();},needsValidation:function(b,c){if(!CR.AddressValidation.isLicensed()){return false;}if(c!=="insert"&&c!=="update"){return false;}var a=CR.AddressValidation.mapFields(b);if(a["ADDRESS_FORMAT"]&&a["ADDRESS_FORMAT"]!=="D"){return false;}if(!CR.AddressValidation.fieldsChanged(b)){return false;}return true;},fieldsChanged:function(b){var d=false;var c=["ADDITIONAL_ADDRESS_LINE","STREET","CITY","STATE","POSTAL_CODE","CARRIER_ROUTE","ADDRESS_FORMAT"];var a=CR.Core.findFields(b);Ext.each(a,function(i){if(!d&&!i.crExcludeFromFMPanel){var h=i.crGetColumnName();if(c.indexOf(h)>-1){var f=i.crGetOldContents();var g=i.crGetNewContents();if(g!==f){if(h==="ADDRESS_FORMAT"){d=(g==="D");}else{d=true;}}}}});return d;},validateAddress:function(b){b=Ext.apply({address:null,fieldPanel:null,callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},b);if(!b.address&&b.fieldPanel){b.address=CR.AddressValidation.mapFields(b.fieldPanel);}var a=b.address;CR.Core.ajaxRequest({method:"POST",url:"AddressValidation/ValidateAddress",params:a,crMask:{message:"Validating Address..."},scope:b.callbackScope,success:function(d){var c=CR.JSON.parse(d.responseText);b.addresses=c;CR.AddressValidation.handleResponse(b);},failure:function(c){if(!c.crExceptionItems){c.crExceptionItems=[CR.Core.getHttpStatusMessage(c)];}CR.Core.displayExceptions({title:"Address Validation Service",items:c.crExceptionItems});b.callbackArgs.addressValidated=false;b.callbackArgs.overrideRequired=false;b.callbackFunction.call(b.callbackScope,b.callbackArgs);}});},mapFields:function(b,d){var c={};var a=CR.Core.findFields(b);if(!a||!a.length){a=d;Ext.each(a,function(h){if(!h.crExcludeFromFMPanel&&h.columnName&&h.newContents){var g=h.columnName;var f=h.newContents;c[g]=f;}});}else{Ext.each(a,function(h){if(!h.crExcludeFromFMPanel&&h.crGetColumnName&&h.crGetNewContents){var g=h.crGetColumnName();var f=h.crGetNewContents();c[g]=f;}});}return c;},setFields:function(b,c){var a=CR.Core.findFields(b);Ext.each(a,function(g){if(!g.crExcludeFromFMPanel){if(g.crGetColumnName){var f=g.crGetColumnName();var d=c[f];if(d||d===""){if(g.crSetContents){g.crSetContents(d);}else{if(g.crSetSerial){g.crSetSerial(d);}}}}}});},copyFields:function(d,b,a){var c=CR.AddressValidation.mapFields(d,a);c["SERIAL"]="";c["ADDRESS_CONFIRMATION_DATE"]="";c["ADDRESS_CONFIRMATION_OPTION"]="-";delete c["TYPE_SERIAL"];CR.AddressValidation.setFields(b,c);},updateSourceAddress:function(i){var d=i.fieldPanel;var b=i.addressFields;var f=new CR.RecordReferencePanel({title:"Select References to Update",crTableName:"ADDRESS",crTargetSerial:i.sourceAddressSerial,crUseCheckboxSelectionModel:true,crPageSize:1000,region:"north",split:true,collapsible:false,autoHeight:false,autoScroll:true,height:200});f.getBottomToolbar().hide();f.getStore().load();var m=new CR.Panel({region:"center",layout:"fit"});CR.FMPanel.open({container:m,fmRequest:{requestType:"insert",tableName:"ADDRESS"},fmPanelConfig:{crPanelTitle:"Address",crAppAddressSerial:i.targetAddressSerial,crSuppressButtons:true,crPanelCloseOnUpdateOrInsert:false,crRefreshRecordInquiry:function(){},crCallbackFunction:function(p){CR.AddressValidation.copyFields(m.crFMPanel,d,b);var o=d.find("crColumnName","SOURCE_ADDRESS_SERIAL").shift();if(o){o.crSetSerial(p.serial,p.rowDescription);}else{var n="";for(var q=0;q<b.length;q++){if(b[q].columnName==="SERIAL"){n=b[q].newContents;}}if(n){CR.Core.recordUpdate({tableName:"APPLICANT_ADDRESS",targetSerial:n,displayExceptions:true,fields:[{columnName:"SOURCE_ADDRESS_SERIAL",newContents:p.serial}]});}}k.crClose();},crCallbackFunctionScope:this},onFMPanelLoad:function(n){if(n){m.crFMPanel=n;var o=n.find("crViewGroup","General").shift();if(o){o.collapse(false);}CR.AddressValidation.copyFields(d,n,b);n.crTargetSerial="";}}});var g,c,h;var a=function(w,o){var u,q,n,t,x,y,z,p;var A=o.getSelectionModel().getSelections();var s=o.getStore().getCount();g=new CR.XML();u=g.addContainer(g.getRootElement(),"sequence");c=g.addContainer(u,"transaction");q=g.addContainer(c,"step");h=g.addContainer(q,"record");g.setAttribute(h,"label","Main");g.addOption(h,"includeRowDescriptions","Y");g.addText(h,"tableName","ADDRESS");if(A.length===s){g.addOption(h,"operation","U");g.addText(h,"targetSerial",i.sourceAddressSerial);}else{g.addOption(h,"operation","I");}Ext.each(CR.Core.findFields(w),function(B){if(B.clearInvalid&&B.crColumnName){B.clearInvalid();}if(B.crGetColumnName()!=="LAST_FM_DATE"){t=B.crGetNewContents();x=B.crGetOldContents();if(t!==x&&!B.crExcludeFromFMPanel){y=g.addContainer(h,"field");g.addText(y,"columnName",B.crGetColumnName());g.addOption(y,"operation","S");g.addText(y,"newContents",t);}}});var r=["LAST_FM_DATE","ADDRESS_CHANGE_DATE","LATITUDE","LONGITUDE","ADDRESS_CONFIRMATION_DATE","ADDRESS_CONFIRMATION_OPTION"];var v=g.addContainer(q,"record");g.setAttribute(v,"label","Main_App_Address");g.addOption(v,"operation","U");g.addOption(v,"includeRowDescriptions","Y");g.addText(v,"tableName","APPLICANT_ADDRESS");g.addSerial(v,"targetSerial",w.crAppAddressSerial);Ext.each(CR.Core.findFields(w),function(B){if(B.clearInvalid&&B.crColumnName){B.clearInvalid();}if(!r.includes(B.crGetColumnName())){t=B.crGetNewContents();x=B.crGetOldContents();if(t!==x&&!B.crExcludeFromFMPanel){y=g.addContainer(v,"field");g.addText(y,"columnName",B.crGetColumnName());g.addOption(y,"operation","S");g.addText(y,"newContents",t);}}});if(A.length!==s){Ext.each(A,function(B){q=g.addContainer(c,"step");n=g.addContainer(q,"record");g.addText(n,"tableName",B.data.tableName);g.addOption(n,"operation","U");g.addSerial(n,"targetSerial",B.data.serial);p=null;if(B.data.tableName==="PERSON_ADDRESS_LINK"){p="ADDRESS_SERIAL";}else{if(B.data.tableName==="APPLICANT_ADDRESS"){p="SOURCE_ADDRESS_SERIAL";}else{if(B.data.tableName==="COLLATERAL"||B.data.tableName==="LR_COLLATERAL"){p="PROPERTY_ADDRESS_SERIAL";}}}y=g.addContainer(n,"field");g.addText(y,"columnName",p);g.addOption(y,"operation","S");z=g.addContainer(y,"newContentsFrom");g.addText(z,"label","Main");g.addOption(z,"resultValue","TargetSerial");});}return g;};var l=new CR.ToolbarButton({text:"Update",disabled:true,handler:function(q,r){var n=m.crFMPanel;var p=f.getSelectionModel().getSelections();if(p.length===0){CR.Core.displayExceptions({items:["You must select at least one reference"]});}else{if(!n.crAddressValidated&&CR.AddressValidation.needsValidation(n,"insert")){CR.AddressValidation.validateAddress({fieldPanel:n,callbackScope:this,callbackFunction:function(s){var t=a(m.crFMPanel,f);if(s.addressValidated){if(s.validatedAddress){CR.AddressValidation.setFields(n,s.validatedAddress);n.crAddressValidated=true;n.crFMPostAttempt(t,CR.FMPanel.getDefaultContainer());}else{n.crFMPostAttempt(t,CR.FMPanel.getDefaultContainer());}}else{if(s.overrideRequired){var u=t.addContainer(c,"step");var w=t.addContainer(u,"securityCheck");t.addOption(w,"operation","CHECK");t.addOption(w,"securityEvent","ADD_UFM");var v=t.addContainer(h,"field");t.addText(v,"columnName","ADDRESS_CONFIRMATION_OPTION");t.addOption(v,"operation","S");t.addText(v,"newContents","N");}n.crFMPostAttempt(t,CR.FMPanel.getDefaultContainer());}}});}else{var o=a(m.crFMPanel,f);n.crFMPostAttempt(o,CR.FMPanel.getDefaultContainer());}}}});f.getSelectionModel().on("selectionchange",function(n){l.setDisabled(n.getSelections().length===0);});var j=new Ext.Toolbar({region:"south",height:"26",items:[l,"-",{xtype:"button",text:"Validate",handler:function(n,o){CR.AddressValidation.validateAddress({fieldPanel:m,callbackScope:m,callbackFunction:function(p){this.crAddressValidated=p.addressValidated;}});}},"-",{xtype:"button",text:"Cancel",handler:function(n,o){if(!i.callbackArgs){i.callbackArgs={};}i.callbackArgs.addressValidated=false;i.callbackArgs.overrideRequired=true;i.callbackArgs.cancel=true;i.callbackFunction.call(i.callbackScope,i.callbackArgs);n.findParentByType(CR.Window).crClose();}}]});var k=new CR.Window({title:"Update Source Address"+(d.title?" for "+d.title:""),collapsible:false,closable:true,draggable:true,shadow:true,resizable:true,modal:true,width:600,height:600,layout:"border",items:[f,m,j]});k.show();},setupFMPanelButton:function(a){if(CR.AddressValidation.isLicensed()&&(a.crTableName==="ADDRESS"||a.crTableName==="APPLICANT_ADDRESS")){var b=new CR.ToolbarButton({text:"Validate",handler:function(){CR.AddressValidation.validateAddress({fieldPanel:a,callbackScope:a,callbackFunction:function(d){a.crAddressValidated=d.addressValidated;}});}});var c=a.getBottomToolbar();c.add(b,"-");c.doLayout();}}};CR.NADA={};CR.NADA.externalUrls=undefined;CR.NADA.checkInterfaces=function(b){if(CR.NADA.externalUrls===undefined){var a=new CR.XML();var h=a.addContainer(a.getRootElement(),"sequence");var f=a.addContainer(h,"transaction");var d=a.addContainer(f,"step");var c=a.addContainer(d,"search");a.setAttribute(c,"label","NADA_GUIDE_URL");a.addText(c,"tableName","INTERFACE");a.addText(c,"filterName","BY_DESCRIPTION_PRODUCT");a.addOption(c,"includeTotalHitCount","Y");a.addOption(c,"includeSelectColumns","Y");a.addCount(c,"returnLimit",99);var g=a.addContainer(c,"parameter");a.addText(g,"columnName","DESCRIPTION");a.addText(g,"contents","");g=a.addContainer(c,"parameter");a.addText(g,"columnName","PRODUCT");a.addText(g,"contents","NADA_GUIDE_URL");g=a.addContainer(c,"parameter");a.addText(g,"columnName","PRODUCT");a.addText(g,"contents","WRG_VIEWMBR_URL");g=a.addContainer(c,"parameter");a.addText(g,"columnName","STATUS");a.addText(g,"contents","O");CR.Core.ajaxRequest({url:"SearchJSON",xmlData:a.getXMLDocument(),params:{},scope:this,success:function(k){var j=CR.JSON.parse(k.responseText);var n=j.query;var m="failed";var l=[];var i=null;if(j.resultRows&&j.resultRows.length>0){CR.NADA.externalUrls=j.resultRows;}else{CR.NADA.externalUrls=null;}if(b.callbackFunction){if(!b.callbackArgs){b.callbackArgs={};}b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}});}else{if(b.callbackFunction){if(!b.callbackArgs){b.callbackArgs={};}b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}};CR.NADA.openLink=function(d){var c=(d&&d.serial)||CR.NADA.externalUrls[0].serial;var b=new CR.XML();var i=b.addContainer(b.getRootElement(),"sequence");var h=b.addContainer(i,"transaction");var f=b.addContainer(h,"step");var a=b.addContainer(f,"record");b.addOption(a,"operation","V");b.addText(a,"tableName","INTERFACE");b.addText(a,"targetSerial",c);b.addOption(a,"includeColumnMetadata","N");b.addOption(a,"includeAllColumns","N");b.addOption(a,"includeRowDescriptions","N");var g=b.addContainer(a,"field");b.addText(g,"columnName","CONTROL_VALUE_1");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),params:{},success:function(u){var q=CR.JSON.parse(u.responseText);var y=q.query;var t="failed";var A=[];var l="";if(q.query){var s=y.sequence;if(s){for(var w=0;w<s.length;w++){var p=s[w].transaction;if(p){for(var v=0;v<p.length;v++){t=p[v].$attr.result;var n=p[v].step;if(n){for(var r=0;r<n.length;r++){var x=n[r].record;if(n[r].tranResult&&n[r].tranResult.category&&n[r].tranResult.category.option&&n[r].tranResult.category.option==="E"){A.push(n[r].tranResult.description);}else{if(x){var z=x.field;if(z&&x.tableName==="INTERFACE"){for(var o=0;o<z.length;o++){if(z[o].columnName==="CONTROL_VALUE_1"){l=z[o].newContents;}}}}}}}}}}}}if(t!=="posted"&&t!=="verified"){CR.Core.displayExceptions({items:A});}else{window.open(l,"NADA");}}});};CR.VehicleValuation={};CR.VehicleValuation.interfaceSerial=undefined;CR.VehicleValuation.interfaceRecord=null;CR.VehicleValuation.usageSecurityEventSerial=null;CR.VehicleValuation.checkInterface=function(b){b.callbackFunction=b.callbackFunction||CR.Core.emptyFunction;b.callbackScope=b.callbackScope||this;b.callbackArgs=b.callbackArgs||{};if(CR.VehicleValuation.interfaceSerial===undefined){var a=new CR.XML();var h=a.addContainer(a.getRootElement(),"sequence");var f=a.addContainer(h,"transaction");var d=a.addContainer(f,"step");var c=a.addContainer(d,"search");a.setAttribute(c,"label","VEHICLE_VALUE_URL");a.addText(c,"tableName","INTERFACE");a.addText(c,"filterName","BY_DESCRIPTION_PRODUCT");a.addOption(c,"includeTotalHitCount","Y");a.addOption(c,"includeSelectColumns","Y");a.addCount(c,"returnLimit",1);var g=a.addContainer(c,"parameter");a.addText(g,"columnName","DESCRIPTION");
a.addText(g,"contents","");g=a.addContainer(c,"parameter");a.addText(g,"columnName","PRODUCT");a.addText(g,"contents","VEHICLE_VALUE_URL");g=a.addContainer(c,"parameter");a.addText(g,"columnName","STATUS");a.addText(g,"contents","O");CR.Core.ajaxRequest({url:"SearchJSON",xmlData:a.getXMLDocument(),params:{},scope:this,success:function(j){CR.VehicleValuation.interfaceSerial="";var i=CR.JSON.parse(j.responseText);if(i.resultRows&&i.resultRows.length>0){var k=i.resultRows[0].serial;CR.Core.recordView({tableName:"INTERFACE",targetSerial:k,callbackFunction:function(l){if(l.tranResult==="posted"){CR.VehicleValuation.interfaceSerial=k;CR.VehicleValuation.interfaceRecord=l.record;CR.VehicleValuation.usageSecurityEventSerial=l.record["USAGE_1_SECURITY_EVENT_SERIAL"];b.callbackFunction.call(b.callbackScope,b.callbackArgs);}}});}}});}else{b.callbackFunction.call(b.callbackScope,b.callbackArgs);}};CR.VehicleValuation.createID=(function(){function a(){return Math.floor((1+Math.random())*65536).toString(16).substring(1);}return function(){var b=CR.Login.userName||"";b=b.replace(/\W/g,"");var c=b?(b+"_"):"";while(c.length<40){c+=a();}return c;};})();CR.VehicleValuation.show=function(k){var i=new Ext.Template("VehicleValuation/{command}?id={id}&type={type}&vin={vin}");var c=CR.VehicleValuation.createID();var n=null;var o=k.collateralPanel;var l=null;var h=function(){var p=i.apply({command:"getdata",id:c,type:n});CR.Core.ajaxRequest({url:p,crMask:{message:"Geting Valuation Data..."},scope:this,success:function(r){var s=[];var q=CR.JSON.parse(r.responseText);if(q.success){l.close();if(q.data&&q.data.LOOKUP&&q.data.LOOKUP.VEHICLE){b(o,q.data.LOOKUP.VEHICLE,q.valuationDocument);}else{s.push("Vehicle information not found in the response");}}else{s.push(q.message);}CR.Core.displayExceptions({items:s});},failure:function(q){if(!q.crExceptionItems){q.crExceptionItems=[CR.Core.getHttpStatusMessage(q)];}CR.Core.displayExceptions({title:"Vehicle Valuation",items:q.crExceptionItems});}});};var b=function(t,q,y){var x=function(E,G,F){var H=t.find("crColumnName",E).shift();if(H){if(F&&G){G=G+".00";}H.crSetContents(G||"");}};var D="A";if((q.category&&q.category.indexOf("Motorcycle")>=0)||(q.type&&q.type.indexOf("Motorcycle")>=0)||(q.type&&q.type.indexOf("Side Car")>=0)){D="C";}else{if((q.type&&q.type.indexOf("Boat")>=0)||(q.type&&q.type.indexOf("Personal Watercraft")>=0)){D="B";}else{if(q.type&&q.type.indexOf("Classic Car")>=0){D="A";}else{if(q.category&&q.category.indexOf("RV")>=0){D="M";}else{if(q.type&&q.type.indexOf("Trailers")>=0){D="T";}else{if((q.type&&q.type.indexOf("Outboards")>=0)||(q.type&&q.type.indexOf("Snowmobile")>=0)){D="R";}}}}}}var r=t.find("crColumnName","VIN").shift();if(r){if(typeof r.crGetNewContents==="function"){r=r.crGetNewContents();}else{r=r.crContents;}}x("VEHICLE_CATEGORY",D);x("VIN",q.vin||r);x("VEHICLE_MAKE",q.make||q.manufacture);x("VEHICLE_MODEL",q.model||q.series);x("VEHICLE_BODY_TYPE",q.body||q.trim);x("VEHICLE_YEAR",q.year);x("VEHICLE_ODOMETER",q.mileage||"0");x("VALUATION_DOCUMENT",y);x("VALUATION_DATE",CR.Login.postingDate);if(q.VALUE){function u(F){var E=F||"";E=E.toLowerCase();E=E.replace(/_/g," ");E=E.replace(/\w\S*/g,function(G){return G.charAt(0).toUpperCase()+G.substr(1).toLowerCase();});return E;}function w(G,F){var E=G||"0.00";if(E.indexOf(".")===-1){E+=".00";}if(F){E=CR.MoneyField.convertToDisplay(E);}return E;}var C=q.VALUE;var v=[];for(var B in C){if(C.hasOwnProperty(B)){var s=null;if(CR.VehicleValuation.interfaceRecord.CONTROL_VALUE_7==="Y"){s=CR.VehicleValuation.interfaceRecord.CONTROL_VALUE_10;}else{if(CR.VehicleValuation.interfaceRecord.CONTROL_VALUE_8==="Y"){s=CR.VehicleValuation.interfaceRecord.CONTROL_VALUE_11;}else{if(CR.VehicleValuation.interfaceRecord.CONTROL_VALUE_9==="Y"){s=CR.VehicleValuation.interfaceRecord.CONTROL_VALUE_12;}}}var p=u(B)||"";var A=false;if(s&&s.length>0){A=p.toLowerCase()===s.toLowerCase();}v.push({fieldLabel:p,fieldStyle:"float:right;",boxLabel:w(C[B],true),name:"selectedValue",inputValue:w(C[B]),checked:A});}}var z=new CR.Window({title:"Select Collateral Value",closable:true,autoWidth:false,autoHeight:true,width:350,padding:10,modal:true,layout:"form",defaultType:"radio",labelWidth:200,items:[v],buttons:[{text:"Ok",handler:function(E,G){var F=E.findParentByType(CR.Window);var H=F.find("name","selectedValue");if(!H||H.length===0||!H[0].getGroupValue()){CR.Core.displayExceptions({title:"Select Collateral Value",items:["Please select a value for the Collateral"]});}else{x("AMOUNT",H[0].getGroupValue());F.crClose();}}},{text:"Cancel",handler:function(E,F){E.findParentByType(CR.Window).crClose();}}]});z.crShow();}};var f=function(s,t){s.findParentByType(CR.Window).crClose();n=s.crVehicleValuationType;var r=k.collateralPanel.find("crColumnName","VIN")[0];var p=i.apply({command:"lookup",id:c,type:n,vin:r.crGetNewContents()||r.crContents});var q=window.open(p,"Vehicle Valuation","scrollbars=1,location=0,status=0,menubar=1,resizable=1");l=new Ext.Window({title:"Vehicle Valuation",modal:true,width:250,height:84,bodyStyle:{display:"flex",justifyContent:"center",alignItems:"center"},items:[{xtype:"button",text:"Load Data",width:75,handler:function(){var u=function(){h();q.close();};if(q.closed){u();}else{Ext.Msg.confirm("Vehicle Valuation Load Data","The Vehicle Valuation window is still open.<br>Are you sure you want to load data?",function(v){if(v==="yes"){u();}});}}},{xtype:"container",width:12},{xtype:"button",text:"Cancel",width:75,handler:function(){var u=function(){l.close();q.close();};if(q.closed){u();}else{Ext.Msg.confirm("Vehicle Valuation Cancel","The Vehicle Valuation window is still open.<br>Are you sure you want to cancel?",function(v){if(v==="yes"){u();}});}}}]});if(CR.VehicleValuation.usageSecurityEventSerial){CR.Core.securityCheck({securityEvent:CR.VehicleValuation.usageSecurityEventSerial,callbackFunction:function(){l.show();}});}else{l.show();}};var g=new Ext.Template("{description}");var m=0;var j=[];if(CR.VehicleValuation.interfaceRecord.CONTROL_VALUE_7==="Y"){m++;j.push({xtype:"button",crVehicleValuationType:"NADA",text:"NADA Auto",tooltip:"Automobile Values",width:100,handler:f},{rowspan:2,height:80,html:g.apply({image:"nada-logo.png",description:["<b>National Automobile Dealers Association</b>","<p>Valuation for used cars, trucks, vans and SUVs.</p>","<p>Use Other for personal watercraft, motorcycles, ATVs and Recreation Vehicles.</p>"].join("")})},{xtype:"button",crVehicleValuationType:"NADAOther",text:"NADA Other",tooltip:"RV, Marine, Motor Sport",width:100,handler:f});}if(CR.VehicleValuation.interfaceRecord.CONTROL_VALUE_8==="Y"){m++;j.push({xtype:"button",crVehicleValuationType:"KBBNew",text:"KBB New",tooltip:"New Vehicle Values",width:100,handler:f},{rowspan:2,height:80,html:g.apply({image:"kbb-logo.png",description:"<b>Kelly Blue Book</b><p>Vehicle pricing and values available for new or used vehicles.</p>"})},{xtype:"button",crVehicleValuationType:"KBB",text:"KBB Used",tooltip:"Used Vehicle Values",width:100,handler:f});}if(CR.VehicleValuation.interfaceRecord.CONTROL_VALUE_9==="Y"){m++;j.push({xtype:"button",crVehicleValuationType:"blackbook",text:"Black Book",tooltip:"New or Used Vehicle Values",width:100,handler:f},{rowspan:2,height:80,html:g.apply({image:"blackbook-logo.png",description:"<b>Black Book</b><p>Vehicle pricing and values available for new or used vehicles.</p>"})});}if(m===0){m++;j.push({rowspan:3,height:80,html:g.apply({image:"blackbook-logo.png",description:"<p>At least one of NADA, KBB or BlackBook must set to use</p>"+"<p>Please update the '"+CR.VehicleValuation.interfaceRecord.DESCRIPTION+"' Interface record</p>"})});CR.VehicleValuation.interfaceSerial=undefined;}var a=new CR.Panel({layout:"table",baseCls:"x-plain",layoutConfig:{columns:2},defaults:{style:{margin:"10px"},bodyStyle:"padding: 10px"},items:j});var d=new CR.Window({title:"Vehicle Valuation",closable:true,autoWidth:false,autoHeight:true,width:500,modal:true,items:[a],buttons:[{text:"Cancel",handler:function(p,q){p.findParentByType(CR.Window).crClose();}}]});d.crShow();};CR.VehicleValuationViewer=Ext.extend(CR.Panel,{crValuationDocument:null,crValuationDocumentText:null,crValuationDocumentJSON:null,constructor:function(b){var a=Ext.apply({autoScroll:true,bodyStyle:{font:"12px arial,tahoma,helvetica,sans-serif"}},b);if(!a.text){a.html="<p>Loading...</p>";}CR.VehicleValuationViewer.superclass.constructor.call(this,a);this.addListener("afterrender",function(){if(this.crValuationDocumentText){this.crDisplayValuation(this.crValuationDocumentText);}else{this.crLoadValuationDocument();}});},crLoadValuationDocument:function(){var b=new CR.XML();var g=b.addContainer(b.getRootElement(),"sequence");var f=b.addContainer(g,"transaction");var c=b.addContainer(f,"step");var a=b.addContainer(c,"record");b.addText(a,"tableName",this.crTableName);b.addOption(a,"operation","V");b.addText(a,"targetSerial",this.crTargetSerial);b.addOption(a,"includeTableMetadata","N");b.addOption(a,"includeColumnMetadata","N");b.addOption(a,"includeRowDescriptions","Y");b.addOption(a,"includeAllColumns","N");var d=b.addContainer(a,"field");b.addText(d,"columnName","VALUATION_DOCUMENT");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),scope:this,success:function(j){var h=null;var l="failed";var k=[];var i=CR.JSON.parse(j.responseText);var m=i.query;if(m){Ext.each(m.sequence,function(o){Ext.each(o.transaction,function(p){l=p.$attr.result;Ext.each(p.exception,function(q){k.push(q.message);});Ext.each(p.step,function(q){if(q.tranResult&&q.tranResult.category&&q.tranResult.category.option&&q.tranResult.category.option==="E"){k.push(q.tranResult.description);}else{if(q.record){h=q.record;}}});});});}if(l!=="posted"||k.length>0){CR.Core.displayExceptions({items:k});}else{var n=h.field[0];this.crDisplayValuation(n.newContents);}}});},crDisplayValuation:function(b){if(b){this.crValuationDocumentText=b;this.crValuationDocument=new CR.XML({xmlText:this.crValuationDocumentText});this.crValuationDocumentJSON=this.crValuationDocument.toJSON();var a=this.crGetValuationHTML(this.crValuationDocumentJSON);this.update(a);}else{this.crValuationDocumentText=null;this.crValuationDocument=null;this.crValuationDocumentJSON=null;CR.Core.displayExceptions({title:"Collateral Valuation Document",items:["Valuation Document Not Found"],callbackFunction:function(){if(this.crValuationViewerWindow){this.crValuationViewerWindow.crClose();}},callbackFunctionScope:this});}},crGetValuationHTML:function(c){var b=[];function a(h){var g=h||"";g=g.toLowerCase();g=g.replace(/_/g," ");return g;}function f(h){var g=h||"0.00";if(g.indexOf(".")===-1){g+=".00";}return CR.MoneyField.convertToDisplay(g);}function d(n,h){if(n instanceof Object){for(var r in n){if(n.hasOwnProperty(r)){var q=n[r];var k=q instanceof Array;var l=["EQUIPMENTS","LOOKUP","OPTION","ACCESSORY"];if(r!=="$attr"&&l.indexOf(r)===-1){var j=a(r);if(r==="collateralValuation"){j="Vehicle Valuation";}if(!k||q.length>0){b.push('<h1 class="header">'+j+"</h1>");}}if(r==="$attr"){b.push('<table style="width:100%">');for(var m in q){if(m!=="id"){var o=a(m);var p=q[m];if(h==="VALUE"){p=f(p);}if(m==="date"){p=CR.DateField.convertToDisplay(p);}b.push("<tr>");b.push('<td class="label">'+o+"</td>");b.push('<td class="value">'+p+"</td>");b.push("</tr>");}}b.push("</table>");}else{if(k){var g=q;b.push('<table style="width:100%">');if(g.length>0){for(var i=0;i<g.length;i++){b.push("<tr>");if(typeof g[i]==="string"){b.push('<td class="flat-label">'+g[i]+"</td>");if(i+1<g.length){b.push('<td class="flat-label">'+g[++i]+"</td>");}}else{d(g[i],r);}b.push("</tr>");}}else{b.push("<tr><td>None</td></tr>");}b.push("</table>");}else{d(n[r],r);}}}}}else{if(typeof n==="string"){b.push('<table style="width:100%">');b.push("<tr><td>"+n+"</td></tr>");b.push("</table>");}}}b.push('<div class="cr-vehicleValuation">');d(c);b.push("</div>");return b.join("");},crDeleteValuationDocument:function(){Ext.Msg.confirm("Valuation Document","Are you sure you want to delete the Valuation Document for this Collateral?",function(c){if(c==="yes"){var b=new CR.XML();var h=b.addContainer(b.getRootElement(),"sequence");var g=b.addContainer(h,"transaction");var d=b.addContainer(g,"step");var a=b.addContainer(d,"record");b.addText(a,"tableName",this.crTableName);b.addOption(a,"operation","U");b.addText(a,"targetSerial",this.crTargetSerial);b.addOption(a,"includeTableMetadata","N");b.addOption(a,"includeColumnMetadata","N");b.addOption(a,"includeRowDescriptions","N");b.addOption(a,"includeAllColumns","N");var f=b.addContainer(a,"field");b.addText(f,"columnName","VALUATION_DOCUMENT");b.addOption(f,"operation","S");b.addText(f,"newContents","");var f=b.addContainer(a,"field");b.addText(f,"columnName","VALUATION_DATE");b.addOption(f,"operation","S");b.addText(f,"newContents","");CR.Core.ajaxRequest({url:"DirectXMLPostJSON",xmlData:b.getXMLDocument(),success:function(k){var m="failed";var l=[];var j=CR.JSON.parse(k.responseText);var n=j.query;if(n){Ext.each(n.sequence,function(p){Ext.each(p.transaction,function(q){m=q.$attr.result;Ext.each(q.exception,function(r){l.push(r.message);});Ext.each(q.step,function(r){if(r.tranResult&&r.tranResult.category&&r.tranResult.category.option&&r.tranResult.category.option==="E"){l.push(r.tranResult.description);}});});});}if(m!=="posted"||l.length>0){CR.Core.displayExceptions({items:l});}else{if(this.crCollateralFMPanel){var i=this.crCollateralFMPanel;var o=i.find("crColumnName","VALUATION_DOCUMENT").shift();o.crSetContents("");}Ext.Msg.alert("Status","Changes saved successfully.");}}});}},this);}});CR.CollateralValuationViewButton=Ext.extend(CR.Button,{crShowUnpin:false,crShowInNewBrowser:false,crTargetSerial:"",crRowDescription:"",crTableName:null,crViewColumnName:"VALUATION_DOCUMENT",crOpenInContainer:null,crCollateralFMPanel:null,width:CR.Field.DEFAULT_TEXT_WIDTH,constructor:function(b){var a=Ext.apply({},b);if(!a.text){a.text="View Valuation Document";}CR.CollateralValuationViewButton.superclass.constructor.call(this,a);this.addListener("click",this.crClickListener);},crClickListener:function(){var d=null;var a=this.findParentByType(CR.FMPanel);var f=a.find("crColumnName","VALUATION_DOCUMENT").shift();if(f.crGetNewContents()){d=f.crGetNewContents();}var c=new CR.VehicleValuationViewer({crShowInNewBrowser:this.crShowInNewBrowser,crTableName:this.crTableName,crTargetSerial:this.crTargetSerial,crRowDescription:this.crRowDescription,crViewColumnName:this.crViewColumnName,crValuationDocumentText:d});var b=new CR.Window({title:"Valuation Document",layout:"fit",closable:true,collapsible:true,titleCollapse:true,height:600,width:500,items:[c],buttons:[{text:"Print...",handler:function(g){CR.Panel.printInnerHTML(c.body.dom.innerHTML);}},{text:"Delete",handler:function(g){c.crDeleteValuationDocument();}},{text:"Close",handler:function(g){g.findParentByType(CR.Window).crClose();}}]});b.show();c.crValuationViewerWindow=b;}});Ext.reg("crCollateralValuationViewButton",CR.CollateralValuationViewButton);(function(){function a(g){var h="    ";if(isNaN(parseInt(g))){h=g;}else{switch(g){case 1:h=" ";break;case 2:h="  ";break;case 3:h="   ";break;case 4:h="    ";break;case 5:h="     ";break;case 6:h="      ";break;case 7:h="       ";break;case 8:h="        ";break;case 9:h="         ";break;case 10:h="          ";break;case 11:h="           ";break;case 12:h="            ";break;}}var f=["\n"];for(ix=0;ix<100;ix++){f.push(f[ix]+h);}return f;}function b(){this.step="    ";this.shift=a(this.step);}b.prototype.xml=function(m,g){var i=m.replace(/>\s{0,}</g,"><").replace(/></g,">~::~<").split("~::~"),j=i.length,n=false,l=0,k="",h=0,f=g?a(g):this.shift;for(h=0;h<j;h++){if(i[h].search(/<!/)>-1){k+=f[l]+i[h];n=true;if(i[h].search(/-->/)>-1||i[h].search(/\]>/)>-1||i[h].search(/!DOCTYPE/)>-1){n=false;}}else{if(i[h].search(/-->/)>-1||i[h].search(/\]>/)>-1){k+=i[h];n=false;}else{if(/^<\w/.exec(i[h-1])&&/^<\/\w/.exec(i[h])&&/^<[\w:\-\.\,]+/.exec(i[h-1])===/^<\/[\w:\-\.\,]+/.exec(i[h])[0].replace("/","")){k+=i[h];
if(!n){l--;}}else{if(i[h].search(/<\w/)>-1&&i[h].search(/<\//)===-1&&i[h].search(/\/>/)===-1){k=!n?k+=f[l++]+i[h]:k+=i[h];}else{if(i[h].search(/<\w/)>-1&&i[h].search(/<\//)>-1){k=!n?k+=f[l]+i[h]:k+=i[h];}else{if(i[h].search(/<\//)>-1){k=!n?k+=f[--l]+i[h]:k+=i[h];}else{if(i[h].search(/\/>/)>-1){k=!n?k+=f[l]+i[h]:k+=i[h];}else{if(i[h].search(/<\?/)>-1){k+=f[l]+i[h];}else{if(i[h].search(/xmlns\:/)>-1||i[h].search(/xmlns\=/)>-1){k+=f[l]+i[h];}else{k+=i[h];}}}}}}}}}}return(k[0]==="\n")?k.slice(1):k;};b.prototype.json=function(g,f){var f=f?f:this.step;if(typeof JSON==="undefined"){return g;}if(typeof g==="string"){return JSON.stringify(JSON.parse(g),null,f);}if(typeof g==="object"){return JSON.stringify(g,null,f);}return g;};b.prototype.css=function(m,k){var j=m.replace(/\s{1,}/g," ").replace(/\{/g,"{~::~").replace(/\}/g,"~::~}~::~").replace(/\;/g,";~::~").replace(/\/\*/g,"~::~/*").replace(/\*\//g,"*/~::~").replace(/~::~\s{0,}~::~/g,"~::~").split("~::~"),f=j.length,i=0,l="",h=0,g=k?a(k):this.shift;for(h=0;h<f;h++){if(/\{/.exec(j[h])){l+=g[i++]+j[h];}else{if(/\}/.exec(j[h])){l+=g[--i]+j[h];}else{if(/\*\\/.exec(j[h])){l+=g[i]+j[h];}else{l+=g[i]+j[h];}}}}return l.replace(/^\n{1,}/,"");};function d(g,f){return f-(g.replace(/\(/g,"").length-g.replace(/\)/g,"").length);}function c(g,f){return g.replace(/\s{1,}/g," ").replace(/ AND /ig,"~::~"+f+f+"AND ").replace(/ BETWEEN /ig,"~::~"+f+"BETWEEN ").replace(/ CASE /ig,"~::~"+f+"CASE ").replace(/ ELSE /ig,"~::~"+f+"ELSE ").replace(/ END /ig,"~::~"+f+"END ").replace(/ FROM /ig,"~::~FROM ").replace(/ GROUP\s{1,}BY/ig,"~::~GROUP BY ").replace(/ HAVING /ig,"~::~HAVING ").replace(/ IN /ig," IN ").replace(/ JOIN /ig,"~::~JOIN ").replace(/ CROSS~::~{1,}JOIN /ig,"~::~CROSS JOIN ").replace(/ INNER~::~{1,}JOIN /ig,"~::~INNER JOIN ").replace(/ LEFT~::~{1,}JOIN /ig,"~::~LEFT JOIN ").replace(/ RIGHT~::~{1,}JOIN /ig,"~::~RIGHT JOIN ").replace(/ ON /ig,"~::~"+f+"ON ").replace(/ OR /ig,"~::~"+f+f+"OR ").replace(/ ORDER\s{1,}BY/ig,"~::~ORDER BY ").replace(/ OVER /ig,"~::~"+f+"OVER ").replace(/\(\s{0,}SELECT /ig,"~::~(SELECT ").replace(/\)\s{0,}SELECT /ig,")~::~SELECT ").replace(/ THEN /ig," THEN~::~"+f+"").replace(/ UNION /ig,"~::~UNION~::~").replace(/ USING /ig,"~::~USING ").replace(/ WHEN /ig,"~::~"+f+"WHEN ").replace(/ WHERE /ig,"~::~WHERE ").replace(/ WITH /ig,"~::~WITH ").replace(/ ALL /ig," ALL ").replace(/ AS /ig," AS ").replace(/ ASC /ig," ASC ").replace(/ DESC /ig," DESC ").replace(/ DISTINCT /ig," DISTINCT ").replace(/ EXISTS /ig," EXISTS ").replace(/ NOT /ig," NOT ").replace(/ NULL /ig," NULL ").replace(/ LIKE /ig," LIKE ").replace(/\s{0,}SELECT /ig,"SELECT ").replace(/\s{0,}UPDATE /ig,"UPDATE ").replace(/ SET /ig," SET ").replace(/~::~{1,}/g,"~::~").split("~::~");}b.prototype.sql=function(r,h){var o=r.replace(/\s{1,}/g," ").replace(/\'/ig,"~::~'").split("~::~"),m=o.length,k=[],q=0,i=this.step,s=true,l=false,g=0,n="",j=0,f=h?a(h):this.shift;for(j=0;j<m;j++){if(j%2){k=k.concat(o[j]);}else{k=k.concat(c(o[j],i));}}m=k.length;for(j=0;j<m;j++){g=d(k[j],g);if(/\s{0,}\s{0,}SELECT\s{0,}/.exec(k[j])){k[j]=k[j].replace(/\,/g,",\n"+i+i+"");}if(/\s{0,}\s{0,}SET\s{0,}/.exec(k[j])){k[j]=k[j].replace(/\,/g,",\n"+i+i+"");}if(/\s{0,}\(\s{0,}SELECT\s{0,}/.exec(k[j])){q++;n+=f[q]+k[j];}else{if(/\'/.exec(k[j])){if(g<1&&q){q--;}n+=k[j];}else{n+=f[q]+k[j];if(g<1&&q){q--;}}}var p=0;}n=n.replace(/^\n{1,}/,"").replace(/\n{1,}/g,"\n");return n;};b.prototype.xmlmin=function(h,f){var g=f?h:h.replace(/\<![ \r\n\t]*(--([^\-]|[\r\n]|-[^\-])*--[ \r\n\t]*)\>/g,"").replace(/[ \r\n\t]{1,}xmlns/g," xmlns");return g.replace(/>\s{0,}</g,"><");};b.prototype.jsonmin=function(f){if(typeof JSON==="undefined"){return f;}return JSON.stringify(JSON.parse(f),null,0);};b.prototype.cssmin=function(h,f){var g=f?h:h.replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*+\//g,"");return g.replace(/\s{1,}/g," ").replace(/\{\s{1,}/g,"{").replace(/\}\s{1,}/g,"}").replace(/\;\s{1,}/g,";").replace(/\/\*\s{1,}/g,"/*").replace(/\*\/\s{1,}/g,"*/");};b.prototype.sqlmin=function(f){return f.replace(/\s{1,}/g," ").replace(/\s{1,}\(/,"(").replace(/\s{1,}\)/,")");};window.vkbeautify=new b();})();Ext.namespace("CR.IMM");CR.IMM.eSign={openESignURL:function(a){a=Ext.apply({tableName:"",targetSerial:"",eSignFunction:"",callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},a);var b={EndpointName:CR.Login.locationName,EndpointPassword:"{ENDPOINT_PASSWORD}",SerialType:a.tableName,SerialNum:a.targetSerial,UserID:CR.Login.userSerial,UserName:CR.Login.userName,BranchID:CR.Login.branchSerial,BranchName:CR.Login.branchName,Function:a.eSignFunction};if(a.loanRequestSerial){b.SerialNum2=a.loanRequestSerial;}if(a.accountSerial){b.SerialNum3=a.accountSerial;}CR.Core.ajaxRequest({url:"IMMeSign/eSignURL",jsonData:b,success:function(d){var c=CR.JSON.parse(d.responseText);if(c.Status==="Success"&&c.Url){CR.IMM.crHandleCustomProtocol({url:c.Url});a.callbackArgs.eSignURL=c.Url;a.callbackFunction.call(a.callbackScope,a.callbackArgs);}else{CR.Core.displayExceptions({title:"IMMeSign Service",items:[c.ErrorMessage||"Unknown Error"]});}}});}};CR.IMM.crHandleCustomProtocol=function(a){if(a&&a.url){var d=a.url.replace(/(\w+):\/\/.+/,"$1");d=d.toLowerCase();if(d==="http"||d==="https"){window.open(a.url,"_blank");}else{var b=document.createElement("a");b.href=a.url;var c=new Ext.Window({items:[{xtype:"component",el:new Ext.Element(b)}]});c.show();b.click();c.close();}}};if(CR.Interface){CR.IMM.eSign.interfaceFound=undefined;CR.IMM.eSign.checkForInterface=function(a){a=Ext.apply({callbackFunction:CR.Core.emptyFunction,callbackScope:this,callbackArgs:{}},a);CR.Interface.getInterface({product:"IMM_ESIGN_URL",callbackFunction:function(b){CR.IMM.eSign.interfaceFound=false;var c=[];if(b.interfaceResult&&b.interfaceResult.record){CR.IMM.eSign.interfaceFound=true;}if(c.length>0){CR.Core.displayExceptions({title:"IMM eSign URL Interface",items:c});}else{a.callbackFunction.call(a.callbackScope,a.callbackArgs);}}});};}CR.Jaspersoft={messageReceiver:function(g){var f=g.data;var a=g.origin;if(CR.Login.jaspersoftBaseURL){if(f){if(typeof f==="string"){f=CR.JSON.parse(f);}if(a===CR.Login.jaspersoftBaseURL){if(f.success||f.refresh){if(CR.Login.jaspersoftConfirmationWin){CR.Login.jaspersoftConfirmationWin.close();CR.Login.jaspersoftConfirmationWin=null;}if(CR.Login.jaspersoftBaseURL.substring(0,5)==="https"){CR.Storage.setItem("successfulJaspersoftHTTPSLogon",f.success);}if(f.refresh&&(f.containerId||f.id)){var d=Ext.getCmp(f.containerId||f.id);d.body.update('<iframe src="'+d.crJaspersoftUrl+'" '+'width="100%" height="100%" frameborder="0" scrolling="auto">'+"<p>Your browser doesn't support iframes.</p></iframe>");}}else{var h=null;if(f.containerId||f.id){var b=Ext.getCmp(f.containerId||f.id);if(b){h=b.body;}}var c=[];if(f.errors&&f.errors.length>0){c=c.concat(f.errors);}if(f.message){c.push(f.message);}CR.Core.displayExceptions({renderTo:h,title:"Jaspersoft Access Error",items:c});}}}}},display:function(c){c=Ext.apply({workArea:"mainPage",report:null,dashboard:null,sso:null,decorate:false,parameters:{},container:"_blank"},c);c.report=c.report||c.reportUnit||"";c.dashboard=c.dashboard||c.dashboardResource||"";c.parameters=Ext.apply({"KeyStone_workArea":c.workArea,"KeyStone_userSerial":CR.Login.userSerial,"KeyStone_branchSerial":CR.Login.branchSerial,"KeyStone_deviceSerial":CR.Login.deviceSerial,"KeyStone_postingDate":CR.Login.postingDate},c.parameters||{});function b(j){j=j||"";var k="";for(var i in c.parameters){if(c.parameters.hasOwnProperty(i)){k+="&";k+=encodeURIComponent(j+i)+"=";k+=encodeURIComponent(c.parameters[i]);}}return k;}function f(k){var m="Jaspersoft/display";m+="?j_base_url="+encodeURIComponent(CR.Login.jaspersoftBaseURL);m+="&j_internal_base_url="+encodeURIComponent(CR.Login.jaspersoftInternalBaseURL);m+="&j_url="+encodeURIComponent("/jasperserver-pro");m+="&j_username="+encodeURIComponent(CR.Login.adHocReportingUserName);m+="&j_password="+encodeURIComponent(CR.Login.adHocReportingPassword);m+="&orgId="+encodeURIComponent(CR.Login.databaseName.toLowerCase());m+="&userLocale="+encodeURIComponent("en_US");m+="&postingDate="+encodeURIComponent(CR.Login.postingDate);var j="";if(k.container&&k.container!=="_none"){var i=k.container;if(typeof k.container==="string"){i=Ext.getCmp(k.container);}if(i){if(i.id){j=i.id;}else{if(typeof i.getId==="function"){j=i.getId();}}}}m+="&containerId="+encodeURIComponent(j);m+=b();if(k.dashboard){m+="&dashboard="+encodeURIComponent(k.dashboard);var l=CR.Login.jaspersoftBaseURL+"/jasperserver-pro";l+="/flow.html?_flowId=dashboardRuntimeFlow&decorate=no&dashboardResource=";if(k.dashboard[0]!=="/"){l+="/Dashboards/";}l+=k.dashboard;l+=b("hidden_");m+="&redirectUrl="+encodeURIComponent(l);}else{if(k.report){m+="&report="+encodeURIComponent(k.report);}else{if(k.sso){m+="&sso="+encodeURIComponent(k.sso);}}}if(window.CRDebug===true){m+="&debug=true";}return m;}var h=f(c);if(c.container&&c.container!=="_none"){var a=null;if(typeof c.container==="string"){if(c.container==="_blank"){var d=window.open("");d.document.write('<html><body><iframe src="'+h+'" '+'width="100%" height="100%" frameborder="0" scrolling="auto">'+"<p>Your browser doesn't support iframes.</p></iframe></body></html>");d.document.close();}else{if(c.container==="_self"){window.location=h;}else{a=Ext.getCmp(c.container);}}}else{a=c.container;}if(a){a.crJaspersoftUrl=h;CR.Core.defer(function(){if(a.body&&a.body.update){a.body.update('<iframe src="'+h+'" '+'width="100%" height="100%" frameborder="0" scrolling="auto">'+"<p>Your browser doesn't support iframes.</p></iframe>");}},a);}}var g=CR.Storage.getItem("successfulJaspersoftHTTPSLogon");if(window.location.href.indexOf("localhost:")===-1&&(g==="null"||g==="false")){if(c.dashboard){window.open(f(Ext.apply(c,{dashboard:null,sso:"/flow.html?_flowId=searchFlow&mode=search&filterId=resourceTypeFilter&filterOption=resourceTypeFilter-reports"})));}else{window.open(h);}}CR.Storage.setItem("successfulJaspersoftHTTPSLogon",false);return h;}};if(window.top===window.self&&CR.Core&&!CR.Script){window.addEventListener("message",CR.Jaspersoft.messageReceiver,false);}